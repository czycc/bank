window.TILE_VERSION={"ditu":{"normal":{"version":"088","updateDate":"20200429"},"satellite":{"version":"009","updateDate":"20200429"},"normalTraffic":{"version":"081","updateDate":"20200429"},"satelliteTraffic":{"version":"083","updateDate":"20200429"},"mapJS":{"version":"104","updateDate":"20200429"},"satelliteStreet":{"version":"083","updateDate":"20200429"},"earthVector":{"version":"001","updateDate":"20200429"}},"webapp":{"high_normal":{"version":"001","updateDate":"20200429"},"lower_normal":{"version":"002","updateDate":"20200429"}},"api_for_mobile":{"vector":{"version":"002","updateDate":"20200429"},"vectorIcon":{"version":"002","updateDate":"20200429"}}};window.MSV={"mapstyle":{"updateDate":"20200428","version":"001"}};window.BMAP_AUTHENTIC_KEY="gUC2qbHdnXaCcKwG8SRzbz6GCciw3T9h";window.BMapGL=window.BMapGL||{};(function(aU,dx){var A=A||{version:"20150702",emptyFn:function(){}};(function(){A._log=[];var i=0;var gi={};A.BaseClass=function(gj){gi[(this.hashCode=(gj||A.BaseClass.guid()))]=this};A.BaseClass.guid=function(){return"mz_"+(i++).toString(36)};A.BaseClass.create=function(){var gj=new A.BaseClass();gj.decontrol();return gj};var e=A.instance=A.I=function(gj){return gi[gj]};A.BaseClass.prototype.dispose=function(){if(this.hashCode){delete gi[this.hashCode]}for(var gj in this){if(typeof this[gj]!="function"){delete this[gj]}}};A.BaseClass.prototype.getHashCode=function(){if(!this.hashCode){gi[(this.hashCode=A.BaseClass.guid())]=this}return this.hashCode};A.BaseClass.prototype.decontrol=function(){delete gi[this.hashCode]};A.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};A.BaseClass.prototype._wlog=function(gk,gl){var gj=A._log;if(gj.length>100){gj.reverse().length=50;gj.reverse()}gj[gj.length]="["+gk+"]["+(this._className||"Object")+" "+this.hashCode+"] "+gl}})();Function.prototype.inherits=function(gj,gi){var e,gk,gm=this.prototype,gl=function(){};gl.prototype=gj.prototype;gk=this.prototype=new gl();if(typeof(gi)=="string"){gk._className=gi}for(e in gm){gk[e]=gm[e]}this.prototype.constructor=gm.constructor;gm=gl=null;return gk};A.BaseEvent=function(e,i){this.type=e;this.returnValue=true;this.target=i||null;this.currentTarget=this.srcElement=null;this.cancelBubble=false;this.domEvent=null};A.BaseClass.prototype.on=A.BaseClass.prototype.addEventListener=function(gi,i){if(typeof i!=="function"){return this._wlog("error","addEventListener:"+i+" is not a function")}if(!this._listeners){this._listeners={}}var e=this._listeners;if(gi.indexOf("on")!==0){gi="on"+gi}if(typeof e[gi]!=="object"){e[gi]={}}var gj=i.hashCode||A.BaseClass.guid();i.hashCode=gj;if(e[gi][gj]){this._wlog("warning","repeat key:"+gj)}e[gi][gj]=i};A.BaseClass.prototype.off=A.BaseClass.prototype.removeEventListener=function(gi,i){if(typeof i=="function"){i=i.hashCode}else{if(typeof i!="string"){return}}if(!this._listeners){this._listeners={}}if(gi.indexOf("on")!=0){gi="on"+gi}var e=this._listeners;if(!e[gi]){return}if(e[gi][i]){delete e[gi][i]}};A.BaseClass.prototype.fire=A.BaseClass.prototype.dispatchEvent=function(gj){if(!this._listeners){this._listeners={}}var gi,e=this._listeners,gk=gj.type;gj.target=gj.srcElement=gj.target||gj.srcElement||this;gj.currentTarget=this;if(typeof this[gk]=="function"){this[gk](gj)}if(typeof e[gk]=="object"){for(gi in e[gk]){if(typeof e[gk][gi]=="function"){e[gk][gi].call(this,gj)}}}return gj.returnValue};A.BaseEvent.prototype.inherit=function(gi){var i=this;this.domEvent=gi=window.event||gi;i.clientX=gi.clientX||gi.pageX;i.clientY=gi.clientY||gi.pageY;i.offsetX=gi.offsetX||gi.layerX;i.offsetY=gi.offsetY||gi.layerY;i.screenX=gi.screenX;i.screenY=gi.screenY;i.ctrlKey=gi.ctrlKey||gi.metaKey;i.shiftKey=gi.shiftKey;i.altKey=gi.altKey;return i};A.Browser=(function(){var gi=navigator.userAgent;var gk=0;var e=0;var gl=0;var i=0;var gp=0;var gn=0;var go=0;var gm=0;var gj=0;var gq=0;if(typeof window.opera==="object"&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(gi)){gl=parseFloat(RegExp.$2)}else{if(/OPR(\/(\d+)(\..?)?)/.test(gi)){gl=parseInt(RegExp.$2,10)}else{if(/Edge\/((\d+)\.\d+)/.test(gi)){gk=parseInt(RegExp.$2,10)}else{if(/MSIE (\d+(\.\d+)?)/.test(gi)){e=parseFloat(RegExp.$1)}else{if(gi.indexOf("Trident")>-1&&/rv:(\d+(\.\d+)?)/.test(gi)){e=parseInt(RegExp.$1,10)}else{if(/Firefox(\s|\/)(\d+(\.\d+)?)/.test(gi)){gp=parseFloat(RegExp.$2)}else{if(navigator.vendor==="Netscape"&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(gi)){go=parseFloat(RegExp.$2)}else{if(gi.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(gi)){i=parseFloat(RegExp.$1)}}}}}}}}if(gi.indexOf("Trident")>-1&&/Trident\/(\d+(\.\d+)?)/.test(gi)){gm=parseInt(RegExp.$1,10)}else{if(!e&&!gk&&gi.indexOf("Gecko")>-1&&gi.indexOf("KHTML")===-1&&/rv\:(\d+(\.\d+)?)/.test(gi)){gj=parseFloat(RegExp.$1)}else{if(!gk&&/chrome\/(\d+(\.\d+)?)/i.test(gi)){gn=parseFloat(RegExp.$1)}else{if(!gk&&/AppleWebKit\/(\d+(\.\d+)?)/.test(gi)){gq=parseInt(RegExp.$1,10)}}}}var gr={edge:gk,ie:e,firefox:gp,netscape:go,opera:gl,safari:i,chrome:gn,gecko:gj,trident:gm,webkit:gq};return gr})();window.FeBrowser=A.Browser;A.Dom={};A.Dom.createDom=function(i,e){if(A.isIE&&e&&e.name){i="<"+i+' name="'+A.String.escapeHTML(e.name)+'">'}var gi=document.createElement(i);if(e){A.Dom.setProperties(gi,e)}return gi};A.Dom.getOffset=function(gj){var gm=A.Dom.getOwnerDocument(gj);var gl=A.isGecko>0&&gm.getBoxObjectFor&&A.Dom.getStyle(gj,"position")=="absolute"&&(gj.style.top===""||gj.style.left==="");var gn={left:0,top:0};var i=(A.isIE&&!A.isStrict)?gm.body:gm.documentElement;if(gj==i){return gn}var gi=null;var gk;if(gj.getBoundingClientRect){gk=gj.getBoundingClientRect();gn.left=gk.left+Math.max(gm.documentElement.scrollLeft,gm.body.scrollLeft);gn.top=gk.top+Math.max(gm.documentElement.scrollTop,gm.body.scrollTop);gn.left-=gm.documentElement.clientLeft;gn.top-=gm.documentElement.clientTop;if(A.isIE&&!A.isStrict){gn.left-=2;gn.top-=2}}else{if(gm.getBoxObjectFor&&!gl){gk=gm.getBoxObjectFor(gj);var e=gm.getBoxObjectFor(i);gn.left=gk.screenX-e.screenX;gn.top=gk.screenY-e.screenY}else{gi=gj;do{gn.left+=gi.offsetLeft;gn.top+=gi.offsetTop;if(A.isWebkit>0&&A.Dom.getStyle(gi,"position")=="fixed"){gn.left+=gm.body.scrollLeft;gn.top+=gm.body.scrollTop;break}gi=gi.offsetParent}while(gi&&gi!=gj);if(A.isOpera>0||(A.isWebkit>0&&A.Dom.getStyle(gj,"position")=="absolute")){gn.top-=gm.body.offsetTop}gi=gj.offsetParent;while(gi&&gi!=gm.body){gn.left-=gi.scrollLeft;if(!A.isOpera||gi.tagName!="TR"){gn.top-=gi.scrollTop}gi=gi.offsetParent}}}return gn};A.Dom.getOwnerDocument=function(e){return e.nodeType==9?e:e.ownerDocument||e.document};A.Dom.setProperties=function(i,e){A.each(e,function(gj,gi){A.Dom._setProperty(i,gi,gj)})};A.Dom._setProperty=function(i,e,gi){if(e=="style"){i.style.cssText=gi}else{if(e=="class"){i.className=gi}else{if(e=="for"){i.htmlFor=gi}else{if(e in A.Dom._DIRECT_ATTRIBUTE_MAP){i.setAttribute(A.Dom._DIRECT_ATTRIBUTE_MAP[e],gi)}else{i[e]=gi}}}}};A.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"};A.G=function(){for(var gi=[],gj=arguments.length-1;gj>-1;gj--){var gk=arguments[gj];gi[gj]=null;if(typeof gk=="object"&&gk&&gk.dom){gi[gj]=gk.dom}else{if((typeof gk=="object"&&gk&&gk.tagName)||gk==window||gk==document){gi[gj]=gk}else{if(typeof gk=="string"&&(gk=document.getElementById(gk))){gi[gj]=gk}}}}return gi.length<2?gi[0]:gi};A.ac=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);if(!new RegExp("(^| )"+i.replace(/(\W)/g,"\\$1")+"( |$)").test(e.className)){e.className=e.className.split(/\s+/).concat(i).join(" ")}};A.addClassName=A.ac;A.each=function(gl,e){if(typeof e!="function"){return gl}if(gl){if(gl.length===undefined){for(var gi in gl){e.call(gl[gi],gl[gi],gi)}}else{for(var gj=0,gk=gl.length;gj<gk;gj++){e.call(gl[gj],gl[gj],gj)}}}return gl};A.extend=function(gl,gj){if(gl&&gj&&typeof(gj)=="object"){for(var gk in gj){gl[gk]=gj[gk]}var gi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];for(var e=0,i;e<gi.length;e++){i=gi[e];if(Object.prototype.hasOwnProperty.call(gj,i)){gl[i]=gj[i]}}}return gl};A.hide=function(){A.each(arguments,function(e){if(e=A.G(e)){e.style.display="none"}})};A.inherit=function(gn,gj,gi){var gm=gn.prototype;var gl=function(){};gl.prototype=gj.prototype;var gk=gn.prototype=new gl();if(typeof gi=="string"){gk._className=gi}for(var e in gm){gk[e]=gm[e]}gn.prototype.constructor=gm.constructor;gm=null;return gk};A.isIE=0;(function(){if(navigator.userAgent.indexOf("MSIE")>0&&!window.opera){/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent);A.isIE=parseFloat(RegExp.$1)}})();A.rc=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);var gi=e.className.replace(new RegExp("(^| +)"+i.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");if(e.className!=gi){e.className=gi}};A.removeClassName=A.rc;A.show=function(){this.each(arguments,function(e){if(e=A.G(e)){e.style.display=""}})};A.trim=function(e){return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")};if(typeof HTMLElement!="undefined"&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera){try{HTMLElement.prototype.__defineGetter__("children",function(){for(var gi=[],gj=0,gl,gk=0,e=this.childNodes.length;gk<e;gk++){gl=this.childNodes[gk];if(gl.nodeType==1){gi[gj++]=gl;if(gl.name){if(!gi[gl.name]){gi[gl.name]=[]}gi[gl.name][gi[gl.name].length]=gl}if(gl.id){gi[gl.id]=gl}}}return gi})}catch(fe){}}if(typeof(HTMLElement)!="undefined"&&!window.opera&&HTMLElement.prototype&&!HTMLElement.prototype.insertAdjacentHTML){HTMLElement.prototype.insertAdjacentHTML=function(i,gi){var gj=this.ownerDocument.createRange();gj.setStartBefore(this);gj=gj.createContextualFragment(gi);switch(i){case"beforeBegin":this.parentNode.insertBefore(gj,this);break;case"afterBegin":this.insertBefore(gj,this.firstChild);break;case"beforeEnd":this.appendChild(gj);break;case"afterEnd":if(!this.nextSibling){this.parentNode.appendChild(gj)}else{this.parentNode.insertBefore(gj,this.nextSibling)}break}}}if(typeof HTMLElement!="undefined"&&!window.opera){HTMLElement.prototype.contains=function(e){if(e==this){return true}while(e=e.parentNode){if(e==this){return true}}return false}}if(!A.Browser.ie&&typeof Event!="undefined"&&!window.opera){Event.prototype.__defineSetter__("returnValue",function(e){if(!e){this.preventDefault()}return e});Event.prototype.__defineSetter__("cancelBubble",function(e){if(e){this.stopPropagation()}return e})}A.each=function(gk,gj){if(bn(gj)){for(var gi=0,e=gk.length;gi<e;gi++){if(gj.call(gk,gk[gi],gi)===false){break}}}return gk};A.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var fa in A.Platform){if(A.Platform.hasOwnProperty(fa)){A.Platform[fa]=new RegExp(fa,"i").test(window.navigator.userAgent)?1:0}}if(typeof(A.Dom)==="undefined"){A.Dom={}}A.Dom.getComputedStyle=function(i,e){var gj=i.nodeType==9?i:i.ownerDocument||i.document,gi;if(gj.defaultView&&gj.defaultView.getComputedStyle){gi=gj.defaultView.getComputedStyle(i,null);if(gi){return gi[e]||gi.getPropertyValue(e)}}else{if(i.currentStyle){return i.currentStyle[e]||""}}return""};var aM=A.BaseEvent;var dc=A.BaseClass;dc.prototype.toString=function(){return this._className||""};A.on=function(gi,i,e){if(!(gi=A.G(gi))){return gi}i=i.replace(/^on/,"");if(gi.addEventListener){gi.addEventListener(i,e,false)}else{if(gi.attachEvent){gi.attachEvent("on"+i,e)}}return gi};A.un=function(gi,i,e){if(!(gi=A.G(gi))){return gi}i=i.replace(/^on/,"");if(gi.removeEventListener){gi.removeEventListener(i,e,false)}else{if(gi.detachEvent){gi.detachEvent("on"+i,e)}}return gi};A.hc=function(gj,gi){if(!gj||!gj.className||typeof gj.className!="string"){return false}var i=-1;try{i=gj.className==gi||gj.className.search(new RegExp("(\\s|^)"+gi+"(\\s|$)"))}catch(gk){return false}return i>-1};A.isEmptyObject=function(gi){if(Object.prototype.toString.call(gi)==="[object Object]"){for(var e in gi){return false}return true}else{return false}};var dQ={mapStyleNameIdPair:{"default":0,"grayed-out":1},mapHost:"https://map.baidu.com",apiHost:"https://api.map.baidu.com",staticHost:"//webmap0.bdimg.com",imgPath:"//webmap0.bdimg.com/image/api/",tileDomain:["https://maponline0.bdimg.com","https://maponline1.bdimg.com","https://maponline2.bdimg.com","https://maponline3.bdimg.com"],optDomain:"http://10.120.25.45:8017",rasterTilePath:"/tile/",vectorTilePath:"/pvd/",originTilePath:["https://pcor.baidu.com"],getIconSetPath:function(e){var i="map_icons2x/";if(typeof e==="string"&&this.mapStyleNameIdPair[e]>0){i="map_icons2x_"+(this.mapStyleNameIdPair[e]-1)+"/"}return"https://maponline0.bdimg.com/sty/"+i},getMapStyleFiles:function(gi){var gk=true;if(typeof gi==="string"&&gi!=="default"){gk=false}var gl=gk?"":"_"+(this.mapStyleNameIdPair[gi]-1);var i=ep();var gj="udt="+i.udt+"&v="+i.ver;var e="https://maponline0.bdimg.com/sty/";return[e+"icons_2x"+gl+".js?"+gj,e+"fs"+gl+".js?"+gj,e+"indoor_fs.js?"+gj]},tvc:{ditu:{normal:{version:"088",updateDate:"20190618"},satellite:{version:"009",updateDate:"20190618"},normalTraffic:{version:"081",updateDate:"20190618"},satelliteTraffic:{version:"083",updateDate:"20190618"},mapJS:{version:"104",updateDate:"20190618"},satelliteStreet:{version:"083",updateDate:"20190618"},panoClick:{version:"1033",updateDate:"20180108"},panoUdt:{version:"20180108",updateDate:"20180108"},panoSwfAPI:{version:"20150123",updateDate:"20150123"},panoSwfPlace:{version:"20141112",updateDate:"20141112"},earthVector:{version:"001",updateDate:"20190618"}}},msv:{mapstyle:{updateDate:"20190108",version:"001"}}};dQ.imgResources={blankGIF:dQ.staticHost+"/res/litemapapi/v1d1/images/blank.gif?20170501",markerPng:dQ.staticHost+"/res/litemapapi/v1d1/images/marker.png?20170501",locPng:dQ.staticHost+"/res/litemapapi/v1d1/images/loc.png?20180918",locNewPng:dQ.staticHost+"/res/litemapapi/v1d1/images/loc_new.png?20190314",zoomPng:dQ.staticHost+"/res/litemapapi/v1d1/images/zoombtn.png?20180918",mapLogoPng:dQ.staticHost+"/res/litemapapi/v1d1/images/logo-2x.png?20190226"};var dX=dQ;var aG="ruler.cur";if(A.Browser.ie||A.Browser.edge){A.extend(dX,{distCursor:"url("+dX.imgPath+aG+"),crosshair",defaultCursor:"url("+dX.imgPath+"openhand.cur),default",draggingCursor:"url("+dX.imgPath+"closedhand.cur),move"})}else{if(A.Browser.firefox){A.extend(dX,{distCursor:"url("+dX.imgPath+aG+"),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"})}else{if(A.Browser.chrome||A.Browser.safari){A.extend(dX,{distCursor:"url("+dX.imgPath+aG+") 2 6,crosshair",defaultCursor:"url("+dX.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+dX.imgPath+"closedhand.cur) 8 8,move"});if(A.Platform.macintosh){dX.defaultCursor="-webkit-grab";dX.draggingCursor="-webkit-grabbing"}}else{A.extend(dX,{distCursor:"url("+dX.imgPath+aG+"),crosshair",defaultCursor:"url("+dX.imgPath+"openhand.cur),default",draggingCursor:"url("+dX.imgPath+"closedhand.cur),move"})}}}aU=aU||{};aU.version="3.0";aU._register=[];aU.register=function(e){this._register[this._register.length]=e};aU.guid=1;aU.getGUID=function(e){return(e||"")+aU.guid++};var eX=window.BMAP_AUTHENTIC_KEY||"";aU.bmapVerifyCbk=function(e){if(e&&e.error!==0){if(typeof map!=="undefined"){map.getContainer().innerHTML="";map.__listeners={}}aU=null;var i="百度未授权使用地图API，可能是因为您提供的密钥不是有效的百度LBS开放平台密钥，或此密钥未对本应用的百度地图JavaScriptAPI授权。您可以访问如下网址了解如何获取有效的密钥：http://lbsyun.baidu.com/apiconsole/key#。";switch(e.error){case 101:i="开发者禁用了该ak的jsapi服务权限。您可以访问如下网址了解如何获取有效的密钥：http://lbsyun.baidu.com/apiconsole/key#。";break;case 102:i="开发者Referer不正确。您可以访问如下网址了解如何获取有效的密钥：http://lbsyun.baidu.com/apiconsole/key#。";break}alert(i)}};aU.verify=function(){var e=dX.apiHost+"/?qt=verify&ak="+eX+"&callback="+dx+".bmapVerifyCbk";fR.load(e)};aU.apiLoad=aU.apiLoad||function(){};function ey(i,e){this._size=i;this._cache=[];this._totalGetTimes=0;this._totalHitTimes=0;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var gi in e){if(e.hasOwnProperty(gi)){this._options[gi]=e[gi]}}}ey.prototype.setData=function(gi,gj){var e=this._cache;var i=this._size;if(i===0){return}if(e.length>i){this._removeOld()}if(!e[gi]){e.push(gj)}e[gi]=gj;gj._key_=gi};ey.prototype.getHitRate=function(){return Math.round(this._totalHitTimes/this._totalGetTimes*1000)/1000};ey.prototype.getData=function(i){var e=this._cache[i];if(e){this._totalHitTimes++}this._totalGetTimes++;return e};ey.prototype.removeData=function(gk){if(this._options.clearCallback){this._options.clearCallback(this._cache[gk])}var gi=this._cache;var gl=gi[gk];for(var gj=0,e=gi.length;gj<e;gj++){if(gi[gj]===gl){gi.splice(gj,1);break}}delete gi[gk]};ey.prototype._removeOld=function(){var e=this._cache;var gk=Math.round(this._size*0.6);for(var gj=0;gj<gk;gj++){var gi=e[gj]._key_;if(this._options.clearCallback){this._options.clearCallback(e[gi])}delete e[gi]}e.splice(0,gk);if(this._options.removeOldCallback){this._options.removeOldCallback()}};ey.prototype.clear=function(){var gi=this._cache;for(var gk=0,e=gi.length;gk<e;gk++){var gj=gi[gk]._key_;if(this._options.clearCallback){this._options.clearCallback(gi[gj])}delete gi[gj]}this._cache=gi=[]};ey.prototype.forEach=function(gj){var gi=this._cache;for(var gl=0,e=gi.length;gl<e;gl++){var gk=gi[gl]._key_;gj(gi[gk])}};ey.prototype.getBatch=function(gk){var e=[];for(var gj=0,gi=gk.length;gj<gi;gj++){if(this.getData(gk[gj])){e[e.length]=this.getData(gk[gj])}}return e};ey.prototype.clearExcept=function(gl){var gi=this._cache;for(var e=gi.length,gk=e-1;gk>=0;gk--){var gj=this._cache[gk]._key_;if(!gl[gj]){gi.splice(gk,1);if(this._options.clearCallback){this._options.clearCallback(gi[gj])}delete gi[gj]}}};ey.prototype.getDataCount=function(){return this._cache.length};function ac(){}A.extend(ac.prototype,{centerAndZoomIn:function(go,gi,gp){var gm=this;if(!go&&!gi){return}go=go||this.centerPoint;gi=gi||this.zoomLevel;gi=this._getProperZoom(gi).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAPGL_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function gn(){gm._earth=new aU.Earth(gm,{showRealSunlight:gm.config.showRealSunlight,showMilkyway:gm.config.showMilkyway,earthBackground:gm.config.earthBackground});gm._proxyEarthEvents();gm._changeEarthMapType(BMAP_EARTH_MAP);A.extend(gm,aU.EarthView.prototype);if(!gm._navigationCtrl&&gm.config.showControls){gm._navigationCtrl=new aU.NavigationControl3D(gm)}delete gm.temp.originMapType}da.load("earth",function(){if(aU["FeatureStyle"+gm.config.style]){gn()}else{gm.loadMapStyleFiles(function(){gn()})}})}}this.lastLevel=this.zoomLevel||gi;this.zoomLevel=gi;var gk=new aM("onload");gk.point=go;gk.zoom=gi;this.centerPoint=this.restrictCenter(new fX(go.lng,go.lat));if(this.centerPoint.zoom){this.zoomLevel=this.centerPoint.zoom}this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var gl=new ck(i,"baidu",this.mapType);var gj=new b8({mapType:this.mapType,copyright:gl,customLayer:false,baseLayer:true,tileTypeName:"web"});gj._isInnerLayer=true;this.addTileLayer(gj);if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}}this.dispatchEvent(gk);this.loaded=true;gp=gp||{};gp.callback&&gp.callback()},_setPlatformPosition:function(gp,go,gs){gs=gs||{};if(gp===0&&go===0&&!gs.point){return}if(isNaN(gs.initMapOffsetX)){gs.initMapOffsetX=this.offsetX}if(isNaN(gs.initMapOffsetY)){gs.initMapOffsetY=this.offsetY}var gq=gp+gs.initMapOffsetX;var gn=go+gs.initMapOffsetY;if(gs.point){var i=this.restrictCenter(gs.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new aM("oncenter_changed"))}}else{var gj=this.offsetX-gq;var e=this.offsetY-gn;var gi=this.getZoomUnits();var gm=this.centerPoint.lng;var gl=this.centerPoint.lat;var gk=new fX(gm,gl);this.centerPoint=this.restrictCenter(new fX(gk.lng+gj*gi,gk.lat-e*gi),gi);this.fire(new aM("oncenter_changed"));if(this.zoomLevel<10){gq=this.offsetX-(this.centerPoint.lng-gk.lng)/gi;gn=this.offsetY+(this.centerPoint.lat-gk.lat)/gi}}this.offsetX=gq;this.offsetY=gn;var gr=this.platform.style;gr.left=gq+"px";gr.top=gn+"px";this.maskLayer.style.left=-gq+"px";this.maskLayer.style.top=-gn+"px";if(gs.dispatchEvent!==false){this.dispatchEvent(new aM("onmoving"))}},zoomTo:function(e,gm,gq){gq=gq||{};gq.zoomCenter=gm;if(gq.noAnimation!==true){this.deepZoomTo(e,gq);return}if(typeof e!=="number"){return}var gk=bw[this.mapType];if(!gk){return}var gi=e;e=this._getProperZoom(e).zoom;if(e===this.zoomLevel){var gn=new aM("onzoomexceeded");gn.targetZoom=gi;this.dispatchEvent(gn);gq.callback&&gq.callback();return}this.lastLevel=this.zoomLevel;if(gm){this.temp._cPoint=gm;this.temp._cPixel=this.pointToPixelIn(gm)}else{if(this.getInfoWindow()){var gp=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixelIn(gp);this.temp._cPoint=gp}}if(this.config.zoomCenter){gm=this.config.zoomCenter;this.temp._cPoint=gm;this.temp._cPixel=this.pointToPixelIn(gm)}if(gm||this.temp.infoWin&&this.temp.infoWin.isOpen()){var i=this.temp._cPoint;var go=this.temp._cPixel;var gj=this.getZoomUnits(e);var gl=new fX(i.lng+gj*(this.width/2-go.x),i.lat-gj*(this.height/2-go.y));this.centerPoint=this.restrictCenter(gl,gj,e);if(this.centerPoint.zoom){e=this.centerPoint.zoom}}if(gq.fireEvent!==false){this.dispatchEvent(new aM("onzoomstart"))}if(e!==this.zoomLevel){this.zoomLevel=e;this.dispatchEvent(new aM("onzooming"));this.dispatchEvent(new aM("onzoomstartcode"))}if(gq.fireEvent!==false){this.dispatchEvent(new aM("onzoomend"))}if(gq.callback){gq.callback()}},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(gn,gj){gj=gj||{};var gl=gn-this.zoomLevel;var gk=this._getProperZoom(gn);if(gk.exceeded){var e=new aM("onzoomexceeded");e.targetZoom=gn;this.dispatchEvent(e);return}var i;if(gj.zoomCenter){i=this.pointToPixelIn(gj.zoomCenter)}else{if(this.getInfoWindow()){i=this.pointToPixelIn(this.getInfoWindow().getPoint(),{zoom:this.lastLevel})}else{var i=new di(this.width/2,this.height/2)}}this.lastLevel=this.zoomLevel;var gm=this.deepZoom||new a9(this);var gi=gl>0?1:-1;gm.zoomMap(i,gl,gi,null,gj)},flyToIn:function(go,e){if(e===this.zoomLevel){this.panToIn(go);return}var gl=this._getProperZoom(e);if(gl.exceeded){var gp=new aM("onzoomexceeded");gp.targetZoom=e;this.dispatchEvent(gp);return}var gn=e-this.zoomLevel;var gi=new di(this.width/2,this.height/2);var i=this.pointToPixelIn(go);var gm=new c9(i.x-gi.x,i.y-gi.y);this.lastLevel=this.zoomLevel;if(Math.abs(gn)>=4||Math.abs(gm.width)>this.width||Math.abs(gm.height)>this.height){this.centerAndZoomIn(go,e);return}var gk=this.deepZoom||new a9(this);var gj=gn>0?1:-1;gk.zoomMap(i,gn,gj,gm)},panToIn:function(i,gi){gi=gi||{};if(!i||i.equals(this.centerPoint)){gi.callback&&gi.callback();return}var gj=this.pointToPixelIn(i);var e=Math.round(this.width/2);var gk=Math.round(this.height/2);if(Math.abs(e-gj.x)>this.width||Math.abs(gk-gj.y)>this.height||gi.noAnimation===true){this._panToIn(e-gj.x,gk-gj.y,i);gi.callback&&gi.callback()}else{this._panBy(e-gj.x,gk-gj.y,gi)}},_panToIn:function(i,e,gj){var gi=this.temp;if(gi.operating===true){return}if(gi.dragAni){gi.dragAni.stop();gi.dragAni=null;this.dispatchEvent(new aM("onmoveend"))}this.dispatchEvent(new aM("onmovestart"));this._setPlatformPosition(i,e,{point:gj});this.dispatchEvent(new aM("onmoveend"))},panBy:function(i,e,gi){gi=gi||{};i=Math.round(i)||0;e=Math.round(e)||0;if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&gi.noAnimation!==true){this._panBy(i,e,gi)}else{this._panToIn(i,e);gi.callback&&gi.callback()}},_panBy:function(i,e,gk){if(this.temp.operating===true){return}gk=gk||{};this.dispatchEvent(new aM("onmovestart"));var gj=this;var gi=gj.temp;gi.pl=gj.offsetX;gi.pt=gj.offsetY;if(gi.tlPan){gi.tlPan.cancel()}if(gi.dragAni){gi.dragAni.stop();gi.dragAni=null;this.dispatchEvent(new aM("onmoveend"))}gi.tlPan=new n({fps:gk.fps||gj.config.fps,duration:gk.duration||gj.config.actionDuration,transition:gk.transition||bL.easeInOutQuad,render:function(gl){this.terminative=gj.temp.operating;if(gj.temp.operating){return}gj._setPlatformPosition(Math.ceil(i*gl),Math.ceil(e*gl),{initMapOffsetX:gi.pl,initMapOffsetY:gi.pt})},finish:function(gl){gj.dispatchEvent(new aM("onmoveend"));gj.temp.tlPan=false;if(gj.temp.stopArrow===true){gj.temp.stopArrow=false;if(gj.temp.arrow!==0){gj._arrow()}}gk.callback&&gk.callback()}})},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},setTilt:function(){},getTilt:function(){return this._tilt},setHeading:function(){},getHeading:function(){return this._heading},restrictCenter:function(gn,gk,go){this.isRestrict=false;gk=gk||this.getZoomUnits();go=go||this.zoomLevel;var gi=this.pixelToPointIn(new di(0,0),{center:gn,zoom:go});var gl=this.pixelToPointIn(new di(0,this.height),{center:gn,zoom:go});if(this.zoomLevel<5){if(gi.lat>cm.MAX_LAT&&gl.lat<cm.MIN_LAT){this.isRestrict=true;var i=cm.MAX_LAT-gn.lat;var e=gn.lat-cm.MIN_LAT;var gm;if(i<e){gm=i/(this.height/2)}else{gm=e/(this.height/2)}var gj=18-dz(gm);this.zoomLevel=Math.ceil(gj);gn.zoom=Math.ceil(gj);return gn}}if(gi.lat>cm.MAX_LAT){this.isRestrict=true;gn.lat=cm.MAX_LAT-this.height/2*gk}else{if(gl.lat<cm.MIN_LAT){this.isRestrict=true;gn.lat=cm.MIN_LAT+this.height/2*gk}}return gn}});function cm(e,gi){if(typeof e==="string"){e=document.getElementById(e)}dc.call(this);this.container=e;this.width=e.clientWidth;this.height=e.clientHeight;this.offsetX=0;this.offsetY=0;this._setStyle(e);e.unselectable="on";e.innerHTML="";A.ac(e,"bmap-container");e.appendChild(this.render());this._initDate=new Date();this.platform=e.children[0];this.maskLayer=this.platform.children[0];this._panes={};this.centerPoint=new fX(0,0);this.zoomLevel=0;this._heading=0;this._tilt=0;this._bounds=new cY();this.lastLevel=0;this._lock=false;this._enableTiltZoom=7;this._enableHeadingZoom=7;this.defaultZoomLevel=null;this.defaultCenter=null;this.zoomEventStatus="idle";this.currentOperation=c0.idle;this._setConfig(gi);this._initMapRenderType();this._animationInfo={};this._animationInfoUnstopable={};this.suspendLoad=false;this._customTileLabels=[];if(this._renderType==="webgl"){this._workerMgr=new eT(this);this._featureMgr=new cq();A.extend(this,cl.prototype);this.jobScheduler=new eC(this);this.benchmark=new T();this._setupWebGLMap();this.deviceInfo={hardwareInfo:{renderer:"",vendor:""}};if(aL.ifSupportWebGL._renderer){this.deviceInfo.hardwareInfo.renderer=aL.ifSupportWebGL._renderer;this.deviceInfo.hardwareInfo.vendor=aL.ifSupportWebGL._vendor}}else{A.extend(this,ac.prototype)}if(!bw[this.config.mapType]){this.config.mapType=BMAPGL_NORMAL_MAP}if(this.config.mapType===BMAP_EARTH_MAP&&!this.config.enableEarth){if(this.forceEnableEarth()===false){this.config.mapType=BMAPGL_NORMAL_MAP}}this.mapType=this.config.mapType;this.preMapType=null;if(this.config.enableEarth){var gl=this.maskLayer.style;gl.opacity=0;gl.background="#000";if(this.config.mapType===BMAP_EARTH_MAP){gl.opacity=1}setTimeout(function(){gl.WebkitTransition=gl.transition="opacity .4s"},100)}this._isHybridShow=this.config.showStreetLayer;this.temp={operating:false,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:false,I:function(i){return A.I(i)},curSpots:[],curSpotsArray:[],curAreaSpot:null,spotsGuid:1,registerIndex:-1,hoverOnSpot:null,isStdCtrlBusy:false};window.InstanceCore=this.temp.I;this.platform.style.cursor=this.config.defaultCursor;this._bind();for(var gj=0;gj<aU._register.length;gj++){aU._register[gj](this)}this.temp.registerIndex=gj;var gk=this;if(this._renderType==="webgl"){da.load("oppcgl",function(){gk._asyncRegister()})}else{da.load("oppc",function(){gk._asyncRegister()})}if(this.config.mapType==="B_EARTH_MAP"){if(!aU.Earth){da.load("earth",function(){})}else{gk._syncAndChangeMapType("B_EARTH_MAP")}}}cm.MAX_TILT=87;cm.MAX_DRAG_TILT=73;cm.MAX_DRAG_TILT_L2=50;cm.MIN_TILT=0;cm.MAX_LAT=19431424;cm.MIN_LAT=-16023552;cm.WORLD_SIZE_MC_HALF=20037726.372307256;cm.WORLD_SIZE_MC=cm.WORLD_SIZE_MC_HALF*2;cm.RIGHT_EDGE_POINT=new fX(cm.WORLD_SIZE_MC_HALF,0);cm.LEFT_EDGE_POINT=new fX(-cm.WORLD_SIZE_MC_HALF,0);cm.inherits(dc,"Map");A.extend(cm.prototype,{render:function(){var e=M("div",{id:"platform"});var gj=e.style;gj.overflow="visible";gj.position="absolute";gj.zIndex=5;gj.top=gj.left="0px";var i=M("div",{id:"mask","class":"BMap_mask"});var gi=i.style;gi.position="absolute";gi.top=gi.left="0px";gi.zIndex="9";gi.overflow="hidden";gi.WebkitUserSelect="none";gi.width=this.width+"px";gi.height=this.height+"px";e.appendChild(i);return e},_initMapRenderType:function(){var e=this.config.forceRenderType;if(e==="dom"){this._renderType="dom";return}else{if(e==="canvas"){if(aL.isModernBrowser){this._renderType="canvas";return}}else{if(e==="webgl"){if(aL.ifSupportWebGL()){this._renderType="webgl";return}}}}if(aL.ifSupportWebGL()&&aL.ifEnableWebGLMap()){this._renderType="webgl";return}if(aL.isModernBrowser&&aL.ifEnableCanvas2dMap()){this._renderType="canvas";return}this._renderType="dom"},_setConfig:function(i){i=i||{};this.config={bottomOffset:0,clickInterval:200,enableDragging:true,enableKeyboard:false,enableDblclickZoom:true,enableContinuousZoom:true,enableWheelZoom:false,enablePinchZoom:true,enableRotateGestures:true,enableTiltGestures:true,fixCenterWhenPinch:false,enableAutoResize:true,zoomCenter:null,fps:60,zoomerDuration:240,actionDuration:450,defaultCursor:dX.defaultCursor,draggingCursor:dX.draggingCursor,coordType:BMAP_COORD_MERCATOR,mapType:BMAPGL_NORMAL_MAP,drawer:BMAP_SYS_DRAWER,enableInertialDragging:true,drawMargin:500,drawMarginGL:500,enableFulltimeSpotClick:false,enableResizeOnCenter:false,isModernBrowser:aL.isModernBrowser,forceRenderType:"",textRenderType:null,ratio:aJ()>=1.5?2:1,enableEarth:aL.ifEnableEarth(),defaultMaxBounds:new cY(new fX(-21364736,-10616832),new fX(23855104,15859712)),showControls:false,showRealSunlight:true,showMilkyway:true,earthBackground:null,showStreetLayer:true,minZoom:null,maxZoom:null,style:"default",enableIconClick:false,autoSafeArea:false,ak:null,restrictCenter:true,smaa:true,preserveDrawingBuffer:false};for(var gi in i){if(i.hasOwnProperty(gi)){this.config[gi]=i[gi];if(gi==="fixCenterWhenResize"){this.config.enableResizeOnCenter=i[gi]}}}if(i.style){if(i.style["styleId"]&&i.style["styleId"].length<32){this.config.style=i.style["styleId"]}else{this.config.style=i.style}}this._setTextRenderType();this._displayOptions={poi:true,poiText:true,poiIcon:true,overlay:true,layer:true,building:true,indoor:true,street:true,skyColors:["rgb(226, 237, 248)","rgb(186, 211, 252)"],isFlat:false};if(i.displayOptions){for(var e in i.displayOptions){if(i.displayOptions.hasOwnProperty(e)){this._displayOptions[e]=i.displayOptions[e]}}}if(this.config.restrictCenter===false){this._enableTiltZoom=0;this._enableHeadingZoom=0}},getMinZoom:function(){var gi;if(bw[this.mapType][this._renderType]){gi=bw[this.mapType][this._renderType].minZoom}else{gi=bw[this.mapType].minZoom}if(this.config.minZoom!==null&&this.config.minZoom>=gi){gi=this.config.minZoom}if(this.mapType==="B_EARTH_MAP"){return gi}var i=this.getSize();var e=this.worldSize(gi);while(e<i.width){gi++;e=this.worldSize(gi)}return gi},getMaxZoom:function(){var e;if(bw[this.mapType][this._renderType]){e=bw[this.mapType][this._renderType].maxZoom}else{e=bw[this.mapType].maxZoom}if(this.config.maxZoom!==null&&this.config.maxZoom<=e){e=this.config.maxZoom}return e},_drawFrame:function(){this._webglMapScene._painter.draw()},_setupWebGLMap:function(){var e=this;da.load("mapgl",function(){e._asyncRegister()})},_setStyle:function(i){var e=i.style;e.overflow="hidden";if(eK(i).position!=="absolute"){e.position="relative"}e.backgroundImage="url("+dX.imgPath+"bg.png)";e.textAlign="left";e.touchAction=e.MSTouchAction="none"},_bind:function(){var e=this;if(e._renderType!=="webgl"){e._watchSize=function(){var gi=e.getContainerSize();if(e.width!==gi.width||e.height!==gi.height){var gm=(gi.width-e.width)/2;var go=(gi.height-e.height)/2;var gj=e.getZoomUnits();var gl=e.centerPoint;if(gl&&!e.config.enableResizeOnCenter){e.centerPoint=new fX(gl.lng+gm*gj,gl.lat-go*gj)}e.maskLayer.style.width=(e.width=gi.width)+"px";e.maskLayer.style.height=(e.height=gi.height)+"px";var gk=new aM("onresize");gk.size=gi;e.dispatchEvent(gk);e.fire(new aM("onsize_changed"));var i=parseInt(e.platform.style.left,10)||0;var gn=parseInt(e.platform.style.top,10)||0;if(e.currentOperation!=="undefined"&&e.currentOperation!==c0.idle&&(e.offsetX!==i||e.offsetY!==gn)){e._setPlatformPosition(i,gn)}}}}else{e._watchSize=function(){var i=e.getContainerSize();if(e.width!==i.width||e.height!==i.height){var gj=e.getSize();e.maskLayer.style.width=(e.width=i.width)+"px";e.maskLayer.style.height=(e.height=i.height)+"px";if(aJ()!==e.config.ratio){e.config.ratio=aJ()}var gk=new aM("onresize");gk.size=i;e.dispatchEvent(gk);var gi=new aM("onsize_changed");gi.size=i;gi.oldSize=gj;e.fire(gi)}}}if(e.config.enableAutoResize){e.temp.autoResizeTimer=setInterval(e._watchSize,16)}this.on("size_changed",function(){var i=e.getMinZoom();if(e.zoomLevel<i){e.setZoomIn(i,{noAnimation:true})}});this.on("zoom_changed",function(){this.dispatchEvent(new aM("onzooming"))})},addControl:function(e){if(e&&bn(e._i)){e._i(this);this.dispatchEvent(new aM("onaddcontrol",e))}},removeControl:function(e){if(e&&bn(e.remove)){e.remove();this.dispatchEvent(new aM("onremovecontrol",e))}},addContextMenu:function(e){if(e){e.initialize(this);this.dispatchEvent(new aM("onaddcontextmenu",e))}},removeContextMenu:function(e){if(e){this.dispatchEvent(new aM("onremovecontextmenu",e));e.remove()}},addOverlay:function(i){if(i&&bn(i._i)){var gi=new aM("onbeforeaddoverlay",i);gi.overlay=i;this.dispatchEvent(gi);i._i(this);gi=new aM("onaddoverlay",i);gi.overlay=i;this.dispatchEvent(gi)}},removeOverlay:function(i){if(i&&bn(i.remove)){var gi=new aM("onremoveoverlay",i);gi.overlay=i;i.remove();this.dispatchEvent(gi)}},clearOverlays:function(){this.dispatchEvent(new aM("onclearoverlays"))},addTileLayer:function(gk){if(!gk){return}for(var gj=0,e=this.tileMgr.tileLayers.length;gj<e;gj++){var gi=this.tileMgr.tileLayers[gj];if(gi===gk||gi.getMapType()===gk.getMapType()){return}}gk.initialize(this);this.dispatchEvent(new aM("onaddtilelayer",gk))},removeTileLayer:function(e){if(e){e.remove();this.dispatchEvent(new aM("onremovetilelayer",e))}},getTileLayer:function(e){if(this.tileMgr){return this.tileMgr.getTileLayer(e)}return null},setMapType:function(e){var i=this;if(this.mapType===e||this._mapTypeChanging){return}if(e===BMAP_EARTH_MAP&&!this.config.enableEarth){return}if(this._earth&&this._earth.getLock()){return}this._mapTypeChanging=true;this.preMapType=this.mapType;this._boundsInPreMapType=this.getBoundsIn();if(this.preMapType===BMAP_SATELLITE_MAP){this._preStreetLayerShow=this._isHybridShow}if(e===BMAP_EARTH_MAP){if(!aU.Earth){da.load("earth",function(){i._syncAndChangeMapType(e)});return}i._syncAndChangeMapType(e)}else{if(this.preMapType!==BMAP_EARTH_MAP){this._changeFlatMapType(e);this._mapTypeChanging=false}else{this._setMapTypeStatus(e,function(gi,gj){var gk=i._earth.getEarthCanvas();i._changeFlatMapType(e,this.preMapType);if(i._mapTypeChangAni){i._mapTypeChangAni.stop()}i._mapTypeChangAni=ee.start({el:gk,style:"opacity",startValue:1,endValue:0,duration:200,callback:function(){i._mapTypeChangAni=null;i._mapTypeChanging=false}});gi=dm.convertLL2MC(gi);if(i._renderType==="webgl"){A.extend(i,cl.prototype);i.setCenterIn(gi,{noAnimation:true});i.setZoomIn(gj,{noAnimation:true})}else{A.extend(i,ac.prototype);i.centerAndZoomIn(gi,gj)}})}}},_changeFlatMapType:function(gm){if(!gm||!bw[gm]){return}var gu=this.preMapType;this.mapType=gm;var gj=this.getTileLayer(gu);if(gj){this.removeTileLayer(gj)}if(gu!==BMAP_EARTH_MAP||this._renderType!=="webgl"||this.baseLayerAdded!==true){var gi=new cY(new fX(-21364736,-10616832),new fX(23855104,15859712));var gr=new ck(gi,"baidu",gm);var gt=this._renderType==="webgl"?2:1;var gk=new b8({mapType:gm,copyright:gr,dataType:gt,customLayer:false,baseLayer:true,tileTypeName:"na"});gk._isInnerLayer=true;this.addTileLayer(gk);if(this._renderType==="webgl"&&!this.baseLayerAdded){this.baseLayerAdded=true}}if(gu===BMAP_SATELLITE_MAP){this._preStreetLayerShow=this._isHybridShow;this._removeHybirdMap()}else{if(gm===BMAP_SATELLITE_MAP){if(this._preStreetLayerShow===true||typeof this._preStreetLayerShow==="undefined"){this._addHybirdMap()}}}var go=this.tileMgr.tileLayers;for(var gn=0,gl=go.length;gn<gl;gn++){var gp=go[gn];var gs=gp.tilesDiv;if(!gs){continue}if(!gp._isInnerLayer&&gs.style.visibility==="hidden"){gs.style.visibility=""}}var gq=new aM("onmaptypechange");gq.zoomLevel=this.zoomLevel;gq.mapType=gm;gq.exMapType=gu;this.dispatchEvent(gq)},showStreetLayer:function(e){e?this._addHybirdMap():this._removeHybirdMap()},hideStreetLayer:function(e){this._hideStreetLayerOptions=e;this._removeHybirdMap(e)},_addHybirdMap:function(){this._isHybridShow=true;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.showStreetLayer()}return}if(this._hybridTileLayer){this.addTileLayer(this._hybridTileLayer);var gl=new aM("onstreetlayer_show");this.dispatchEvent(gl);return}var gk=new cY(new fX(-21364736,-10616832),new fX(23855104,15859712));var gi=new ck(gk,"",BMAP_HYBRID_MAP);var i=new b8({copyright:gi,transparentPng:true,tileTypeName:"web"});i._isInnerLayer=true;var gj=this.isCanvasMap();i.getTilesUrl=function(gm,gr){var gp=bw.B_STREET_MAP;var gq=an("ditu","satelliteStreet");var gn=gq.ver;var e=gq.udt;var go=gp.tileUrls[Math.abs(gm.x+gm.y)%gp.tileUrls.length]+"?qt=vtile&x="+(gm.x+"").replace(/-/gi,"M")+"&y="+(gm.y+"").replace(/-/gi,"M")+"&z="+gr+"&styles=sl&v="+gn+"&udt="+e+"$scaler="+aJ()+"&showtext="+(gj?0:1);return go};this._isHybridShow=true;this.addTileLayer(i);this._hybridTileLayer=i;var gl=new aM("onstreetlayer_show");this.dispatchEvent(gl)},_removeHybirdMap:function(i){this._isHybridShow=false;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.hideStreetLayer(i)}return}if(this._hybridTileLayer){this.removeTileLayer(this._hybridTileLayer);var gi=new aM("onstreetlayer_hide");this.dispatchEvent(gi)}},isStreetLayerShow:function(){return this._isHybridShow},getTileId:function(e,gl){var gj=bw[this.mapType];if(typeof gj!=="object"){return null}var gi=gj.baseUnits*Math.pow(2,(gj.zoomLevelBase-gl));var gk=parseInt(e.lng/gi,10);var i=parseInt(e.lat/gi,10);return{row:gk,column:i,level:gl}},reset:function(){this.centerAndZoomIn(this.defaultCenter,this.defaultZoomLevel,true)},setOptions:function(e){e=e||{};for(var gi in e){if(e.hasOwnProperty(gi)){var i=true;if(typeof e[gi]!=="object"){i=e[gi]!==this.config[gi]}this.config[gi]=e[gi];if(gi==="fixCenterWhenResize"){this.config.enableResizeOnCenter=e[gi]}if(!i){continue}switch(gi){case"style":this.fire(new aM("onstyle_willchange"));var gj=this;this.loadMapStyleFiles(function(){gj.fire(new aM("onstyle_changed"))});break;case"enableAutoResize":if(e[gi]===true){this.enableAutoResize()}else{this.disableAutoResize()}break;case"displayOptions":this.setDisplayOptions(e[gi]);break}}}},enableDragging:function(){this.config.enableDragging=true},disableDragging:function(){this.config.enableDragging=false},enableInertialDragging:function(){this.config.enableInertialDragging=true},disableInertialDragging:function(){this.config.enableInertialDragging=false},enableScrollWheelZoom:function(){this.config.enableWheelZoom=true},disableScrollWheelZoom:function(){this.config.enableWheelZoom=false},enableContinuousZoom:function(){this.config.enableContinuousZoom=true},disableContinuousZoom:function(){this.config.enableContinuousZoom=false},enableResizeOnCenter:function(){this.config.enableResizeOnCenter=true},disableResizeOnCenter:function(){this.config.enableResizeOnCenter=false},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=true},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=false},enableKeyboard:function(){this.config.enableKeyboard=true},disableKeyboard:function(){this.config.enableKeyboard=false},getSize:function(){return new c9(this.width,this.height)},enablePinchToZoom:function(){this.config.enablePinchZoom=true},disablePinchToZoom:function(){this.config.enablePinchZoom=false},enableAutoResize:function(){this.config.enableAutoResize=true;this._watchSize();if(!this.temp.autoResizeTimer){this.temp.autoResizeTimer=setInterval(this._watchSize,16)}},disableAutoResize:function(){this.config.enableAutoResize=false;if(this.temp.autoResizeTimer){clearInterval(this.temp.autoResizeTimer);this.temp.autoResizeTimer=null}},checkResize:function(){this._watchSize()},resize:function(){this._watchSize()},getContainerSize:function(){return new c9(this.container.clientWidth,this.container.clientHeight)},_getProperZoom:function(gi){if(!gi){gi=this.zoomLevel}var i=this.getMinZoom();var e=this.getMaxZoom();var gj=false;if(gi<i){gj=true;gi=i}if(gi>e){gj=true;gi=e}if(this._renderType!=="webgl"){gi=Math.round(gi)}return{zoom:gi,exceeded:gj}},getContainer:function(){return this.container},getZoomUnits:function(gi){if(this.mapType===BMAP_EARTH_MAP){return Math.pow(2,18-this._earth.getImageZoom())}var e=bw[this.mapType];if(typeof e!=="object"){return null}var i=gi||this.zoomLevel;return Math.pow(2,(e.zoomLevelBase-i))},pointToPixelIn:function(gs,gu){if(!gs){return}gu=gu||{};if(this.mapType===BMAP_EARTH_MAP){var gj;if(!gs._llPt){gj=dm.convertMC2LL(gs);gs._llPt=gj}gj=gs._llPt;var go=null;var gi=null;if(typeof gu.zoom==="number"){var gr=this._earth;var gt=gr._getEarthZoomByImgZoom(gu.zoom);if(gt<=3){go=gr._generateTmpPMatrix(gt)}gi=gr._generateTmpMVMatrix(gr.getCenter(),gt)}var gk=this._earth.fromLatLngToPixel(gj,{useRound:false,isCalcOnBack:true,matrixInfo:{modelViewMatrix:gi,projectionMatrix:go}});return gk}if((this._heading%360===0&&this._tilt===0)||!this._webglMapCamera){var gq=this.getZoomUnits(gu.zoom);var gm=gu.center||this.centerPoint;var i=this.width/2;var gl=this.height/2;var gp=(gs.lng-gm.lng)/gq+i;var gn=(gm.lat-gs.lat)/gq+gl;if(gu.useRound!==false){gp=Math.round(gp);gn=Math.round(gn)}return new di(gp,gn)}var e=this._webglMapCamera.fromMCToScreenPixel(gs.lng,gs.lat,gu);if(gu.useRound===false){return e}e.x=Math.round(e.x);e.y=Math.round(e.y);return e},pixelToPointIn:function(e,gq){if(!e){return}gq=gq||{};if(this.mapType===BMAP_EARTH_MAP){if(typeof gq.zoom==="number"){var go=this._earth;var gl=null;var gi=null;var gp=go._getEarthZoomByImgZoom(gq.zoom);if(gp<=3){gl=go._generateTmpPMatrix(gp)}gi=go._generateTmpMVMatrix(go.getCenter(),gp)}var i=this._earth.fromPixelToLatLng(e,{matrixInfo:{modelViewMatrix:gi,projectionMatrix:gl}});if(i===null){return null}return dm.convertLL2MC(i)}if((this._heading%360!==0||this._tilt>0)&&this._webglMapCamera){return this._webglMapCamera.fromScreenPixelToMC(e.x,e.y,gq)}var gm=gq.center||this.centerPoint;var gn=this.getZoomUnits(gq.zoom);var gk=gm.lng+gn*(e.x-this.width/2);var gj=gm.lat-gn*(e.y-this.height/2);return new fX(gk,gj)},pointToOverlayPixelIn:function(e,gj){gj=gj||{};var gi=this.pointToPixelIn(e,{zoom:gj.zoom,center:gj.center,forLabel:true,frustumTest:true});if(!gi){return}if(gj.fixPosition&&this.mapType!=="B_EARTH_MAP"){var gk=this.getSize();var i=this.worldSize(gj.zoom);if(gi.x>gk.width){while(gi.x>gk.width){gi.x-=i}}else{if(gi.x<0){while(gi.x<0){gi.x+=i}}}}if(this._renderType==="webgl"){return gi}gi.x-=this.offsetX;gi.y-=this.offsetY;return gi},overlayPixelToPointIn:function(i,e){if(!i){return}var gi=i.clone();if(this._renderType!=="webgl"){gi.x+=this.offsetX;gi.y+=this.offsetY}return this.pixelToPointIn(gi,e)},lnglatToMercator:function(e,gj){var i=new fX(e,gj);var gi=dm.convertLL2MC(i);return[gi.lng,gi.lat]},mercatorToLnglat:function(i,e){if(isNaN(i)||isNaN(e)){return[]}i=parseFloat(i);e=parseFloat(e);var gj=new fX(i,e);var gi=dm.convertMC2LL(gj);return[gi.lng,gi.lat]},getBoundsIn:function(){var gw=arguments[0];if(this.mapType===BMAP_EARTH_MAP&&this._earth){var gq=this._earth.getCustomBounds();if(!gq){return this.config.defaultMaxBounds}var gp=gq.getSouthWest();var e=gq.getNorthEast();if(gp.lng>e.lng){e.lng=180}var gN=dm.convertLL2MC(gp);var gD=dm.convertLL2MC(e);var gt=this.config.defaultMaxBounds;var gC=Math.max(gN.lng,gt.sw.lng);var gB=Math.max(gN.lat,gt.sw.lat);var gv=Math.min(gD.lng,gt.ne.lng);var gu=Math.min(gD.lat,gt.ne.lat);var gy=new cY(new fX(gC,gB),new fX(gv,gu));gy.pointBottomLeft=new fX(gC,gB);gy.pointBottomRight=new fX(gv,gB);gy.pointTopLeft=new fX(gC,gu);gy.pointTopRight=new fX(gv,gu);gy.setMinMax();gy.makeNormalizedPoint(this._earth.getHeading());return gy}gw=gw||{};var gk=gw.margins||[0,0,0,0];var gI=this.pixelToPointIn({x:gk[3],y:this.height-gk[2]},gw);var gM=this.pixelToPointIn({x:this.width-gk[1],y:gk[0]},gw);var gA=typeof gw.heading==="number"?gw.heading:(this._heading%360);var gi=typeof gw.tilt==="number"?gw.tilt:this._tilt;var gs=this._webglMapCamera;if((gA===0&&gi===0)||!gs){this._bounds.setSouthWest(gI);this._bounds.setNorthEast(gM);this._bounds.pointBottomLeft=gI;this._bounds.pointBottomRight=new fX(gM.lng,gI.lat);this._bounds.pointTopRight=gM;this._bounds.pointTopLeft=new fX(gI.lng,gM.lat);this._bounds.setMinMax();this._bounds.makeNormalizedPoint(gA);return this._bounds}var gz=this.pixelToPointIn({x:gk[3],y:gk[0]},gw);var gj=gs.getPosition();var gO=Math.sqrt(Math.pow(gz.lng-gj[0],2)+Math.pow(gz.lat-gj[1],2));var gJ=this.getZoomUnits();var gQ=gO/gJ;var gG=gs._frustumSideLen;var go=gs._fovy;if(gQ>gG||(90-gi)<go/2){var gP=[gz.lng-gj[0],gz.lat-gj[1]];if((90-gi)<go/2){gP[0]=-gP[0];gP[1]=-gP[1]}var gH=gG*gJ;var gn=[gP[0]/gO*gH+gj[0],gP[1]/gO*gH+gj[1]];var gE=[gM.lng-gj[0],gM.lat-gj[1]];if((90-gi)<go/2){gE[0]=-gE[0];gE[1]=-gE[1]}var gl=[gE[0]/gO*gH+gj[0],gE[1]/gO*gH+gj[1]];gz.lng=gn[0];gz.lat=gn[1];gM.lng=gl[0];gM.lat=gl[1]}var gx=this.pixelToPointIn({x:this.width-gk[1],y:this.height-gk[2]},gw);var gF=[gI,gM,gz,gx];var gL=gF[0].lng;var gR=gF[0].lat;var gm=gF[0].lng;var gr=gF[0].lat;for(var gK=1;gK<4;gK++){if(gF[gK].lng<gL){gL=gF[gK].lng}if(gF[gK].lng>gm){gm=gF[gK].lng}if(gF[gK].lat<gR){gR=gF[gK].lat}if(gF[gK].lat>gr){gr=gF[gK].lat}}this._bounds.setSouthWest(new fX(gL,gR));this._bounds.setNorthEast(new fX(gm,gr));this._bounds.pointTopLeft=gz;this._bounds.pointTopRight=gM;this._bounds.pointBottomRight=gx;this._bounds.pointBottomLeft=gI;this._bounds.makeNormalizedPoint(gA);this._bounds.setMinMax();return this._bounds},isLoaded:function(){return !!this.loaded},_getBestLevel:function(i,gs){var gl=0;if(this._renderType==="webgl"&&!eP()){gl=100}var gm=gs.margins||[10,10,10,10];var gj=gs.zoomFactor||0;var gn=gm[1]+gm[3];var gk=gm[0]+gm[2];var e=this.getMinZoom();var gr=this.getMaxZoom();var gq=i.toSpan();var gp=gq.width/(this.width-gn-gl);var go=gq.height/(this.height-gk-gl);var gi=18-dz(Math.max(gp,go));if(gi<e){gi=e}if(gi>gr){gi=gr}gi+=gj;if(this._renderType!=="webgl"){gi=Math.floor(gi)}return gi},getViewportIn:function(gu,gx){if(this.mapType===BMAP_EARTH_MAP){gu=gu||[];var gt=[];for(var gk=0;gk<gu.length;gk++){if(!gu[gk]){continue}gt.push(dm.convertMC2LL(gu[gk]))}var gs=this._earth.getViewportIn(gt,gx);var gl=gs.center;var gm=gs.zoom;var gq=dm.convertLL2MC(gl);return{center:gq,zoom:gm}}var gw={center:this.getCenterIn(),zoom:this.getZoom()};if(!gu||gu.length===0){return gw}gx=gx||{};var gi;if(gu instanceof cY){gi=gu}else{var gp=gu;gi=new cY();for(var gk=gp.length-1;gk>=0;gk--){gi.extend(gp[gk])}if(gi.isEmpty()){return gw}}var e=gi.getCenter();var gv=this._getBestLevel(gi,gx);if(gx.margins){var go=gx.margins;var gn=(go[1]-go[3])/2;var gr=(go[0]-go[2])/2;var gj=this.getZoomUnits(gv);e.lng=e.lng+gj*gn;e.lat=e.lat+gj*gr}return{center:e,zoom:gv}},setViewportIn:function(gj,gk){if(this.mapType===BMAP_EARTH_MAP){var go;if(gj&&gj.center){var gi=dm.convertMC2LL(gj.center);var gm=this._earth._getEarthZoomByImgZoom(gj.zoom,gi);go={center:gi,zoom:gm}}else{go=[];for(var gl=0;gl<gj.length;gl++){var gn=dm.convertMC2LL(gj[gl]);go[gl]=new cj(gn.lat,gn.lng)}}this._earth.setViewportIn(go,gk);return}var e;if(gj&&gj.center){e=gj}else{e=this.getViewportIn(gj,gk)}gk=gk||{};if(this._renderType==="webgl"){this.centerAndZoomIn(e.center,e.zoom,gk);return}if(e.zoom===this.zoomLevel&&gk.enableAnimation!==false){this.panToIn(e.center,{duration:200,callback:gk.callback})}else{this.centerAndZoomIn(e.center,e.zoom,gk)}},addSpots:function(gi,i){if(!gi||gi.length===0){return}i=i||{};var gl=i.zIndex||0;var gk=typeof i.enableMultiResponse==="undefined"?true:!!i.enableMultiResponse;this.spotsPool=this.spotsPool||{};var e="sp"+(this.temp.spotsGuid++);this.spotsPool[e]={spots:gi.slice(0),zIndex:gl,enableMultiResponse:gk};var gj=this;da.load("hotspot",function(){gj._asyncRegister()});return e},getSpots:function(e){return this.spotsPool[e]&&this.spotsPool[e].spots||[]},removeSpots:function(e){if(!e||!this.spotsPool[e]){return}delete this.spotsPool[e]},clearSpots:function(){delete this.spotsPool},getIconByClickPosition:function(i){if(!this.config.enableIconClick||!this._spotsMgr){return null}var e=this._spotsMgr.getSpotsByScreenPosition(i);if(e[0]&&e[0].userdata){var gi=e[0].userdata;return{name:gi.name,uid:gi.uid,position:gi.iconPoint||e[0].pt}}return null},setBounds:function(e){bw[this.mapType].bounds=e.clone()},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){if(this.temp.infoWin&&this.temp.infoWin.isOpen()){return this.temp.infoWin}return null},getDistanceIn:function(gk,e){if(!gk||!e){return}if(this.mapType===BMAP_EARTH_MAP){var gj=dm.convertMC2LL(gk);var gi=dm.convertMC2LL(e);return this._earth.getDistance(gj,gi)}var i=dm.getDistanceByMC(gk,e);return i},getOverlays:function(){var gk=[];var gl=this._overlays;var gj=this._customOverlays;if(gl){for(var gi in gl){if(gl[gi] instanceof cb){gk.push(gl[gi])}}}if(gj){for(var gi=0,e=gj.length;gi<e;gi++){gk.push(gj[gi])}}return gk},getMapType:function(){return this.mapType},_asyncRegister:function(){for(var e=this.temp.registerIndex;e<aU._register.length;e++){aU._register[e](this)}this.temp.registerIndex=e},setDefaultCursor:function(e){this.config.defaultCursor=e;if(this.platform){this.platform.style.cursor=this.config.defaultCursor}},getDefaultCursor:function(){return this.config.defaultCursor},setDraggingCursor:function(e){this.config.draggingCursor=e},getDraggingCursor:function(){return this.config.draggingCursor},_syncAndChangeMapType:function(e){var i=this;if(i._renderType==="webgl"&&i.getTilt()>cm.MAX_DRAG_TILT_L2){i.setTilt(cm.MAX_DRAG_TILT_L2,{callback:function(){i._changeEarthMapType(e)}})}else{i._changeEarthMapType(e)}},_changeEarthMapType:function(gi){var gj=this;var gm=gj.tileMgr.tileLayers;if(this._mapTypeChangAni){this._mapTypeChangAni.stop()}var gl;if(this._earth){gl=this._earth.getEarthCanvas()}if(!this._earth){this.maskLayer.style.opacity=1;this.maskLayer.style.zIndex=999;this.maskLayer.style.background="#000"}this._mapTypeChangAni=new n({duration:400,render:function(e){if(!gj._earth){return}gl.style.opacity=e},finish:function(){for(var e=gm.length-1,gn=e;gn>=0;gn--){var gp=gm[gn].tilesDiv;if(gp){gp.style.visibility="hidden"}if(gm[gn]._isInnerLayer&&gj._renderType!=="webgl"){gj.removeTileLayer(gm[gn])}}gj._mapTypeChangAni=null;gj._mapTypeChanging=false;function go(){var gt=gj.getZoom()-2;var gu=gj.getCenterIn();var gr=dm.convertMC2LL(gu);gj._earth=new aU.Earth(gj,{center:gr,zoom:gt,showRealSunlight:gj.config.showRealSunlight,showMilkyway:gj.config.showMilkyway,earthBackground:gj.config.earthBackground});gj._proxyEarthEvents();var gq=gj.mapType;gj.mapType=gi;var gs=new aM("onmaptypechange");gs.zoomLevel=this.zoomLevel;gs.mapType=gi;gs.exMapType=gq;gj.dispatchEvent(gs);gj._setMapTypeStatus(gi);A.extend(gj,aU.EarthView.prototype);if(!gj._navigationCtrl&&gj.config.showControls){gj._navigationCtrl=new dP(gj)}}if(!gj._earth){if(aU["FeatureStyle"+gj.config.style]){go()}else{gj.loadMapStyleFiles(function(){go()})}}if(parseInt(gj.maskLayer.style.opacity,10)===1){setTimeout(function(){gj.maskLayer.style.zIndex=9;gj.maskLayer.style.opacity=0},1000)}}});if(!this._earth){return}var i=this.mapType;this.mapType=gi;var gk=new aM("onmaptypechange");gk.zoomLevel=this.zoomLevel;gk.mapType=gi;gk.exMapType=i;this.dispatchEvent(gk);gj._setMapTypeStatus(gi);A.extend(gj,aU.EarthView.prototype)},getMapStyleId:function(){if(typeof this.config.style==="string"){return this.config.style}return this.config.mapStyleId||"custom"},_setMapTypeStatus:function(gi){var gn=arguments[1];if(gi===BMAP_EARTH_MAP){var gl=this._earth.getEarthCanvas();if(gl){gl.style.display=""}var go={noAnimation:true};this._earth.setCenter(dm.convertMC2LL(this.centerPoint),go);this._earth.setImageZoom(this.zoomLevel,go);this._earth.setTilt(this.getTilt(),go);this._earth.setHeading(this.getHeading(),go)}else{if(this.preMapType===BMAP_EARTH_MAP&&this._earth){var gm=this._earth;var gj=gm.getMapZoom();var gk=gm._imageRawZoom||gj;var i=gk-gj;var e=gm.getCenter();if(this._renderType==="webgl"){this._tilt=gm.getTilt();if(this.zoomLevel>7){this._heading=gm.getHeading();gn&&gn(e,gj);return}if(gm.getHeading()!==0){gm.setTilt(this.getTilt());gm.setHeading(this.getHeading(),{callback:function(){gn&&gn(e,gj)}})}else{gn&&gn(e,gj)}return}if(i<0.1&&gm.getTilt()===0&&gm.getHeading()===0){gn&&gn(e,gj);return}gm.setTilt(0);gm.setHeading(0);gm.setZoom(gm.getZoom()-i,{callback:function(){gn&&gn(e,gj)}})}}},_proxyEarthEvents:function(){var gl=this;var gm=this._earth;var e=false;gm.on("tilesload",function(i){gl.fire(i)});gm.on("centerandzoom",function(i){gl.dispatchEvent(new aM("onmoveend"));gl.dispatchEvent(new aM("onzoomend"))});function gk(i){gl.fire(i)}var gi=["zoomstart","zoomend","tilesload","sunlighttime_change","sunlighttime_clear","centerandzoom","animation_start","animation_stop","movestart","moveend","moving","dragstart","dragend","dragging"];for(var gj=0;gj<gi.length;gj++){gm.on(gi[gj],gk)}},forceEnableEarth:function(){this.config.forceEnableEarth=true;this.config.enableEarth=aL.ifEnableEarth(true);this.dispatchEvent(new aM("forceenableearth"));return this.config.enableEarth},setLock:function(e){if(this.mapType===BMAP_EARTH_MAP){this._earth.setLock(e)}this._lock=e},getLock:function(){if(this.mapType===BMAP_EARTH_MAP){return this._earth.getLock()}return this._lock},getEarth:function(){return this._earth},isSupportEarth:function(){return this.config.enableEarth},isCanvasMap:function(){return !!(this._renderType==="canvas"&&this.getMapType()!=="B_EARTH_MAP")},getCanvasMapCoordByUid:function(gk){if(this._renderType==="webgl"){var gl=this.tileMgr.tileLayers;for(var gj=0;gj<gl.length;gj++){if(gl[gj].labelProcessor){return gl[gj].labelProcessor.getLabelByUid(gk,"")}}return null}var e=this.canvas2dMapMgr._labelClick;var gi=e.findLabelByUid(gk);return gi?new fX(gi.iconPos.geoX,gi.iconPos.geoY):null},loadBizData:function(i){var e=new aM("onloadbizdata");e.data=i;this.dispatchEvent(e)},unloadBizData:function(){var e=new aM("onunloadbizdata");this.dispatchEvent(e)},zoomIn:function(e){this.setZoomIn(this.zoomLevel+1,{zoomCenter:e})},zoomOut:function(e){this.setZoomIn(this.zoomLevel-1,{zoomCenter:e})},setCenterIn:function(e,i){this.panToIn(e,i)},getRenderType:function(){return this._renderType},getSolarInfo:function(gj){gj=gj||this._initDate;var gi=a4(gj);var e=dm.convertLL2MC(new fX(gi[0],gi[1]));var gr=e.latLng;var gm=aU.Projection.convertMC2LL(this.centerPoint);var go=gj.getUTCHours();var gq=go+24*gm.lng/360;var gp=gq-12;var gn=gp*60*0.25;var gl=Math.asin(Math.sin(cT(gm.lat))*Math.sin(cT(gr.lat))+Math.cos(cT(gm.lat))*Math.cos(cT(gr.lat))*Math.cos(cT(gn)));var gk=Math.asin(Math.sin(cT(gn))*Math.cos(cT(gr.lat))/Math.cos(gl));var i="north";if(gm.lat<gr.lat){i="south"}return{zenith:e,solarAltitude:gl,solarAzimuth:gk,centerPosition:i,position:e}},setDisplayOptions:function(gi){if(!gi){return}for(var e in this._displayOptions){if(this._displayOptions.hasOwnProperty(e)){if(typeof gi[e]==="boolean"||(e==="skyColors"&&typeof gi.skyColors==="object")){this._displayOptions[e]=gi[e]}}}var i=this.getMapType();if(i===co.NORMAL){this.fire(new aM("ondisplayoptions_changed"))}else{if(i===co.EARTH&&this._earth){this._earth.fire(new aM("ondisplayoptions_changed"))}}},getHorizonPosY:function(e){if(!e||!this._webglMapCamera){return null}var i=this._webglMapCamera.fromMCToScreenPixel(e.lng,e.lat,{heading:0});return i.y},getIndoorInfo:function(){if(!this._indoorMgr){return}return this._indoorMgr.getData()},showIndoor:function(e,gi){var i=new aM("onindoor_status_changed");i.uid=e;i.floor=gi;this.fire(i)},addAreaSpot:function(e,gi){if(!e||e.length===0){return}gi=gi||{};this.areaSpots=this.areaSpots||{};var i=gi.id||("sp"+(this.temp.spotsGuid++));this.areaSpots[i]={spot:e,userData:gi.userData};var gj=this;da.load("hotspot",function(){gj._asyncRegister()});return i},getAreaSpot:function(e){if(this.areaSpots&&this.areaSpots[e]){return this.areaSpots[e]}return null},removeAreaSpot:function(e){if(!e||!this.areaSpots[e]){return}delete this.areaSpots[e]},clearAreaSpots:function(){this.areaSpots={}},resetSpotStatus:function(){this.fire(new aM("onspot_status_reset"))},hightlightSpotByUid:function(e,gi){var i=new aM("onspot_highlight");i.uid=e;i.tilePosStr=gi;this.fire(i)},setZoomIn:function(i,e){e=e||{};this.zoomTo(i,e.zoomCenter||null,e)},getCurrentMaxTilt:function(){var e=this.zoomLevel;if(this.mapType==="B_EARTH_MAP"){return cm.MAX_DRAG_TILT_L2}if(this.config.restrictCenter===false){return cm.MAX_DRAG_TILT}if(e>=19){return cm.MAX_DRAG_TILT}else{if(e<=18){if(e<this._enableTiltZoom){if(e>=this._enableTiltZoom-2){return(1-(this._enableTiltZoom-e)/2)*cm.MAX_DRAG_TILT_L2}return 0}return cm.MAX_DRAG_TILT_L2}else{return(cm.MAX_DRAG_TILT-cm.MAX_DRAG_TILT_L2)*(e-18)+cm.MAX_DRAG_TILT_L2}}},worldSize:function(i){var e=i||this.zoomLevel;return cm.WORLD_SIZE_MC/Math.pow(2,18-e)},setTrafficOn:function(){this.addTileLayer(bD)},setTrafficOff:function(){this.removeTileLayer(bD)},showOverlayContainer:function(){this.setDisplayOptions({overlay:true})},hideOverlayContainer:function(){this.setDisplayOptions({overlay:false})},addLabelsToMapTile:function(gi){for(var e=0;e<gi.length;e++){if(typeof gi[e].type==="undefined"){gi[e].type="fixed"}if(typeof gi[e].rank!=="number"){gi[e].rank=50000}gi[e].pt=gi[e].position;gi[e].custom=true;gi[e].processedInZoom=0;this._customTileLabels.push(gi[e])}this.dispatchEvent(new aM("onadd_tile_labels"))},removeLabelsFromMapTile:function(gi){for(var gj=0;gj<gi.length;gj++){for(var e=0;e<this._customTileLabels.length;e++){if(this._customTileLabels[e].uid===gi[gj]){this._customTileLabels.splice(e,1)}}}this.dispatchEvent(new aM("onremove_tile_labels"))},clearLabels:function(){this._customTileLabels.length=0;this.dispatchEvent(new aM("onclear_labels"))},loadMapStyleFiles:function(gj){var i=this.config.style;var gi=this;this._setTextRenderType();if(typeof i==="string"){if(aU["FeatureStyle"+i]){gi.fire(new aM("onstyle_loaded"));gj();return}fR.load(dX.getMapStyleFiles(i),function(){if(gi.config.style===i){aU["FeatureStyle"+i]=window.FeatureStyle;aU["iconSetInfo"+i]=window.iconSetInfo_high;aU.indoorStyle=window.indoorStyle;gi.fire(new aM("onstyle_loaded"));gj()}})}else{var e=i;f.init(gi);f.getStyleJson(e,function(gl){var gq=eX;var gs=aU.getGUID("custom");gi.config.mapStyleId=gs;var go={};A.extend(go,gl);var gm=Math.floor(gi.getZoom());window.styleCbk=function(gt,gu){if(gu!==gp){return}gt=JSON.parse(gt);f.onStyleDataBack(gt,gm,gs,go,gq);aU.customStyleLoaded=true;gi.fire(new aM("onstyle_loaded"));gj()};aU.customStyleInfo={zoomRegion:{},zoomStyleBody:[],zoomFrontStyle:{}};var gr=f.getStyleUrl(gl,gq,"styleCbk",gm);var gk=gr.split("?")[0];var gp=gr.split("?")[1];if(!aU.iconSetInfoCustom){var gn=dX.getMapStyleFiles("default");gn.splice(1,1);fR.load(gn,function(){aU.iconSetInfoCustom=window.iconSetInfo_high;aU.indoorStyle=window.indoorStyle;aU.customStyleInfo.xhr=fh.post(gk,gp,styleCbk)})}else{aU.customStyleInfo.xhr=fh.post(gk,gp,styleCbk)}})}},setCopyrightOffset:function(gj,i){var gi=new aM("oncopyrightoffsetchange",{logo:gj,cpy:i});this.dispatchEvent(gi)},_setTextRenderType:function(e){if(e){this.config.textRenderType=e;return}if(this.config.textRenderType!==null){return}if(eP()){this.config.textRenderType="canvas"}else{if(typeof this.config.style==="string"){this.config.textRenderType="image"}else{this.config.textRenderType="canvas"}}},destroy:function(){this.fire(new aM("ondestroy"))},centerAndZoom:function(e,gj,gi){var i=dm.convertLL2MC(e);this.centerAndZoomIn(i,gj,gi)},pointToPixel:function(e,gi){var i=dm.convertLL2MC(e);var gj={};A.extend(gj,gi);if(gj&&gj.center){gj.center=dm.convertLL2MC(gj.center)}return this.pointToPixelIn(i,gj)},pixelToPoint:function(gi,i){var gj={};A.extend(gj,i);if(gj&&gj.center){gj.center=dm.convertLL2MC(gj.center)}var e=this.pixelToPointIn(gi,gj);return dm.convertMC2LL(e)},pointToOverlayPixel:function(e,gi){var i=dm.convertLL2MC(e);var gj={};A.extend(gj,gi);if(gj&&gj.center){gj.center=dm.convertLL2MC(gj.center)}return this.pointToOverlayPixelIn(i,gj)},overlayPixelToPoint:function(gi,i){var gj={};A.extend(gj,i);if(gj&&gj.center){gj.center=dm.convertLL2MC(gj.center)}var e=this.overlayPixelToPointIn(gi,gj);return dm.convertMC2LL(e)},setViewport:function(gi,gj){var e;if(gi&&gi.center){e={};A.extend(e,gi);e.center=dm.convertLL2MC(e.center)}else{e=[];for(var gk=0;gk<gi.length;gk++){e[gk]=dm.convertLL2MC(gi[gk])}}this.setViewportIn(e,gj)},getViewport:function(gl,gj){var gi;if(gl&&gl.length){gi=[];for(var gk=0;gk<gl.length;gk++){gi[gk]=dm.convertLL2MC(gl[gk])}}var e=this.getViewportIn(gi,gj);e.center=dm.convertMC2LL(e.center);return e},getDistance:function(gk,gi){var i=dm.convertLL2MC(gk);var gj=dm.convertLL2MC(gi);var e=this.getDistanceIn(i,gj);return e},setCenter:function(e,gi){var i=dm.convertLL2MC(e);this.setCenterIn(i,gi)},setZoom:function(gi,e){var i={};A.extend(i,e);if(i&&i.zoomCenter){i.zoomCenter=dm.convertLL2MC(i.zoomCenter)}this.setZoomIn(gi,i)},flyTo:function(e,gi){var i=dm.convertLL2MC(e);this.flyToIn(i,gi)},panTo:function(e,gi){var i=dm.convertLL2MC(e);this.panToIn(i,gi)},getCenter:function(){var e=this.getCenterIn();return dm.convertMC2LL(e)},getBounds:function(){var e=this.getBoundsIn();var i=new cY(dm.convertMC2LL(e.getSouthWest()),dm.convertMC2LL(e.getNorthEast()));return i},setMapStyleV2:function(e){this._setTextRenderType("canvas");this.setOptions({style:e})},startViewAnimation:function(gi){var e=gi._options.delay;var i=this;setTimeout(function(){gi._start(i)},e)},cancelViewAnimation:function(e){e._cancel(this)},getMapScreenshot:function(){return this._webglMapScene._painter._canvas.toDataURL()}});var co={NORMAL:"B_NORMAL_MAP",EARTH:"B_EARTH_MAP",SATELLITE:"B_STREET_MAP"};aU.MapTypeId=co;window.BMAP_NORMAL_MAP="B_NORMAL_MAP";window.BMAPGL_NORMAL_MAP="B_NORMAL_MAP";window.BMAP_SATELLITE_MAP="B_SATELLITE_MAP";window.BMAP_HYBRID_MAP="B_STREET_MAP";window.BMAP_EARTH_MAP="B_EARTH_MAP";window.BMAP_COORD_MERCATOR=1;window.BMAP_SYS_DRAWER=0;window.BMAP_SVG_DRAWER=1;window.BMAP_VML_DRAWER=2;window.BMAP_CANVAS_DRAWER=3;var f={environment:"jsapi",map:null,ontilesloaded:false,onstyle_loaded:false,init:function(i){var e=this;e.map=i;this.changeCopyright();this.setEnvironment(e.map.config.style);this.resetEventListener()},resetEventListener:function(){var e=this;this.ontilesloaded=false;this.onstyle_loaded=false;e.map.addEventListener("ontilesloaded",e.checkLoadedStatus);e.map.addEventListener("onstyle_loaded",e.checkLoadedStatus)},checkLoadedStatus:function(i){f[i.type]=true;if(f.ontilesloaded&&f.onstyle_loaded){this.dispatchEvent(new aM("onstylechangetilesloaded"));this.removeEventListener("ontilesloaded",f.checkLoadedStatus);this.removeEventListener("onstyle_loaded",f.checkLoadedStatus)}},changeCopyright:function(){var e=this;if(e.map.cpyCtrl){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new c9(1,1))}}else{e.map.addEventListener("oncopyrightaddend",function(){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new c9(1,1))}})}},setEnvironment:function(e){if(e.customEditor){this.environment="customEditor";bd.map=this.map}else{if(e.sharing){this.environment="sharing"}else{if(e.preview){this.environment="preview"}else{this.environment="jsapi"}}}},getStyleJson:function(gj,gl){var gk=this;if(gj.styleJson){gl&&gl(gj.styleJson)}else{if(gj.styleId){var i=gj.styleId;var e=(Math.random()*100000).toFixed(0);aU["_cbk_si_phpui"+e]=function(gn){var gm=[];if(gn.result&&gn.result["error"]===0&&gn.content&&gn.content["status"]===0){gm=gk.parseJson(gn.content["data"]["json"]);gl&&gl(gm)}else{gl&&gl("default")}};aU["_cbk_si_api"+e]=function(gn){var gm=[];if(gn.status===0){if(gn.info){gm=gk.parseJson(gn.info["json"])}else{gm=gk.parseJson(gn.data["json"])}gl&&gl(gm)}else{gl&&gl("default")}};var gi="";switch(this.environment){case"jsapi":gi=dQ.apiHost+"/?qt=custom_map&v=3.0&style_id="+i+"&type=publish&ak="+eX;gi+="&callback="+dx+"._cbk_si_phpui"+e;break;case"sharing":gi+="/apiconsole/custommap/getSharingJson";gi+="?styleid="+i+"&type=edit";gi+="&ck="+dx+"._cbk_si_api"+e;break;case"preview":gi+="/apiconsole/custommap/getJson";gi+="?styleid="+i+"&type=edit";gi+="&ck="+dx+"._cbk_si_api"+e;break}fR.load(gi)}else{gl&&gl("default")}}},parseJson:function(gi){if(gi===null||gi===""){return[]}var i={t:"featureType",e:"elementType",v:"visibility",c:"color",l:"lightness",s:"saturation",w:"weight",z:"level",h:"hue",f:"fontsize",zri:"curZoomRegionId",zr:"curZoomRegion"};var gk={all:"all",g:"geometry","g.f":"geometry.fill","g.s":"geometry.stroke",l:"labels","l.t.f":"labels.text.fill","l.t.s":"labels.text.stroke","l.t":"labels.text","l.i":"labels.icon","g.tf":"geometry.topfill","g.sf":"geometry.sidefill"};var gj=gi.split(",");var e=gj.map(function(go){var gn=go.split("|").map(function(gu){var gs=i[gu.split(":")[0]];var gr=(gk[gu.split(":")[1]]?gk[gu.split(":")[1]]:gu.split(":")[1]);switch(gr){case"poi":gr="poilabel";break;case"districtlabel":gr="districtlabel";break}var gt={};gt[gs]=gr;return gt});var gl=gn[0];var gq=1;if(gn[1]["elementType"]){gq=2;A.extend(gl,gn[1])}var gp={};for(var gm=gq;gm<gn.length;gm++){A.extend(gp,gn[gm])}return A.extend(gl,{stylers:gp})});return e},getStyleUrl:function(gi,gk,gj,e){this.styleJson=gi;var i=dX.apiHost+"/custom/v2/mapstyle?version="+4+"&ak="+gk+"&";i+="is_all=true&is_new=1&";i+="styles="+encodeURIComponent(this.styleJson2styleStringV2(gi,e));return i},styleJson2styleStringV2:function(e,go){var gp={featureType:"t",elementType:"e",visibility:"v",color:"c",lightness:"l",saturation:"s",weight:"w",level:"z",hue:"h",fontsize:"f"};var gr={all:"all",geometry:"g","geometry.fill":"g.f","geometry.stroke":"g.s",labels:"l","labels.text.fill":"l.t.f","labels.text.stroke":"l.t.s","labels.text":"l.t","labels.icon":"l.i","geometry.topfill":"g.tf","geometry.sidefill":"g.sf"};var gs=[];for(var gj=this.map.getMinZoom();gj<=this.map.getMaxZoom();gj++){aU.customStyleInfo.zoomFrontStyle[gj]={}}aU.customStyleInfo.zoomFrontStyle.main={};var gi=false;for(var gj=0;!!e[gj];gj++){var gq=e[gj];if(this.isOnlyZoomStyler(gq)){continue}go=this.getFrontZoom(gq,go);if((gq.featureType==="land"||gq.featureType==="all"||gq.featureType==="background")&&typeof gq.elementType==="string"&&(gq.elementType==="geometry"||gq.elementType==="geometry.fill"||gq.elementType==="all")&&gq.stylers&&!gi){if(gq.stylers["color"]){aU.customStyleInfo.bmapLandColor=gq.stylers["color"]}if(gq.stylers["visibility"]&&gq.stylers["visibility"]==="off"){aU.customStyleInfo.bmapLandColor="#00000000"}if(gq.featureType==="land"){gi=true}}if(gq.featureType==="building"&&typeof gq.elementType==="string"&&gq.elementType==="geometry.fill"){aU.customStyleInfo.buildingFill=true}if(gq.featureType==="roadarrow"&&gq.elementType==="labels.icon"&&gq.stylers){aU.customStyleInfo.zoomFrontStyle[go]["bmapRoadarrowVisibility"]=gq.stylers["visibility"]}var gk={};A.extend(gk,gq);var gm=gk.stylers;delete gk.stylers;A.extend(gk,gm);var gl=[];for(var gn in gp){if(gk[gn]){if(this.isEditorZoomKeys(gn)){continue}if(gn==="elementType"){gl.push(gp[gn]+":"+gr[gk[gn]])}else{switch(gk[gn]){case"poilabel":gk[gn]="poi";break;case"districtlabel":gk[gn]="label";break}gl.push(gp[gn]+":"+gk[gn])}}}if(gl.length>2){gs.push(gl.join("|"))}}return gs.join(",")},getFrontZoom:function(i,e){var gi=i.stylers["level"];if(gi===undefined){return"main"}else{return parseInt(gi,10)}},isZoomConfig:function(e){var i=e.stylers["level"];if(i===undefined){return false}else{return true}},isOnlyZoomStyler:function(e){var i={};A.extend(i,e.stylers);delete i.curZoomRegionId;delete i.curZoomRegion;delete i.level;if(A.isEmptyObject(i)){return true}else{return false}},isSelectZoom:function(i,e){var gi=i.stylers["level"];if(gi===undefined){return true}else{if(gi===e+""){return true}else{return false}}},isEditorZoomKeys:function(e){var i={curZoomRegionId:true,curZoomRegion:true};if(i[e]){return true}else{return false}},getZoomRegion:function(e,i){var gj=e.stylers["level"];var gi={};A.extend(gi,i);if(gj===undefined){return gi}else{gi[parseInt(gj,10)]=true;return gi}},onStyleDataBack:function(gj,e,i,gi,gl){if(gj.status!==0){return}if(gj.data.style.length===3){if(!aU.customStyleInfo.baseFs){aU.customStyleInfo.baseFs=gj.data.style}aU.StyleBody=gj.data.style[2]}else{aU.StyleBody=gj.data.style}var gk=aU.customStyleInfo.baseFs;aU["FeatureStyle"+i]=gk;this.updateFrontFeatureStyle()},updateFrontFeatureStyle:function(){if(aU.customStyleInfo.zoomFrontStyle.main["bmapRoadarrowVisibility"]){for(var e=this.map.getMinZoom();e<=this.map.getMaxZoom();e++){if(!aU.customStyleInfo.zoomFrontStyle[e]["bmapRoadarrowVisibility"]){aU.customStyleInfo.zoomFrontStyle[e]["bmapRoadarrowVisibility"]=aU.customStyleInfo.zoomFrontStyle.main["bmapRoadarrowVisibility"]}}}}};var bd={map:null,labelCache:{},calcDrawMc:function(gi,i,e){var gj=[];switch(i){case"fill":gj=this.calcFill(gi,e);break;case"line":break;case"building3d":gj=this.calcBuilding3d(gi,e);break}return gj},calcFill:function(gk,gi){var gl=[];for(var gj=0;gj<gk.length;gj=gj+5){var e=this.coordToMc({x:gk[gj],y:gk[gj+1]},gi.row,gi.col,gi.mercatorSize,gi.baseTileSize);gl.push(e[0],e[1])}return gl},calcLine:function(gk,gi){var gl=[];var gm=new Int16Array(gk.buffer);for(var gj=0;gj<gm.length;gj=gj+10){var e=this.coordToMc({x:gm[gj]/10,y:gm[gj+1]/10},gi.row,gi.col,gi.mercatorSize,gi.baseTileSize);gl.push(e[0],e[1])}return gl},calcBuilding3d:function(gl,gi){var gm=[];var gj={};for(var gk=0;gk<gl.length/2;gk=gk+7){if(gl[gk]===gl[gk-7]&&gl[gk+1]===gl[gk-6]){continue}if(gj[gl[gk].toString()+gl[gk+1].toString()]){continue}gj[gl[gk].toString()+gl[gk+1].toString()]=true;var e=this.coordToMc({x:gl[gk],y:gl[gk+1]},gi.row,gi.col,gi.mercatorSize,gi.baseTileSize);gm.push(e[0],e[1])}return gm},coordToMc:function(gk,gj,e,i,gi){return[gk.x*(i/gi)+e*i,gk.y*(i/gi)+gj*i]},addDrawIntoAreaSpots:function(e,gk){if(f.environment!=="customEditor"){return}if(!gk.styleIds){return}for(var gi=0;gi<gk.styleIds.length;gi++){var gn=0;if(gi>0){gn=gk.verticesLength[gi-1]}end=gk.verticesLength[gi];var gl=[];var gj="";if(gk.vertex){gl=gk.vertex;gj="building3d"}else{if(gk.data[0]){gl=gk.data[0];gj=gk.type}else{continue}}var gm=this.calcDrawMc(gl.slice(gn,end),gj,e);this.map.addAreaSpot(gm,{userData:{styleId:gk.styleIds[gi],type:"mapstyle"}})}},addLabelIntoAreaSpots:function(e){if(f.environment!=="customEditor"){return}for(var gk=0;gk<e.length;gk++){var gl=e[gk];for(var gj=0;gj<gl.fixedLabel.length;gj++){var gi=gl.fixedLabel[gj];if(!gi._mcBds){continue}var gm=[gi._mcBds[0].lng,gi._mcBds[0].lat,gi._mcBds[0].lng,gi._mcBds[1].lat,gi._mcBds[1].lng,gi._mcBds[1].lat,gi._mcBds[1].lng,gi._mcBds[0].lat];if(!this.labelCache[gm.join()]){this.labelCache[gm.join()]=true;this.map.addAreaSpot(gm,{userData:{styleId:gi.styleId,type:"mapstyle",name:gi.name}})}}}}};function bk(i,e,gj,gi){this.cx=3*i;this.bx=3*(gj-i)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*e;this.by=3*(gi-e)-this.cy;this.ay=1-this.cy-this.by;this.p1x=i;this.p1y=gi;this.p2x=gj;this.p2y=gi}bk.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e};bk.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e};bk.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx};bk.prototype.solveCurveX=function(e,go){if(typeof go==="undefined"){go=0.000001}var gn;var gm;var gk;var gi;var gj;for(gk=e,gj=0;gj<8;gj++){gi=this.sampleCurveX(gk)-e;if(Math.abs(gi)<go){return gk}var gl=this.sampleCurveDerivativeX(gk);if(Math.abs(gl)<0.000001){break}gk=gk-gi/gl}gn=0;gm=1;gk=e;if(gk<gn){return gn}if(gk>gm){return gm}while(gn<gm){gi=this.sampleCurveX(gk);if(Math.abs(gi-e)<go){return gk}if(e>gi){gn=gk}else{gm=gk}gk=(gm-gn)*0.5+gn}return gk};bk.prototype.solve=function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))};var bL={};function n(gi){var e={duration:1000,fps:30,delay:0,transition:bL.linear,dropLastAnimation:false};if(gi){for(var gj in gi){e[gj]=gi[gj]}}if(gi.beginTime){this._beginTime=gi.beginTime}this._callbacks=[];this._options=e;if(e.delay){var gk=this;setTimeout(function(){gk._doStart()},e.delay)}else{this._doStart()}}n.INFINITE="INFINITE";n.prototype._doStart=function(){if(window.requestAnimationFrame){var e=this;e._timer=window.requestAnimationFrame(function(i){e._loop(i)})}else{this._beginTime=new Date().getTime();if(this._options.duration===n.INFINITE){this._endTime=null}else{this._endTime=this._beginTime+this._options.duration}this._loop()}};n.prototype._loop=function(gj){var gm=this;gj=gj||new Date().getTime();if(!this._beginTime){this._beginTime=gj}if(!this._endTime&&typeof this._options.duration==="number"){this._endTime=this._beginTime+this._options.duration}if(gm._endTime!==null&&gj>=gm._endTime){if(gm._options.dropLastAnimation===false){gm._options.render(gm._options.transition(1),1,gj)}if(typeof gm._options.finish==="function"){gm._options.finish(gj,this)}for(var gl=0,e=gm._callbacks.length;gl<e;gl++){gm._callbacks[gl]()}return}var gk;if(typeof gm._options.duration==="number"){gk=(gj-gm._beginTime)/gm._options.duration;gm.schedule=gm._options.transition(gk)}else{gk=gj-gm._beginTime;gm.schedule=0}gm._options.render(gm.schedule,gk,gj);if(!gm.terminative){if(window.requestAnimationFrame){gm._timer=requestAnimationFrame(function gi(i){gm._loop(i)})}else{gm._timer=setTimeout(function(){gm._loop()},1000/gm._options.fps)}}};n.prototype.stop=function(i,e){this.terminative=true;if(this._timer){if(window.cancelAnimationFrame){cancelAnimationFrame(this._timer)}else{clearTimeout(this._timer)}this._timer=null;if(typeof this._options.onStop==="function"){this._options.onStop(e)}}if(i){this._endTime=this._beginTime;this._loop()}};n.prototype.cancel=function(){this.stop()};n.prototype.append=function(e){this._callbacks.push(e);return this};bL={_p1:1,_p2:1*1.525,linear:function(e){return e},reverse:function(e){return 1-e},easeInQuad:function(e){return e*e},easeInCubic:function(e){return Math.pow(e,3)},easeInBiquad:function(e){return Math.pow(e,4)},easeInBack:function(e){return e*e*((bL._p1+1)*e-bL._p1)},easeOutQuad:function(e){return -(e*(e-2))},easeOutCubic:function(e){return Math.pow((e-1),3)+1},easeOutBiquad:function(e){return 1-Math.pow((e-1),4)},easeOutBack:function(e){return((e=e-1)*e*((bL._p1+1)*e+bL._p1)+1)},easeInOutQuad:function(e){if(e<0.5){return e*e*2}else{return -2*(e-2)*e-1}},easeInOutCubic:function(e){if(e<0.5){return Math.pow(e,3)*4}else{return Math.pow(e-1,3)*4+1}},easeInOutBiquad:function(e){if(e<0.5){return Math.pow(e,4)*8}else{return 1-(Math.pow(e-1,4)*8)}},easeInOutSine:function(e){return(1-Math.cos(Math.PI*e))/2}};bL.ease=(function(){var e=new bk(0.4,0,0.6,1);return function(i){return e.solve(i)}})();bL["ease-in"]=bL.easeInQuad;bL["ease-out"]=bL.easeOutQuad;var ee={start:function(gp){var gj=gp.el;var e=gp.style;var i=gp.startValue;var gm=gp.endValue;var gk=gp.duration||1400;var gl=gp.transition||bL.linear;var go=gp.callback;var gn=gm-i;var gi=gp.unit||"";return new n({fps:60,duration:gk,transition:gl,render:function(gq){gj.style[e]=i+gn*gq+gi},finish:function(){go&&go()}})}};function b5(gk,gi){dc.call(this);this.keyframes=gk;var e={duration:1000,delay:0,transition:bL.linear,interation:1};if(gi){for(var gj in gi){e[gj]=gi[gj]}}this._options=e}b5.inherits(dc,"ViewAnimation");b5.prototype._start=function(gl){var gi=this;gi.map=gl;var gk=new aM("onanimationstart");gi.dispatchEvent(gk);this._initStatus(gi.map);var gj=this._options.duration;var i=this._options.interation;var gm=this._options.transition;var gn=0;gi.poiStatus=gi.map._displayOptions.poi;if(gi.poiStatus){gi.map.setDisplayOptions({poi:false})}gi.map.viewAnimationTime=new Date().getTime();this.animation=new n({duration:gj,transition:gm,start:function(e){},render:function(go,e){if(go===0){gi._initStatus(gi.map)}else{gi._setViewByRate(go)}},finish:function(gp,go){if(++gn<i||i==="INFINITE"){var gq=new aM("onanimationiterations");gi.dispatchEvent(gq);delete go._beginTime;delete go._endTime;go._doStart()}else{var gq=new aM("onanimationend");gi.dispatchEvent(gq);delete gi.map.viewAnimationTime;gi.map.setDisplayOptions({poi:gi.poiStatus})}}})};b5.prototype._getTotalDuration=function(e,i){if(e===n.INFINITE){return n.INFINITE}else{return e*i}};b5.prototype._initStatus=function(e){if(this.keyframes[0]){e.setCenter(this.keyframes[0].center,{noAnimation:true});e.setZoom(this.keyframes[0].zoom,{noAnimation:true});e.setTilt(this.keyframes[0].tilt,{noAnimation:true});e.setHeading(this.keyframes[0].heading,{noAnimation:true})}};b5.prototype._setViewByRate=function(gj){for(var e=0;e<this.keyframes.length-1;e++){var gk=this.keyframes[e];var gi=this.keyframes[e+1];if(gj>=gk.percentage&&gj<gi.percentage){this.map.setHeading(this._getHeadingDelta(gk,gi,gj),{noAnimation:true});this.map.setTilt(this._getTiltDelta(gk,gi,gj),{noAnimation:true});this.map.setCenter(this._getCenterDelta(gk,gi,gj),{noAnimation:true});this.map.setZoom(this._getZoomDelta(gk,gi,gj),{noAnimation:true})}}};b5.prototype._getHeadingDelta=function(gi,i,e){var gk=(e-gi.percentage)/(i.percentage-gi.percentage);var gj=gi.heading+(i.heading-gi.heading)*gk;return gj};b5.prototype._getTiltDelta=function(gi,i,e){var gk=(e-gi.percentage)/(i.percentage-gi.percentage);var gj=gi.tilt+(i.tilt-gi.tilt)*gk;return gj};b5.prototype._getCenterDelta=function(gi,i,e){var gk=(e-gi.percentage)/(i.percentage-gi.percentage);var gj=gi.center.add(i.center.sub(gi.center).mult(gk));return gj};b5.prototype._getZoomDelta=function(gj,gi,i){var gk=(i-gj.percentage)/(gi.percentage-gj.percentage);var e=gj.zoom+(gi.zoom-gj.zoom)*gk;return e};b5.prototype._cancel=function(gi){gi.setDisplayOptions({poi:this.poiStatus});this.animation.cancel();delete gi.viewAnimationTime;var i=new aM("onanimationcancel");this.dispatchEvent(i)};var dt=undefined;var cg={is64Bit:function(){if(/Windows/.test(navigator.userAgent)){if(/Win64; x64/.test(navigator.userAgent)){return true}else{if(/WOW64/.test(navigator.userAgent)){return true}else{return false}}}return true},isIOS112:function b7(e){return/11_2/.test(navigator.userAgent)},canUseWebAssembly:function(i){if(dt!==undefined){i&&i(dt);return}if(window.WebAssembly&&this.is64Bit()){if(!a0()){dt=true;i&&i(dt)}else{if(this.isIOS112()){dt=false;i&&i(dt)}else{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);WebAssembly.instantiate(e).then(function(gi){dt=true;i&&i(dt)},function(gi){dt=false;i&&i(dt)})}}}else{dt=false;i&&i(dt)}}};var cF={};aU.Utils=cF;function cr(e){return e.style}function cx(i){if(A.Browser.ie>0){i.unselectable="on";i.selectstart=function(){return false};i.onmousedown=function(gi){gi.preventDefault();return false}}else{var e=cr(i);e.MozUserSelect="none";e.WebkitUserSelect="none";i.addEventListener("mousedown",function(gi){gi.preventDefault()},false)}}function fJ(e){return e&&e.parentNode&&e.parentNode.nodeType!==11}function cR(i,e){i.insertAdjacentHTML("beforeEnd",e);return i.lastChild}function f3(gi,i){var gj=document.createElement("div");gj.innerHTML=i;var e=gj.childNodes[0];return gi.parentNode.insertBefore(e,gi)}function j(i){i=i||window.event;i.stopPropagation?i.stopPropagation():i.cancelBubble=true}function bm(i){i=i||window.event;i.preventDefault?i.preventDefault():i.returnValue=false;return false}function cp(i){j(i);return bm(i)}function ex(){var e=document.documentElement;var i=document.body;if(e&&(e.scrollTop||e.scrollLeft)){return[e.scrollTop,e.scrollLeft]}else{if(i){return[i.scrollTop,i.scrollLeft]}else{return[0,0]}}}function ej(gk){if(!gk){return}gk.onload=gk.onerror=null;var gi=gk.attributes,gj,e,gl;if(gi){e=gi.length;for(gj=0;gj<e;gj+=1){gl=gi[gj].name;if(typeof gk[gl]==="function"){gk[gl]=null}}}gi=gk.children;if(gi){e=gi.length;for(gj=0;gj<e;gj+=1){ej(gk.children[gj])}}}function bb(i,gm,gl){var gk=gm.lng-gl.lng;var gj=gm.lat-gl.lat;if(gk===0){return Math.abs(i.lng-gm.lng)}if(gj===0){return Math.abs(i.lat-gm.lat)}var gi=gj/gk;var e=gm.lat-gi*gm.lng;return Math.abs(gi*i.lng-i.lat+e)/Math.sqrt(gi*gi+1)}function fw(i,e){if(!i||!e){return}return Math.round(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)))}function bh(i,e){if(!i||!e){return 0}return Math.round(Math.sqrt(Math.pow(i.lng-e.lng,2)+Math.pow(i.lat-e.lat,2)))}function ch(gi,i){var e=Math.round((gi.x+i.x)/2);var gj=Math.round((gi.y+i.y)/2);return new di(e,gj)}function fO(e,gi){var i=[];gi=gi||function(gk){return gk};for(var gj in e){i.push(gj+"="+gi(e[gj]))}return i.join("&")}function M(gi,i,gl){var gm=document.createElement(gi);if(gl){gm=document.createElementNS(gl,gi)}i=i||{};for(var gj in i){var gk={"for":"htmlFor","class":"cssClass"}[gj]||gj;if(gj==="style"){gm.style.cssText=i[gj];continue}if(gj==="class"){A.ac(gm,i[gj]);continue}if(gm.setAttribute){gm.setAttribute(gk,i[gj])}else{try{gm[gk]=i[gj]}catch(gm){}}}return gm}function eK(e){if(e.currentStyle){return e.currentStyle}else{if(e.ownerDocument&&e.ownerDocument.defaultView){return e.ownerDocument.defaultView.getComputedStyle(e,null)}}}function bn(e){return typeof e==="function"}var fS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function fB(gk){var gi="";var gr;var gp;var gn="";var gq;var go;var gm;var gl="";var gj=0;var e=/[^A-Za-z0-9+/=]/g;if(!gk||e.exec(gk)){return gk}gk=gk.replace(/[^A-Za-z0-9+/=]/g,"");do{gq=fS.indexOf(gk.charAt(gj++));go=fS.indexOf(gk.charAt(gj++));gm=fS.indexOf(gk.charAt(gj++));gl=fS.indexOf(gk.charAt(gj++));gr=(gq<<2)|(go>>4);gp=((go&15)<<4)|(gm>>2);gn=((gm&3)<<6)|gl;gi=gi+String.fromCharCode(gr);if(gm!==64){gi=gi+String.fromCharCode(gp)}if(gl!==64){gi=gi+String.fromCharCode(gn)}gr=gp=gn="";gq=go=gm=gl=""}while(gj<gk.length);return gi}(function(e){if(!e.Utils){e.Utils={}}var i=e.Utils;i.format=(function(){function gi(gm,gl,gn){var gk=gn[+gl];return typeof(gk)==="function"?gk(gl):gk}function gj(gm,gl,gn){var gp=gl;var gq=[];var gk=gl.split(":");if(gk.length===2){gp=gk[0];gq.push(gk[1])}var go=typeof(gn[gp]);if(go==="function"){return gn[gp].apply(undefined,gq)}else{if(go==="undefined"){return gm}else{return String(gn[gp])}}}return function(gk,gl){var gn=gl.splice?gi:gj;var gm=gk.splice?gk.join(""):gk;return gm.replace(/{([a-zA-Z0-9_$:.]+)}/g,function(gp,go){return gn(gp,go,gl)})}})();i.ErrorMonitor=function(gj,gi,gk){};cg.canUseWebAssembly(function(gi){i.canUseWebAssembly=gi})})(aU);function eP(){return(a0()||dy())}function a0(){var e=navigator.userAgent;if(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1){return true}return false}function dy(){var e=navigator.userAgent;if(e.indexOf("Android")>-1){return true}return false}function cT(e){return e*Math.PI/180}function cs(e){return e/Math.PI*180}function cW(e,gk){var gj=Math.pow(10,gk);if(typeof e==="number"){return Math.round(e*gj)/gj}for(var gi=0;gi<e.length;gi++){e[gi]=cW(e[gi],gk)}return e}function et(gi,i,e){if(gi<i){gi=i}else{if(gi>e){gi=e}}return gi}function eL(e,i){while(e<0){e+=i}return e%i}function c8(i,e){return(i>=0&&e>=0)||(i<0&&e<0)}function aI(i){if(i._gl){return i._gl}var e={alpha:true,antialias:false,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,stencil:false};var gi=i.getContext("webgl",e)||i.getContext("experimental-webgl",e);i._gl=gi;return gi}function dF(gj,gi){for(var e=0;e<gi.length;e++){A.on(gj,gi[e],j)}}function gh(i,gi,e){gi[e]=i.getUniformLocation(gi,e)}function dV(gk,gm,e,gi,i){var gj="";switch(i){case"mat4":gk.uniformMatrix4fv(gm[e],false,gi);return;case"v3":gj="uniform3fv";break;case"f":gj="uniform1f";break;case"i":gj="uniform1i";break}if(gj===""){throw"error"}gk[gj](gm[e],gi)}function H(gr,e){while(gr<0){gr+=360}gr=gr%360;var gj=e.width;var gq=e.height;var gm=gj;var gi=gq;if(gr<90){var i=Math.sin(cT(gr))*gj;var go=Math.sin(cT(gr))*gq;var gp=Math.cos(cT(gr))*gj;var gl=Math.cos(cT(gr))*gq;var gm=Math.ceil(gp+go);var gi=Math.ceil(i+gl)}else{if(gr<180){var gr=gr-90;var i=Math.sin(cT(gr))*gj;var go=Math.sin(cT(gr))*gq;var gp=Math.cos(cT(gr))*gj;var gl=Math.cos(cT(gr))*gq;var gm=Math.ceil(i+gl);var gi=Math.ceil(gp+go)}else{if(gr<270){var gr=gr-180;var i=Math.sin(cT(gr))*gj;var go=Math.sin(cT(gr))*gq;var gp=Math.cos(cT(gr))*gj;var gl=Math.cos(cT(gr))*gq;var gm=Math.ceil(gp+go);var gi=Math.ceil(i+gl)}else{var gr=gr-270;var i=Math.sin(cT(gr))*gj;var go=Math.sin(cT(gr))*gq;var gp=Math.cos(cT(gr))*gj;var gl=Math.cos(cT(gr))*gq;var gm=Math.ceil(i+gl);var gi=Math.ceil(gp+go)}}}var gn=gm-gj;var gk=gi-gq;return[0-gn/2,0-gk/2,gj+gn/2,gq+gk/2]}function fm(e){if(e.toDataURL()===fm._blankData){return true}return false}function fd(gk,gj,gi){var i=[gi.lng-gk.lng,gi.lat-gk.lat];var e=[gj.lng-gk.lng,gj.lat-gk.lat];return i[0]*e[1]-i[1]*e[0]}function bF(gl,gk,gi){var e;var gm;var gj;var i;if(gl.lng<gk.lng){e=gl.lng;gj=gk.lng}else{e=gk.lng;gj=gl.lng}if(gl.lat<gk.lat){gm=gl.lat;i=gk.lat}else{gm=gk.lat;i=gl.lat}if(gi.lng<e||gi.lng>gj||gi.lat<gm||gi.lat>i){return false}return true}function ff(gn,gm,gl,gj){var gk=fd(gl,gj,gn);var gi=fd(gl,gj,gm);var i=fd(gn,gm,gl);var e=fd(gn,gm,gj);if(gk*gi<0&&i*e<0){return true}else{if(gk===0&&bF(gl,gj,gn)){return true}else{if(gi===0&&bF(gl,gj,gm)){return true}else{if(i===0&&bF(gn,gm,gl)){return true}else{if(e===0&&bF(gn,gm,gj)){return true}else{return false}}}}}}function f1(gi,i){var e=i.parentNode;if(e.lastChild===i){e.appendChild(gi)}else{e.insertBefore(gi,i.nextSibling)}}function f7(gp,gq){if(gq===0){return gp}var go=0;var gm=0;if(!gp){throw"异常"}if(gp.length===0){return[]}for(var gk=1,gi=gp.length-1;gk<gi;gk++){var gn=bb(gp[gk],gp[0],gp[gp.length-1]);if(gn>go){gm=gk;go=gn}}var e=[];if(go>=gq){var gs=gp.slice(0,gm);var gr=gp.slice(gm,gp.length);var gl=f7(gs,gq);var gj=f7(gr,gq);for(var gk=0,gi=gl.length;gk<gi;gk++){e.push(gl[gk])}for(var gk=0,gi=gj.length;gk<gi;gk++){e.push(gj[gk])}}else{e.push(gp[0]);e.push(gp[gp.length-1])}return e}function dz(e){if(Math.log2){return Math.log2(e)}return Math.log(e)/Math.LN2}function aX(gi,i,e){return Math.min(e,Math.max(i,gi))}function b3(e,i){if(!i){return e}var gl=i[0];var gk=i[1];var gj=i[2];var gi=i[3];var gn=[];var gm=[];gn[0]=gi*e[0]+gj*e[2];gn[1]=e[1];gn[2]=-gj*e[0]+gi*e[2];gm[0]=gn[0];gm[1]=gk*gn[1]-gl*gn[2];gm[2]=gl*gn[1]+gk*gn[2];return gm}var aw=Math.PI/180;var B=180/Math.PI;function a4(gi){var i=(gi-Date.UTC(2000,0,1,12))/86400000/36525;var e=(d3.utcDay.floor(gi)-gi)/86400000*360-180;return[e-N(i)*B,fj(i)*B]}function N(gj){var gk=eR(gj);var i=cU(gj);var gi=Z(gj);var gl=Math.tan(eO(gj)/2);gl*=gl;return gl*Math.sin(2*gi)-2*gk*Math.sin(i)+4*gk*gl*Math.sin(i)*Math.cos(2*gi)-0.5*gl*gl*Math.sin(4*gi)-1.25*gk*gk*Math.sin(2*i)}function fj(e){return Math.asin(Math.sin(eO(e))*Math.sin(fz(e)))}function fz(e){return aP(e)-(0.00569+0.00478*Math.sin((125.04-1934.136*e)*aw))*aw}function aP(e){return Z(e)+cX(e)}function cU(e){return(357.52911+e*(35999.05029-0.0001537*e))*aw}function Z(i){var e=(280.46646+i*(36000.76983+i*0.0003032))%360;return(e<0?e+360:e)/180*Math.PI}function cX(i){var e=cU(i);return(Math.sin(e)*(1.914602-i*(0.004817+0.000014*i))+Math.sin(e+e)*(0.019993-0.000101*i)+Math.sin(e+e+e)*0.000289)*aw}function eO(e){return d7(e)+0.00256*Math.cos((125.04-1934.136*e)*aw)*aw}function d7(e){return(23+(26+(21.448-e*(46.815+e*(0.00059-e*0.001813)))/60)/60)*aw}function eR(e){return 0.016708634-e*(0.000042037+1.267e-7*e)}function aJ(){return window.devicePixelRatio||1}function ao(gi){var i;var e;var gj;if(gi>=0){gj=Math.floor(gi/65536)*65536;i=gj;e=gi-gj}else{gj=Math.floor(-gi/65536)*65536;i=-gj;e=gi+gj}return[i,e]}function D(e){if(e.lng>=0&&e.lat>=0){return new fX(e.lng-10000000,e.lat-6000000)}if(e.lng>=0&&e.lat<0){return new fX(e.lng-10000000,e.lat+6000000)}if(e.lng<0&&e.lat>=0){return new fX(e.lng+10000000,e.lat-6000000)}if(e.lng<0&&e.lat<0){return new fX(e.lng+10000000,e.lat+6000000)}}var eq=null;if(window.performance&&window.performance.now){eq=function(){return performance.now()}}else{if(Date.now){eq=function(){return Date.now()}}else{eq=function(){return(new Date).getTime()}}}function bf(gj,e,i){var gi="mouseWheel";if(A.Platform.macintosh){if(!isNaN(gj)&&(gj<10||gj!==120)&&(e%1===0&&e<5)){gi="padScroll"}if(A.Browser.firefox&&(e%1===0&&e<5&&i===0)){gi="padScroll"}}if(A.Browser.safari&&gj===12){gi="mouseWheel"}return gi}function ct(gs,gn){var gr=gs[0];var gq=gs[1];var gj=false;for(var gm=0,gl=gn.length-2;gm<gn.length;gm+=2){var gp=gn[gm];var gk=gn[gm+1];var go=gn[gl];var gi=gn[gl+1];var e=((gk>gq)!==(gi>gq))&&(gr<(go-gp)*(gq-gk)/(gi-gk)+gp);if(e){gj=!gj}gl=gm}return gj}function bZ(gi,e,i,gj){gj=gj||0.4;if(gi>i){gi=Math.pow(gi-i+1,gj)+i-1}else{if(gi<e){gi=e-Math.pow(e-gi+1,gj)+1}}return gi}function e3(gn){var gl="";for(var gi=0;gi<gn.length;gi++){var go=gn.charCodeAt(gi)<<1;var e=go.toString(2);var gk=e.length;var gr=e;if(gk<8){gr="00000000"+e;gr=gr.substr(e.length,8)}gl+=gr}var gp=5-gl.length%5;var gj=[];for(var gi=0;gi<gp;gi++){gj[gi]="0"}gl=gj.join("")+gl;var gq=[];for(var gi=0;gi<gl.length/5;gi++){var go=gl.substr(gi*5,5);var gm=parseInt(go,2)+50;gq.push(String.fromCharCode(gm))}return gq.join("")+gp.toString()}function an(gi,i){var e=aU.TILE_VERSION||window.TILE_VERSION;if(!e||!e[gi]||!e[gi][i]||!e[gi][i].version||!e[gi][i].updateDate){e=dX.tvc}return{ver:e[gi][i].version,udt:e[gi][i].updateDate}}function ep(){var e=aU.MSV||window.MSV;if(!e||!e.mapstyle||!e.mapstyle.updateDate||!e.mapstyle.version){e=dX.msv}return{ver:e.mapstyle.version,udt:e.mapstyle.updateDate}}function dq(e,gk){var gj=e.slice(0);for(var gi=0;gi<gj.length;gi++){gj[gi]+=gk}return gj}var aH=null;function a3(e){if(aH){return}e.fire(new aM("onloadtile"));aH=setTimeout(function(){aH=null},1000)}function dU(){if(bO("//map.baidu.com")||bO("//maps.baidu.com")||bO("//ditu.baidu.com")){return true}return false}cF.inMapHost=dU();if(typeof window._inMapHost==="boolean"){cF.inMapHost=window._inMapHost}function bO(i){var gi=window.location;var e=document.createElement("a");e.href=i;return e.hostname===gi.hostname&&e.port===gi.port&&e.protocol===gi.protocol}function da(){}A.extend(da,{Request:{INITIAL:-1,WAITING:0,LOADED:1,COMPLETED:2},Dependency:{poly:["marker"],infowindow:["marker"],groundOverlay:["marker"],simpleInfowindow:["marker"],hotspot:["poly"],tools:["marker","poly"],mapgl:["glcommon","poly"],earth:["glcommon"]},MD5Mapping:{control:"yxr1bc",marker:"wwufd1",poly:"tnsnra",infowindow:"5xctze",simpleInfowindow:"ncmi0i",groundOverlay:"ow2ula",hotspot:"aovdde",menu:"wqb3sq",tools:"04fanb",oppc:"f0hcu4",oppcgl:"ikfdsu",mapgl:"2sivp5",markeranimation:"0j5uze",earth:"fkrmmp",glcommon:"0g3zc3",otherSearch:"2xmzsf"},Config:{baseUrl:dX.apiHost+"/getmodules?v=1.0&type=webgl",jsModPath:(cF.inMapHost?"":dX.mapHost)+"/res/newui/",timeout:5000},delayFlag:false,Module:{modules:{},modulesNeedToLoad:[]},_getMd5ModsStr:function(gl){var gk=[];for(var gn=0,gi=gl.length;gn<gi;gn++){var gm=gl[gn];var e=this.MD5Mapping[gm];var gj="$"+gm+"$";if(e!==gj){gk.push(gm+"_"+e)}}return gk.join(",")},load:function(i,gl,gj){var e=this.getModuleInfo(i);if(e.status===this.Request.COMPLETED){if(gj===true){gl()}}else{if(e.status===this.Request.INITIAL){this.combine(i);this.addToLoadQueue(i);var gi=this;if(gi.delayFlag===false){gi.delayFlag=true;setTimeout(function(){var gm=gi.Config.baseUrl+"&mod="+gi._getMd5ModsStr(gi.Module.modulesNeedToLoad);fR.load(gm);gi.Module.modulesNeedToLoad.length=0;gi.delayFlag=false},1)}e.status=this.Request.WAITING;function gk(go){var gn=gi.getModuleInfo(i);if(gn.status!==gi.Request.COMPLETED){if(window.map){var gm=new aM("onmod_timeout");gm.timeout=go/1000;gm.moduleName=i;window.map.fire(gm)}}}setTimeout(gk,this.Config.timeout,this.Config.timeout);setTimeout(gk,this.Config.timeout*2,this.Config.timeout*2)}e.callbacks.push(gl)}},combine:function(e){if(e&&this.Dependency[e]){var gj=this.Dependency[e];for(var gi=0;gi<gj.length;gi++){this.combine(gj[gi]);if(!this.Module.modules[gj[gi]]){this.addToLoadQueue(gj[gi])}}}},addToLoadQueue:function(e){var i=this.getModuleInfo(e);if(i.status===this.Request.INITIAL){i.status=this.Request.WAITING;this.Module.modulesNeedToLoad.push(e)}},run:function(gi,gj){var gn=this.getModuleInfo(gi);var gq=this.Dependency[gi];if(gq){for(var gl=0;gl<gq.length;gl++){var gm=this.getModuleInfo(gq[gl]);if(gm.status!==this.Request.COMPLETED){gm.modsNeedToRun.push({name:gi,code:gj});return}}}try{eval(gj)}catch(go){return}gn.status=this.Request.COMPLETED;for(var gl=0,gk=gn.callbacks.length;gl<gk;gl++){gn.callbacks[gl]()}gn.callbacks.length=0;for(gl=0;gl<gn.modsNeedToRun.length;gl++){var gp=gn.modsNeedToRun[gl];this.run(gp.name,gp.code)}gn.modsNeedToRun.length=0},getModuleInfo:function(i){var e;if(!this.Module.modules[i]){this.Module.modules[i]={status:this.Request.INITIAL,callbacks:[],modsNeedToRun:[]}}e=this.Module.modules[i];return e}});window._jsload=function(gk,gl){var i=da.getModuleInfo(gk);i.status=da.Request.LOADED;if(gl!==""){da.run(gk,gl)}else{if(window.map){var e=new aM("ongetmodules_fail");e.moduleName=gk;window.map.fire(e)}var gi=document.createElement("script");var gj=da.MD5Mapping[gk];gi.src=da.Config.jsModPath+gk+"_"+gj+".js";document.getElementsByTagName("head")[0].appendChild(gi)}};function T(){this._timeData={}}var d4;if(typeof window!=="undefined"){d4=window}else{d4=self}T.prototype.mark=function(e){this._timeData[e]=this._getTime()};T.prototype.getMark=function(e){return this._timeData[e]};T.prototype.getTime=function(i,e){return parseFloat((this._timeData[e]-this._timeData[i]).toFixed(2))};T.prototype.print=function(){};T.prototype.clear=function(){this._timeData={}};if(d4.performance&&d4.performance.now){T.prototype._getTime=function(){return performance.now()}}else{T.prototype._getTime=function(){return Date.now()}}!function(i,gi){gi(i.d3=i.d3||{})}(window,function(gV){function hd(hl,hm,hj,hk){function e(i){return hl(i=new Date(+i)),i}return e.floor=e,e.ceil=function(i){return hl(i=new Date(i-1)),hm(i,1),hl(i),i},e.round=function(i){var hn=e(i),ho=e.ceil(i);return ho-i>i-hn?hn:ho},e.offset=function(i,hn){return hm(i=new Date(+i),null==hn?1:Math.floor(hn)),i},e.range=function(ho,i,hn){var hp=[];if(ho=e.ceil(ho),hn=null==hn?1:Math.floor(hn),!(i>ho&&hn>0)){return hp}do{hp.push(new Date(+ho))}while(hm(ho,hn),hl(ho),i>ho);return hp},e.filter=function(i){return hd(function(hn){for(;hl(hn),!i(hn);){hn.setTime(hn-1)}},function(hn,ho){for(;--ho>=0;){for(;hm(hn,1),!i(hn);){}}})},hj&&(e.count=function(i,hn){return gX.setTime(+i),g1.setTime(+hn),hl(gX),hl(g1),Math.floor(hj(gX,g1))},e.every=function(i){return i=Math.floor(i),isFinite(i)&&i>0?i>1?e.filter(hk?function(hn){return hk(hn)%i===0}:function(hn){return e.count(0,hn)%i===0}):e:null}),e}function g2(e){return hd(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,hj){i.setDate(i.getDate()+7*hj)},function(i,hj){return(hj-i-(hj.getTimezoneOffset()-i.getTimezoneOffset())*gW)/ha})}function gU(e){return hd(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,hj){i.setUTCDate(i.getUTCDate()+7*hj)},function(i,hj){return(hj-i)/ha})}var gX=new Date,g1=new Date,g8=hd(function(){},function(i,hj){i.setTime(+i+hj)},function(i,hj){return hj-i});g8.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?hd(function(i){i.setTime(Math.floor(i/e)*e)},function(i,hj){i.setTime(+i+hj*e)},function(i,hj){return(hj-i)/e}):g8:null};var hh=g8.range,hf=1000,gW=60000,hc=3600000,g4=86400000,ha=604800000,go=hd(function(e){e.setTime(Math.floor(e/hf)*hf)},function(i,hj){i.setTime(+i+hj*hf)},function(i,hj){return(hj-i)/hf},function(e){return e.getUTCSeconds()}),he=go.range,g3=hd(function(e){e.setTime(Math.floor(e/gW)*gW)},function(i,hj){i.setTime(+i+hj*gW)},function(i,hj){return(hj-i)/gW},function(e){return e.getMinutes()}),gw=g3.range,gQ=hd(function(i){var hj=i.getTimezoneOffset()*gW%hc;0>hj&&(hj+=hc),i.setTime(Math.floor((+i-hj)/hc)*hc+hj)},function(i,hj){i.setTime(+i+hj*hc)},function(i,hj){return(hj-i)/hc},function(e){return e.getHours()}),g9=gQ.range,gG=hd(function(e){e.setHours(0,0,0,0)},function(i,hj){i.setDate(i.getDate()+hj)},function(i,hj){return(hj-i-(hj.getTimezoneOffset()-i.getTimezoneOffset())*gW)/g4},function(e){return e.getDate()-1}),gn=gG.range,gD=g2(0),gF=g2(1),gj=g2(2),gB=g2(3),gq=g2(4),gT=g2(5),g0=g2(6),gl=gD.range,gS=gF.range,gu=gj.range,gP=gB.range,g5=gq.range,gR=gT.range,hg=g0.range,g7=hd(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(i,hj){i.setMonth(i.getMonth()+hj)},function(i,hj){return hj.getMonth()-i.getMonth()+12*(hj.getFullYear()-i.getFullYear())},function(e){return e.getMonth()}),hi=g7.range,gA=hd(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(i,hj){i.setFullYear(i.getFullYear()+hj)},function(i,hj){return hj.getFullYear()-i.getFullYear()},function(e){return e.getFullYear()});gA.every=function(e){return isFinite(e=Math.floor(e))&&e>0?hd(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,hj){i.setFullYear(i.getFullYear()+hj*e)}):null};var gt=gA.range,gY=hd(function(e){e.setUTCSeconds(0,0)},function(i,hj){i.setTime(+i+hj*gW)},function(i,hj){return(hj-i)/gW},function(e){return e.getUTCMinutes()}),gI=gY.range,gH=hd(function(e){e.setUTCMinutes(0,0,0)},function(i,hj){i.setTime(+i+hj*hc)},function(i,hj){return(hj-i)/hc},function(e){return e.getUTCHours()}),gE=gH.range,gC=hd(function(e){e.setUTCHours(0,0,0,0)},function(i,hj){i.setUTCDate(i.getUTCDate()+hj)},function(i,hj){return(hj-i)/g4},function(e){return e.getUTCDate()-1}),gz=gC.range,gy=gU(0),gx=gU(1),gv=gU(2),gs=gU(3),gr=gU(4),gm=gU(5),gk=gU(6),gi=gy.range,gO=gx.range,hb=gv.range,gZ=gs.range,g6=gr.range,gN=gm.range,gM=gk.range,gL=hd(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(i,hj){i.setUTCMonth(i.getUTCMonth()+hj)},function(i,hj){return hj.getUTCMonth()-i.getUTCMonth()+12*(hj.getUTCFullYear()-i.getUTCFullYear())},function(e){return e.getUTCMonth()}),gK=gL.range,gp=hd(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(i,hj){i.setUTCFullYear(i.getUTCFullYear()+hj)},function(i,hj){return hj.getUTCFullYear()-i.getUTCFullYear()},function(e){return e.getUTCFullYear()});gp.every=function(e){return isFinite(e=Math.floor(e))&&e>0?hd(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,hj){i.setUTCFullYear(i.getUTCFullYear()+hj*e)}):null};var gJ=gp.range;gV.timeInterval=hd,gV.timeMillisecond=g8,gV.timeMilliseconds=hh,gV.utcMillisecond=g8,gV.utcMilliseconds=hh,gV.timeSecond=go,gV.timeSeconds=he,gV.utcSecond=go,gV.utcSeconds=he,gV.timeMinute=g3,gV.timeMinutes=gw,gV.timeHour=gQ,gV.timeHours=g9,gV.timeDay=gG,gV.timeDays=gn,gV.timeWeek=gD,gV.timeWeeks=gl,gV.timeSunday=gD,gV.timeSundays=gl,gV.timeMonday=gF,gV.timeMondays=gS,gV.timeTuesday=gj,gV.timeTuesdays=gu,gV.timeWednesday=gB,gV.timeWednesdays=gP,gV.timeThursday=gq,gV.timeThursdays=g5,gV.timeFriday=gT,gV.timeFridays=gR,gV.timeSaturday=g0,gV.timeSaturdays=hg,gV.timeMonth=g7,gV.timeMonths=hi,gV.timeYear=gA,gV.timeYears=gt,gV.utcMinute=gY,gV.utcMinutes=gI,gV.utcHour=gH,gV.utcHours=gE,gV.utcDay=gC,gV.utcDays=gz,gV.utcWeek=gy,gV.utcWeeks=gi,gV.utcSunday=gy,gV.utcSundays=gi,gV.utcMonday=gx,gV.utcMondays=gO,gV.utcTuesday=gv,gV.utcTuesdays=hb,gV.utcWednesday=gs,gV.utcWednesdays=gZ,gV.utcThursday=gr,gV.utcThursdays=g6,gV.utcFriday=gm,gV.utcFridays=gN,gV.utcSaturday=gk,gV.utcSaturdays=gM,gV.utcMonth=gL,gV.utcMonths=gK,gV.utcYear=gp,gV.utcYears=gJ,Object.defineProperty(gV,"__esModule",{value:!0})});function e5(e){this._elemType=e;this._objCollection={}}e5.prototype.get=function(){var i=null;for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e]._free===true){this._objCollection[e]._free=false;return this._objCollection[e]}}i=M(this._elemType);e=aU.getGUID("obj_pool_");this._objCollection[e]=i;return i};e5.prototype.free=function(e){if(!e){return}e._free=true;if(e.tagName.toLowerCase()==="img"){e.src="";e.crossOrigin=null;e.onload=e.onerror=null}};e5.prototype.clear=function(){for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e].tagName.toLowerCase==="img"){this._objCollection[e].onload=this._objCollection[e].onerror=null}}this._objCollection={}};var fh={get:function(i,gk,e,gi){var gj=new XMLHttpRequest();gj.open("GET",i,true);gj.timeout=10000;gj.ontimeout=function(){gi&&gi()};gj.onreadystatechange=function(gl){if(this.readyState===4){if(this.status===200){gk&&gk(gj.responseText)}else{e&&e()}}};gj.send()},post:function(i,gl,gk,e,gi){var gj=new XMLHttpRequest();gj.open("POST",i,true);gj.setRequestHeader("Content-type","application/x-www-form-urlencoded");gj.timeout=10000;gj.ontimeout=function(){gi&&gi()};gj.onreadystatechange=function(gm){if(this.readyState===4){if(this.status===200){gk&&gk(gj.responseText,gl)}else{e&&e()}}};gj.send(gl);return gj}};var fR=(function(e){function i(gl,gi,gk){var gj=M("script",{src:gl,type:"text/javascript",charset:"utf-8"});if(gj.addEventListener){gj.addEventListener("load",function(gn){var gm=gn.target;gm.parentNode.removeChild(gm);gi&&gi()},false);gj.addEventListener("error",function(gm){gk&&gk(null)},false)}else{if(gj.attachEvent){gj.attachEvent("onreadystatechange",function(gn){var gm=window.event.srcElement;if(gm&&(gm.readyState==="loaded"||gm.readyState==="complete")){gm.parentNode.removeChild(gm)}gi&&gi()})}}e.getElementsByTagName("head")[0].appendChild(gj)}return{load:function(gm,gi,gj){if(typeof gm==="string"){i(gm,gi,gj)}else{if(gm.length>0){var gl=gm.length;for(var gk=0;gk<gl;gk++){i(gm[gk],function(){gl--;if(gl===0&&gi){gi()}})}}}}}})(window.document);function b4(){}b4.instances={};b4.getInstance=function(i,gi){if(b4.instances[i]){return b4.instances[i]}var e=new cv(i,gi);b4.instances[i]=e;return e};function cv(e,i){this._name=e;this._baseZoom=18;this._opts={tileSize:256};A.extend(this._opts,i||{})}cv.mapZoomBaseIndex=[0,0,0,8,7,7,6,6,5,5,4,3,3,3,2,2,1,1,0,0,0,0];cv.baseScaleZoom=[19,17,15,12,10,9,7,5,3];cv.baseScaleZoomMercatorSize=[512,2048,4096,32768,65536,262144,1048576,4194304,8388608];cv.mapZoomBaseZoomMapping=[0,0,0,3,5,5,7,7,9,9,10,12,12,12,15,15,17,17,19,19,19,19];cv.mapZoomStartZoomMapping=[0,0,0,3,4,4,6,6,8,8,10,11,11,11,14,14,16,16,18,18,18,18];cv.baseScaleTileSize=[1024,1024,512,512,256,512,512,512,256];cv.mapZoomTileSize=[0,0,0,256,256,512,256,512,256,512,256,256,512,1024,256,512,512,1024,512,1024,2048,4096];cv.baseZoomInfo={"3":[3],"5":[4,5],"7":[6,7],"9":[8,9],"10":[10],"12":[11,12,13],"15":[14,15],"17":[16,17],"19":[18,19,20,21]};cv.prototype={getName:function(){return this._name},getTileSize:function(e){e=Math.floor(e);if(e<3){e=3}if(this._name==="na"){return cv.mapZoomTileSize[e]}return this._opts.tileSize},getBaseTileSize:function(i){i=Math.floor(i);if(this._name==="na"){var e=cv.mapZoomBaseZoomMapping[i];return cv.mapZoomTileSize[e]}return this._opts.tileSize},getDataZoom:function(e){e=Math.floor(e);if(this._name==="na"){return cv.mapZoomBaseZoomMapping[e]}return e},getZoomUnits:function(e){return Math.pow(2,(this._baseZoom-e))},getMercatorSize:function(gi,i){if(this._name==="na"){gi=Math.floor(gi);var e=cv.mapZoomBaseIndex[gi];return cv.baseScaleZoomMercatorSize[e]}return this._opts.tileSize*this.getZoomUnits(i)},getBaseZoom:function(){return this._baseZoom},getParentTile:function(gj,gp,go,gi,i){if(this._name==="na"){var gk=cv.baseZoomInfo[go];gi--;if(gk.indexOf(gi)>-1){return{col:gj,row:gp,zoom:go,useZoom:gi}}else{var gm=cv.mapZoomBaseIndex[go];var gl=cv.baseScaleZoom[gm+1];if(!gl){return null}var gn=this.getFactorByZooms(gl,go);var e=cv.baseZoomInfo[gl];return{col:Math.floor(gj/gn),row:Math.floor(gp/gn),zoom:gl,useZoom:e[e.length-1]}}return null}if(go-1<i){return null}return{col:Math.floor(gj/2),row:Math.floor(gp/2),zoom:go-1,useZoom:go-1}},getChildTiles:function(gk,gm,e,gi,gt,gz){if(this._name==="na"){var gj=cv.baseZoomInfo[e];gi+=gz;if(gj.indexOf(gi)>-1){return[{col:gk,row:gm,zoom:e,useZoom:gi}]}else{var gx=0;var gu=e;while(gx<gz){var gy=cv.mapZoomBaseIndex[gu];var go=cv.baseScaleZoom[gy-1];if(!go){return null}var gp=cv.baseZoomInfo[go];if(gp[gz-1]){var gq=[];var gs=this.getFactorByZooms(e,go);var i=gk*gs;var gr=gm*gs;for(var gw=0;gw<gs;gw++){var gl=i+gw;for(var gv=0;gv<gs;gv++){var gn=gr+gv;gq.push({col:gl,row:gn,zoom:go,useZoom:gp[gz-1]})}}return gq}gx+=gp.length;if(gz===gp.length){gu=go}}}return null}var gq=[];if(e+gz>gt){return null}var gs=Math.pow(2,gz);var i=gk*gs;var gr=gm*gs;var go=e+gz;var gq=[];for(var gw=0;gw<2;gw++){var gl=i+gw;for(var gv=0;gv<2;gv++){var gn=gr+gv;gq.push({col:gl,row:gn,zoom:go,useZoom:go})}}return gq},getFactorByZooms:function(i,gj){var gi=cv.mapZoomBaseIndex[i];var gk=cv.mapZoomBaseIndex[gj];var e=cv.baseScaleZoomMercatorSize[gi];var gl=cv.baseScaleZoomMercatorSize[gk];return e/gl}};var aL={};var W=["swiftshader","microsoft basic render driver"];var bJ=["intel","nvidia","amd","apple","geforce"];function cE(e){e=e.toLowerCase();if(W.indexOf(e)>=0){return true}if(e.indexOf("mobile")>=0){return true}return false}function es(gi){gi=gi.toLowerCase();for(var e=0;e<bJ.length;e++){if(gi.indexOf(bJ[e])>=0){return true}}return false}function c4(e){if(!e){return false}if(cE(e)){return false}if(es(e)){return true}return false}aL.ifEnableEarth=function(i){var e=aL.ifEnableEarth;if(!i&&typeof e._enable==="boolean"){return e._enable}if(aL.ifSupportWebGL()){e._enable=true;return true}e._enable=false;return false};aL.ifEnableWebGLMap=function(i){var e=aL.ifEnableWebGLMap;if(!i&&typeof e._enable==="boolean"){return e._enable}if(aL.ifSupportWebGL()){if(cF.inMapHost){e._enable=true;return true}else{if(window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder){e._enable=true;return true}else{e._enable=false;return false}}}e._enable=false;return false};aL.params={};aL.ifSupportWebGL=function(){var i=aL.ifSupportWebGL;if(typeof i._supportWebGL==="boolean"){return i._supportWebGL}if(!window.WebGLRenderingContext){i._supportWebGL=false;return false}var gi=document.createElement("canvas");gi.width=300;gi.height=150;var gk=null;var gr={alpha:true,antialias:false,failIfMajorPerformanceCaveat:true,preserveDrawingBuffer:false,stencil:false};try{gk=gi.getContext("webgl",gr)||gi.getContext("experimental-webgl",gr)}catch(gn){i._supportWebGL=false}if(gk===null){i._supportWebGL=false}else{i._supportWebGL=true;var gp=gk.getExtension("WEBGL_debug_renderer_info");if(gp){var go=gk.getParameter(gp.UNMASKED_RENDERER_WEBGL);if(c4(go)===true){i._supportWebGL=true}var gq=gk.getParameter(gp.UNMASKED_VENDOR_WEBGL);i._renderer=go;i._vendor=gq}if(!gp&&A.Browser.firefox){i._supportWebGL=true}if(!gp&&A.Platform.macintosh){i._supportWebGL=true}if(gk.drawingBufferWidth!==gi.width||gk.drawingBufferHeight!==gi.height){i._supportWebGL=false}if(gk.getParameter(gk.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<4){i._supportWebGL=false}var gj=gk.getParameter(gk.MAX_TEXTURE_SIZE);aL.params.maxTextureSize=gj;if(gj<4096){i._supportWebGL=false}var gm=gk.getParameter(gk.MAX_TEXTURE_IMAGE_UNITS);if(gm<8){i._supportWebGL=false}if(!gk.getShaderPrecisionFormat||gk.getShaderPrecisionFormat(gk.FRAGMENT_SHADER,gk.HIGH_FLOAT).precision<23){i._supportWebGL=false}}return i._supportWebGL};aL.ifSupportCanvas2d=function(){var gk=aL.ifSupportCanvas2d;if(typeof gk.supportCanvas2d==="boolean"){return gk.supportCanvas2d}var gi=document.createElement("canvas");var i=null;try{i=gi.getContext("2d")}catch(gj){gk.supportCanvas2d=false}if(i===null){gk.supportCanvas2d=false}else{gk.supportCanvas2d=true}return gk.supportCanvas2d};aL.ifEnableCanvas2dMap=function(){var i=navigator.userAgent;var e=0;var gj=0;var gk=0;if(/macintosh/ig.test(i)){var gi=0;if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)){gi=parseInt((RegExp["\x241"]||RegExp["\x242"]),10)}if(gi>0){return false}return true}if(/windows nt (\d+\.\d)/ig.test(i)){gj=parseFloat(RegExp.$1);if(gj>=6.1){if(/chrome\/(\d+\.\d)/i.test(i)){e=parseFloat(RegExp.$1);if(e>=31){return true}}if(/MSIE (\d+(\.\d+)?)/.test(i)){gk=parseFloat(RegExp.$1);if(gk>=10){return true}}if(/Firefox/.test(i)){return true}if(/rv:11.0/ig.test(i)){return true}if(/edge/ig.test(i)){return true}}}return false};aL.ifSupportCSS3=function(gn,i){var gm=document.createElement("div");var gl="Webkit Moz O ms".split(" ");var e=gl.length;var gi="";var gj=gm.style;if(gn in gj){gi=gn}gn=gn.replace(/^[a-z]/,function(go){return go.toUpperCase()});while(e--){var gk=gl[e]+gn;if(gk in gj){gi=gk;break}}if(i){return gi}else{return gi.length>0?true:false}};aL.isModernBrowser=aL.ifSupportCanvas2d()&&aL.ifSupportCSS3("transform");function dT(i,e){this._size=i;this._curSize=0;this._cache={};this._least=null;this._most=null;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var gi in e){this._options[gi]=e[gi]}this._getDataTimes=0;this._hitTimes=0}dT.prototype.setData=function(gj,gl){var i=this._cache;var gi=this._size;if(gi===0){return}var e=this._curSize;if(e===gi){this._removeOld()}var gk;if(!i[gj]){gk={key:gj,data:gl,older:null,newwer:null};i[gj]=gk;if(this._least===null){this._least=gk}if(this._most===null){this._most=gk}this._curSize++}else{gk=i[gj];gk.data=gl;if(this._most===gk){return}gk.older&&(gk.older.newer=gk.newer);gk.newer&&(gk.newer.older=gk.older);if(this._least===gk){this._least=gk.newer}}if(this._most&&this._most!==gk){this._most.newer=gk;gk.older=this._most;this._most=gk;gk.newer=null}};dT.prototype.getData=function(e){var i=this._cache[e];this._getDataTimes++;if(i){this._hitTimes++;var gi=i.data;if(this._most===i){return gi}i.older&&(i.older.newer=i.newer);i.newer&&(i.newer.older=i.older);if(this._least===i){this._least=i.newer}this._most.newer=i;i.older=this._most;i.newer=null;this._most=i;return gi}return null};dT.prototype.getAllData=function(){return this._cache};dT.prototype.getHitRate=function(){return this._hitTimes/this._getDataTimes};dT.prototype.removeData=function(i){var e=this._cache;var gi=e[i];if(!gi){return}if(this._options.clearCallback){this._options.clearCallback(gi.data,gi.key)}gi.older&&(gi.older.newer=gi.newer);gi.newer&&(gi.newer.older=gi.older);if(this._least===gi){this._least=gi.newer}if(this._most===gi){this._most=gi.older}delete e[i];this._curSize--};dT.prototype._removeOld=function(){var e=this._cache;var gj=Math.round(this._size*0.6);var gi=0;while(this._least&&gi<gj){var i=this._least;this._least=i.newer;i.newer&&(i.newer.older=null);if(this._options.clearCallback){this._options.clearCallback(i.data,i.key)}delete e[i.key];gi++}this._curSize-=gi;if(this._options.removeOldCallback){this._options.removeOldCallback()}};dT.prototype.clear=function(){var e=this._cache;var i=this._least;if(this._options.clearCallback){while(i){this._options.clearCallback(i.data,i.key);i=i.newer}}this._least=this._most=null;this._cache={};this._curSize=0};dT.prototype.forEach=function(e){var i=this._least;while(i){e(i.data);i=i.newer}};dT.prototype.clearExcept=function(i){var e=this._cache;var gi=this._least;while(gi){if(!i[gi.key]){if(this._options.clearCallback){this._options.clearCallback(gi.data,gi.key)}gi.older&&(gi.older.newer=gi.newer);gi.newer&&(gi.newer.older=gi.older);if(this._least===gi){this._least=gi.newer}if(this._most===gi){this._most=gi.older}delete e[gi.key];this._curSize--}gi=gi.newer}};var bW={request:function(gm,gj,i,go,gi){var gk=(Math.random()*100000).toFixed(0);aU._rd["_cbk"+gk]=function(gp){if(gp.result&&gp.result["error"]&&gp.result["error"]===202){alert("该AK因为恶意行为已经被管理员封禁！");return}i=i||{};gm&&gm(gp,i);delete aU._rd["_cbk"+gk]};go=go||"";var gn;if(i&&i.useEncodeURI){gn=fO(gj,encodeURI)}else{gn=fO(gj,encodeURIComponent)}var gl=this;var e=dX.apiHost+"/"+go+"?"+gn+"&ie=utf-8&oue=1&fromproduct=jsapi";if(!gi){e+="&res=api"}e+="&callback="+dx+"._rd._cbk"+gk;e+="&ak="+eX;fR.load(e)}};aU._rd={};function aK(){this._map=null;this._container;this._type="control";this.blockInfoWindow=true;this._visible=true}aK.inherits(dc,"Control");A.extend(aK.prototype,{initialize:function(e){this._map=e;if(this._container){if(this._opts&&this._opts.container){this._opts.container.appendChild(this._container)}else{e.container.appendChild(this._container)}return this._container}return},_i:function(e){if(!this._container&&this.initialize&&bn(this.initialize)){this._container=this.initialize(e)}this._opts=this._opts||{printable:false};this._setStyle();this._setPosition();if(this._container){this._container._jsobj=this}},_setStyle:function(){var i=this._container;if(i){var e=i.style;e.position="absolute";e.zIndex=this._cZIndex||"10";e.MozUserSelect="none";if(!this._opts.printable){A.ac(i,"BMap_noprint")}A.on(i,"contextmenu",cp)}},remove:function(){this._map=null;if(!this._container){return}this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container._jsobj=null;this._container=null},_render:function(e){if(this._opts&&this._opts.container){this._container=cR(this._opts.container,'<div unselectable="on"></div>')}else{var i='<div unselectable="on"></div>';if(e&&e.config.autoSafeArea&&a0()){this._safeAreaContainer=cR(this._map.container,i);this._safeAreaContainer.style.position="absolute";this._safeAreaContainer.style.bottom="env(safe-area-inset-bottom)";this._container=cR(this._safeAreaContainer,i)}else{this._container=cR(this._map.container,i)}}if(this._visible===false){this._container.style.display="none"}return this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(gj){if(this.anchorFixed||typeof gj!=="number"||isNaN(gj)||gj<BMAP_ANCHOR_TOP_LEFT||gj>BMAP_ANCHOR_BOTTOM_RIGHT){gj=this.defaultAnchor}this._opts.offset=this._opts.offset||this.defaultOffset;var gi=this._opts.anchor;this._opts.anchor=gj;if(!this._container){return}var gl=this._container;var e=this._opts.offset.width;var gk=this._opts.offset.height;gl.style.left=gl.style.top=gl.style.right=gl.style.bottom="auto";switch(gj){case BMAP_ANCHOR_TOP_LEFT:gl.style.top=gk+"px";gl.style.left=e+"px";break;case BMAP_ANCHOR_TOP_RIGHT:gl.style.top=gk+"px";gl.style.right=e+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:gl.style.bottom=gk+"px";gl.style.left=e+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:gl.style.bottom=gk+"px";gl.style.right=e+"px";break;default:break}var i=["TL","TR","BL","BR"];A.rc(this._container,"anchor"+i[gi]);A.ac(this._container,"anchor"+i[gj])},getAnchor:function(){return this._opts.anchor},setOffset:function(e){if(!e){return}this._opts=this._opts||{};this._opts.offset=new c9(e.width,e.height);if(!this._container){return}this.setAnchor(this._opts.anchor)},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){if(this._visible===true){return}this._visible=true;if(this._container){this._container.style.display=""}this.dispatchEvent(new aM("onshow"))},hide:function(){if(this._visible===false){return}this._visible=false;if(this._container){this._container.style.display="none"}this.dispatchEvent(new aM("onhide"))},isPrintable:function(){return !!this._opts.printable},isVisible:function(){if(!this._container&&!this._map){return false}return !!this._visible},_asyncLoadCode:function(){var e=this;da.load("control",function(){if(e._asyncDraw){e._asyncDraw()}})}});var f5={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_LEFT:2,BOTTOM_RIGHT:3};aU.ControlAnchor=f5;window.BMAP_ANCHOR_TOP_LEFT=0;window.BMAP_ANCHOR_TOP_RIGHT=1;window.BMAP_ANCHOR_BOTTOM_LEFT=2;window.BMAP_ANCHOR_BOTTOM_RIGHT=3;function cQ(e){aK.call(this);e=e||{};this._opts={printable:false};A.extend(this._opts,e);this._copyrightCollection=[];this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new c9(5,2);this.setAnchor(e.anchor);this._canShow=true;this.sateMapStyle=false;this.blockInfoWindow=false;this._asyncLoadCode()}cQ.inherits(aK,"CopyrightControl");A.extend(cQ.prototype,{initialize:function(e){this._map=e;return this._container},addCopyright:function(gj){var e={minZoom:0,bounds:null,content:"",mapType:""};for(var gi in gj){e[gi]=gj[gi]}if(this._map){var gm=e.minZoom;if(gm===-1||gm<this._map.getMinZoom()||gm>this._map.getMaxZoom()){e.minZoom=this._map.getMinZoom()}if(e.mapType!==""&&!bw[e.mapType]){e.mapType=BMAPGL_NORMAL_MAP}}var gk=this.getCopyright(gj.id);if(gk){for(var gl in e){gk[gl]=e[gl]}}else{this._copyrightCollection.push(e)}},getCopyright:function(gj){for(var gi=0,e=this._copyrightCollection.length;gi<e;gi++){if(this._copyrightCollection[gi].id===gj){return this._copyrightCollection[gi]}}},addSateMapStyle:function(){this.sateMapStyle=true;if(this._container){A.ac(this._container,"BMap_cpyCtrl_w")}},removeSateMapStyle:function(){this.sateMapStyle=false;if(this._container){A.rc(this._container,"BMap_cpyCtrl_w")}}});function fM(e){aK.call(this);e=e||{};this._opts={printable:false};this._opts=A.extend(A.extend(this._opts,{unit:"metric"}),e);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new c9(81,18);if(eP()){this.defaultOffset=new c9(75,10)}this.setAnchor(e.anchor);this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5280,u1:"英尺",u2:"英里"}};this.sateMapStyle=false;if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._scaleText=null;this._numberArray={};this._asyncLoadCode()}window.BMAP_UNIT_METRIC="metric";window.BMAP_UNIT_IMPERIAL="us";fM.inherits(aK,"ScaleControl");A.extend(fM.prototype,{initialize:function(e){this._map=e;return this._container},setUnit:function(e){this._opts.unit=this._units[e]&&this._units[e].name||this._opts.unit},getUnit:function(){return this._opts.unit},addSateMapStyle:function(){this.sateMapStyle=true;var e=this._container;if(e){A.ac(e.children[0],"dark")}},removeSateMapStyle:function(){this.sateMapStyle=false;var e=this._container;if(e){A.rc(e.children[0],"dark")}}});window.BMAP_NAVIGATION_CONTROL_LARGE=0;window.BMAP_NAVIGATION_CONTROL_SMALL=1;window.BMAP_NAVIGATION_CONTROL_PAN=2;window.BMAP_NAVIGATION_CONTROL_ZOOM=3;window.BMAP_NAVIGATION_CONTROL_ANIM=4;function cC(e){aK.call(this);e=e||{};this._opts={printable:false};A.extend(this._opts,e);this.controlHeight=[{width:65,height:227,zoomHeight:227,zoomWidth:37,sliderHeight:180},{width:65,height:47,zoomHeight:(this._opts.forceNew===true)?56:47,zoomWidth:37,sliderHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0},{width:26,height:56,zoomHeight:56,zoomWidth:6,sliderHeight:0},{width:56,height:47,zoomHeight:47,zoomWidth:37,sliderHeight:180}];this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new c9(10,10);this.setAnchor(e.anchor);this.setType(e.type);this._maxTotalZoomLv=19;this._minZoomLevel=-1;this._maxZoomLevel=-1;this._totalZoomLv=-1;this._sliderInterval=10;this._sliderHeight=180;this._minBarY=1;this._maxBarY=-1;this._curBarY=-1;this._zoomDom=null;this._zoomBtnDom=null;this._sliderDom=null;this._sliderBaseDom=null;this._cZIndex="1100";this._asyncLoadCode()}cC.inherits(aK,"NavigationControl");A.extend(cC.prototype,{initialize:function(e){this._map=e;return this._container},setType:function(e){if(typeof e=="number"&&e>=BMAP_NAVIGATION_CONTROL_LARGE&&e<=BMAP_NAVIGATION_CONTROL_ANIM){this._opts.type=e}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}},getType:function(){return this._opts.type}});function a7(i){aK.call(this);i=i||{};this._opts={printable:false};this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new c9(10,10);this.setAnchor(i.anchor);this._opts=A.extend(A.extend(this._opts,{offset:this.defaultOffset,enableSwitch:true}),i);var e=this;da.load("control",function(){e._asyncDraw()})}a7.inherits(aK,"MapTypeControl");A.extend(a7.prototype,{initialize:function(e){this._map=e;return this._container},showStreetLayer:function(e){this._map.showStreetLayer(e)}});function bU(e){aK.call(this);e=e||{};this._opts={};this._opts=A.extend(this._opts,e);this._zoomInDisabled=false;this._zoomOutDisabled=false;this._zoomInTapped=false;this._zoomOutTapped=false;this.defaultAnchor=f5.BOTTOM_RIGHT;this.defaultOffset=new c9(10,50);this.setAnchor(e.anchor);this._asyncLoadCode()}bU.inherits(aK,"ZoomControl");A.extend(bU.prototype,{initialize:function(e){this._map=e;return this._container}});function a5(e){aK.call(this);e=e||{};this._opts={autoZoom:true,autoViewport:true};this._opts=A.extend(this._opts,e);this.defaultAnchor=f5.BOTTOM_LEFT;this.defaultOffset=new c9(10,50);this.watchPosition=this._opts.watchPosition||false;this.useCompass=this._opts.useCompass||false;this.locMarker=null;this.locLevel=16;this.setAnchor(this._opts.anchor);this.onLocationStart=e.onLocationStart||null;this._asyncLoadCode()}a5.inherits(aK,"LocationControl");A.extend(a5.prototype,{initialize:function(e){this._map=e;return this._container},startLocation:function(){this._startLocationCalled=true},stopLocationTrace:function(){},setOptions:function(e){e=e||{};A.extend(this._opts,e)}});function V(e){aK.call(this);e=e||{};this._opts={};this._opts=A.extend(this._opts,e);this.defaultAnchor=f5.BOTTOM_LEFT;this.defaultOffset=new c9(5,15);if(eP()){this.defaultOffset=new c9(10,10)}this.setAnchor(e.anchor)}V.inherits(aK,"LogoControl");A.extend(V.prototype,{initialize:function(i){this._map=i;var e=this._container=document.createElement("div");e.innerHTML='<img src="'+dX.apiHost+'/images/logo_hd.png"  style="height:21px;width:62px;"/>';i.getContainer().appendChild(e);return e}});function fi(e,i){this._map=e;this._indoorInfo=i;this._visible=true;this._adjustVisible=true;this._isMobile=eP();this._sizeConfig={FLOOR_BTN_HEIGHT:this._isMobile?35:26,SWITCH_ARROW_HEIGHT:this._isMobile?20:15};this._init()}fi.prototype._init=function(){this._render();this._bindDom();this._bind();this._adjustDisplayHeight();var e=new aM("onindoor_bar_show");e.uid=this._indoorInfo.uid;this._map.dispatchEvent(e)};fi.prototype._render=function(){if(!this._indoorInfo){return}var gn=this._isMobile;var e=this._div=M("div");A.ac(e,"floor-select-container");gn&&A.ac(e,"mobile");gn&&A.ac(e,"all-border-radius");var i=this._btnTop=M("button");A.ac(i,"floor-switch-top");A.ac(i,"top-border-radius");var gl=M("div");A.ac(gl,"floor-switch-top-icon");i.appendChild(gl);var gk=this._btnBottom=M("button");var gi=M("div");A.ac(gi,"floor-switch-bottom-icon");gk.appendChild(gi);A.ac(gk,"floor-switch-bottom");A.ac(gk,"bottom-border-radius");var gj=this._floorsContainer=M("div");A.ac(gj,"floors-container");gj.appendChild(this._createFloorsDom());this._div.appendChild(i);this._div.appendChild(gj);this._div.appendChild(gk);var go=0;if(this._btnTop.style.display===""){go=2*this._sizeConfig.SWITCH_ARROW_HEIGHT}this._div.style.height=parseInt(this._floorsContainer.style.height,10)+go+"px";this._map.getContainer().appendChild(this._div);if(!gn){var gm=this;setTimeout(function(){gm._div.style.right="20px"},20)}};fi.prototype._createFloorsDom=function(){if(!this._indoorInfo){return}var gi=this._ol=M("ol");var gl=this._indoorInfo.currentFloor;for(var gk=this._indoorInfo.floors.length-1;gk>=0;gk--){var gm=this._indoorInfo.floors[gk].floorName;var e=M("li");var gj=M("button");A.ac(gj,"btn-select-floor");if(gk===gl){A.ac(gj,"selected")}gj.setAttribute("data-floor",gk);gj.innerHTML=gm;e.appendChild(gj);gi.appendChild(e)}return gi};fi.prototype._updateUI=function(){if(!this._ol){this._render();this._bind();this._adjustDisplayHeight();return}this._ol=null;this._ol=this._createFloorsDom();this._floorsContainer.innerHTML="";this._floorsContainer.appendChild(this._ol);this._adjustDisplayHeight()};fi.prototype._bindDom=function(){var e=this;A.on(this._floorsContainer,"click",function(gj){var gi=gj.target||gj.srcElement;if(gi.tagName.toLowerCase()==="button"){e._map.showIndoor(e._indoorInfo.uid,parseInt(gi.getAttribute("data-floor"),10));var i=new aM("onindoor_bar_click");i.uid=e._indoorInfo.uid;e._map.dispatchEvent(i)}});A.on(this._floorsContainer,"mouseover",function(gi){var i=gi.target;if(i.tagName.toLowerCase()==="button"){A.ac(i,"hover")}});A.on(this._floorsContainer,"mouseout",function(gi){var i=gi.target;if(i.tagName.toLowerCase()==="button"){A.rc(i,"hover")}});A.on(this._floorsContainer,"touchstart",function(gi){var i=gi.target;if(i.tagName.toLowerCase()==="button"){A.ac(i,"onmousedown")}});A.on(this._floorsContainer,"touchend",function(gi){var i=gi.target;if(i.tagName.toLowerCase()==="button"){A.rc(i,"onmousedown")}});A.on(this._btnTop,"mouseover",function(i){if(this._disable){return}A.ac(this,"hover")});A.on(this._btnTop,"mouseout",function(i){A.rc(this,"hover")});A.on(this._btnBottom,"mouseover",function(i){if(this._disable){return}A.ac(this,"hover")});A.on(this._btnBottom,"mouseout",function(i){A.rc(this,"hover")});A.on(this._btnTop,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}A.ac(this,"onmousedown")});A.on(this._btnTop,"touchend",function(i){A.rc(this,"onmousedown")});A.on(this._btnBottom,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}A.ac(this,"onmousedown")});A.on(this._btnBottom,"touchend",function(i){A.rc(this,"onmousedown")});A.on(this._btnTop,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)+26)});A.on(this._btnBottom,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)-26)});A.on(this._div,"mousemove",j);A.on(this._div,"wheel",cp);A.on(this._div,"mousewheel",cp);this._map.addEventListener("resize",function(){e._adjustDisplayHeight()})};fi.prototype._adjustDisplayHeight=function(){if(!this._indoorInfo){return}var gl=this._map.getSize().height;var gm=this._sizeConfig.FLOOR_BTN_HEIGHT;var gn=gl-291-100;if(this._isMobile){gn=gl-12-108-this._map.config.bottomOffset}var e=this._indoorInfo.floors.length;var gi=e*gm;var gj=e;var gp=0;var gq=this._floorsContainer.children[0];if(gi>gn){this._showArrow=true;A.rc(gq.children[0].children[0],"top-border-radius");A.rc(gq.children[e-1].children[0],"bottom-border-radius")}else{this._showArrow=false;A.ac(gq.children[0].children[0],"top-border-radius");A.ac(gq.children[e-1].children[0],"bottom-border-radius")}while(gi>gn){if(gj===0){break}gj--;gp=2*this._sizeConfig.SWITCH_ARROW_HEIGHT;gi=gj*gm+gp}this._currentDisplayHeight=gi;if(gj<3){this._setAdjustVisbile(false)}else{this._setAdjustVisbile(true)}this._floorsContainer.style.height=gj*gm+"px";var gk=this._indoorInfo.currentFloor;var i=e-gk;var go=gk-1;this._div.style.height=parseInt(this._floorsContainer.style.height,10)+gp+"px";var gr=-(e-(gk+Math.round(gj/2)))*gm;this._setBarSliderTop(gr);if(gj<e){A.show(this._btnTop);A.show(this._btnBottom)}else{A.hide(this._btnTop);A.hide(this._btnBottom);this._setBarSliderTop(0)}if(this._isMobile){this._div.style.bottom=108+this._map.config.bottomOffset+"px"}};fi.prototype._setBarSliderTop=function(gj){var gi=26;var i=this._indoorInfo.floors.length;var e=i*gi;if(this._currentDisplayHeight){if(this._showArrow){e=this._currentDisplayHeight-30}else{e=this._currentDisplayHeight}}if(e-gj>=i*gi){gj=e-i*gi;A.ac(this._btnBottom,"disable");A.rc(this._btnBottom,"hover");this._btnBottom._disable=true}else{A.rc(this._btnBottom,"disable");this._btnBottom._disable=false}if(gj>=0){gj=0;A.ac(this._btnTop,"disable");A.rc(this._btnTop,"hover");this._btnTop._disable=true}else{A.rc(this._btnTop,"disable");this._btnTop._disable=false}this._ol.style.top=gj+"px"};fi.prototype._setAdjustVisbile=function(e){if(this._adjustVisible===e){return}this._adjustVisible=e;if(e&&this._visible){this._div.style.right="20px"}else{this._div.style.right="-30px"}};fi.prototype._bind=function(){var i=this._map;var e=this;i.on("indoor_status_changed",function(gn){if(e._visible===false){return}var gi=e._ol;var gl=gn.uid;if(!gl){return}var gm=gn.floor;for(var gk=0;gk<gi.children.length;gk++){var gj=gi.children[gk].children[0];if(parseInt(gj.getAttribute("data-floor"),10)===gm){A.ac(gj,"selected")}else{A.rc(gj,"selected")}}});i.on("zoomend",function(gi){if(this.getZoom()<17){e._setAdjustVisbile(false)}else{e._setAdjustVisbile(true)}})};fi.prototype.setInfo=function(e){if(this._indoorInfo&&this._indoorInfo.uid===e.uid){return}this._indoorInfo=e;this._updateUI()};fi.prototype.show=function(){if(this._visible===true){return}this._visible=true;if(!this._isMobile){this._div.style.right="20px"}else{this._div.style.display=""}var e=new aM("onindoor_bar_show");e.uid=this._indoorInfo.uid;this._map.dispatchEvent(e)};fi.prototype.hide=function(){if(this._visible===false){return}this._visible=false;if(!this._isMobile){this._div.style.right="-30px"}else{this._div.style.display="none"}};function dP(){this._opts={};this.defaultOffset=new c9(0,80);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;this._firstAnimation=true}dP.inherits(aK,"NavigationControl3D");A.extend(dP.prototype,{initialize:function(gi){this._map=gi;this._createDom();this._bindDom();this._bind();if(!eP()){this._headingControl=new f8(this._map,this._div)}this._tiltControl=new dr(this._map,this._div);this._render();var i=this._map.getMapType();var e=this;if(i==="B_EARTH_MAP"||this._map._renderType==="webgl"){e._div.style.opacity="1";e._div.style.visibility="visible"}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}return this._container},_createDom:function(){var i=this._div=document.createElement("div");this._container=i;var e=i.style;e.position="absolute";e.zIndex=5;e.width="52px";e.height="82px";e.right="-3px";e.bottom="79px";e.opacity="0";e.visibility="hidden";e.WebkitTransition=e.transition="opacity .3s ease-out,visibility .3s ease-out"},_render:function(){var e=document.getElementById("map-operate");if(e){e.appendChild(this._div)}else{this._map.getContainer().appendChild(this._div)}},_bindDom:function(){this._div.addEventListener("mousemove",j)},_bind:function(){if(this._map._renderType==="webgl"){return}var e=this;this._map.on("maptypechange",function(){if(this.mapType==="B_EARTH_MAP"){if(e._firstAnimation){e._firstAnimation=false;setTimeout(function(){e._div.style.opacity="1";e._div.style.visibility="visible"},300)}else{e._div.style.opacity="1";e._div.style.visibility="visible"}}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}})}});function f8(gi,i){this._map=gi;this._target=gi;var gj=gi.temp.originMapType||gi.mapType;if(gj==="B_EARTH_MAP"&&gi._earth){this._target=gi._earth}this._outContainer=i||gi.getContainer();this._imgRatio=aJ()>=1.5?2:1;this._imgPath=dX.imgPath+"earth-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setHeadingOptions={callback:function(){e._target.setLock(false)}};this._init()}A.extend(f8.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._updateUI();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableHeadingZoom){this.enable()}else{this.disable()}},_createDom:function(){var i=this._div=M("div");var e=i.style;e.position="absolute";e.zIndex=5;e.top="0";e.left="0";e.width="52px";e.height="54px";e.background="url("+this._imgPath+") no-repeat";e.backgroundSize="266px auto";this._rotateCCW=this._createButton();this._rotateCCW.title="逆时针转动";e=this._rotateCCW.style;e.left="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";this._rotateCW=this._createButton();this._rotateCW.title="顺时针转动";e=this._rotateCW.style;e.right="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";e.WebkitTransform=e.transform="scaleX(-1)";this._compass=this._createButton();this._compass.title="恢复正北方向";e=this._compass.style;e.left="19px";e.top="4px";e.width="14px";e.height="44px";e.backgroundPosition="-56px -4px";e.WebkitTransform=e.transform="rotate(0deg)";this._div.appendChild(this._rotateCCW);this._div.appendChild(this._compass);this._div.appendChild(this._rotateCW);this._domRendered=true},_createButton:function(){var e=M("button");var i=e.style;i.position="absolute";i.outline="none";i.border="none";i.background="url("+this._imgPath+") no-repeat";i.backgroundSize="266px auto";i.cursor="pointer";return e},_render:function(){this._outContainer.appendChild(this._div)},enable:function(){this._enabled=true;if(this._domRendered){this._rotateCCW.style.cursor="pointer";this._rotateCCW.style.opacity=1;this._rotateCW.style.cursor="pointer";this._rotateCW.style.opacity=1;this._compass.style.cursor="pointer";this._compass.style.opacity=1}},disable:function(){this._enabled=false;if(this._domRendered){this._rotateCCW.style.cursor="";this._rotateCCW.style.opacity=0.4;this._rotateCW.style.cursor="";this._rotateCW.style.opacity=0.4;this._compass.style.cursor="";this._compass.style.opacity=0.4}},_bindDom:function(){dF(this._div,["mousedown","click","dblclick"]);var i=this._map;var e=this;this._rotateCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()+90,e._setHeadingOptions);i.fire(new aM("onrotatecwclick"))},false);this._rotateCCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===-360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()-90,e._setHeadingOptions);i.fire(new aM("onrotateccwclick"))},false);this._rotateCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._rotateCCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._compass.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}e._target.setLock(true);var gi=false;if(e._target.getTilt()!==0){gi=true;e._target.setTilt(0,e._setHeadingOptions)}if(e._target.getHeading()%360!==0){gi=true;e._target.resetHeading(e._setHeadingOptions)}if(!gi){e._target.setLock(false)}i.fire(new aM("oncompassclick"))},false)},_bind:function(){var e=this;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(i){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.addEventListener("heading_changed",function(gi){e._updateUI()});i.addEventListener("animation_start",function(gi){e._isOperating=true});i.addEventListener("animation_end",function(gi){e._isOperating=false});i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var e=this._target.getHeading();var i=this._compass.style;i.WebkitTransform=i.transform="rotate("+e+"deg)"},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function dr(gi,i){this._map=gi;this._target=gi;var gj=gi.temp.originMapType||gi.mapType;if(gj==="B_EARTH_MAP"&&gi._earth){this._target=gi._earth}this._outContainer=i||gi.getContainer();this._imgRatio=aJ()>=1.5?2:1;this._imgPath=dX.imgPath+"gl-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setTiltOptions={callback:function(){e._target.setLock(false)}};this._init()}A.extend(dr.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableTiltZoom){this.enable()}else{this.disable()}},_createDom:function(){var e=this._div=M("button");e.title="倾斜";var i=e.style;i.position="absolute";i.zIndex=5;i.outline="none";i.border="none";i.cursor="pointer";i.width="26px";i.height="26px";i.top="56px";i.right="13px";i.background="url("+this._imgPath+") no-repeat #fff";i.backgroundSize="266px auto";i.backgroundPosition="-110px 1px";i.boxShadow="1px 2px 1px rgba(0, 0, 0, 0.15)"},enable:function(){this._enabled=true;if(this._div){this._div.style.cursor="pointer"}this._updateUI()},disable:function(){this._enabled=false;if(this._div){this._div.style.cursor=""}this._updateUI()},_render:function(){this._outContainer.appendChild(this._div)},_bindDom:function(){var e=this;this._div.addEventListener("mousedown",function(gj){if(!e._enabled){return}if(e._target.getLock()){return}var i=e._target.getTilt();var gi;if(i===e._map.getCurrentMaxTilt()){gi="out"}else{if(i===0){gi="in"}else{gi=e._preTrend?e._preTrend:"in"}}e._curTrend=gi;e._clickTimer=setTimeout(function(){e._map.fire(new aM("ontiltmsdown"));e._tiltAni=new n({duration:9999999,render:function(gk){i=e._target.getTilt();if(gi==="in"&&i<e._map.getCurrentMaxTilt()){e._target.setTilt(i+1,{noAnimation:true})}else{if(gi==="out"&&i>0){e._target.setTilt(i-1,{noAnimation:true})}}},finish:function(){e._tiltAni=null}});e._clickTimer=null},200);gj.stopPropagation()},false);this._div.addEventListener("mouseup",function(i){if(!e._enabled){return}if(e._tiltAni){e._tiltAni.stop()}e._preTrend=e._curTrend},false);this._div.addEventListener("click",function(gj){if(!e._enabled){return}if(!e._clickTimer){return}if(e._target.getLock()){return}clearTimeout(e._clickTimer);e._map.fire(new aM("ontiltclick"));var i=e._target.getTilt();e._target.setLock(true);gj.stopPropagation();var gi=e._map.getCurrentMaxTilt();if(e._curTrend==="in"){e._target.setTilt(gi,e._setTiltOptions)}else{if(e._curTrend==="out"){e._target.setTilt(0,e._setTiltOptions)}else{if(i<gi){e._target.setTilt(gi,e._setTiltOptions)}else{e._target.setTilt(0,e._setTiltOptions)}}}},false);this._div.addEventListener("mouseover",function(i){if(!e._enabled){return}e._mouseOver=true;e._updateUI()},false);this._div.addEventListener("mouseout",function(i){if(!e._enabled){return}e._mouseOver=false;e._updateUI()},false);dF(this._div,["mousedown","click","dblclick"])},_bind:function(){var e=this;var i=this._map;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(gi){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});i.on("tilt_changed",function(){e._updateUI()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var gi=this._target.getTilt();var i=0;var gj=0;var e=0;if(gi>0){i=78}if(this._mouseOver){e=52}if(this._enabled===false){gj=26;e=0;i=0}var gk="-"+(110+i+gj+e)+"px 1px";this._div&&(this._div.style.backgroundPosition=gk);if(this._enabled){if(gi>0){this._div&&(this._div.title="恢复")}else{this._div&&(this._div.title="倾斜")}}else{this._div&&(this._div.title="请放大地图后操作")}},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function bE(i){dc.call(this);this._opts={container:null,cursor:"default"};this._opts=A.extend(this._opts,i);this._type="contextmenu";this._map=null;this._container;this._left=0;this._top=0;this._items=[];this._rItems=[];this._dividers=[];this._enable=true;this.curPixel=null;this.curPoint=null;this._isOpen=false;var e=this;da.load("menu",function(){e._draw()})}bE.inherits(dc,"ContextMenu");A.extend(bE.prototype,{initialize:function(e){this._map=e},remove:function(){this._map=null},addItem:function(gk,e){if(!gk||gk._type!="menuitem"||gk._text==""||gk._width<=0){return}for(var gj=0,gi=this._items.length;gj<gi;gj++){if(this._items[gj]===gk){return}}if(e===undefined||e>this._items.length-1){e=-1}gk._insertIndex=e;if(e===-1){this._items.push(gk);this._rItems.push(gk)}else{this._items.splice(e,0,gk);this._rItems.splice(e,0,gk)}},removeItem:function(gj){if(!gj||gj._type!="menuitem"){return}for(var gi=0,e=this._items.length;gi<e;gi++){if(this._items[gi]===gj){this._items[gi].remove();this._items.splice(gi,1);delete gj._insertIndex;e--}}for(var gi=0,e=this._rItems.length;gi<e;gi++){if(this._rItems[gi]===gj){this._rItems[gi].remove();this._rItems.splice(gi,1);delete gj._insertIndex;e--}}},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var i={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(e===-1){this._items.push(i)}else{this._items.splice(e,0,i)}},removeSeparator:function(gi){if(!this._dividers[gi]){return}for(var gj=0,e=this._items.length;gj<e;gj++){if(this._items[gj]&&this._items[gj]._type=="divider"&&this._items[gj]._dIndex==gi){this._items.splice(gj,1);e--}if(this._items[gj]&&this._items[gj]._type=="divider"&&this._items[gj]._dIndex>gi){this._items[gj]._dIndex--}}this._dividers.splice(gi,1)},getDom:function(){return this._container},show:function(){if(this._isOpen==true){return}this._isOpen=true},hide:function(){if(this._isOpen==false){return}this._isOpen=false},setCursor:function(e){if(!e){return}this._opts.cursor=e},getItem:function(e){return this._rItems[e]},enable:function(){this._enable=true},disable:function(){this._enable=false}});function eo(gi,gj,i){if(!gi||!gj||typeof gj!="function"){return}dc.call(this);this._opts={width:100,id:""};i=i||{};this._opts.width=(i.width*1)?i.width:100;this._opts.id=i.id?i.id:"";this._text=gi+"";this._callback=gj;this._map=null;this._type="menuitem";this._contextmenu=null;this._container=null;this._enabled=true;var e=this;da.load("menu",function(){e._draw()})}eo.inherits(dc,"MenuItem");A.extend(eo.prototype,{initialize:function(e,i){this._map=e;this._contextmenu=i},remove:function(){this._contextmenu=null;this._map=null},setText:function(e){if(!e){return}this._text=e+""},getDom:function(){return this._container},enable:function(){this._enabled=true},disable:function(){this._enabled=false}});function cY(e,i){this.setSouthWest(e);this.setNorthEast(i)}A.extend(cY.prototype,{isEmpty:function(){return this.sw===null&&this.ne===null},equals:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return this.sw.equals(e.sw)&&this.ne.equals(e.ne)},containsBounds:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return(e.sw.lng>this.sw.lng&&e.ne.lng<this.ne.lng&&e.sw.lat>this.sw.lat&&e.ne.lat<this.ne.lat)},getCenter:function(){if(this.isEmpty()){return null}return new fX((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)},intersects:function(gi){if(!gi||gi.isEmpty()||this.isEmpty()){return null}if(Math.max(gi.sw.lng,gi.ne.lng)<Math.min(this.sw.lng,this.ne.lng)||Math.min(gi.sw.lng,gi.ne.lng)>Math.max(this.sw.lng,this.ne.lng)||Math.max(gi.sw.lat,gi.ne.lat)<Math.min(this.sw.lat,this.ne.lat)||Math.min(gi.sw.lat,gi.ne.lat)>Math.max(this.sw.lat,this.ne.lat)){return null}var gk=Math.max(this.sw.lng,gi.sw.lng);var i=Math.min(this.ne.lng,gi.ne.lng);var gj=Math.max(this.sw.lat,gi.sw.lat);var e=Math.min(this.ne.lat,gi.ne.lat);return new cY(new fX(gk,gj),new fX(i,e))},setMinMax:function(){this.minX=this.sw?this.sw.lng:null;this.minY=this.sw?this.sw.lat:null;this.maxX=this.ne?this.ne.lng:null;this.maxY=this.ne?this.ne.lat:null},containsPoint:function(e){if(!e){return}return(e.lng>=this.sw.lng&&e.lng<=this.ne.lng&&e.lat>=this.sw.lat&&e.lat<=this.ne.lat)},extend:function(e){if(!e){return}var i=e.lng;var gi=e.lat;if(!this.sw){this.sw=e.clone()}if(!this.ne){this.ne=e.clone()}if(this.sw.lng>i){this.sw.lng=i}if(this.ne.lng<i){this.ne.lng=i}if(this.sw.lat>gi){this.sw.lat=gi}if(this.ne.lat<gi){this.ne.lat=gi}},getMin:function(){return this.sw},getMax:function(){return this.ne},getSouthWest:function(){return this.sw},getNorthEast:function(){return this.ne},setSouthWest:function(e){this.sw=e?e.clone():null},setNorthEast:function(e){this.ne=e?e.clone():null},clone:function(){return new cY(this.sw,this.ne)},toSpan:function(){if(this.isEmpty()){return new c9(0,0)}return new c9(Math.abs(this.ne.lng-this.sw.lng),Math.abs(this.ne.lat-this.sw.lat))},div:function(e){if(!e||e.isEmpty()||this.isEmpty()){return 0}return((this.ne.lng-this.sw.lng)*(this.ne.lat-this.sw.lat))/((e.ne.lng-e.sw.lng)*(e.ne.lat-e.sw.lat))},makeNormalizedPoint:function(e){this.normalizedTopLeft=this.pointTopLeft.clone();this.normalizedTopRight=this.pointTopRight.clone();this.normalizedBottomRight=this.pointBottomRight.clone();this.normalizedBottomLeft=this.pointBottomLeft.clone();while(e<0){e+=360}e=e%360;if(e>=0&&e<90||e>=270&&e<360){if(this.normalizedTopRight.lng<this.normalizedTopLeft.lng){this.normalizedTopRight.lng+=cm.WORLD_SIZE_MC}if(this.normalizedBottomRight.lng<this.normalizedBottomLeft.lng){this.normalizedBottomRight.lng+=cm.WORLD_SIZE_MC}}else{if(this.normalizedTopLeft.lng<this.normalizedTopRight.lng){this.normalizedTopLeft.lng+=cm.WORLD_SIZE_MC}if(this.normalizedBottomLeft.lng<this.normalizedBottomRight.lng){this.normalizedBottomLeft.lng+=cm.WORLD_SIZE_MC}}},toString:function(){return"Bounds"}});function fX(e,i){if(isNaN(e)){e=fB(e);e=isNaN(e)?0:e}if(typeof e==="string"){e=parseFloat(e)}if(isNaN(i)){i=fB(i);i=isNaN(i)?0:i}if(typeof i==="string"){i=parseFloat(i)}this.lng=e;this.lat=i}fX.prototype.equals=function(i){if(!i){return false}var gj=Math.abs(this.lat-i.lat);var gi=Math.abs(this.lng-i.lng);var e=1e-8;if(gj<e&&gi<e){return true}return false};fX.prototype.clone=function(){return new fX(this.lng,this.lat)};fX.prototype.add=function(e){return new fX(this.lng+e.lng,this.lat+e.lat)};fX.prototype.sub=function(e){return new fX(this.lng-e.lng,this.lat-e.lat)};fX.prototype.mult=function(e){return new fX(this.lng*e,this.lat*e)};fX.prototype.div=function(e){return new fX(this.lng/e,this.lat/e)};fX.prototype.mag=function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)};fX.prototype.toString=function(){return"Point"};function dm(){}A.extend(dm,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[86,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],LL2MC:[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]],getDistanceByMC:function(gl,gj){if(!gl||!gj){return 0}var i;var gk;var e;var gi;gl=this.convertMC2LL(gl);if(!gl){return 0}i=cT(gl.lng);gk=cT(gl.lat);gj=this.convertMC2LL(gj);if(!gj){return 0}e=cT(gj.lng);gi=cT(gj.lat);return this.getDistance(i,e,gk,gi)},getDistanceByLL:function(gl,gj){if(!gl||!gj){return 0}gl.lng=this.getLoop(gl.lng,-180,180);gl.lat=this.getRange(gl.lat,-80,84);gj.lng=this.getLoop(gj.lng,-180,180);gj.lat=this.getRange(gj.lat,-80,84);var i;var e;var gk;var gi;i=cT(gl.lng);gk=cT(gl.lat);e=cT(gj.lng);gi=cT(gj.lat);return this.getDistance(i,e,gk,gi)},convertMC2LL:function(e){if(e===null){return e}if(!e){return new fX(0,0)}var gi;var gk;gi=new fX(Math.abs(e.lng),Math.abs(e.lat));for(var gj=0;gj<this.MCBAND.length;gj++){if(gi.lat>=this.MCBAND[gj]){gk=this.MC2LL[gj];break}}var gl=this.convertor(e,gk);return new cj(gl.lat,gl.lng)},convertLL2MC:function(gm){if(!gm){return new fX(0,0)}var go=gm.lat;var gj=gm.lng;gj=this.getLoop(gm.lng,-180,180);go=et(go,-85,85);var gl;for(var gk=0;gk<this.LLBAND.length;gk++){if(go>=this.LLBAND[gk]){gl=this.LL2MC[gk];break}}if(!gl){for(gk=0;gk<this.LLBAND.length;gk++){if(go<=-this.LLBAND[gk]){gl=this.LL2MC[gk];break}}}var gi=new fX(gj,go);var gn=this.convertor(gi,gl);var e=new fX(gn.lng,gn.lat);e.latLng=gm.clone();return e},convertor:function(gi,gj){if(!gi||!gj){return}var e=gj[0]+gj[1]*Math.abs(gi.lng);var i=Math.abs(gi.lat)/gj[9];var gk=gj[2]+gj[3]*i+gj[4]*i*i+gj[5]*i*i*i+gj[6]*i*i*i*i+gj[7]*i*i*i*i*i+gj[8]*i*i*i*i*i*i;e*=(gi.lng<0?-1:1);gk*=(gi.lat<0?-1:1);return new fX(e,gk)},getDistance:function(i,e,gj,gi){return this.EARTHRADIUS*Math.acos((Math.sin(gj)*Math.sin(gi)+Math.cos(gj)*Math.cos(gi)*Math.cos(e-i)))},getRange:function(gi,i,e){if(i!=null){gi=Math.max(gi,i)}if(e!=null){gi=Math.min(gi,e)}return gi},getLoop:function(gi,i,e){while(gi>e){gi-=e-i}while(gi<i){gi+=e-i}return gi}});function cj(i,e){if(i<-90){i=-90}else{if(i>90){i=90}}while(e<-180){e+=360}while(e>180){e-=360}this.lat=i||0;this.lng=e||0}A.extend(cj.prototype,{equals:function(e){return(this.lat===e.lat&&this.lng===e.lng)},clone:function(){return new cj(this.lat,this.lng)},getLngSpan:function(e){var i=this.lng;var gi=Math.abs(e-i);if(gi>180){gi=360-gi}return gi},sub:function(e){return new cj(this.lat-e.lat,this.lng-e.lng)},toString:function(){return this.lat+", "+this.lng}});function dC(e,i){if(e&&!i){i=e}this._sw=this._ne=null;this._swLng=this._swLat=null;this._neLng=this._neLat=null;if(e){this._sw=new cj(e.lat,e.lng);this._ne=new cj(i.lat,i.lng);this._swLng=e.lng;this._swLat=e.lat;this._neLng=i.lng;this._neLat=i.lat}}A.extend(dC.prototype,{isEmpty:function(){return !this._sw||!this._ne},equals:function(e){if(this.isEmpty()){return false}return this.getSouthWest().equals(e.getSouthWest())&&this.getNorthEast().equals(e.getNorthEast())},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},containsBounds:function(e){if(this.isEmpty()||e.isEmpty()){return false}return(e._swLng>this._swLng&&e._neLng<this._neLng&&e._swLat>this._swLat&&e._neLat<this._neLat)},getCenter:function(){if(this.isEmpty()){return null}return new cj((this._swLat+this._neLat)/2,(this._swLng+this._neLng)/2)},intersects:function(gi){if(Math.max(gi._swLng,gi._neLng)<Math.min(this._swLng,this._neLng)||Math.min(gi._swLng,gi._neLng)>Math.max(this._swLng,this._neLng)||Math.max(gi._swLat,gi._neLat)<Math.min(this._swLat,this._neLat)||Math.min(gi._swLat,gi._neLat)>Math.max(this._swLat,this._neLat)){return false}var gk=Math.max(this._swLng,gi._swLng);var i=Math.min(this._neLng,gi._neLng);var gj=Math.max(this._swLat,gi._swLat);var e=Math.min(this._neLat,gi._neLat);this._sw=new cj(gj,gk);this._ne=new cj(e,i);this._swLng=gk;this._swLat=gj;this._neLng=i;this._neLat=e;return true},containsPoint:function(e){if(this.isEmpty()){return false}return(e.lng>=this._swLng&&e.lng<=this._neLng&&e.lat>=this._swLat&&e.lat<=this._neLat)},extend:function(e){var i=e.lng;var gi=e.lat;if(!this._sw){this._sw=new cj(0,0)}if(!this._ne){this._ne=new cj(0,0)}if(!this._swLng||this._swLng>i){this._sw.lng=this._swLng=i}if(!this._neLng||this._neLng<i){this._ne.lng=this._neLng=i}if(!this._swLat||this._swLat>gi){this._sw.lat=this._swLat=gi}if(!this._neLat||this._neLat<gi){this._ne.lat=this._neLat=gi}},toSpan:function(){if(this.isEmpty()){return new cj(0,0)}return new cj(Math.abs(this._neLat-this._swLat),Math.abs(this._neLng-this._swLng))},union:function(i){if(i.isEmpty()){return false}var e=i.getSouthWest();var gi=i.getNorthEast();if(this._swLat>e.lat){this._swLat=e.lat}if(this._swLng>e.lng){this._swLng=e.lng}if(this._neLat<gi.lat){this._neLat=gi.lat}if(this._neLng<gi.lng){this._neLng=gi.lng}this._sw=new cj(this._swLat,this._swLng);this._ne=new cj(this._neLat,this._neLng);return true},toString:function(){return this._swLat+", "+this._swLng+", "+this._neLat+", "+this._neLng}});var c0={idle:0,freeze:1,zooming:2,dragging:3,moving:4,readyToDrag:5,readyToPinch:6,pinching:7,stdMapCtrlDrag:8,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,arrowOpCodes:{37:1,38:2,39:4,40:8}};var dg={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:false,show:function(e){if(!this._map){this._map=e}this.inUse=true;if(!this._maskElement){this._createMask(e)}this._maskElement.style.display="block"},_createMask:function(i){if(!this._map){this._map=i}if(!this._map){return}var e=this._maskElement=cR(this._map.container,this._html);A.on(e,"mouseup",function(gi){if(gi.button==2){cp(gi)}});A.on(e,"contextmenu",cp);e.style.display="none"},getDrawPoint:function(gj,gm,gk){gj=window.event||gj;var i=gj.offsetX||gj.layerX||0;var gl=parseInt(gj.offsetY)||parseInt(gj.layerY)||0;var gi=gj.target||gj.srcElement;if(gi!=dg.getDom(this._map)&&gm==true){while(gi&&gi!=this._map.container){if(!(gi.clientWidth==0&&gi.clientHeight==0&&gi.offsetParent&&gi.offsetParent.nodeName.toLowerCase()=="td")){i+=gi.offsetLeft;gl+=gi.offsetTop}gi=gi.offsetParent}}if(gi!=dg.getDom(this._map)&&gi!=this._map.container){return}if(typeof i==="undefined"||typeof gl==="undefined"){return}if(isNaN(i)||isNaN(gl)){return}if(gk){i=i+gk.x;gl=gl+gk.y}return this._map.pixelToPointIn(new di(i,gl))},hide:function(){if(!this._map){return}this.inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(e){if(!this._maskElement){this._createMask(e)}return this._maskElement},setCursor:function(e){this._cursor=e||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function aT(){this._type="overlay"}aT.inherits(A.BaseClass,"Overlay");aT.getZIndex=function(i,e){i=i*1;if(!i){return 0}if(e){i=dm.convertMC2LL(new fX(0,i)).lat}return(i*-100000)<<1};A.extend(aT.prototype,{_i:function(e){this._map=e;if(!this.domElement&&bn(this.initialize)){this.domElement=this.initialize(e);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}}this.draw()},initialize:function(e){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){this._map=null;if(this.domElement&&this.domElement.parentNode){this.domElement.parentNode.removeChild(this.domElement)}this.domElement=null;this.dispatchEvent(new aM("onremove"))},hide:function(){this._visible=false;A.hide(this.domElement)},show:function(){this._visible=true;A.show(this.domElement)},getMap:function(){return this._map},dispose:function(){A.BaseClass.prototype.decontrol.call(this)}});function cb(){A.BaseClass.call(this);aT.call(this);this._visible=true;this._visibleInternal=true;this.infoWindow=null;this._dblclickTime=0}cb.inherits(aT,"OverlayInternal");A.extend(cb.prototype,{initialize:function(e){this.map=e;A.BaseClass.call(this,this.hashCode);return null},draw:function(){},remove:function(){this.map=null;this.decontrol();aT.prototype.remove.call(this)},hide:function(){this._visible=false},show:function(){this._visible=true},getDom:function(){return this.domElement},getContainer:function(){return this.domElement},setClassName:function(){},setConfig:function(i){if(!i){return}for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},getPoint:function(gi,gj){if(!gi){return this.point}else{var e=gj?gj.width:0;var gk=gj?gj.height:0;if(this.map){var i=this.map.pointToPixelIn(this.point);if(this._config&&this._config.offset){i.x=i.x+this._config.offset.width+e;i.y=i.y+this._config.offset.height+gk}else{i.x=i.x+e;i.y=i.y+gk}return this.map.pixelToPointIn(i)}}},setZIndex:function(e){this.zIndex=e},isVisible:function(){if(!this.domElement){return false}return !!this._visible},enableMassClear:function(){this._config.enableMassClear=true},disableMassClear:function(){this._config.enableMassClear=false},showInternal:function(){this._visibleInternal=true},hideInternal:function(e){this._visibleInternal=false;this._hideInternalReason=e}});function dR(e){this.map=e;this._overlays={};this._overlayArray=[];this._customOverlays=[];e._overlays=this._overlays;e._overlayArray=this._overlayArray;e._customOverlays=this._customOverlays;this._zoomingOrMoving=false;this._init()}dR.prototype._init=function(){if(this.map._renderType!=="webgl"){this._createOverlayContainers()}else{this._createWebGLOverlayContainers()}this._bind()};dR.prototype._createOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e.temp.overlayDivEx=e.overlayDivEx=this._createOverlayDiv(e.platform,50);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400);if(e.isCanvasMap()){e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDivEx,50)}else{e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDiv,200)}};dR.prototype._createWebGLOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400)};dR.prototype._createOverlayDiv=function(e,gj){var gi=M("div");var i=gi.style;i.position="absolute";i.top=i.left=i.width=i.height="0";i.zIndex=gj;e.appendChild(gi);return gi};dR.prototype._bind=function(){var gk=this.map;var gj=this;function i(gm){gj.draw(gm)}if(gk._renderType!=="webgl"){gk.addEventListener("load",i);gk.addEventListener("moveend",i);gk.addEventListener("resize",i);gk.addEventListener("zoomend",i);gk.addEventListener("zooming_inner",i)}else{gk.on("update",i)}gk.addEventListener("zoomend",function(gm){if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});gk.addEventListener("oncenterandzoom",function(gm){gj.draw(gm);if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});gk.addEventListener("maptypechange",function(gm){if(this.mapType==="B_EARTH_MAP"){if(this._panes.mapPane){this._panes.mapPane.style.display="none"}if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}if(this._panes.markerPane){this._panes.markerPane.style.display="none"}}else{if(this._panes.mapPane){this._panes.mapPane.style.display=""}if(this._panes.markerPane){this._panes.markerPane.style.display=""}if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}gj.draw(gm)});gk.on("earthstatuschange",function gl(gm){gj.draw(gm)});gk.addEventListener("addoverlay",function(gq){var gn=gq.target;if(gn instanceof cb){if(!gj._overlays[gn.hashCode]){gj._overlays[gn.hashCode]=gn;gj._overlayArray.push(gn)}}else{var gp=false;for(var go=0,gm=gj._customOverlays.length;go<gm;go++){if(gj._customOverlays[go]===gn){gp=true;break}}if(!gp){gj._customOverlays.push(gn)}}});gk.addEventListener("removeoverlay",function(gp){var gn=gp.target;if(gn instanceof cb){delete gj._overlays[gn.hashCode];for(var go=0;go<gj._overlayArray.length;go++){if(gj._overlayArray[go]===gn){gj._overlayArray.splice(go,1);break}}}else{for(var go=0,gm=gj._customOverlays.length;go<gm;go++){if(gj._customOverlays[go]===gn){gj._customOverlays.splice(go,1);break}}}});gk.addEventListener("clearoverlays",function(go){this.closeInfoWindow();this.closeSimpleInfoWindow();for(var gn in gj._overlays){if(gj._overlays[gn]._config.enableMassClear){this.removeOverlay(gj._overlays[gn])}}for(var gm=gj._customOverlays.length-1;gm>0;gm--){if(gj._customOverlays[gm].enableMassClear!==false){this.removeOverlay(gj._customOverlays[gm]);gj._customOverlays.splice(gm,1)}}});gk.addEventListener("infowindowopen",function(gn){var gm=this.infoWindow;if(gm){A.hide(gm.popDom);A.hide(gm.shadowDom)}});function gi(){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(gj._zoomingOrMoving===false){this._panes.markerMouseTarget.style.display="none";gj._zoomingOrMoving=true}}}function e(go){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(gj._zoomingOrMoving===true){this._panes.markerMouseTarget.style.display="";gj._zoomingOrMoving=false;for(var gn=0;gn<gj._overlayArray.length;gn++){var gm=gj._overlayArray[gn];if(gm instanceof cA===true){gm.draw(go)}}}}}gk.addEventListener("movestart",gi);gk.addEventListener("moveend",e);gk.addEventListener("zoomstart",gi);gk.addEventListener("zoomend",e);gk.addEventListener("animation_start",gi);gk.addEventListener("animation_end",e);gk.addEventListener("displayoptions_changed",function(gm){if(this._displayOptions.overlay===false){this.temp.overlayDiv.style.display="none"}else{this.temp.overlayDiv.style.display=""}})};dR.prototype.draw=function(gm){gm=gm||{};if(this.map.getMapType()==="B_EARTH_MAP"){for(var gk=0;gk<this._overlayArray.length;gk++){var gi=this._overlayArray[gk];if(gi instanceof u===true){continue}if(this._zoomingOrMoving){if(gi instanceof cA===true){continue}}gi.draw(gm)}}else{for(var gk=0,gj=this._overlayArray.length;gk<gj;gk++){var gi=this._overlayArray[gk];if(this._zoomingOrMoving&&gi instanceof cA===true){continue}gi.draw(gm)}}A.each(this._customOverlays,function(e){e.draw(gm)});if(this.map.temp.infoWin){this.map.temp.infoWin.setPosition(gm.center,gm.zoom)}if(this.map.getMapType()!=="B_EARTH_MAP"&&this.map._renderType!=="webgl"){if(aU.DrawerSelector){var gl=aU.DrawerSelector.getDrawer(this.map);gl.setPalette()}}};aU.register(function(e){e._overlayMgr=new dR(e)});function u(e){cb.call(this);this._config={strokeColor:"#000",strokeWeight:2,strokeOpacity:1,strokeStyle:"solid",strokeLineCap:"round",strokeLineJoin:"round",enableMassClear:true,getParseTolerance:null,getParseCacheIndex:null,enableParse:true,enableEditing:false,mouseOverTolerance:15,geodesic:false,clip:true,texture:null};this.setConfig(e);if(this._config.strokeOpacity<0||this._config.strokeOpacity>1){this._config.strokeOpacity=0.65}if(this._config.fillOpacity<0||this._config.fillOpacity>1){this._config.fillOpacity=0.65}if(this._config.strokeStyle!=="solid"&&this._config.strokeStyle!=="dashed"&&this._config.strokeStyle!=="dotted"){this._config.strokeStyle="solid"}this.domElement=null;this._bounds=new cY();this.points=[];this.greatCirclePoints=[];this._parseCache=[];this._holesCache=[];this._parseCacheGL=[];this._parseCacheGLRaw=[];this._areaCacheGL=[];this._strokeStyleInfoForGL=[[]];this._fillStyleInfoForGL="";this.vertexMarkers=[];this._temp={}}u.JOININDEX={miter:0,round:1,bevel:2};u.CAPINDEX={round:0,butt:1,square:2};u.inherits(cb,"Graph");u.getGraphPoints=function(i){var e=[];if(!i||i.length===0){return e}if(typeof i==="string"){var gi=i.split(";");A.each(gi,function(gk){var gj=gk.split(",");e.push(new fX(gj[0],gj[1]))})}if(i.constructor===Array&&i.length>0){e=i}return e};u.parseTolerance={0:[0.09,0.005,0.0001,0.00001],1:[9000,500,20,1]};A.extend(u.prototype,{initialize:function(e){this.map=e;return null},draw:function(){},setPoints:function(e){this._clearCache();this.points=u.getGraphPoints(e).slice(0);this._calcBounds()},setPathIn:function(e){this.setPoints(e)},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds=new cY();if(!this.hasMultipleParts){A.each(this.points,function(i){e._bounds.extend(i)})}else{A.each(this.points,function(i){A.each(i,function(gi){e._bounds.extend(gi)})})}},getPoints:function(){return this.points},getPathIn:function(){return this.points},setPointAt:function(i,e){if(!e||!this.points[i]){return}this._clearCache();this.points[i]=new fX(e.lng,e.lat);this._calcBounds()},setOptions:function(i){i=i||{};for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},setStrokeColor:function(e){this._config.strokeColor=e},getStrokeColor:function(){return this._config.strokeColor},setStrokeLineCap:function(e){this._config.strokeLineCap=e},getStrokeLineCap:function(){return this._config.strokeLineCap},setStrokeLineJoin:function(e){this._config.strokeLineJoin=e},getStrokeLineJoin:function(){return this._config.strokeLineJoin},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e}},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(e){if(e!=="solid"&&e!=="dashed"&&e!=="dotted"){return}this._config.strokeStyle=e},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(e){this._config.fillColor=e||""},getFillColor:function(){return this._config.fillColor},getBounds:function(){this._bounds.setMinMax();return this._bounds},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent)}cb.prototype.remove.call(this);this._clearCache();var e=new aM("onlineupdate");e.action="remove";e.overlay=this;this.fire(e)},enableEditing:function(){this._config.enableEditing=true},disableEditing:function(){this._config.enableEditing=false},getParsedPoints:function(){var e=this._simplification(this.points);if(this.hasMultipleParts){return e}return[e]},_simplification:function(gn){var e=this.map;var gm=this.getParseCacheIndex(e.getZoom());var gp;if(this._parseCache[gm]){gp=this._parseCache[gm]}else{var gk=gn;if(this.greatCirclePoints.length>0){gk=this.greatCirclePoints}var gl=this.getParseTolerance(e.getZoom(),e.config.coordType);if(!this.hasMultipleParts){var go=f7(gk,gl)}else{var go=[];for(var gi=0;gi<gk.length;gi++){var gj=f7(gk[gi],gl);go.push(gj)}}gp=this._parseCache[gm]=go}return gp},_clearCache:function(){this._parseCache.length=0;this._parseCacheGL.length=0;this._parseCacheGLRaw.length=0;this._areaCacheGL.length=0}});if(A.Browser.ie&&document.namespaces&&!document.namespaces.olv){document.namespaces.add("olv","urn:schemas-microsoft-com:vml")}function fH(gl,gj,gi){if(!gl||!gj){return}this.imageUrl=null;this.imageDom=null;if(typeof gl==="string"){this.imageUrl=gl}else{this.imageDom=gl;if(!this.imageDom.id){this.imageDom.id=aU.getGUID("icon_dom_")}}this.size=gj;var gk=new c9(Math.floor(gj.width/2),Math.floor(gj.height/2));var i={offset:gk,imageOffset:new c9(0,0)};gi=gi||{};for(var e in gi){i[e]=gi[e]}if(gi.anchor){i.offset=gi.anchor}this.anchor=this.offset=i.offset;this.imageOffset=i.imageOffset;this.infoWindowOffset=gi.infoWindowOffset||this.offset;this.printImageUrl=gi.printImageUrl||"";this.imageSize=gi.imageSize;this.srcSetObject={};this.setImageSrcset(gi.srcset||gi.srcSet)}fH.prototype.setImageUrl=function(e){if(!e){return}this.imageUrl=e;this._renderData=null};fH.prototype.getCurrentImageUrl=function(){if(window.devicePixelRatio>1&&this.srcSetObject["2x"]){return this.srcSetObject["2x"]}return this.imageUrl};fH.prototype.setPrintImageUrl=function(e){if(!e){return}this.printImageUrl=e};fH.prototype.setSize=function(e){if(!e){return}this.size=new c9(e.width,e.height);this._renderData=null};fH.prototype.setOffset=function(e){if(!e){return}this.anchor=this.offset=new c9(e.width,e.height);this._renderData=null};fH.prototype.setAnchor=function(e){this.setOffset(e)};fH.prototype.setImageOffset=function(e){if(!e){return}this.imageOffset=new c9(e.width,e.height);this._renderData=null};fH.prototype.setInfoWindowOffset=function(e){if(!e){return}this.infoWindowOffset=new c9(e.width,e.height)};fH.prototype.setImageSize=function(e){if(!e){return}this.imageSize=new c9(e.width,e.height)};fH.prototype.setImageSrcset=function(gi){var e="";if(!gi){return}for(var i in gi){if(gi.hasOwnProperty(i)){this.srcSetObject[i]=gi[i];e=gi[i]+" "+i+","}}this.srcSet=e};fH.prototype.toString=function(){return"Icon"};fH.prototype.generateRenderData=function(){var i=this.offset;var e=this.size;var gj=this.imageOffset;var gi=[];gi.push(-i.width,i.height-e.height,0);gi.push(e.width-i.width,i.height-e.height,0);gi.push(e.width-i.width,i.height,0);gi.push(-i.width,i.height-e.height,0);gi.push(e.width-i.width,i.height,0);gi.push(-i.width,i.height,0);return{vertex:gi}};fH.prototype.getRenderData=function(){if(!this._renderData){this._renderData=this.generateRenderData()}return this._renderData};function ad(gi,i){A.BaseClass.call(this);this.content=gi;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new c9(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width!=0){if(this._config.width<220){this._config.width=220}if(this._config.width>730){this._config.width=730}}if(this._config.height!=0){if(this._config.height<60){this._config.height=60}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!=0){if(this._config.maxWidth<220){this._config.maxWidth=220}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=dX.imgPath;this.overlay=null;var e=this;da.load("infowindow",function(){e._draw()})}ad.inherits(A.BaseClass,"InfoWindow");A.extend(ad.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<220){e=220}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<60){e=60}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<220){e=220}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},getContent:function(){return this.content},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){A.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPointIn:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getTitle:function(){return this._config.title||""},getPosition:function(){return this.latLng;var e=this.getPointIn();return dm.convertMC2LL(e)},getPoint:function(){var e=this.getPointIn();return dm.convertMC2LL(e)},getOffset:function(){return this._config.offset},dispose:function(){A.BaseClass.prototype.decontrol.call(this)},toString:function(){return"InfoWindow"}});cm.prototype.openInfoWindowIn=function(gj,e){if(!gj||gj.toString()!="InfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var gi=new fH(dX.imgPath+"blank.gif",{width:1,height:1});i.marker=new cA(e,{icon:gi,width:1,height:1,offset:new c9(0,0),infoWindowOffset:new c9(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openInfoWindow(gj)};cm.prototype.openInfoWindow=function(gi,e){gi.latLng=new cj(e.lat,e.lng);var i=dm.convertLL2MC(e);this.openInfoWindowIn(gi,i)};cm.prototype.closeInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeInfoWindow()}};cb.prototype.openInfoWindow=function(e){if(this.map){this.map.closeInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;A.BaseClass.call(e,e.hashCode)}};cb.prototype.closeInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function au(gi,i){cb.call(this);this.content=gi;this.map=null;this.domElement=null;this._config={width:0,offset:new c9(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",fontSize:"12px",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:true};i=i||{};this.setConfig(i);if(this._config.width<0){this._config.width=0}this.point=this._config.point;var e=this;da.load("marker",function(){e._draw()})}au.inherits(cb,"Label");A.extend(au.prototype,{setPoint:function(e){if(e&&e.toString()==="Point"&&!this.getMarker()){this.point=this._config.point=new fX(e.lng,e.lat)}},setContent:function(e){this.content=e},getContent:function(e){return this.content},setOpacity:function(e){if(e>=0&&e<=1){this._config.opacity=e}},setOffset:function(e){if(!e||e.toString()!=="Size"){return}this._config.offset=new c9(e.width,e.height)},getOffset:function(){return this._config.offset},setStyle:function(e){e=e||{};this._config.styles=A.extend(this._config.styles,e)},setStyles:function(e){this.setStyle(e)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setMarker:function(e){if(this._marker&&this._marker!==e){this._marker._config.label=null}this._marker=e;if(e){this.point=this._config.point=e.getPoint()}else{this.point=this._config.point=null}},getMarker:function(){return this._marker||null},getPositionIn:function(){return this.getPoint()},});function eD(gi,i){var gj={};for(var e in i){if(i.hasOwnProperty(e)){if(e==="position"){gj.point=dm.convertLL2MC(i[e]);this.latLng=new cj(i[e]["lat"],i[e]["lng"])}else{gj[e]=i[e]}}}au.call(this,gi,gj)}eD.inherits(au,"LabelOut");A.extend(eD.prototype,{toString:function(){return"Label"},setPosition:function(e){this.latLng=new cj(e.lat,e.lng);var i=dm.convertLL2MC(e);this.setPoint(i)},getPosition:function(){return this.latLng;var e=this.getPositionIn();return dm.convertMC2LL(e)}});window.BMAP_ANIMATION_DROP=1;window.BMAP_ANIMATION_BOUNCE=2;function cA(e,i){cb.call(this);i=i||{};this.point=e;this._rotation=0;this.map=null;this._animation=null;this.domElement=null;this.iconDom=null;this.infoWindowDom=null;this.siblingElement=null;this.textureCoord=null;this.textureCoordGLMap=null;this.collisionDetectionFailed=false;this._config={offset:new c9(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:true,zIndexFixed:false,isTop:false,enableMassClear:true,enableDragging:false,raiseOnDrag:false,restrictDraggingArea:false,startAnimation:"",enableCollisionDetection:false,rank:0,enableDraggingMap:false};this.setConfig(i);if(!i.icon){this._config.icon=new fH(dX.imgPath+"marker_red.png",new c9(23,25),{offset:new c9(10,25),infoWindowOffset:new c9(10,0)})}this._isDragging=false;var gi=this;da.load("marker",function(){gi._draw()})}cA.TOP_ZINDEX=aT.getZIndex(-90)+1000000;cA.DRAG_ZINDEX=cA.TOP_ZINDEX+1000000;cA._injectMethond=function(e){A.extend(cA.prototype,e)};cA.inherits(cb,"Marker");A.extend(cA.prototype,{toString:function(){return"Marker"},setIcon:function(e){if(e){this._config.icon=e;this.textureCoord=this.textureCoordGLMap=null}},getIcon:function(){return this._config.icon},setLabel:function(e){if(!e){return}this._config.label=e;e._config.enableMassClear=this._config.enableMassClear;e.setPoint(this.point)},getLabel:function(){return this._config.label},enableDragging:function(){this._config.enableDragging=true},disableDragging:function(){this._config.enableDragging=false},setPoint:function(e){if(e){this.point=this._config.point=new fX(e.lng,e.lat);this.latLng=dm.convertMC2LL(e)}},setPositionIn:function(e){this.setPoint(e)},getPositionIn:function(){return this.getPoint()},setTop:function(i,e){this._config.isTop=!!i;if(i){this._addi=e||0}},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setOffset:function(e){if(e){this._config.offset=e}},getOffset:function(){return this._config.offset},setAnimation:function(e){this._animation=e},setRank:function(e){this._config.rank=e},getRank:function(){return this._config.rank},setRotation:function(e){while(e<0){e+=360}this._rotation=e%360},getRotation:function(){return this._rotation}});function am(e,gi){this.latLng=new cj(e.lat,e.lng);var i=dm.convertLL2MC(e);cA.call(this,i,gi)}am.inherits(cA,"MarkerOut");A.extend(am.prototype,{toString:function(){return"Marker"},setPosition:function(e){this.latLng=new cj(e.lat,e.lng);var i=dm.convertLL2MC(e);this.setPositionIn(i)},getPosition:function(){return this.latLng;var e=this.getPositionIn();return dm.convertMC2LL(e)}});function a(gi,e){u.call(this,e);this.setPoints(gi);var i=this;da.load("poly",function(){i._draw()})}a.inherits(u,"Polyline");function aa(gk,e){if(!gk||gk.length===0){return}var gj=[];for(var gi=0;gi<gk.length;gi++){gj[gi]=dm.convertLL2MC(gk[gi])}a.call(this,gj,e)}aa.inherits(a,"PolylineOut");A.extend(aa.prototype,{toString:function(){return"Polyline"},setPath:function(gj){if(!gj||gj.length===0){return}var gi=[];for(var e=0;e<gj.length;e++){gi[e]=dm.convertLL2MC(gj[e])}this.setPathIn(gi)},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var gj=[];for(var gi=0;gi<e.length;gi++){gj[gi]=dm.convertMC2LL(e[gi])}return gj}});function ef(e,gi){u.call(this,gi);this._normalizedBounds=new cY();this.setPoints(e);var i=this;da.load("poly",function(){i._draw()})}ef.inherits(a,"PolylineMultipart");A.extend(ef.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);this._calcBounds()},_unifyArgs:function(gi){var e=[];var i=[];if(gi.constructor===Array){if(gi[0].constructor===fX){i.push(gi)}else{i=gi}}else{if(typeof gi==="string"){i.push(gi)}}A.each(i,function(gj){e.push(u.getGraphPoints(gj))});return e},setPointAt:function(i,e,gi){gi=gi||0;if(!e||!this.points[gi]||!this.points[gi][i]){return}this._clearCache();this.points[gi][i]=new fX(e.lng,e.lat);this._calcBounds()},getBounds:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){A.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{A.each(e.points,function(i){A.each(i,function(gi){e._bounds.extend(gi)})})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-cm.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>cm.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-cm.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=cm.WORLD_SIZE_MC_HALF}}});function ax(gi,e){u.call(this,e);e=e||{};if(typeof e.fillOpacity==="number"){this._config.fillOpacity=e.fillOpacity}else{this._config.fillOpacity=0.6}et(this._config.fillOpacity,0,1);if(e.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=e.fillColor?e.fillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(gi,e);var i=this;da.load("poly",function(){i._draw()})}ax.inherits(u,"Polygon");A.extend(ax.prototype,{setPoints:function(gl){var gj=[];if(typeof gl==="string"||gl[0] instanceof fX||this instanceof eS||gl.length===0){var e=this._processSinglePointArray(gl);this._userPoints=e.userPoints;gj=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var gk=0;gk<gl.length;gk++){var gi=this._processSinglePointArray(gl[gk]);this._userPoints.push(gi.userPoints);gj.push(gi.innerPoints)}this.hasMultipleParts=true}u.prototype.setPoints.call(this,gj)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=u.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new fX(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._userPoints[i]=new fX(e.lng,e.lat);this.points[i]=new fX(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new fX(e.lng,e.lat)}this._calcBounds()},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function fC(gk,e){if(!gk||gk.length===0){return}var gj=[];for(var gi=0;gi<gk.length;gi++){gj[gi]=dm.convertLL2MC(gk[gi])}ax.call(this,gj,e)}fC.inherits(ax,"PolygonOut");A.extend(fC.prototype,{toString:function(){return"Polygon"},setPath:function(gj){if(!gj||gj.length===0){return}var gi=[];for(var e=0;e<gj.length;e++){gi[e]=dm.convertLL2MC(gj[e])}this.setPathIn(gi)},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var gj=[];for(var gi=0;gi<e.length;gi++){gj[gi]=dm.convertMC2LL(e[gi])}return gj}});function eS(i,e,gi){this.point=i;this.radius=Math.abs(e);ax.call(this,[],gi)}eS.parseTolerance={0:[0.01,0.0001,0.00001,0.000004],1:[1000,10,1,0.4]};eS.inherits(ax,"Circle");A.extend(eS.prototype,{initialize:function(e){this.map=e;this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return null},getPoint:function(){return this.point},setPoint:function(e){if(!e){return}this.point=e},setCenterIn:function(e){var i=arguments[1];this.setPoint(e,i)},setRadius:function(e){this.radius=Math.abs(e)},getCenterIn:function(){return this.point},getRadius:function(){return this.radius},_getPerimeterPoints:function(e,gq){if(!e||!gq||!this.map){return[]}var gi=this.map;var gn=e.lng;var gl=e.lat;var gw=dm.convertMC2LL(e);gn=gw.lng;gl=gw.lat;var gx=[];var gs=gq/dm.EARTHRADIUS;var gp=(Math.PI/180)*gl;var gv=(Math.PI/180)*gn;for(var go=0;go<360;go+=9){var gm=(Math.PI/180)*go;var gt=Math.asin(Math.sin(gp)*Math.cos(gs)+Math.cos(gp)*Math.sin(gs)*Math.cos(gm));var gr=Math.atan2(Math.sin(gm)*Math.sin(gs)*Math.cos(gp),Math.cos(gs)-Math.sin(gp)*Math.sin(gt));var gu=((gv-gr+Math.PI)%(2*Math.PI))-Math.PI;var gk=new cj(gt*(180/Math.PI),gu*(180/Math.PI));gx.push(dm.convertLL2MC(gk))}var gj=gx[0];gx.push(new fX(gj.lng,gj.lat));if(gj){this._radiusMercator=Math.sqrt(Math.pow(gj.lng-this.point.lng,2)+Math.pow(gj.lat-this.point.lat,2))}else{this._radiusMercator=this.radius}return gx}});function cO(i,e,gj){this.latLng=new cj(i.lat,i.lng);var gi=dm.convertLL2MC(i);eS.call(this,gi,e,gj)}cO.inherits(eS,"CircleOut");A.extend(cO.prototype,{toString:function(){return"Circle"},setCenter:function(e){this.latLng=new cj(e.lat,e.lng);var i=dm.convertLL2MC(e);this.setCenterIn(i)},getCenter:function(){return this.latLng;var e=this.getCenterIn();return dm.convertMC2LL(e)}});function fQ(gj,e,i){u.call(this,i);i=i||{};if(typeof i.fillOpacity==="number"){this._config.fillOpacity=i.fillOpacity}else{this._config.fillOpacity=0.6}et(this._config.fillOpacity,0,1);if(i.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=i.fillColor?i.fillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(gj,i);this.altitude=e||0;var gi=this;da.load("poly",function(){gi._draw()})}fQ.inherits(u,"Polygon3d");A.extend(fQ.prototype,{setPoints:function(gl){var gj=[];if(typeof gl==="string"||gl[0] instanceof fX||this instanceof eS||gl.length===0){var e=this._processSinglePointArray(gl);this._userPoints=e.userPoints;gj=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var gk=0;gk<gl.length;gk++){var gi=this._processSinglePointArray(gl[gk]);this._userPoints.push(gi.userPoints);gj.push(gi.innerPoints)}this.hasMultipleParts=true}u.prototype.setPoints.call(this,gj)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=u.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new fX(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._userPoints[i]=new fX(e.lng,e.lat);this.points[i]=new fX(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new fX(e.lng,e.lat)}this._calcBounds()},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function x(gl,e,gi){if(!gl||gl.length===0){return}var gk=[];for(var gj=0;gj<gl.length;gj++){gk[gj]=dm.convertLL2MC(gl[gj])}fQ.call(this,gk,e,gi)}x.inherits(fQ,"Polygon3dOut");A.extend(x.prototype,{toString:function(){return"Polygon3d"},setPath:function(gj){if(!gj||gj.length===0){return}var gi=[];for(var e=0;e<gj.length;e++){gi[e]=dm.convertLL2MC(gj[e])}this.setPathIn(gi)},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var gj=[];for(var gi=0;gi<e.length;gi++){gj[gi]=dm.convertMC2LL(e[gi])}return gj}});var a6={};function f9(gi,i){A.BaseClass.call(this);this.content=gi;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new c9(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width<50){this._config.width=50}if(this._config.width>730){this._config.width=730}if(this._config.height!=0){if(this._config.height<50){this._config.height=50}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!==0){if(this._config.maxWidth<50){this._config.maxWidth=50}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=dX.imgPath;this.overlay=null;var e=this;da.load("simpleInfowindow",function(){e._draw()})}f9.inherits(A.BaseClass,"SimpleInfoWindow");A.extend(f9.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;e-=10;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){A.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPoint:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getOffset:function(){return this._config.offset},dispose:function(){A.BaseClass.prototype.decontrol.call(this)},toString:function(){return"SimpleInfoWindow"}});cm.prototype.openSimpleInfoWindow=function(gj,e){if(!gj||gj.toString()!="SimpleInfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var gi=new fH(dX.imgPath+"blank.gif",{width:1,height:1});i.marker=new cA(e,{icon:gi,width:1,height:1,offset:new c9(0,0),infoWindowOffset:new c9(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openSimpleInfoWindow(gj)};cm.prototype.closeSimpleInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeSimpleInfoWindow()}};cb.prototype.openSimpleInfoWindow=function(e){if(this.map){this.map.closeSimpleInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;A.BaseClass.call(e,e.hashCode)}};cb.prototype.closeSimpleInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function c1(gi,e){if(arguments.length===0){return}cb.apply(this,arguments);e=e||{};this._config={bounds:gi,opacity:e.opacity||1,imageURL:e.imageURL||"",displayOnMinLevel:e.displayOnMinLevel||1,enableMassClear:e.enableMassClear===false?false:true,displayOnMaxLevel:e.displayOnMaxLevel||19,stretch:e.stretch||false};if(e.opacity===0){this._config.opacity=0}var i=this;da.load("groundOverlay",function(){i._draw()})}c1.inherits(cb,"GroundOverlay");A.extend(c1.prototype,{setBounds:function(e){this._config.bounds=e},getBounds:function(){return this._config.bounds},setOpacity:function(e){this._config.opacity=e},getOpacity:function(){return this._config.opacity},setImageURL:function(e){this._config.imageURL=e},getImageURL:function(){return this._config.imageURL},setDisplayOnMinLevel:function(e){this._config.displayOnMinLevel=e},getDisplayOnMinLevel:function(){return this._config.displayOnMinLevel},setDisplayOnMaxLevel:function(e){this._config.displayOnMaxLevel=e},getDisplayOnMaxLevel:function(){return this._config.displayOnMaxLevel}});function di(e,i){e=isNaN(e)?0:e;i=isNaN(i)?0:i;this.x=e;this.y=i}di.prototype.equals=function(e){if(!e){return false}return e.x===this.x&&e.y===this.y};di.prototype.clone=function(){return new di(this.x,this.y)};di.prototype.toString=function(){return"Pixel"};function c9(i,e){if(typeof i!=="number"){this.width=parseFloat(i)}else{this.width=i}if(typeof e!=="number"){this.height=parseFloat(e)}else{this.height=e}}c9.prototype.equals=function(e){return !!(e&&this.width===e.width&&this.height===e.height)};c9.prototype.toString=function(){return"Size"};var bc={B_NORMAL_MAP:{tileUrls:dq(dX.tileDomain,dX.rasterTilePath),vectorTileUrls:dq(dX.tileDomain,dX.vectorTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:dX.imgPath+"bg.png",bounds:new cY(new fX(-21364736,-11708041.66),new fX(23855104,12474104.17)),imgExtend:"png"},B_SATELLITE_MAP:{tileUrls:["https://maponline0.bdimg.com/starpic/?qt=satepc&","https://maponline1.bdimg.com/starpic/?qt=satepc&","https://maponline2.bdimg.com/starpic/?qt=satepc&","https://maponline3.bdimg.com/starpic/?qt=satepc&"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:dX.imgPath+"bg.png",bounds:new cY(new fX(-21364736,-10616832),new fX(23855104,15859712)),imgExtend:"png"},B_STREET_MAP:{tileUrls:dq(dX.tileDomain,dX.rasterTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:dX.imgPath+"bg.png",bounds:new cY(new fX(-21364736,-10616832),new fX(23855104,15859712)),imgExtend:"png"},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:dX.imgPath+"blank.gif",bounds:new cY(new fX(-21364736,-10616832),new fX(23855104,15859712)),imgExtend:"png"},B_EARTH_MAP:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:dX.imgPath+"blank.gif",bounds:new cY(new fX(-21364736,-10616832),new fX(23855104,15859712)),imgExtend:"png"}};var bw=bc;function bl(go,i,gk,gi,gj){this.mgr=go;this.position=gk;this._cbks=[];this.name=go.getTileName(gi,gj,go.map.config.style);this.info=gi;this._transparentPng=gj.isTransparentPng();var gp=M("img");cx(gp);gp.galleryImg=false;var gn=gp.style;gn.position="absolute";gn.width=go.tileSize+"px";gn.height=go.tileSize+"px";gn.left=gk[0]+"px";gn.top=gk[1]+"px";this.img=gp;this.src=i;if(S&&gk._offsetX===0){gn.opacity=0;gn.willChange="opacity"}var gm=this;this.img.onload=function(gx){if(!gm.mgr){return}var gs=gm.mgr;var gq=gs.bufferTiles;if(gs.bufferNumber>0){gq[gm.name]=gm;gq.push(gm.name)}var gu=gq.length-gs.bufferNumber;for(var gv=0;gu>0&&gv<gq.length;gv++){var gw=gq[gv];if(!gs.mapTiles[gw]){if(gq[gw]){gq[gw].mgr=null;var gt=gq[gw].img;if(gt.parentNode){ej(gt);gt.parentNode.removeChild(gt)}gt=null;gq[gw].img=null;gq[gw]=null;delete gq[gw]}gq.splice(gv,1);gv--;gu--}}gm.loaded=true;gs.imgNumber++;if(!fJ(gm.img)){if(gj.tilesDiv){gj.tilesDiv.appendChild(gm.img)}}var gx=new aM("onimagechange");gx.action="show";gx.tile=gm.name;gs.map.dispatchEvent(gx);if(S&&gk._offsetX===0){var gr=new n({fps:10,duration:300,render:function(e){if(gm.img&&gm.img.style){gm.img.style.opacity=e*1}},finish:function(){if(gm.img&&gm.img.style){delete gm.img.style.opacity;gm.img.style.willChange="auto"}}})}gm._callCbks()};this.img.onerror=function(gs){gm.error=true;gm._callCbks();if(!gm.mgr){return}var gq=gm.mgr;var gr=bw[gj.mapType];if(gr.errorUrl){gm.img.src=gr.errorUrl}if(!fJ(gm.img)){if(gj.tilesDiv){gj.tilesDiv.appendChild(gm.img)}}};gp=null;var gl=new aM("onimagebefore");gl.tile=gm.name;go.map.dispatchEvent(gl)}bl.prototype._addLoadCbk=function(e){this._cbks.push(e)};bl.prototype._load=function(){if(FeBrowser.ie<=6&&FeBrowser.ie>0&&this._transparentPng){this.img.src=dX.imgPath+"blank.gif"}else{this.img.src=this.src}};bl.prototype._callCbks=function(){var gi=this;for(var e=0;e<gi._cbks.length;e++){gi._cbks[e]()}gi._cbks.length=0};var S=(!A.Browser.ie||A.Browser.ie>8);function d8(e){this.tileLayers=[];this.map=e;this.bufferNumber=300;this.mapTiles=[];this.bufferTiles=[];this.config=bw[this.map.mapType];this.errorUrl=this.config.errorUrl;this.tileSize=this.config.tileSize;this.baseUnits=this.config.baseUnits;this.baseZoomLevel=this.config.zoomLevelBase;this.tileURLs=this.config.tileUrls;this.imgNumber=0;this.numLoading=0;this.temp={}}aU.register(function(i){if(i._renderType==="webgl"){return}var e=i.tileMgr=new d8(i);i.addEventListener("mousewheel",function(gi){e.mouseWheel(gi)});i.addEventListener("dblclick",function(gi){e.dblClick(gi)});i.addEventListener("rightdblclick",function(gi){e.dblClick(gi)});i.addEventListener("minuspress",function(gi){e.keypress(gi)});i.addEventListener("pluspress",function(gi){e.keypress(gi)});i.addEventListener("load",function(gi){if(this.mapType===BMAP_EARTH_MAP){return}e.loadTiles()});i.addEventListener("zoomstartcode",function(gi){if(this.mapType===BMAP_EARTH_MAP){return}e._zoom(gi)});i.addEventListener("moving",function(gi){if(this.mapType===BMAP_EARTH_MAP){return}e.moveGridTiles()});i.addEventListener("resize",function(gi){if(this.mapType===BMAP_EARTH_MAP){return}e.resizeMap(gi)});i.addEventListener("addtilelayer",function(gi){e.addTileLayer(gi)});i.addEventListener("removetilelayer",function(gi){e.removeTileLayer(gi)})});A.extend(d8.prototype,{addTileLayer:function(gj){var gi=this;var i=gj.target;gi.tileLayers.push(i);if(gi.map.loaded){gi.moveGridTiles()}},removeTileLayer:function(gq){var gr=this;var go=gq.target;var gm=go.mapType;var gl=gr.mapTiles;var gt=gr.bufferTiles;for(var gi in gt){var gj=gi.split("-")[1];if(gj==gm){delete gt[gi]}}for(var gi in gl){var gj=gi.split("-")[1];if(gj==gm){delete gl[gi]}}if(gr.zoomsDiv&&gr.zoomsDiv.parentNode){gr.zoomsDiv.parentNode.removeChild(gr.zoomsDiv);gr.zoomsDiv.innerHTML=""}var gk=gr.map;if(gk.deepZoom){var gs=gk.deepZoom.preDeepZoomDiv;if(gs&&gs.parentNode){gs.parentNode.removeChild(gs)}}for(var gp=0,gn=gr.tileLayers.length;gp<gn;gp++){if(go==gr.tileLayers[gp]){gr.tileLayers.splice(gp,1)}}gr.moveGridTiles()},hideDeepZoomDiv:function(){var i=this,gi=i.map;if(gi.deepZoom){var e=gi.deepZoom.preDeepZoomDiv;if(e&&e.style.display!="none"){e.style.display="none"}}},getTileLayer:function(gk){var gj=this;for(var gi=0,e=gj.tileLayers.length;gi<e;gi++){tilelayer=gj.tileLayers[gi];if(tilelayer.mapType==gk){return tilelayer}}return null},_zoom:function(gi){var i=this;if(i.zoomsDiv&&i.zoomsDiv.style.display!="none"){i.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},resizeMap:function(i){this.loaded=false;this.moveGridTiles()},_checkTilesLoaded:function(){this.numLoading--;var e=this;if(this.numLoading==0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading==0){e.map.dispatchEvent(new aM("ontilesloaded"))}e._checkLoadedTimer=null},80)}},getTileName:function(e,gi,i){var gk=gi.mapType;var gj="TILE-"+gk+"-"+i+"-"+e[0]+"-"+e[1]+"-"+e[2];return gj},hideTile:function(gj,gi){var i=gj.img;if(fJ(i)){if(gj.loaded){this.imgNumber--}if(i.parentNode){ej(i);i.parentNode.removeChild(i)}}var gk=new aM("onimagechange");gk.tile=this.getTileName(gj.info,gi,this.map.config.style);gk.action="hide";delete this.mapTiles[gj.name];if(!gj.loaded){ej(i);gj._callCbks();i=null;gj.img=null;gj.mgr=null}this.map.dispatchEvent(gk)},loadTiles:function(){var i=this;if(A.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(gi){}}if(this.zoomsDiv&&this.zoomsDiv.style.display!="none"){this.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},getCell:function(gk,gj){var e=this.baseUnits*Math.pow(2,(this.baseZoomLevel-gj));var gi=parseInt(gk.lng/e);var i=parseInt(gk.lat/e);return[gi,i,e*(gi+0.5),e*(i+0.5)]},moveGridTiles:function(){var gx=this.map,gG=gx.getMapType(),gE=this.tileLayers.length;var gC=gx.centerPoint;if(gG!==BMAP_SATELLITE_MAP){gC=c6.calcLoopCenterPoint(gC)}var go=gx.width;var gS=gx.getZoomUnits();var gD=gS*go;var gI=gC.lng-gD/2;var gt=gC.lng+gD/2;var gw=c6.isAddWidth(gI,gt);for(var gK=0;gK<gE;gK++){var gk=this.tileLayers[gK];if(gk.baseLayer||gE==1){this.tilesDiv=gk.tilesDiv}var gy=bw[gk.mapType];var gj=gx.zoomLevel;var gN=gx.getZoomUnits(gx.zoomLevel);var gs=gy.baseUnits*Math.pow(2,(gy.zoomLevelBase-gj));var gq=Math.floor(gC.lng/gs);var gJ=Math.floor(gC.lat/gs);var gv=gy.tileSize;var gz=[gq,gJ,(gC.lng-gq*gs)/gs*gv,(gC.lat-gJ*gs)/gs*gv];var gr=gw?gx.width/2*1.5:gx.width/2;var gu=gz[0]-Math.ceil((gr-gz[2])/gv);var gR=gz[1]-Math.ceil((gx.height/2-gz[3])/gv);var gL=gz[0]+Math.ceil((gr+gz[2])/gv);var gA=gz[1]+Math.ceil((gx.height/2+gz[3])/gv);var gp=[];for(var gP=gu;gP<gL;gP++){for(var gO=gR;gO<gA;gO++){gp.push([gP,gO]);var gF="id_"+gP+"_"+gO+"_"+gj;gp[gF]=true}}if(gk.mapType!==BMAP_SATELLITE_MAP){gp=c6.calcLoopTiles(gp,gj)}gp.sort((function(i){return function(gU,gV){return((0.4*Math.abs(gU[0]-i[0])+0.6*Math.abs(gU[1]-i[1]))-(0.4*Math.abs(gV[0]-i[0])+0.6*Math.abs(gV[1]-i[1])))}})([gz[0],gz[1]]));var gi=this.mapTiles;var e=-gC.lng/gN;var gT=gC.lat/gN;var gH=[e,gT];for(var gB in gi){var gm=gi[gB];var gQ=gm.info;if(!gQ){continue}var gF="id_"+gQ[0]+"_"+gQ[1]+"_"+gQ[2];if(!gp[gF]){this.hideTile(gm,gk)}}var gl=-gx.offsetX+gx.width/2;var gn=-gx.offsetY+gx.height/2;gk.tilesDiv.style.left=Math.round(e+gl)-gH[0]+"px";gk.tilesDiv.style.top=Math.round(gT+gn)-gH[1]+"px";this.numLoading+=gp.length;for(var gP=0,gM=gp.length;gP<gM;gP++){this.showTile([gp[gP][0],gp[gP][1],gx.zoomLevel],gH,gk,gP,gx.config.style)}}},showTile:function(gm,gl,gp,gu){this.centerPos=gl;var gn=bw[gp.mapType];var gq=this.map.config.style;var gj=this.getTileName(gm,gp,gq);var gk=(gm[0]*gn.tileSize)+gl[0];var gi=(-1-gm[1])*gn.tileSize+gl[1];var gt=[gk,gi];var go=null;if(gp.mapType!==BMAP_SATELLITE_MAP){go=c6.calcLoopParam(gm[0],gm[2]);var gs=go.offsetX;gt[0]+=gs;gt._offsetX=gs}var gx=this;var gw=this.mapTiles[gj];if(gw){gw.img.style.left=gt[0]+"px";gw.img.style.top=gt[1]+"px";if(gw.loaded){this._checkTilesLoaded()}else{gw._addLoadCbk(function(){gx._checkTilesLoaded()})}return}gw=this.bufferTiles[gj];if(gw){this.imgNumber++;gp.tilesDiv.insertBefore(gw.img,gp.tilesDiv.lastChild);this.mapTiles[gj]=gw;gw.img.style.left=gt[0]+"px";gw.img.style.top=gt[1]+"px";if(gw.loaded){this._checkTilesLoaded()}else{gw._addLoadCbk(function(){gx._checkTilesLoaded()})}var gv=new aM("onimagechange");gv.action="cache";gv.tile=this.getTileName(gm,gp,gq);this.map.dispatchEvent(gv)}else{var gr=new di(gm[0],gm[1]);if(go){gr.x=go.col}var i=gp.getTilesUrl(gr,gm[2]);gw=new bl(this,i,gt,gm,gp);gw._addLoadCbk(function(){gx._checkTilesLoaded()});gw._load();this.mapTiles[gj]=gw;a3(this.map)}},mouseWheel:function(gn){var gm=this.map;if(!gm.config.enableWheelZoom){return}var go=gm.zoomLevel+(gn.trend===true?1:-1);var gk=gm._getProperZoom(go);if(gk.exceeded){var gi=new aM("onzoomexceeded");gi.targetZoom=go;gm.dispatchEvent(gi);return}gm.dispatchEvent(new aM("onzoomstart"));gm.lastLevel=gm.zoomLevel;gm.zoomLevel=gk.zoom;var i=gn.pixel;var gj=gm.pixelToPointIn(i,{zoom:gm.lastLevel});var gl=gm.getZoomUnits(gm.zoomLevel);gm.centerPoint=new fX(gj.lng+gl*(gm.width/2-i.x),gj.lat-gl*(gm.height/2-i.y));this.zoom(i)},dblClick:function(gi){var i=this.map;if(!i.config.enableDblclickZoom){return}if(i.mapType==="B_EARTH_MAP"){return}if(i.currentOperation===c0.dragging){return}if(gi.type=="onrightdblclick"){i.zoomOut(gi.point)}else{i.zoomIn(gi.point)}},keypress:function(gi){var i=this.map;if(i.getMapType()===BMAP_EARTH_MAP){return}gi.type=="onpluspress"?i.zoomIn():i.zoomOut()}});function b8(gj){this.opts=gj||{};this.copyright=this.opts.copyright||{};this.transparentPng=this.opts.transparentPng||false;this.png8=this.opts.png8||false;this.baseLayer=this.opts.baseLayer||false;this.dataType=this.opts.dataType||1;this.isFlat=this.opts.isFlat===false?false:true;this.showLabel=this.opts.showLabel===false?false:true;var e=this.opts.tileTypeName||"web";this.tileType=b4.getInstance(e);this.clipTile=this.opts.clipTile||false;this._type="tilelayer";var i=eP()?128:256;this.cacheSize=this.opts.cacheSize||i;var gi=this;this.tileCache=new dT(this.cacheSize,{clearCallback:function(gk){if(gk.label){if(gk.label.textImageBitmap){gk.label.textImageBitmap.close()}if(gk.label.indoorTextImageBitmap){gk.label.indoorTextImageBitmap.close()}}gi._removeIndoorData(gk)}});this.scaler=aJ()>=1.5?2:1;this.normalUdt=an("ditu","normal").udt;this.numLoading=0;this.useThumbData=false;if(this.baseLayer){this.useThumbData=true}if(typeof this.opts.customLayer==="boolean"){this.customLayer=this.opts.customLayer}else{this.customLayer=true}}b8.inherits(dc,"TileLayer");A.extend(b8.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(gq,e){var gi=bw[this.mapType];if(typeof gi!="object"){return null}var gj=gq.x;var gr=gq.y;if(this.mapType!==BMAP_SATELLITE_MAP){var gr=c6.calcLoopParam(gr,e).col}var i="";if(this.opts.tileUrlTemplate){i=this.opts.tileUrlTemplate;i=i.replace(/\{X\}/,gr);i=i.replace(/\{Y\}/,gj);i=i.replace(/\{Z\}/,e)}else{if(this.mapType==BMAPGL_NORMAL_MAP){var gp=this.isCanvasMap?0:1;var gl=gi.tileUrls[Math.abs(gr+gj)%gi.tileUrls.length];if(window.offLineIPAddress){gl=window.offLineIPAddress+"tile5/"}var gk=this.map.config.style;i=gl+"?qt=vtile&x="+gj+"&y="+gr+"&z="+e+(gk==="default"?"":("&styleId="+dX.mapStyleNameIdPair[gk]))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&showtext="+gp;i=i.replace(/-(\d+)/gi,"M$1")}if(this.mapType==BMAP_SATELLITE_MAP){var gm=an("ditu","satellite");var go=gm.ver;var gn=gm.udt;i=gi.tileUrls[Math.abs(gr+gj)%gi.tileUrls.length]+"u=x="+gj+";y="+gr+";z="+e+";v="+go+";type=sate&fm=46&udt="+gn;i=i.replace(/-(\d+)/gi,"M$1")}}return i},initialize:function(gk){this.map=gk;if(gk._renderType==="webgl"){var gj=null;if(this.customLayer!==false){gj=this.getTilesUrl}A.extend(this,eF);this.labelProcessor=new cw(this);this.callbackDataQueue=[];if(gj){this.getTilesUrl=gj}var e=this;gk.on("indoor_data_refresh",function(gl){if(!e.baseLayer){return}e._refreshIndoorData(gl.uid,gl.floor)});gk.on("custom_labels_ready",function(gl){if(!e.baseLayer){return}e._doWorkAfterLabelImageLoad(gl.virtualTile,gl.labelCanvas,null,gl.imgKey)});gk.on("glmoduleloaded",function(){if(!e.baseLayer){return}e.updateAllIconsTextureCoords()})}if(!gk.temp.layerZIndex){gk.temp.layerZIndex=0}this.zIndex=this.zIndex||0;if(this.baseLayer){this.zIndex=0}if(!gk.temp.layid){gk.temp.layid=0}if(!this.opts.mapType){this.mapType="BMAP_CUSTOM_LAYER_"+gk.temp.layid;gk.temp.layid++}else{this.mapType=this.opts.mapType}var i=bw[this.mapType];if(!i){bw[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minZoom:3,maxZoom:19,minDataZoom:3,maxDataZoom:19,zoomLevelBase:18,errorUrl:dX.imgPath+"/blank.gif",bounds:new cY(new fX(-21364736,-10616832),new fX(23855104,15859712)),imgExtend:"png"}}if(gk._renderType!=="webgl"){var gi=cR(gk.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');gi.style.display="";gi.style.left=Math.ceil(-gk.offsetX+gk.width/2)+"px";gi.style.top=Math.ceil(-gk.offsetY+gk.height/2)+"px";this.tilesDiv=gi}this.isCanvasMap=gk.isCanvasMap();this.lastZoom=gk.getZoom()},remove:function(){if(this.tilesDiv&&this.tilesDiv.parentNode){this.tilesDiv.innerHTML="";this.tilesDiv.parentNode.removeChild(this.tilesDiv)}delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},setZIndex:function(e){this.zIndex=e;if(this.tilesDiv){this.tilesDiv.style.zIndex=e}}});function ck(i,e,gi){this.bounds=i;this.content=e;this.mapType=gi}ck.inherits(dc,"Copyright");var e6={get:function(e){if(!e6.singleton){e6.singleton=new Y(e)}return e6.singleton}};function Y(i){this._map=i;this._tileMgr=i.tileMgr;this._animationDiv=null;this._preAnimationDiv=null;this._animation=null;this._baseLayerDiv=null;this._transformStyleName=aL.ifSupportCSS3("transform",true);this._transformOriginStyleName=aL.ifSupportCSS3("transformOrigin",true);this._preZoomTimes=1;this._preRenderTick=1;this._enableCanvas2dMap=!!(i.getRenderType()==="canvas");this._isIE9=!!(A.Browser.ie===9);var e=this;i.addEventListener("maptypechange",function(){e.hide()});i.addEventListener("load",function(){e.hide()})}A.extend(Y.prototype,{prepareLayer:function(){var gj=this._map;var e=this._tileMgr;this._canvas2dMapMgr=gj.canvas2dMapMgr;var gi=this._baseLayerDiv=e.tilesDiv;if(!this._animationDiv){var i=this._preAnimationDiv;if(i){i.parentNode&&i.parentNode.removeChild(i);this._preAnimationDiv=null}this._preAnimationDiv=this._animationDiv=gi.cloneNode(true);gj.platform.insertBefore(this._animationDiv,gj.platform.firstChild)}this.show()},prepareAniParam:function(){var gj=this._animationDiv;if(!gj){return}var e=gj.children.length;var gi;this._zoomAniInfo=[];for(var gk=e-1;gk>-1;gk--){var gl={};gi=gj.children[gk].style;gl.top=parseInt(gi.top,10);gl.left=parseInt(gi.left,10);this._zoomAniInfo[gk]=gl}},prepareLabelLayer:function(){var gk=this._map;if(this._enableCanvas2dMap&&gk.canvas2dMapMgr){if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.parentNode.removeChild(this.touchZoomLabelCanvas)}var i=gk.canvas2dMapMgr._labelCanvas;this.touchZoomLabelCanvas=i.cloneNode(false);var e=this.touchZoomLabelCanvas.getContext("2d");e.drawImage(i,0,0);gk.platform.insertBefore(this.touchZoomLabelCanvas,gk.platform.firstChild);var gj=parseInt(i.style.left,10);var gi=parseInt(i.style.top,10);this.touchZoomLabelCanvas.style.zIndex=9;this.touchZoomLabelCanvas.style[this._transformOriginStyleName]=(this._fixPosition.x-(gk.offsetX+gj))+"px "+(this._fixPosition.y-(gk.offsetY+gi))+"px";i.style.visibility="hidden"}},show:function(){if(this._animationDiv){this._animationDiv.style.visibility=""}},showLabel:function(){var i=this._map;if(this._enableCanvas2dMap&&i.canvas2dMapMgr){var e=i.canvas2dMapMgr._labelCanvas;if(e){e.style.visibility=""}if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.zIndex=-2;this.touchZoomLabelCanvas.style.visibility="hidden"}}},hide:function(){if(this._animationDiv){this._animationDiv.style.visibility="hidden"}if(this._preAnimationDiv){this._preAnimationDiv.style.visibility="hidden"}},hideNonAnimationLayers:function(){var gj=this._map;if(gj.getRenderType()==="dom"){if(gj.overlayDiv){gj.overlayDiv.style.visibility="hidden"}if(gj.overlayDivEx){gj.overlayDivEx.style.visibility="hidden"}}var gl=gj.tileMgr.tileLayers;var gk;for(var gi=0,e=gl.length;gi<e;gi++){gk=gl[gi];gk.tilesDiv.style.visibility="hidden"}},showNonAnimationLayers:function(){var gj=this._map;if(gj.getRenderType()==="dom"){if(gj.overlayDiv){gj.overlayDiv.style.visibility=""}if(gj.overlayDivEx){gj.overlayDivEx.style.visibility=""}}var gl=gj.tileMgr.tileLayers;var gk;for(var gi=0,e=gl.length;gi<e;gi++){gk=gl[gi];gk.tilesDiv.style.visibility=""}},setFixPosition:function(e){this._fixPosition=e},setZoom:function(e,gp){var gm=this._fixPosition;var gv=this._map;var gw=this._baseLayerDiv;var gn={x:gm.x-parseInt(gw.style.left,10)-gv.offsetX,y:gm.y-parseInt(gw.style.top,10)-gv.offsetY};var gj=this._animationDiv;if(!gj){return}var gt=gj.children.length;var gr;var gu=this._transformStyleName;var gl=this._transformOriginStyleName;var gx=this;var gz;var go;for(var gs=gt-1;gs>-1;gs--){var gq=this._zoomAniInfo[gs];gr=gj.children[gs].style;var gk=gq.left-gn.x;var gi=gq.top-gn.y;gq.dx=gk*e-gk;gq.dy=gi*e-gi;gq.preDx=gk-gk;gq.preDy=gi-gi;gz=gq.preDx+(gq.dx-gq.preDx);go=gq.preDy+(gq.dy-gq.preDy)+gp;gr.left=gq.left+gz+"px";gr.top=gq.top+go+"px";gr.width=gr.height=256*e+"px"}if(this._enableCanvas2dMap){var gy=!gx._isIE9?"translate3d(0px, "+gp+"px, 0) scale("+e+")":"translate(0px, "+gp+"px) scale("+e+")";this.touchZoomLabelCanvas.style[gu]=gy}},setZoomFinish:function(){this._animationDiv=null},startAnimation:function(gm){this.prepareLayer();this.hideNonAnimationLayers();var gF=this._map;if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.display="none"}gm=gm||{};var gD=gm.zoomCount||0;var gr=gm.fixPosition;var gB=gm.fixMCPosition;var gp=gm.pixOffset;this._zoomCount=gD;var gj=gF.getZoom();var gE=gj+gD;var e=gF.config.enableContinuousZoom;var gv=0.5;var gq=5;var gi=Math.pow(2,gD);var gH=this._baseLayerDiv;var gs={x:gr.x-parseInt(gH.style.left,10)-gF.offsetX,y:gr.y-parseInt(gH.style.top,10)-gF.offsetY};var gn=this._animationDiv;var gz=gn.children.length;var gJ=this._preZoomTimes;var gC=[];var gA=this._transformStyleName;var go=this._transformOriginStyleName;for(var gy=gz-1;gy>-1;gy--){var gw={};var gx=gn.children[gy].style;gw.top=parseInt(gx.top,10);gw.left=parseInt(gx.left,10);var gl=gw.left-gs.x;var gk=gw.top-gs.y;gw.dx=gl*gi-gl;gw.dy=gk*gi-gk;gw.preDx=gl*gJ-gl;gw.preDy=gk*gJ-gk;gC[gy]=gw}var gG=this;var gu;var gI;var gt;this._zoomAni=new n({fps:60,duration:e?500:1,transition:function(i){i=i*gq/(2*gv);return gq*i-gv*i*i},render:function(gS){gS=gS*(4*gv)/(gq*gq);gu=gJ+gS*(gi-gJ);var gL=gj+dz(gu);var gQ=null;var gP=0;var gT=0;if(gm.onAnimationBeforeLooping){var gU=gm.onAnimationBeforeLooping(gS,gL);gQ=gU.loopingCenter;gP=gU.yDiff;gT=gU.totalYDiff}for(var gM=gC.length-1;gM>-1;gM--){var gN=gC[gM];if(gn.children[gM]){var gR=gn.children[gM].style;gI=gN.preDx+(gN.dx-gN.preDx)*gS-gp.width*gS;gt=gN.preDy+(gN.dy-gN.preDy)*gS-gp.height*gS+gP;gR.left=gN.left+gI+"px";gR.top=gN.top+gt+"px";gR.height=gR.width=256*gu+"px"}}var gK=gp.width*gS;var gO=gp.height*gS;if(gF.isRestrict){gG._enableCanvas2dMap&&gG._canvas2dMapMgr.clearLabel()}else{gG._enableCanvas2dMap&&gG._canvas2dMapMgr.drawLabel(gu,gr,gj,gE,gD,gS,gK,gO,gT,gP)}gG._preZoomTimes=gu;gG._preRenderTick=gS;gm.onAnimationLooping&&gm.onAnimationLooping(gS,gL,gQ)},finish:function(){gG._preZoomTimes=1;gG._zoomAni=null;gG._animationDiv=null;gm.onAnimationFinish&&gm.onAnimationFinish();gG.showNonAnimationLayers()}});return this._zoomAni},stopAnimation:function(){if(this._zoomAni){this._zoomAni.stop();this._zoomAni=null}}});function c(e){this._initVars(e);this._initColorCanvas();this._bindEvent(e)}A.extend(c.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this._labelCtx=e._labelCtx;this.ratio=this._map.config.ratio;this.sizeRatio=this.ratio>1?2:1;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},_initColorCanvas:function(){var i=256,gi=M("canvas"),e=gi.style;e.width=i+"px";e.height=i+"px";gi.width=i;gi.height=i;this._colorCvsSize=i;this._colorCvs=gi;this._colorCtx=gi.getContext("2d")},getLabelImageData:function(gw){var gv=gw.textImg;var gi=gw.textPos;var gt=this.ratio;var gr=this.sizeRatio/gt;var gk=this._colorCtx;var go=this._colorCvsSize;gk.clearRect(0,0,go,go);var gq=0;var e=0;var gn=0;for(var gp=0;gp<gi.length;gp++){if(gi[gp].width>gq){gq=gi[gp].width;e=gp;gn=gi[gp].drawX}}gq/=gr;var gs=0;for(var gp=0,gm=gi.length;gp<gm;gp++){var gu=gi[gp];var gx;if(gp===e){gx=0}else{gx=gu.drawX-gn}gk.drawImage(gv,gu.srcX,gu.srcY,gu.width,gu.height,gx,gs,gu.width/gr,gu.height/gr);if(gu.width/gr>gq){gq=gu.width/gr}gs+=gu.height/gr+2*gt}var gj=gk.getImageData(0,0,gq,gs);var gl=gk.getImageData(0,0,gq,gs);return[gj,gl]},_bindEvent:function(i){var e=this,gi=i._map;gi.addEventListener("onspotmouseover",function(gm){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(gm.spots.length>0){var gl=gm.spots[0].userdata.uid;var gk=gm.spots[0].userdata.name;var gj=e.findLabelByUid(gl,gk);gj&&e._toHighLightColor(gj)}});gi.addEventListener("onspotmouseout",function(gm){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(gm.spots.length>0){var gl=gm.spots[0].userdata.uid;var gk=gm.spots[0].userdata.name;var gj=e.findLabelByUid(gl,gk);gj&&e._toDefaultColor(gj)}});gi.addEventListener("onspotclick",function(gm){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(gm.spots&&gm.spots.length>0){var gl=gm.spots[0].userdata.uid;var gk=gm.spots[0].userdata.name;var gj=e.findLabelByUid(gl,gk);gj&&e._changeBaseMapState(gj)}else{e._recoverNormalState()}});gi.on("spot_status_reset",function(){e._recoverNormalState()});gi.on("spot_highlight",function(gk){var gj=e.findLabelByUid(gk.uid);gj&&e._changeBaseMapState(gj)})},_getTextBound:function(gu){if(!gu.textPos){return null}var gs=this.ratio;var gq=this.sizeRatio/gs;var gi=gu.textPos;var gt=gu.baseDrawX;var gr=gu.baseDrawY;var go=gt*gs+(gi[0].drawX-gt)/gq;var gm=gr*gs+(gi[0].drawY-gr)/gq;var gk=go+gi[0].width/gq;var e=gm+gi[0].height/gq;for(var gp=0,gn=gi.length;gp<gn;gp++){var gv=gi[gp];var gl=gt*gs+(gv.drawX-gt)/gq;if(gl<go){go=gl}var gj=gr*gs+(gv.drawY-gr)/gq;if(gj<gm){gm=gj}if(gl+gv.width>gk){gk=gl+gv.width}if(gj+gv.height>e){e=gj+gv.height}}return[go,gm,gk,e]},_toHighLightColor:function(gi){if(gi._tempRank&&gi._tempRank==this.RANK5){return}var gn=this._getTextBound(gi);if(!gn){return}var gj=Math.round(gn[0]);var i=Math.round(gn[1]);var e=this.getLabelImageData(gi);var gl=e[0];var gk=e[1];var gm=this._canvas2dMapMgr.getFilterImageData(gl,this.RANK5);gi._oldImgData=gk;this._labelCtx.putImageData(gm,gj,i)},_toDefaultColor:function(e){if(e._tempRank&&e._tempRank==this.RANK5){return}if(e._oldImgData){var i=this.sizeRatio;var gi=this._getTextBound(e);if(!gi){return}this._labelCtx.putImageData(e._oldImgData,Math.round(gi[0]),Math.round(gi[1]));e._oldImgData=null}},_changeBaseMapState:function(gj){var gi=this._canvas2dMapMgr;var i=gj.guid;var e=gj.guidExt;var gk={guid:i,name:gj.name,guidExt:e};gi._labelStrategy.setStrategyInfo(gk);gi._loadData()},_recoverNormalState:function(){var e=this._canvas2dMapMgr;e._labelStrategy.setStrategyInfo(null);e._loadData()},findLabelByUid:function(gl,gj){var gn=this._canvas2dMapMgr,e=gn._computedLabel;for(var gk=0,gi=e.length;gk<gi;gk++){var gm=e[gk];if(!gn.isClickableLabel(gm)){continue}if(gl&&gm.guid===gl){return gm}if(gj&&gm.name===gj){return gm}}return null}});function db(e){this._initVars(e)}A.extend(db.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.ratio=this._map.config.ratio;this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},setStrategyInfo:function(e){this._strategyInfo=e},preComputeLabel:function(gp,hg,gZ,gB,ha,hu){var gT=[],gx=gp._centerX,gv=gp._centerY,hv=gB*ha;var g5=this.ratio;var go=this._map.getZoom();var gO=0;if(go===5){gO=4}if(go===8){gO=-6}gp.sort(function(hw,i){if(hw.x*hw.y<i.x*i.y){return -1}else{return 1}});for(var gQ=0,gM=gp.length;gQ<gM;gQ++){var hl=gp[gQ],gH=hl.x,gE=hl.y,gC=hl.z;var gJ=c6.calcLoopParam(gH,gC).offsetX;var g3=gH*hv,g2=(gE+1)*hv,gj=(g3-gx)/gB+hg/2+gJ,gi=(gv-g2)/gB+gZ/2;for(var gN=0,hp=hl.length;gN<hp;gN++){var gr=hl[gN],gy=undefined,gw=undefined,hn=undefined,hm=undefined;var hc=gr.baseDrawX=gj+gr.baseX;var hb=gr.baseDrawY=gi+gr.baseY;if(gr.type=="fixed"){var gX=gr.iconPos,gA=gr.textPos,hr=gr.textImg;if(gX){gX.drawX=gj+gX.destX;gX.drawY=gi+gX.destY;gy=gX.drawX;gw=gX.drawY;hn=gX.drawX+gX.width;hm=gX.drawY+gX.height}if(gA&&hr){for(var hd=0;hd<gA.length;hd++){var hq=gA[hd];hq.drawX=gj+hq.destX;hq.drawY=gi+hq.destY;if(!gy){gy=hq.drawX;gw=hq.drawY;hn=hq.drawX+hq.width;hm=hq.drawY+hq.height}else{if(hq.drawX<gy){gy=hq.drawX}if(hq.drawY<gw){gw=hq.drawY}if(hq.drawX+hq.width>hn){hn=hq.drawX+hq.width}if(hq.drawY+hq.height>hm){hm=hq.drawY+hq.height}}}}}else{gr.tileX=gj;gr.tileY=gi;gy=gj+gr.minXOriginal;gw=gi+gr.minYOriginal;hn=gj+gr.maxXOriginal;hm=gi+gr.maxYOriginal}if(gy!=undefined){var hf=hc+(gy-hc)/g5;var he=hb+(gw-hb)/g5;var gR=hc+(hn-hc)/g5;var gP=hb+(hm-hb)/g5;gr.minX=hf;gr.minY=he;gr.maxX=gR;gr.maxY=gP;var hj=(hf+gR)/2,hi=(he+gP)/2,g0=gx+(hj-hg/2)*gB,gY=gv+(gZ/2-hi)*gB;gr.geoX=g0;gr.geoY=gY;gT.push(gr)}}}if(hu){for(var gQ=0,gM=hu.length;gQ<gM;gQ++){var gL=hu[gQ];var g8=gL[0];var gs=gL[1];var gX=g8.iconPos;var gm=gX.geoX;var gk=gX.geoY;var hc=(gm-gx)/gB+hg/2;var hb=(gv-gk)/gB+gZ/2;var gy=hc+gX.destX;var gw=hb+gX.destY;var hn=gy+gX.width;var hm=gw+gX.height;g8.textPos=g8.textPos||g8._textPos;var gA=g8.textPos;var hh=gA[0];var gG=hc+hh.destX;var gu=hb+hh.destY;if(gu<gw){gw=gu}if(gG+hh.width>hn){hn=gG+hh.width}if(gu+hh.height>hm){hm=gu+hh.height}if(gA.length===2){var gF=gA[1];var gD=hc+gF.destX;var gt=hb+gF.destY;if(gt<gw){gw=gt}if(gD+gF.width>hn){hn=gD+gF.width}if(gt+gF.height>hm){hm=gt+gF.height}}g8._tempBounds=[gy,gw,hn,hm];var gX=gs.iconPos;var gm=gX.geoX;var gk=gX.geoY;var hc=(gm-gx)/gB+hg/2;var hb=(gv-gk)/gB+gZ/2;var gy=hc+gX.destX;var gw=hb+gX.destY;var hn=gy+gX.width;var hm=gw+gX.height;gs.textPos=gs.textPos||gs._textPos;var gA=gs.textPos;var hh=gA[0];var gG=hc+hh.destX;var gu=hb+hh.destY;if(gG<gy){gy=gG}if(gu<gw){gw=gu}if(gu+hh.height>hm){hm=gu+hh.height}if(gA.length===2){var gF=gA[1];var gD=hc+gF.destX;var gt=hb+gF.destY;if(gD<gy){gy=gD}if(gt<gw){gw=gt}if(gt+gF.height>hm){hm=gt+gF.height}}gs._tempBounds=[gy,gw,hn,hm]}for(var gQ=0,gM=hu.length;gQ<gM;gQ++){var gL=hu[gQ];var g8=gL[0];var gs=gL[1];if(gQ===0&&gs.textPos){gs._textPos=gs.textPos;delete gs.textPos}var hk=g8;if(!g8.textPos&&gs.textPos){hk=gs}var ho=hk._tempBounds;for(gN=gQ+1;gN<gM;gN++){var gK=hu[gN];var gU=gK[0];var ht=gK[1];var gz=0;var hs=gU._tempBounds;if(!(ho[2]<hs[0]||ho[0]>hs[2]||ho[3]<hs[1]||ho[1]>hs[3])){gz++;if(gU.textPos){gU._textPos=gU.textPos;delete gU.textPos}}var hs=ht._tempBounds;if(!(ho[2]<hs[0]||ho[0]>hs[2]||ho[3]<hs[1]||ho[1]>hs[3])){gz++;if(ht.textPos){ht._textPos=ht.textPos;delete ht.textPos}}if(gz>=2){if(hk.textPos){hk._textPos=hk.textPos;delete hk.textPos}}}}for(var gQ=0,gM=hu.length;gQ<gM;gQ++){var gL=hu[gQ];var g8=gL[0];var gs=gL[1];var gV=g8;if(!g8.textPos&&gs.textPos){gV=gs}var gX=gV.iconPos;var gm=gX.geoX;var gk=gX.geoY;var hc=gV.baseDrawX=(gm-gx)/gB+hg/2;var hb=gV.baseDrawY=(gv-gk)/gB+gZ/2;gX.drawX=hc+gX.destX;gX.drawY=hb+gX.destY;var gy=gX.drawX;var gw=gX.drawY;var hn=gX.drawX+gX.width;var hm=gX.drawY+gX.height;var gA=gV.textPos;if(gA){var hh=gA[0];hh.drawX=hc+hh.destX;hh.drawY=hb+hh.destY;if(hh.drawX<gy){gy=hh.drawX}if(hh.drawY<gw){gw=hh.drawY}if(hh.drawX+hh.width>hn){hn=hh.drawX+hh.width}if(hh.drawY+hh.height>hm){hm=hh.drawY+hh.height}if(gA.length===2){var gF=gA[1];gF.drawX=hc+gF.destX;gF.drawY=hb+gF.destY;if(gF.drawX<gy){gy=gF.drawX}if(gF.drawY<gw){gw=gF.drawY}if(gF.drawX+gF.width>hn){hn=gF.drawX+gF.width}if(gF.drawY+gF.height>hm){hm=gF.drawY+gF.height}}}var hf=hc+(gy-hc)/g5;var he=hb+(gw-hb)/g5;var gR=hc+(hn-hc)/g5;var gP=hb+(hm-hb)/g5;gV.minX=hf;gV.minY=he;gV.maxX=gR;gV.maxY=gP;var g7=(hf+gR)/2;var g6=(he+gP)/2;var gn=gx+(g7-hg/2)*gB;var gl=gv+(gZ/2-g6)*gB;gV.geoX=gn;gV.geoY=gl;gT.push(gV)}}var g9=this._strategyInfo;if(g9){var gS=g9.guid;var g1=g9.name;var gI=g9.guidExt;for(var gQ=0,gM=gT.length;gQ<gM;gQ++){var gq=gT[gQ];delete gq._tempRank;if(!this._canvas2dMapMgr.isClickableLabel(gq)||(gI===1&&!gq.guidExt)){continue}if((gS&&gS===gq.guid)||(g1&&g1===gq.name)){gq._tempRank=this.RANK5}}}else{for(var gQ=0,gM=gT.length;gQ<gM;gQ++){var gq=gT[gQ];if(gq.type=="line"||!gq.iconPos){continue}delete gq._tempRank}}gT.sort(function(hx,hw){var hy=hx._tempRank?hx._tempRank:hx.rank,i=hw._tempRank?hw._tempRank:hw.rank;if(hy===i){return hx.baseX-hw.baseX}return i-hy});for(var gQ=0,gM=gT.length;gQ<gM;gQ++){var hk=gT[gQ];hk.isDel=false;hk.isFadeout=false;hk._schedule=0;hk._isIgnore=false;hk.arrIntersectIndex=[];for(gN=gQ+1;gN<gM;gN++){var gW=gT[gN];if(!(hk.maxX-gO<gW.minX||hk.minX>gW.maxX-gO||hk.maxY-gO<gW.minY||hk.minY>gW.maxY-gO)){hk.arrIntersectIndex.push(gN)}}}for(var gQ=0,gM=gT.length;gQ<gM;gQ++){var gq=gT[gQ];if(gq.isDel==false){var e=gq.arrIntersectIndex;for(var gN=0,hp=e.length;gN<hp;gN++){var g4=gT[e[gN]];g4.isDel=true;if(g4.guidExt===1){g4.isDel=false}}}}return gT}});function X(e){this._map=e;this._initCanvas();this._initVars();this._bindEvent();this._tileType=b4.getInstance("na")}aU.register(function(i){if(i.getRenderType()==="canvas"){var e=i.config.style;if(aU["FeatureStyle"+e]){i.canvas2dMapMgr=new X(i)}else{i.loadMapStyleFiles(function(){i.canvas2dMapMgr=new X(i);i.canvas2dMapMgr._loadData()})}}});A.extend(X.prototype,{_initCanvas:function(){var gm=this._map,gk=gm.getSize(),gj=gk.width,i=gk.height,e=gm.platform,gn=M("canvas"),gl=gn.style;var gi=this.ratio=gm.config.ratio;this._width=gj;this._height=i;gl.cssText="position: absolute;left:0;top:0;width:"+gj+"px;height:"+i+"px;z-index:100;";gn.width=gj*gi;gn.height=i*gi;this._labelCanvas=gn;this._labelCtx=gn.getContext("2d");e.appendChild(gn)},_initVars:function(){var e=an("ditu","normal");this._udt=e.udt;this._version=e.ver;this._labelDataUrls=bw.B_NORMAL_MAP.vectorTileUrls;this._style=aU["FeatureStyle"+this._map.config.style];this._labelCount=0;this._vectorDrawLib=new aD(this);this._cache={maxNum:500,delNum:50,arrCache:[]};this._computedLabel=null;this._spotData=null;this._labelStrategy=new db(this);this._labelClick=new c(this);this._biz=new fr(this);this._map.temp.isPermitSpotOver=true;this.labelStyleParam="pl";if(this._map.getMapType()===BMAP_SATELLITE_MAP){this.labelStyleParam="sl"}this.statRequestCount=0;this.statResponseCount=0},_resizeHandler:function(gl){var gn=this,i=gn._map,gk=i.getSize(),gi=gk.width,gp=gk.height;var gm=this.ratio;var gq=this._labelCanvas,gj=gq.style;gj.width=gi+"px";gj.height=gp+"px";gq.width=gi*gm;gq.height=gp*gm;gn._width=gi;gn._height=gp;var go=true;gn._loadData(go)},_bindEvent:function(){var e=this,i=e._map;i.addEventListener("load",function(gi){e.clearLabel();e._loadData()});i.addEventListener("zoomend",function(gi){if(!gi.notClearLabel){e.clearLabel()}e._loadData()});i.addEventListener("moveend",function(gi){e._loadData()});i.addEventListener("resize",function(gi){e._resizeHandler(gi)});i.addEventListener("maptypechange",function(gi){if(gi.mapType===BMAP_EARTH_MAP){e.hideLabelCanvas()}else{e.showLabelCanvas();if(gi.mapType===BMAPGL_NORMAL_MAP){e.labelStyleParam="pl"}else{if(gi.mapType===BMAP_SATELLITE_MAP){e.labelStyleParam="sl"}}e._loadData()}});i.addEventListener("streetlayer_show",function(gi){if(this.isCanvasMap()){e.showLabelCanvas()}});i.addEventListener("streetlayer_hide",function(gi){if(this.isCanvasMap()){e.hideLabelCanvas()}});i.addEventListener("loadbizdata",function(gj){var gi=gj.data;e._biz.proecessBizData(gi,function(){e.updateLabel()})});i.addEventListener("unloadbizdata",function(gi){e._biz.clearBizData();e.updateLabel()});e.isDrawText=false;setTimeout(function(){if(!e.isDrawText){i.dispatchEvent(new aM("onmapwhitescreen"))}},10000)},getStyle:function(){return this._style},_getZoomUnits:function(e){return Math.pow(2,18-e)},_createCacheForm:function(gi,gn,gm,i){var gl=this;var e=gl._cache;var gj=e.arrCache;var go=this._getLabelId(gi,gn,gm,i);var gk={id:go,updateLabelCounter:0};gj.push(gk);gj[go]=gk;return gk},_getLabelId:function(i,gj,gi,e){return"_"+i+"_"+gj+"_"+gi+"_"+e+"_"+this.labelStyleParam},_getCache:function(i,gj,gi,e){return this._cache.arrCache[this._getLabelId(i,gj,gi,e)]},_setCacheValue:function(gk,gx,gv,gj,gq){var gs=this;var e=gs._cache;var gm=e.arrCache;var go=e.maxNum;var gl=e.delNum;var gw=this._getLabelId(gk,gx,gv,gj);var gr=gm[gw];if(gq){gr.lb=gq}if(gm.length>go){var gi=gm.splice(0,gl);for(var gp=0,gn=gi.length;gp<gn;gp++){var gt=gi[gp],gu=gt.id;if(gm[gu].lb){gm[gu].lb=null}gm[gu]=null;delete gm[gu]}gi=null}},_loadData:function(gv){var gO=this._map;if(!gO.isCanvasMap()){return}var go=gO.getCenterIn();var gN=c6.calcLoopCenterPoint(go);var gn=this._tileType;var gq=this._width/2;var gC=this._height;var gD=gO.getZoom();var gz=gn.getDataZoom(gD);var gs=gO.getZoomUnits(gD);var gy=gs*gq;var gM=gN.lng-gy;var gL=gN.lng+gy;var gw=c6.isAddWidth(gM,gL);gq=gw?gq*1.5:gq;var gx=gn.getTileSize(gD);var gk=gn.getMercatorSize(gD,gz);var gr=Math.floor(gN.lng/gk);var gt=Math.floor(gN.lat/gk);var gl=[gr,gt,(gN.lng-gr*gk)/gk*gx,(gN.lat-gt*gk)/gk*gx];var gF=gl[0]-Math.ceil((gq-gl[2])/gx);var gJ=gl[1]-Math.ceil((gC/2-gl[3])/gx);var gB=gl[0]+Math.ceil((gq+gl[2])/gx);var gG=gl[1]+Math.ceil((gC/2+gl[3])/gx);gO.temp.isPermitSpotOver=false;var e=[];for(var gI=gF;gI<gB;gI++){for(var gH=gJ;gH<gG;gH++){e.push([gI,gH,gz]);var gA="id_"+gI+"_"+gH+"_"+gD;e[gA]=true}}e._zoom=gz;e=c6.calcLoopTiles(e,gD);e.sort((function(i){return function(gQ,gR){return((0.4*Math.abs(gQ[0]-i[0])+0.6*Math.abs(gQ[1]-i[1]))-(0.4*Math.abs(gR[0]-i[0])+0.6*Math.abs(gR[1]-i[1])))}})([gl[0],gl[1]]));var gu=this._cache.arrCache;this._curViewLabels=[];var gj="viewKey_"+Math.floor(go.lng)+"_"+Math.floor(go.lat)+"_"+gD;this.statRequestCount=0;this.statResponseCount=0;this._labelCount+=e.length;var gp=gD;for(var gI=0,gE=e.length;gI<gE;gI++){var gr=e[gI][0];var gt=e[gI][1];var gi=e[gI][2];var gm=this._getLabelId(gr,gt,gi,gp);var gK=gu[gm];if(!gK){gK=this._createCacheForm(gr,gt,gi,gp)}if(typeof gK.lb==="undefined"){gK.lb=null;this._loadLabelData(gr,gt,gi,gp,gx,gj);this.statRequestCount++}else{if(gK.lb){this._curViewLabels.push(gK.lb);this._labelCount--}else{if(gv){this._loadLabelData(gr,gt,gi,gp,gx,gj)}gK.updateLabelCounter++}}}if(this._labelCount===0){this.updateLabel()}var gP=this;if(gP.errorTimer){clearTimeout(gP.errorTimer)}gP.errorTimer=setTimeout(function(){if(gP._labelCount!==0){gP._labelCount=0;gP.updateLabel()}var gR=new aM("onloaddatatimeout");var gS=0;var gQ=0;var gT=0;var i=0;if(gP.statRequestCount===gP.statResponseCount){gS=1}else{gQ=1}if(gQ===1){i=gP.statRequestCount-gP.statResponseCount;gT=gP.statResponseCount}gR.noTimeoutCount=gS;gR.timeoutCount=gQ;gR.timeoutNoLoaded=i;gR.timeoutLoaded=gT;gP._map.dispatchEvent(gR)},500)},clearLabel:function(){var e=this._width;var gi=this._height;var i=this.ratio;this._labelCtx.clearRect(0,0,e*i,gi*i)},updateLabel:function(){var i=this._map;var e=i.getCenterIn();var gj=this._width;var gm=this._height;var gp=i.getZoom();var go=this._tileType.getTileSize(gp);var gn=this._getZoomUnits(gp);var gi=this._labelCtx;this._labelCanvas.style.left=-i.offsetX+"px";this._labelCanvas.style.top=-i.offsetY+"px";var gl=this._curViewLabels;gl._centerX=e.lng;gl._centerY=e.lat;var gk=this._biz.bizLabels;this._computedLabel=this._labelStrategy.preComputeLabel(gl,gj,gm,gn,go,gk);this._computedLabel._zoom=gp;this.clearLabel();this._vectorDrawLib.drawIconAndText(gi,this._computedLabel,gp);this._addSpotData();i.temp.isPermitSpotOver=true;if(gl.length>0){this.isDrawText=true}},_loadLabelData:function(gs,gr,gq,gi,gt,e){var gl=gs.toString();var gj=gr.toString();var gn="cbk_"+gl.replace("-","_")+"_"+gj.replace("-","__")+"_"+Math.floor(gq);var gx=dx+"."+gn;var gw=this._labelDataUrls;var gp=Math.abs(gs+gr)%gw.length;var gC=gw[gp];if(window.offLineIPAddress){gC=window.offLineIPAddress+"pvd/"}var i=this.labelStyleParam;var gv="?qt=vtile";var gy="";if(this._map.config.style!=="default"){gy="&styleId="+dX.mapStyleNameIdPair[this._map.config.style]}var gu="x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}"+gy+"&textonly=1&textimg=1&scaler={scaler}&fn="+encodeURIComponent(gx);var gz=c6.calcLoopParam(gs,gq).col;var go=this.ratio>1?2:1;var gm=gu.replace(/{x}/,gz).replace(/{y}/,gr).replace(/{z}/,Math.floor(gq)).replace(/{styles}/,i).replace(/{udt}/,this._udt).replace(/{v}/,this._version).replace(/{scaler}/,go);var gk=gC+gv+"&param="+window.encodeURIComponent(e3(gm));var gB=this;var gA=gB._map;aU[gn]=function(gD){gB._vectorDrawLib.parseLabelData(gD,gs,gr,gq,gi,gt,function(gI){var gF=gA.getCenterIn();var gJ=gA.getZoom();var gL="viewKey_"+Math.floor(gF.lng)+"_"+Math.floor(gF.lat)+"_"+gJ;gB._labelCount--;var gM=gB._getCache(gs,gr,gq,gi).updateLabelCounter;gB._labelCount-=gM;var gG=gB._curViewLabels;if(gL===e||(gB._labelCount<0&&gJ===gq)){gG.push(gI)}if(gL===e){gB.statResponseCount++}if(gB._labelCount<=0){var gE=(new Date()).getTime();gB.updateLabel();var gH=(new Date()).getTime();var gK=new aM("oncanvasmaploaded");gK.drawTime=gH-gE;if(gB.statResponseCount===gB.statRequestCount){gK.isAllLoadedDrawing=true}gA.dispatchEvent(gK)}gB._setCacheValue(gs,gr,gq,gi,gI);delete aU[gn]})};fR.load(gk)},drawLabel:function(gi,gj,gq,i,go,gk,e,gl,gp,gm){var gn=this;if(!gn._computedLabel){return}if(gn._computedLabel._zoom!==gq){gn.clearLabel();return}gn._map.temp.isPermitSpotOver=false;gn.clearLabel();gn._vectorDrawLib.zoomingIconAndText(this._labelCtx,gn._computedLabel,gi,gj,i,go,gk,e,gl,gp,gm)},_addSpotData:function(){this._spotData=[];var gq=this._map.getZoom();for(var gl=0,gk=this._computedLabel.length;gl<gk;gl++){var gn=this._computedLabel[gl];if(!this.isClickableLabel(gn)||(gn.guidExt===1&&gn.startScale>gq)){continue}var gm=[];gm[0]=(gn.minX-gn.maxX)/2;gm[1]=(gn.minY-gn.maxY)/2;gm[2]=(gn.maxX-gn.minX)/2;gm[3]=(gn.maxY-gn.minY)/2;var gj=null;if(gn.iconPos){gj=new fX(gn.iconPos.geoX,gn.iconPos.geoY)}var gi=gn.name?gn.name.replace("\\\\","<br>"):"";if(gn.iconPos&&gn.iconPos.iconType.indexOf("ditie")>-1&&this._map.getZoom()>14){gi=""}var gp={n:gi,pt:new fX(gn.geoX,gn.geoY),userdata:{iconPoint:gj,uid:gn.guid,name:gi,type:gn.iconPos?gn.iconPos.iconType:"",iconImg:gn.iconImg,mapPoi:true,adver_log:gn.adver_log||""},bd:gm,tag:"MAP_SPOT_INFO"};this._spotData.push(gp)}var go=new aM("onspotsdataready");go.spots=this._spotData;this._map._spotDataOnCanvas=this._spotData;this._map.dispatchEvent(go)},isClickableLabel:function(e){if(e.isDel||(!e.guid&&!e.name)){return false}return true},getFilterImageData:function(gi,gm){var gn=gi.data,gl=this._labelStrategy,gm=parseInt(gm);for(var go=0,gk=gn.length;go<gk;go+=4){var e=gn[go],gp=gn[go+1],gq=gn[go+2],gr=gn[go+3];if(gr===0){continue}var gj=Math.round((e+gp+gq)/3);var gs=gj-90;gs=gs<0?0:gs;if(gm===gl.RANK5){gn[go]=51+gs*1.3;gn[go+1]=133+gs*0.8;gn[go+2]=255}}return gi},showLabelCanvas:function(){this._labelCanvas.style.visibility=""},hideLabelCanvas:function(){this._labelCanvas.style.visibility="hidden"}});var bz=5;var c3=4;var fV=3;var ea=2;var gb=1;var c5=0;var ge=3;var fL=5;var F={3:{start:3,base:3},4:{start:4,base:5},5:{start:4,base:5},6:{start:6,base:7},7:{start:6,base:7},8:{start:8,base:9},9:{start:8,base:9},10:{start:10,base:10},11:{start:11,base:12},12:{start:11,base:12},13:{start:11,base:12},14:{start:14,base:15},15:{start:14,base:15},16:{start:16,base:17},17:{start:16,base:17},18:{start:18,base:19},19:{start:18,base:19},20:{start:18,base:19},21:{start:18,base:19}};function aD(gj){this._canvas2dMapMgr=gj;var i=this.ratio=gj._map.config.ratio;this._featureStyle=null;this._map=gj._map;var gi=ep();var e="udt="+gi.udt+"&v="+gi.ver;this.sizeRatio=this.ratio>1?2:1;this._binaryCache={};this._iconCache={};this._initColorCanvas()}A.extend(aD.prototype,{_initColorCanvas:function(){var i=256,gi=M("canvas"),e=gi.style;e.width=i+"px";e.height=i+"px";gi.width=i;gi.height=i;this._colorCvs=gi;this._colorCtx=gi.getContext("2d")},parseLabelData:function(i,gl,gk,gj,e,go,gn){if(!this._featureStyle){this._featureStyle=this._canvas2dMapMgr.getStyle()}if(!i||!i[0]){gn([]);return}var gm=this._map.getZoomUnits();var gi=this;this.loadTextPng(i,go,gl,gk,gj,e,gm,gn)},loadTextPng:function(gA,gr,gp,go,gm,i,gk,gj){var gz=this;var e=gA[5];var gy=this._map;var gv=gy.getZoom();var gi=gy.getSize();var gw=gi.width;var gu=gi.height;var gx=gy.getCenterIn();var gn=gx.lng;var gl=gx.lat;var gt=gp*gr*gk;var gs=(go+1)*gr*gk;if(e){var gq=new Image();gq.onload=function(){gz.calcIconAndTextInfo(gA,gq,gr,gp,go,gm,i,gk,gt,gs,gj);delete this.onload};gq.src=e}else{setTimeout(function(){gz.calcIconAndTextInfo(gA,null,gr,gp,go,gm,i,gk,gt,gs,gj)},1)}},calcIconAndTextInfo:function(gC,gt,gu,gs,gp,gn,gj,gl,gw,gv,gk){var gB=this;var gA=gB._featureStyle;var gq=[];gq.x=gs;gq.y=gp;gq.z=gn;var gr=gB._canvas2dMapMgr,gi=gs*gl*gu,gz=(gp+1)*gl*gu,gm={tileLeft:gi,tileTop:gz,zoomUnits:gl};var e=[];if(gC[0]){for(var gx=0;gx<gC[0].length;gx++){if(gC[0][gx][0]===ge){e.push(gC[0][gx])}}}var go=gC[2]||[];for(var gx=0;gx<e.length;gx++){this._getFixedLabelInfo(e[gx],gt,gj,gl,gu,gw,gv,gq)}var gy=Math.pow(2,gj-gn);for(gx=0;gx<go.length;gx++){this._getLineLabelInfo(go[gx],gt,gn,gj,gl,gu,gw,gv,gy,gq)}gk(gq)},_getFixedLabelInfo:function(gt,gx,gk,go,gy,gB,gA,gD){var gs=gt[1];if(!gs){return}var gF=this._map.getZoom();var gN=this._map.config.style;var gO=this._featureStyle;var gp=gk;if(gp===9){gp=8}for(var gK=0;gK<gs.length;gK++){var gP=gs[gK];var e=gP[0];var gj=dk.getStyleFromCache(gN,e,"point",gp,gO);var gJ=dk.getStyleFromCache(gN,e,"pointText",gp,gO);if((!gJ||gJ.length===0)&&(!gj||gj.length===0)){if(gp===5){var gn=gP[1];if(!gn){continue}for(var gG=0;gG<gn.length;gG++){var gE=gn[gG][4];if(gE&&gE[7]==="北京"){gj=dk.getStyleFromCache(gN,e,"point",6,gO);gJ=dk.getStyleFromCache(gN,e,"pointText",6,gO);break}else{continue}}}else{continue}}var gn=gP[1];if(!gn){continue}var gL=null;var gq=1;var gi=0;var gw=0;if(gj&&gj[0]){gj=gj[0];gL=gj.icon;gq=gj.zoom?gj.zoom/100:1}else{gj=null}for(var gG=0;gG<gn.length;gG++){var gE=gn[gG][4];if(!gE){continue}var gI=gE[2];if(!this._isVisible(gI,gF)){continue}var gr=gE[12];if(gJ&&gJ.length>0&&!gr){continue}var gv=Math.round(gE[0]/100);var gu=Math.round(gE[1]/100);var gH={lng:gB+gv,lat:gA-(gy*go-gu)};var gm=gv/go;var gl=gy-gu/go;var gz=gE[7]||"";var gM=gE[5];var gC={type:"fixed",name:gz,textImg:gx,rank:gE[4],baseX:gm,baseY:gl,iconPos:null,textPos:null,guid:gE[3]||"",tracer:gI,direction:gM,startScale:3};if((gM!==c3&&gr||!gr)&&gL!==null){gC.iconPos=this._getIconPosition(gL,gq,gm,gl,gH);if(gC.iconPos){gi=gC.iconPos.width;gw=gC.iconPos.height}}if(gi===0){gC.direction=c3}if(gr){gC.textPos=this._getTextDrawData(gE,gm,gl,gi,gw)}if(gC.textPos||gC.iconPos){gD.push(gC)}}}},_isVisible:function(e,i){var gj;if(!this._binaryCache[e]){gj=e.toString(2);if(gj.length<8){gj=new Array(8-gj.length+1).join("0")+gj}this._binaryCache[e]=gj}gj=this._binaryCache[e];var gi=F[i].start;return gj[i-gi]==="1"},_getIconPosition:function(gn,gl,gi,i,e){var gj=this._map.config.style;var go=aU["iconSetInfo"+gj][gn];if(!go){if(gn.charCodeAt(0)>=48&&gn.charCodeAt(0)<=57){go=aU["iconSetInfo"+gj]["_"+gn]}}if(!go){return null}var gk=go[0];var gm=go[1];gk=gk*gl;gm=gm*gl;return{srcX:0,srcY:0,destX:gi-gk/2,destY:i-gm/2,width:gk,height:gm,geoX:e.lng,geoY:e.lat,mcPt:e,iconType:gn}},_getTextDrawData:function(gu,gt,gs,gj,gq){var gz=gu[5];if(typeof gz!=="number"){gz=0}var go=this.ratio;var gn=go/2;gj*=gn;gq*=gn;var gp=gu[12];var gk=gp.length;var gC=0;var gB=0;var gy=[];var gx=0;var gA=0;for(var gw=0;gw<gk;gw++){gA+=Math.round(gp[gw][3])}for(var gw=0;gw<gk;gw++){var gm=gp[gw];var gl=gm[0];var i=gm[1];var gi=gm[2];var e=gm[3];var gD=2*go;var gv=0;if(gj!==0){gv=2*go}if(gj===0){gz=c3}switch(gz){case fV:var gr=gs-gA/2-gD*(gk-1)/2;gC=gt-gi-gj/2-gv;gB=gr+gx+gD*gw;break;case gb:var gr=gs-gA/2-gD*(gk-1)/2;gC=gt+gj/2+gv;gB=gr+gx+gD*gw;break;case ea:var gr=gs-gq/2-gA-gD*(gk-1)-gD;gC=gt-gi/2;gB=gr+gx+gD*gw;break;case c5:var gr=gs+gq/2+gD/2;gC=gt-gi/2;gB=gr+gx+gD*gw;break;case c3:var gr=gs-e/2-gD*(gk-1)/2;gC=gt-gi/2;gB=gr+gx+gD*gw;break}gx+=e;if(gi>0&&e>0){gy.push({srcX:gl,srcY:i,destX:gC,destY:gB,width:gi,height:e})}}if(gy.length>0){return gy}return null},_getLineLabelInfo:function(gr,gj,gk,gG,gT,gy,gE,gD,gF,gx){if(gr.length!==10){return}var gI=this.ratio;var gi=this.ratio;var gP=gr[7].length;var gz=gr[1];var gR=gr[3];var gX=gr[8];var gn=gr[4];var e=2;var gl=gn.slice(0,e);for(var gU=e;gU<gn.length;gU+=e){gl[gU]=gl[gU-e]+gn[gU];gl[gU+1]=gl[gU-(e-1)]+gn[gU+1]}for(var gU=e;gU<gn.length;gU+=e){if(gU%(gR*e)===0||gU%(gR*e)===1){continue}gl[gU]=gl[gU-e]+gn[gU]/gF;gl[gU+1]=gl[gU-(e-1)]+gn[gU+1]/gF}for(var gW=0;gW<gP;gW++){var gS=gr[7][gW];if(!this._isVisible(gS,gG)){continue}var gK=gr[6][gW];var gw=gW*gR*e;gn=gl.slice(gw,gw+gR*e);var gA=[];var gJ=undefined;var gH=undefined;var gv=undefined;var gu=undefined;var gX=gr[9].slice(0);if(gK){gX.reverse()}var gN;var gL;for(var gV=0;gV<gR;gV++){var gt=gr[5][gR*gW+gV];var gO=gn[gV*e]/100;var gM=gn[gV*e+1]/100;var gs=gX[gV];var go=gs[0];var gq=gs[1];var gm=gs[2];var gp=gs[3];var gC;var gB;var gZ;var gY;if(gV===0){gN=gZ=gO/gT;gL=gy-gM/gT;gY=gM/gT}else{gZ=gO/gT;gY=gM/gT}var g1=gN+(gZ-gN)*gi-gm/2;var g0=gL+(gy-gY-gL)*gi-gp/2;if(gJ===undefined){gJ=gN-gm/2;gH=gL-gp/2;gv=gJ+gm;gu=gH+gp}else{if(g1<gJ){gJ=g1}if(g0<gH){gH=g0}if(g1+gm>gv){gv=g1+gm}if(g0+gp>gu){gu=g0+gp}}gA.push({angle:gt,srcX:go,srcY:gq,destX:g1,destY:g0,width:gm,height:gp})}var gQ={type:"line",textImg:gj,rank:gz,baseX:gN,baseY:gL,arrWordPos:gA,minXOriginal:gJ,minYOriginal:gH,maxXOriginal:gv,maxYOriginal:gu,text:""};gx.push(gQ)}},alterColor:function(gm,e,gl){var gi=this._colorCtx,i=this._canvas2dMapMgr;gi.clearRect(0,0,gm.width,gm.height);gi.drawImage(e,gm.srcX,gm.srcY,gm.width,gm.height,0,0,gm.width,gm.height);var gk=gi.getImageData(0,0,gm.width,gm.height),gj=i.getFilterImageData(gk,gl);gi.putImageData(gj,0,0)},drawIconAndText:function(gy,gx,e){var gp=this.ratio;var gn=this.sizeRatio/gp;var gr=2/gp;var gJ=this;for(var gB=0,gz=gx.length;gB<gz;gB++){var gq=gx[gB];if(gq.isDel==false){var gk=gq.baseDrawX;var gj=gq.baseDrawY;if(gq.type=="fixed"){var gm=gq.iconPos,gC=gq.textPos,gv=gq.textImg,gF=gq.startScale;if(gm&&gF<=e){var gi=this._iconCache[gm.iconType];if(gi){if(gi.img){gy.drawImage(gi.img,0,0,gi.img.width,gi.img.height,Math.round(gk*gp+(gm.drawX-gk)/gr),Math.round(gj*gp+(gm.drawY-gj)/gr),gm.width/gr,gm.height/gr)}else{gi.drawLabels.push(gq)}}else{if(!gi){this._iconCache[gm.iconType]={img:null,drawLabels:[gq]};var gL=new Image();gL._iconName=gm.iconType;gL.onload=function(){var gR=gJ._iconCache[this._iconName];gR.img=this;this.onload=null;for(var gN=0;gN<gR.drawLabels.length;gN++){var gP=gR.drawLabels[gN];var gO=gP.baseDrawX;var gM=gP.baseDrawY;var gQ=gP.iconPos;gy.drawImage(this,0,0,this.width,this.height,Math.round(gO*gp+(gQ.drawX-gO)/gr),Math.round(gM*gp+(gQ.drawY-gM)/gr),gQ.width/gr,gQ.height/gr)}gR.drawPos=[]};gL.src=dX.getIconSetPath(gJ._map.config.style)+gm.iconType+".png"}}}if(gC&&gv&&gF<=e){for(var go=0;go<gC.length;go++){var gw=gC[go];if(!gq._tempRank){gy.drawImage(gv,gw.srcX,gw.srcY,gw.width,gw.height,Math.round(gk*gp+(gw.drawX-gk)/gn),Math.round(gj*gp+(gw.drawY-gj)/gn),gw.width/gn,gw.height/gn)}else{this.alterColor(gw,gv,gq._tempRank);gy.drawImage(this._colorCvs,0,0,gw.width,gw.height,Math.round(gk*gp+(gw.drawX-gk)/gn),Math.round(gj*gp+(gw.drawY-gj)/gn),gw.width/gn,gw.height/gn)}}}}else{var gl=gq.arrWordPos,gv=gq.textImg,gu=gq.tileX,gs=gq.tileY;for(var gA=0,gt=gl.length;gA<gt;gA++){var gD=gl[gA];var gK=Math.round(gu+gD.destX);var gI=Math.round(gs+gD.destY);var gE=gD.angle;gK=gk*gp+gK-gk;gI=gj*gp+gI-gj;if(gE>10&&gE<350){gy.save();var gH=Math.round(gK+gD.width/2);var gG=Math.round(gI+gD.height/2);gy.translate(gH,gG);gy.rotate(-gE/180*Math.PI);gy.drawImage(gv,gD.srcX,gD.srcY,gD.width,gD.height,-Math.round(gD.width/2),-Math.round(gD.height/2),gD.width/gn,gD.height/gn);gy.restore()}else{gy.drawImage(gv,gD.srcX,gD.srcY,gD.width,gD.height,gK,gI,gD.width/gn,gD.height/gn)}}}}}},isCollide:function(gl,gu,gt,e,gn,gi,gp){for(var gk=0,gj=gi.length;gk<gj;gk++){var go=gi[gk],gm=1/Math.pow(2,gp+1),gs=gm*go[3]/2,gr=gm*go[4]/2,gq=go[0];if(gq!=gl){if(!(gu+e<go[1]-gs||gu>go[1]+go[3]+gs||gt+gn<go[2]-gr||gt>go[2]+go[4]+gr)){return true}}}return false},zoomingIconAndText:function(gJ,gD,gj,gH,gI,ha,gQ,gr,gW,gP,gA){var hb=this.ratio;var gs=this.sizeRatio/hb;var hc=2/hb;var hm=hb/2;var g6=gH.x;var g5=gH.y;var gK=2*hb;if(gA!==0){g5+=gP}var gv=undefined,go=undefined,gl=undefined,gq=undefined,gz=undefined;var gV=ha>0?true:false;if(!gV){gv=[];var gZ=1-gQ}for(var hi=0,hg=gD.length;hi<hg;hi++){var hd=gD[hi];if(hd.isDel==false){var hn=hd.baseDrawX;var hk=hd.baseDrawY;gJ.save();gJ.translate(-gr*hb,-gW*hb);if(hd.isFadeout){if(!gV&&hd._schedule<=gQ&&!hd._isIgnore){gJ.globalAlpha=gZ;hd._schedule=gQ}else{hd._isIgnore=true;continue}}if(hd.type=="fixed"){var gL=hd.iconPos,gS=hd.textPos,gm=hd.textImg,gM=hd.startScale;var gi;var g3=0;if(gL){g3=gK}if(gL&&!hd.iconImg&&this._iconCache[gL.iconType]){gi=this._iconCache[gL.iconType].img}if(gL&&gM<=gI&&gi){gq=gL.width;gz=gL.height;go=(g6+(hn-g6)*gj)*hb-gq/2/hc;gl=(g5+(hk-g5)*gj)*hb-gz/2/hc+gA;if(!gV&&this.isCollide(hi,go,gl,gq,gz,gv,ha)){hd.isFadeout=true}gJ.drawImage(gi,gL.srcX,gL.srcY,gi.width,gi.height,Math.round(go),Math.round(gl),gq/hc,gz/hc);!gV&&gv.push([hi,go,gl,gq,gz])}if(gS&&gm&&gM<=gI){var gR;var gT;var gC=0;var gO=0;if(gL){gC=gL.width;gO=gL.height}var g4=gS.length;var gu=0;var gU=0;for(var gE=0;gE<g4;gE++){var hf=gS[gE];gU+=hf.height;if(gu<hf.width){gu=hf.width}}gU+=(gE-1)*gK;if(!gV&&this.isCollide(hi,go,gl,gu,gU,gv,ha)){hd.isFadeout=true}var he=0;for(var gE=0;gE<g4;gE++){var hf=gS[gE];switch(hd.direction){case fV:gR=-(gC/2/hc+hf.width+g3);gT=-gU/2+he+gK*gE;break;case gb:gR=gC/2/hc+g3;gT=-gU/2+he+gK*gE;break;case ea:gR=-hf.width/2;gT=-gO/2/hc-gU+he-gK*(gE+1);break;case c5:gR=-hf.width/2;gT=gO/2/hc+he+gK*(gE+1);break;case c3:gR=-hf.width/2;gT=-gU/2+he+gK*gE;break}he+=hf.height;go=(g6+(hn-g6)*gj)*hb+gR/gs;gl=(g5+(hk-g5)*gj)*hb+gT/gs;+gA;gq=hf.width;gz=hf.height;if(!hd._tempRank){gJ.drawImage(gm,hf.srcX,hf.srcY,gq,gz,Math.round(go),Math.round(gl),gq/gs,gz/gs)}else{this.alterColor(hf,gm,hd._tempRank);gJ.drawImage(this._colorCvs,0,0,gq,gz,Math.round(go),Math.round(gl),gq/gs,gz/gs)}!gV&&gv.push([hi,go,gl,gq,gz])}}}else{var gB=hd.arrWordPos,gm=hd.textImg,hl=hd.tileX,hj=hd.tileY;var gt=gB[0];var gp=Math.round(hl+gt.destX);var gn=Math.round(hj+gt.destY);for(var hh=0,g2=gB.length;hh<g2;hh++){var g9=gB[hh];var hp=Math.round(hl+g9.destX);var ho=Math.round(hj+g9.destY);var gG=g9.angle;var g1=Math.round((g6+(hn-g6)*gj)*hb-gt.width/2+hp-gp);var g0=Math.round((g5+(hk-g5)*gj)*hb-gt.height/2+ho-gn);go=g1;gl=g0;gq=g9.width;gz=g9.height;if(!gV&&this.isCollide(hi,go,gl,gq,gz,gv,ha)){hd.isFadeout=true}if(gG>10&&gG<350){var g8=g1+g9.width/2;var g7=g0+g9.height/2;var gk=gG/180*Math.PI;var gN=Math.cos(gk);var gw=Math.sin(gk);var gY=gN;var gx=gN;var gX=gw;var gy=-gw;var gF=g8-g8*gN-g7*gw;var e=g7+g8*gw-g7*gN;gJ.save();gJ.transform(gY,gy,gX,gx,gF,e);gJ.drawImage(gm,g9.srcX,g9.srcY,gq,gz,go,gl,gq/gs,gz/gs);gJ.restore()}else{gJ.drawImage(gm,g9.srcX,g9.srcY,gq,gz,go,gl,gq/gs,gz/gs)}!gV&&gv.push([hi,go,gl,gq,gz])}}gJ.restore()}}}});function fr(e){this.initVars(e)}A.extend(fr.prototype,{initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.base64Prefix="data:image/png;base64,";this.bizData=null;this.objTextsPng=null;this.arrIconsPng=null;this.bizLabels=null},proecessBizData:function(gl,gp){var gn=this;this.bizData=gl;this.objTextsPng=null;this.arrIconsPng=null;var gi=gl.textsPng;var gr=gl.iconsPng;if(!gi||!gr){return}var go=new Image();go.onload=function(){gn.objTextsPng=this;gn.calcIconAndTextInfo(gp);this.onload=null};go.src=this.base64Prefix+gi;var gq=gr.length;var e=[];for(var gk=0;gk<gq;gk++){var gm=gr[gk];var gj=new Image();(function(i){gj.onload=function(){gq--;e[i]=this;if(gq===0){gn.arrIconsPng=e;gn.calcIconAndTextInfo(gp)}this.onload=null}})(gk);gj.src=this.base64Prefix+gm}},calcIconAndTextInfo:function(gs){if(this.objTextsPng&&this.arrIconsPng){var go=this.bizData;var gm=go.pois;var e=[];for(var gp=0,gl=gm.length;gp<gl;gp++){var gj=gm[gp];var gn=this.arrIconsPng[gj.iconPng];var gk=gn.height/2;var gr={type:"fixed",name:"",textImg:this.objTextsPng,iconImg:gn,rank:gj.rank,iconPos:{srcX:0,srcY:0,destX:-gn.width/2,destY:-gk/2,width:gn.width,height:gk,geoX:gj.x,geoY:gj.y,iconType:"vectorCustom"},textPos:this.calcTextPos(gj.pos,gn),startScale:gj.from<12?12:gj.from,guid:gj.guid,guidExt:1,adver_log:gj.adver_log||""};var gi={type:"fixed",textDirLeft:"left",name:"",textImg:this.objTextsPng,iconImg:gn,rank:gj.rank,iconPos:{srcX:0,srcY:0,destX:-gn.width/2,destY:-gk/2,width:gn.width,height:gk,geoX:gj.x,geoY:gj.y,iconType:"vectorCustom"},textPos:this.calcTextPosLeft(gj.pos,gn),startScale:gj.from<12?12:gj.from,guid:gj.guid,guidExt:1,adver_log:gj.adver_log||""};var gq=[gr,gi];e.push(gq)}this.bizLabels=e;gs&&gs()}},calcTextPos:function(gm,gi){var i=[];var gl=gm.length/4;var gk=gi.width/2;if(gl===1){var gj={srcX:gm[0],srcY:gm[1],destX:gk,destY:-gm[3]/2,width:gm[2],height:gm[3]};i.push(gj)}else{var gj={srcX:gm[0],srcY:gm[1],destX:gk,destY:-gm[3],width:gm[2],height:gm[3]};var e={srcX:gm[4],srcY:gm[5],destX:gk,destY:0,width:gm[6],height:gm[7]};i.push(gj);i.push(e)}return i},calcTextPosLeft:function(gm,gi){var i=[];var gl=gm.length/4;var gk=gi.width/2;if(gl===1){var gj={srcX:gm[0],srcY:gm[1],destX:-gk-gm[2],destY:-gm[3]/2,width:gm[2],height:gm[3]};i.push(gj)}else{var gj={srcX:gm[0],srcY:gm[1],destX:-gk-gm[2],destY:-gm[3],width:gm[2],height:gm[3]};var e={srcX:gm[4],srcY:gm[5],destX:-gk-gm[2],destY:0,width:gm[6],height:gm[7]};i.push(gj);i.push(e)}return i},clearBizData:function(){this.bizData=null;this.bizLabels=null}});function cl(){}A.extend(cl.prototype,{centerAndZoomIn:function(gi,gp,gq){gq=gq||{};if(!this.loaded){this.firstTileLoad=false}gp=this._getProperZoom(gp).zoom;if(gq.noAnimation!==true&&this.loaded){var gl=this._ifUseAnimation(gi,gp);if(gl){this.flyToIn(gi,gp,gq);return}}var gn=this;if(!gi&&!gp){return}this._stopAllAnimations();if(gi&&!gi.equals(this.centerPoint)){this.fire(new aM("oncenter_changed"))}if(gp&&gp!==this.zoomLevel){this.fire(new aM("onzoom_changed"))}gi=gi||this.centerPoint;gp=gp||this.zoomLevel;gp=this._getProperZoom(gp).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAPGL_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function go(){gn._earth=new aU.Earth(gn,{showRealSunlight:gn.config.showRealSunlight,showMilkyway:gn.config.showMilkyway,earthBackground:gn.config.earthBackground});gn._proxyEarthEvents();gn._changeEarthMapType(BMAP_EARTH_MAP);A.extend(gn,aU.EarthView.prototype);delete gn.temp.originMapType}da.load("earth",function(){if(aU["FeatureStyle"+gn.config.style]){go()}else{gn.loadMapStyleFiles(function(){go()})}})}}this.lastLevel=this.zoomLevel||gp;this.zoomLevel=gp;var gm=new aM("onload");gm.point=gi;gm.zoom=gp;this.centerPoint=new fX(gi.lng,gi.lat);this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(this.mapType!==BMAP_EARTH_MAP){this.centerPoint=this.restrictCenter(this.centerPoint)}if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var gk=new ck(i,"baidu",this.mapType);var gj=new b8({mapType:this.mapType,copyright:gk,dataType:fb,customLayer:false,baseLayer:true,tileTypeName:"na"});gj._isInnerLayer=true;this.addTileLayer(gj);if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}this.baseLayerAdded=true;this.on("zoom_changed",function(){if(this._heading===0){return}if(this.getZoom()<7&&this.config.restrictCenter===true){gn.resetHeading()}})}this.loaded=true;this.dispatchEvent(gm);gq.callback&&gq.callback()},_ifUseAnimation:function(gj,go){var gn=this.getSize();var gi={zoom:this.zoomLevel};var gq={zoom:go};var gp=this.pointToPixelIn(this.centerPoint);var gk=this.pointToPixelIn(gj,gi);var gm=this.pointToPixelIn(this.centerPoint,gq);var gs=this.pointToPixelIn(gj,gq);var gl=Math.abs(gp.x-gk.x);var i=Math.abs(gp.y-gk.y);var e=Math.abs(gm.x-gs.x);var gr=Math.abs(gm.y-gs.y);if((gl>gn.width||i>gn.height)&&(e>gn.width||gr>gn.height)){return false}return true},_setPlatformPosition:function(gq,gp,gs){gs=gs||{};if(gq===0&&gp===0&&!gs.point){return}if(isNaN(gs.initMapOffsetX)){gs.initMapOffsetX=this.offsetX}if(isNaN(gs.initMapOffsetY)){gs.initMapOffsetY=this.offsetY}var gm=cT(this._heading);if(this._tilt>0){gp=gp/Math.cos(cT(this._tilt))}var gr=gq*Math.cos(gm)+gp*Math.sin(gm);var go=-gq*Math.sin(gm)+gp*Math.cos(gm);gr=gr+gs.initMapOffsetX;go=go+gs.initMapOffsetY;if(gs.point){var i=this.restrictCenter(gs.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new aM("oncenter_changed"))}}else{var gj=this.offsetX-gr;var e=this.offsetY-go;var gn=this.centerPoint.lng;var gl=this.centerPoint.lat;var gk=new fX(gn,gl);var gi=this.getZoomUnits();this.centerPoint=this.restrictCenter(new fX(gk.lng+gj*gi,gk.lat-e*gi),gi);this.fire(new aM("oncenter_changed"))}this.offsetX=gr;this.offsetY=go;this.dispatchEvent(new aM("onmoving"))},restrictCenter:function(gj,gk){if(this.config.restrictCenter===false){return gj}gk=gk||this.getZoomUnits();var gi=this.pixelToPointIn(new di(0,0),{center:gj});var i=this.pixelToPointIn(new di(0,this.height),{center:gj});if(this.zoomLevel<5){if(gi.lat>cm.MAX_LAT&&i.lat<cm.MIN_LAT){var gl=cm.MAX_LAT-gj.lat;var e=gj.lat-cm.MIN_LAT;var gn;if(gl<e){gn=gl/(this.height/2)}else{gn=e/(this.height/2)}var gm=18-dz(gn);this.zoomLevel=gm;return gj}}if(gi.lat>cm.MAX_LAT){gj.lat=cm.MAX_LAT-this.height/2*gk}else{if(i.lat<cm.MIN_LAT){gj.lat=cm.MIN_LAT+this.height/2*gk}}return gj},zoomTo:function(e,gu,gv){var gq=bw[this.mapType];if(!gq){return}var gp=this._getProperZoom(e);e=gp.zoom;if(this.zoomLevel===e){return}var gl=e;this.lastLevel=this.zoomLevel;gv=gv||{};if(this.zoomEventStatus==="idle"){this.fire(new aM("onzoomstart"));this.zoomEventStatus="zooming"}if(!gu&&(this.getInfoWindow()&&this.temp.infoWin&&this.temp.infoWin.isOpen())){gu=this.getInfoWindow().getPoint()}var gi;if(gu){gi=this.pointToPixelIn(gu)}var gm=this.pixelToPointIn(gi);var gn=this.centerPoint.clone();this.fixPoint=gu;this.fixPixel=gi;this.fixCenter=gn;this.mousePosMCPoint=gm;if(gv.noAnimation){e=gp.zoom;this.zoomLevel=e;this.fire(new aM("onzoom_changed"));var gk=this.getCurrentMaxTilt();if(this._tilt>gk){this._tilt=gk}if(gu){if(this._heading%360!==0||this._tilt>0){var i=this._webglMapCamera.fromScreenPixelToMC(gi.x,gi.y,{center:gn,zoom:this.zoomLevel});if(i){var gr=i.sub(gm);var gj=gn.sub(gr);this.centerPoint=this.restrictCenter(gj)}}else{var go=this.getZoomUnits();var gj=new fX(gu.lng-go*(gi.x-this.width/2),gu.lat+go*(gi.y-this.height/2));this.centerPoint=this.restrictCenter(gj,go)}this.fire(new aM("oncenter_changed"))}this._checkFireZoomend();return}this._animationInfo.zoom={current:this.zoomLevel,diff:e-this.zoomLevel,target:e};var gs=this;gv.callback=function(){gs._checkFireZoomend()};var gt=this._tilt;if(this.fixPoint||gt>cm.MAX_DRAG_TILT_L2){gv.renderCallback=function(){var gz=gs.getCurrentMaxTilt();if(gs._tilt>gz){gs._tilt=gz}var gA=gs.fixPixel;if(!gs.fixPixel||!gs.fixPoint){return}var gw=gs.fixPixel;var gG=gs.fixPoint;var gD=gs.fixCenter;var gB=gs.mousePosMCPoint;if(gs._heading%360!==0||gs._tilt>0){var gx=gs._webglMapCamera.fromScreenPixelToMC(gw.x,gw.y,{center:gD,zoom:gs.zoomLevel,tilt:gs._tilt});if(gx){var gF=gx.sub(gB);var gy=gD.sub(gF);gs.centerPoint=gs.restrictCenter(gy)}}else{var gC=gw;var gE=gs.getZoomUnits();var gy=new fX(gG.lng-gE*(gC.x-gs.width/2),gG.lat+gE*(gC.y-gs.height/2));gs.centerPoint=gs.restrictCenter(gy,gE)}gs.fire(new aM("oncenter_changed"))}}if(gv.fromMouseWheel===true){this._startInfiniteZoomAnimation(gv);return}this._startAnimation(gv)},_checkFireZoomend:function(){var e=this;if(e.fireZoomendTimer){clearTimeout(e.fireZoomendTimer)}e.fireZoomendTimer=setTimeout(function(){if(e.zoomEventStatus==="zooming"){e.fire(new aM("onzoomend"));e.zoomEventStatus="idle"}e.fireZoomendTimer=null},150)},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(e){this.zoomTo(e)},flyToIn:function(gi,gN,gy){gy=gy||{};var gk=this._getProperZoom(gN);gN=gk.zoom;if(this.centerPoint.equals(gi)&&this.zoomLevel===gN&&typeof gy.heading!=="number"&&typeof gy.tilt!=="number"){return}var e=this.getHeading()%360;var gq=this.getTilt();var gw=0;var gA=0;var gt=this.getBounds().containsPoint(gi);if(typeof gy.heading==="number"){gw=gy.heading}else{if(gt){gw=e}}if(typeof gy.tilt==="number"){gA=gy.tilt}else{if(gt){gA=gq}}this._heading=e;var gK=gw-e;var gG=gA-gq;var gu=this;var gm=this.zoomLevel;var gn=1.42;var gC=this.zoomScale(gN-gm);var gP=this.getZoomUnits();var gs=this.centerPoint.div(gP);var gQ=gi.div(gP);var gJ=this.worldSize();var gF=gn;var gE=Math.max(this.width,this.height);var gD=gE/gC;var gr=gQ.sub(gs).mag();var i=gF*gF;function gM(gS){var gR=(gD*gD-gE*gE+(gS?-1:1)*i*i*gr*gr)/(2*(gS?gD:gE)*i*gr);return Math.log(Math.sqrt(gR*gR+1)-gR)}function gj(gR){return(Math.exp(gR)-Math.exp(-gR))/2}function go(gR){return(Math.exp(gR)+Math.exp(-gR))/2}function gx(gR){return gj(gR)/go(gR)}var gp=gM(0);var gH=function(gR){return(go(gp)/go(gp+gF*gR))};var gI=function(gR){return gE*((go(gp)*gx(gp+gF*gR)-gj(gp))/i)/gr};var gl=(gM(1)-gp)/gF;if(Math.abs(gr)<0.000001||gl===Infinity||isNaN(gl)){if(Math.abs(gE-gD)<0.000001){this._animationInfo.zoom={current:this.zoomLevel,diff:gN-this.zoomLevel};this._animationInfo.center={current:this.centerPoint,diff:gi.sub(this.centerPoint)};this._animationInfo.heading={current:e,diff:gw-e};this._animationInfo.tilt={current:gq,diff:gA-gq};this.setLock(true);this._startAnimation({callback:function(gR){gu.setLock(false);if(gy.callback){gy.callback(gR)}},duration:gy.duration});return}var gO=gD<gE?-1:1;gl=Math.abs(Math.log(gD/gE))/gF;gI=function(){return 0};gH=function(gR){return Math.exp(gO*gF*gR)}}var gL=1.7;if(gl<0.3){gL=0.8}else{if(gl>5){gL=(gl-5)/2+gL}}var gz=gy.duration||1000*gl/gL;if(isNaN(gz)){var gB={};for(var gv in gy){gB[gv]=gy[gv];gB.noAnimation=true}this.centerAndZoomIn(gi,gN,gB);return}this.fire(new aM("onmovestart"));this.fire(new aM("onzoomstart"));this.setLock(true);this._startAnimation({duration:gz,renderCallback:function(gR,gS){var gT=gR*gl;var gW=gI(gT);var gV=gm+gu.scaleZoom(1/gH(gT));if(gV<gu.getMinZoom()){gV=gu.getMinZoom()}if(gV>gu.getMaxZoom()){gV=gu.getMaxZoom()}if(gV!==gu.zoomLevel){gu.zoomLevel=gV;gu.fire(new aM("onzoom_changed"))}gu.centerPoint=gs.add(gQ.sub(gs).mult(gW)).mult(gP);gu.fire(new aM("oncenter_changed"));if(typeof gw==="number"){var gU=gR/0.7;if(gU>1){gU=1}gu.setHeading(e+gK*gR,{noAnimation:true})}if(typeof gA==="number"){gu.setTilt(gq+gG*gR,{noAnimation:true})}},callback:function(gR,gS){gu.setLock(false);if(gS&&gS.stop===true){gu.fire(new aM("onmoveend"));gu.fire(new aM("onzoomend"));gy.callback&&gy.callback(gR);return}if(gN!==gu.zoomLevel){gu.zoomLevel=gN;gu.fire(new aM("onzoom_changed"))}gu.fire(new aM("onmoveend"));gu.fire(new aM("onzoomend"));gy.callback&&gy.callback(gR)}})},zoomScale:function(e){return Math.pow(2,e)},scaleZoom:function(e){return Math.log(e)/Math.LN2},panToIn:function(i,gi){gi=gi||{};if(!i||i.equals(this.centerPoint)){gi.callback&&gi.callback();return}var gj=this.pointToPixelIn(i);var e=Math.round(this.width/2);var gl=Math.round(this.height/2);var gk=this._ifUseAnimation(i,this.zoomLevel);if(gi.noAnimation===true||gk===false){this._stopAllAnimations();this._panToIn(e-gj.x,gl-gj.y,i);gi.callback&&gi.callback();return}this.flyToIn(i,this.zoomLevel,gi)},_panToIn:function(i,e,gj){var gi=this.temp;if(gi.operating===true){return}if(gi.dragAni){gi.dragAni.stop(false,{readyToMove:true});gi.dragAni=null}this.dispatchEvent(new aM("onmovestart"));this._setPlatformPosition(i,e,{point:gj});this.dispatchEvent(new aM("onmoveend"))},_stopAllAnimations:function(e){e=e||{};if(this._ani){this._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation});this._ani=null}if(this._infiniteAni){this._infiniteAni.stop();this._infiniteAni=null}},panBy:function(i,e,gi){i=Math.round(i)||0;e=Math.round(e)||0;gi=gi||{};if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&gi.noAnimation!==true){this._panBy(i,e,gi)}else{this._panToIn(i,e,gi.point);gi.callback&&gi.callback()}},_panBy:function(i,e,gk){if(this.temp.operating===true){return}gk=gk||{};this.dispatchEvent(new aM("onmovestart"));var gj=this;var gi=gj.temp;gi.pl=gj.offsetX;gi.pt=gj.offsetY;if(gi.tlPan){gi.tlPan.cancel()}if(gi.dragAni){gi.dragAni.stop(false,{readyToMove:true});gi.dragAni=null}gi.tlPan=new n({fps:gk.fps||gj.config.fps,duration:gk.duration||gj.config.actionDuration,transition:gk.transition||bL.easeInOutQuad,render:function(gl){this.terminative=gj.temp.operating;if(gj.temp.operating){return}gj._setPlatformPosition(i*gl,e*gl,{initMapOffsetX:gi.pl,initMapOffsetY:gi.pt})},finish:function(gl){gj.dispatchEvent(new aM("onmoveend"));gj.temp.tlPan=false;if(gj.temp.stopArrow===true){gj.temp.stopArrow=false;if(gj.temp.arrow!==0){gj._arrow()}}}})},_startAnimation:function(i){var gk=this._animationInfo;var gi=this;i=i||{};if(gi._ani){gi._ani.stop(!!i.goToEnd,{stopCurrentAnimation:i.stopCurrentAnimation})}if(gi._infiniteAni){gi._infiniteAni.stop();gi._infiniteAni=null}var gl=i.duration||500;var gm=i.transition||bL.ease;var e=new aM("onanimation_start");this.fire(e);if(i.unstopable){gk=this._animationInfoUnstopable}var gj=new n({duration:gl,transition:gm,render:function(gp,go){for(var gn in gk){if(!gk.hasOwnProperty(gn)){continue}var gr=gk[gn].current;var gq=gk[gn].diff;gi._setValueTick(gn,gr,gq,gp)}if(i.renderCallback){i.renderCallback(gp,go)}},finish:function(gn){gi.fire(new aM("onanimation_end"));if(i.unstopable){gi._animationInfoUnstopable={};gi._unstopableAni=null}else{gi._ani=null;gi._animationInfo={}}if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(gn)}},onStop:function(gn){gn=gn||{};gi.fire(new aM("onanimation_end"));if(gn.stopCurrentAnimation){gi._animationInfo={}}gi._ani=null;if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(null,{stop:true})}}});if(i.unstopable){gi._unstopableAni=gj}else{gi._ani=gj}},_startInfiniteZoomAnimation:function(e){var i=this;if(i._ani){i._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation})}if(i._infiniteAni){return}this.fire(new aM("onanimation_start"));i._infiniteAni=new n({duration:10000,transition:bL.linear,render:function(){var gi=i._animationInfo.zoom;if(Math.abs(gi.current-gi.target)<0.001){i._setValue("zoom",gi.target);i._infiniteAni.stop();return}gi.current+=(gi.target-gi.current)*0.35;i._setValue("zoom",gi.current);if(e.renderCallback){e.renderCallback()}},finish:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new aM("onanimation_end"));if(e.callback){e.callback()}},onStop:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new aM("onanimation_end"));if(e.callback){e.callback()}}})},_setValue:function(e,gi){if(e==="zoom"){this._preZoomLevel=this.zoomLevel;var i=this._getProperZoom(gi);gi=i.zoom;if(gi!==this.zoomLevel){this.zoomLevel=gi;if(gi<5){this.restrictCenter(this.centerPoint)}this.fire(new aM("on"+e+"_changed"))}return}else{if(e==="center"){this.centerPoint=gi}}this["_"+e]=gi;this.fire(new aM("on"+e+"_changed"))},_setValueTick:function(e,gk,gj,i){if(e==="center"){var gi=new fX(gk.lng+gj.lng*i,gk.lat+gj.lat*i);this._setValue(e,gi);return}if(e==="zoom"){this._setValue(e,Math.pow(gk,1-i)*Math.pow(gk+gj,i));return}this._setValue(e,gk+gj*i)},setHeading:function(gj,i){i=i||{};if(gj===this._heading){i.callback&&i.callback();return}var gi=eL(this._heading,360);var e=eL(gj,360);if(e===gi){this._heading=gj;i.callback&&i.callback();return}if(i.noAnimation){this._setValue("heading",gj);i.callback&&i.callback();return}if(i.unstopable){this._animationInfoUnstopable.heading={current:this._heading,diff:gj-this._heading}}else{this._animationInfo.heading={current:this._heading,diff:gj-this._heading}}this._startAnimation(i)},resetHeading:function(e){var i=this._heading;while(i<0){i+=360}i=i%360;if(i>180){i-=360}this._heading=i;e=e||{};e.unstopable=true;this.setHeading(0,e)},getHeading:function(){return this._heading},setTilt:function(e,i){i=i||{};if(e===this._tilt){i.callback&&i.callback();return}if(e>cm.MAX_TILT){e=cm.MAX_TILT}if(e<cm.MIN_TILT){e=cm.MIN_TILT}if(i&&i.noAnimation){this._setValue("tilt",e);i.callback&&i.callback();return}this._animationInfo.tilt={current:this._tilt,diff:e-this._tilt};this._startAnimation(i)},getTilt:function(){return this._tilt},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},getCameraPosition:function(gi){gi=gi||{};var e=gi.center||this.centerPoint;var gj=gi.zoom||this.zoomLevel;var gm=typeof gi.heading==="number"?gi.heading:this._heading;var i=typeof gi.tilt==="number"?gi.tilt:this._tilt;var gl=this._webglMapCamera.generateMVMatrix(e,gj,gm,i);var gk=mat4.create(Float32Array);mat4.invert(gk,gl);return this._webglMapCamera.getPosition(gk)}});function eC(i){this._jobQueue=[];this._idleOnlyJobQueue=[];var e=this;this.isIdle=true;i.on("updateframe",function(gj){var gi=12-gj.frameTime;gi=gi<1?1:gi;e.isIdle=false;if(e.idleWorkTimer){clearInterval(e.idleWorkTimer);e.idleWorkTimer=null}e.runJobs(gi)});this._idleWorkerTicker=(function(gi){return function(){if(gi.isIdle){gi.runJobs();gi.runIdleOnlyJobs()}}})(this);i.on("mapglidle",function(){e.isIdle=true;e.runJobs();e.runIdleOnlyJobs();e.idleWorkTimer=setInterval(e._idleWorkerTicker,eC.MAX_IDLE_TIME)})}eC.MAX_IDLE_TIME=50;eC.MAX_FRAME_TIME=6;eC.prototype.runJobs=function(i){if(this._jobQueue.length===0){return}var gj=eq();var e=0;i=i||eC.MAX_FRAME_TIME;while(this._jobQueue.length&&e<i){var gi=this._jobQueue.shift();if(gi.state!=="invalid"){gi.call()}e=eq()-gj}};eC.prototype.runIdleOnlyJobs=function(){if(this._idleOnlyJobQueue.length===0){return}var gi=eq();var e=0;while(this._idleOnlyJobQueue.length&&e<eC.MAX_IDLE_TIME){var i=this._idleOnlyJobQueue.shift();if(i.state!=="invalid"){i.call()}e=eq()-gi}};eC.prototype.checkIdleRunning=function(){if(this.isIdle&&!this.idleWorkTimer){this.runJobs();this.runIdleOnlyJobs();this.idleWorkTimer=setInterval(this._idleWorkerTicker,50)}};eC.prototype.addJob=function(e){this._jobQueue.push(e);this.checkIdleRunning()};eC.prototype.clearJobs=function(){this._jobQueue.length=0;this._idleOnlyJobQueue.length=0};eC.prototype.addIdleOnlyJob=function(e){this._idleOnlyJobQueue.push(e);this.checkIdleRunning()};var bB={};(function(gm){if(!gq){var gq=0.000001}if(!i){var i=(typeof Float32Array!=="undefined")?Float32Array:Array}if(!gk){var gk=Math.random}var gi={};var gl=Math.PI/180;gi.toRadian=function(gr){return gr*gl};var gp={};gp.create=function(gs){gs=gs||i;var gr=new gs(2);gr[0]=0;gr[1]=0;return gr};gp.clone=function(gr,gt){gt=gt||i;var gs=new gt(2);gs[0]=gr[0];gs[1]=gr[1];return gs};gp.fromValues=function(gr,gu,gt){gt=gt||i;var gs=new gt(2);gs[0]=gr;gs[1]=gu;return gs};gp.copy=function(gs,gr){gs[0]=gr[0];gs[1]=gr[1];return gs};gp.set=function(gs,gr,gt){gs[0]=gr;gs[1]=gt;return gs};gp.add=function(gt,gs,gr){gt[0]=gs[0]+gr[0];gt[1]=gs[1]+gr[1];return gt};gp.subtract=function(gt,gs,gr){gt[0]=gs[0]-gr[0];gt[1]=gs[1]-gr[1];return gt};gp.sub=gp.subtract;gp.multiply=function(gt,gs,gr){gt[0]=gs[0]*gr[0];gt[1]=gs[1]*gr[1];return gt};gp.mul=gp.multiply;gp.divide=function(gt,gs,gr){gt[0]=gs[0]/gr[0];gt[1]=gs[1]/gr[1];return gt};gp.div=gp.divide;gp.min=function(gt,gs,gr){gt[0]=Math.min(gs[0],gr[0]);gt[1]=Math.min(gs[1],gr[1]);return gt};gp.max=function(gt,gs,gr){gt[0]=Math.max(gs[0],gr[0]);gt[1]=Math.max(gs[1],gr[1]);return gt};gp.scale=function(gt,gs,gr){gt[0]=gs[0]*gr;gt[1]=gs[1]*gr;return gt};gp.scaleAndAdd=function(gt,gs,gr,gu){gt[0]=gs[0]+(gr[0]*gu);gt[1]=gs[1]+(gr[1]*gu);return gt};gp.distance=function(gt,gs){var gr=gs[0]-gt[0],gu=gs[1]-gt[1];return Math.sqrt(gr*gr+gu*gu)};gp.dist=gp.distance;gp.squaredDistance=function(gt,gs){var gr=gs[0]-gt[0],gu=gs[1]-gt[1];return gr*gr+gu*gu};gp.sqrDist=gp.squaredDistance;gp.length=function(gs){var gr=gs[0],gt=gs[1];return Math.sqrt(gr*gr+gt*gt)};gp.len=gp.length;gp.squaredLength=function(gs){var gr=gs[0],gt=gs[1];return gr*gr+gt*gt};gp.sqrLen=gp.squaredLength;gp.negate=function(gs,gr){gs[0]=-gr[0];gs[1]=-gr[1];return gs};gp.normalize=function(gu,gt){var gs=gt[0],gv=gt[1];var gr=gs*gs+gv*gv;if(gr>0){gr=1/Math.sqrt(gr);gu[0]=gt[0]*gr;gu[1]=gt[1]*gr}return gu};gp.dot=function(gs,gr){return gs[0]*gr[0]+gs[1]*gr[1]};gp.cross=function(gt,gs,gr){var gu=gs[0]*gr[1]-gs[1]*gr[0];gt[0]=gt[1]=0;gt[2]=gu;return gt};gp.lerp=function(gt,gs,gr,gu){var gw=gs[0],gv=gs[1];gt[0]=gw+gu*(gr[0]-gw);gt[1]=gv+gu*(gr[1]-gv);return gt};gp.random=function(gr,gt){gt=gt||1;var gs=gk()*2*Math.PI;gr[0]=Math.cos(gs)*gt;gr[1]=Math.sin(gs)*gt;return gr};gp.transformMat2=function(gu,gt,gs){var gr=gt[0],gv=gt[1];gu[0]=gs[0]*gr+gs[2]*gv;gu[1]=gs[1]*gr+gs[3]*gv;return gu};gp.transformMat2d=function(gu,gt,gs){var gr=gt[0],gv=gt[1];gu[0]=gs[0]*gr+gs[2]*gv+gs[4];gu[1]=gs[1]*gr+gs[3]*gv+gs[5];return gu};gp.transformMat3=function(gu,gt,gs){var gr=gt[0],gv=gt[1];gu[0]=gs[0]*gr+gs[3]*gv+gs[6];gu[1]=gs[1]*gr+gs[4]*gv+gs[7];return gu};gp.transformMat4=function(gu,gt,gs){var gr=gt[0],gv=gt[1];gu[0]=gs[0]*gr+gs[4]*gv+gs[12];gu[1]=gs[1]*gr+gs[5]*gv+gs[13];return gu};gp.rotate=function(gu,gs,gr,gy){var gx=gs[0]-gr[0];var gw=gs[1]-gr[1];var gt=Math.sin(gy);var gv=Math.cos(gy);gu[0]=gx*gv-gw*gt+gr[0];gu[1]=gx*gt+gw*gv+gr[1];return gu};gp.forEach=(function(){var gr=gp.create();return function(gu,gy,gz,gx,gw,gs){var gv,gt;if(!gy){gy=2}if(!gz){gz=0}if(gx){gt=Math.min((gx*gy)+gz,gu.length)}else{gt=gu.length}for(gv=gz;gv<gt;gv+=gy){gr[0]=gu[gv];gr[1]=gu[gv+1];gw(gr,gr,gs);gu[gv]=gr[0];gu[gv+1]=gr[1]}return gu}})();gp.str=function(gr){return"vec2("+gr[0]+", "+gr[1]+")"};gm.vec2=gp;var go={};go.create=function(gs){gs=gs||i;var gr=new gs(3);gr[0]=0;gr[1]=0;gr[2]=0;return gr};go.clone=function(gr,gt){gt=gt||i;var gs=new gt(3);gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];return gs};go.fromValues=function(gr,gv,gt,gu){gu=gu||i;var gs=new gu(3);gs[0]=gr;gs[1]=gv;gs[2]=gt;return gs};go.copy=function(gs,gr){gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];return gs};go.set=function(gs,gr,gu,gt){gs[0]=gr;gs[1]=gu;gs[2]=gt;return gs};go.add=function(gt,gs,gr){gt[0]=gs[0]+gr[0];gt[1]=gs[1]+gr[1];gt[2]=gs[2]+gr[2];return gt};go.subtract=function(gt,gs,gr){gt[0]=gs[0]-gr[0];gt[1]=gs[1]-gr[1];gt[2]=gs[2]-gr[2];return gt};go.sub=go.subtract;go.multiply=function(gt,gs,gr){gt[0]=gs[0]*gr[0];gt[1]=gs[1]*gr[1];gt[2]=gs[2]*gr[2];return gt};go.mul=go.multiply;go.divide=function(gt,gs,gr){gt[0]=gs[0]/gr[0];gt[1]=gs[1]/gr[1];gt[2]=gs[2]/gr[2];return gt};go.div=go.divide;go.min=function(gt,gs,gr){gt[0]=Math.min(gs[0],gr[0]);gt[1]=Math.min(gs[1],gr[1]);gt[2]=Math.min(gs[2],gr[2]);return gt};go.max=function(gt,gs,gr){gt[0]=Math.max(gs[0],gr[0]);gt[1]=Math.max(gs[1],gr[1]);gt[2]=Math.max(gs[2],gr[2]);return gt};go.scale=function(gt,gs,gr){gt[0]=gs[0]*gr;gt[1]=gs[1]*gr;gt[2]=gs[2]*gr;return gt};go.scaleAndAdd=function(gt,gs,gr,gu){gt[0]=gs[0]+(gr[0]*gu);gt[1]=gs[1]+(gr[1]*gu);gt[2]=gs[2]+(gr[2]*gu);return gt};go.distance=function(gt,gs){var gr=gs[0]-gt[0],gv=gs[1]-gt[1],gu=gs[2]-gt[2];return Math.sqrt(gr*gr+gv*gv+gu*gu)};go.dist=go.distance;go.squaredDistance=function(gt,gs){var gr=gs[0]-gt[0],gv=gs[1]-gt[1],gu=gs[2]-gt[2];return gr*gr+gv*gv+gu*gu};go.sqrDist=go.squaredDistance;go.length=function(gs){var gr=gs[0],gu=gs[1],gt=gs[2];return Math.sqrt(gr*gr+gu*gu+gt*gt)};go.len=go.length;go.squaredLength=function(gs){var gr=gs[0],gu=gs[1],gt=gs[2];return gr*gr+gu*gu+gt*gt};go.sqrLen=go.squaredLength;go.negate=function(gs,gr){gs[0]=-gr[0];gs[1]=-gr[1];gs[2]=-gr[2];return gs};go.normalize=function(gu,gt){var gs=gt[0],gw=gt[1],gv=gt[2];var gr=gs*gs+gw*gw+gv*gv;if(gr>0){gr=1/Math.sqrt(gr);gu[0]=gt[0]*gr;gu[1]=gt[1]*gr;gu[2]=gt[2]*gr}return gu};go.dot=function(gs,gr){return gs[0]*gr[0]+gs[1]*gr[1]+gs[2]*gr[2]};go.cross=function(gs,gx,gw){var gr=gx[0],gz=gx[1],gy=gx[2],gv=gw[0],gu=gw[1],gt=gw[2];gs[0]=gz*gt-gy*gu;gs[1]=gy*gv-gr*gt;gs[2]=gr*gu-gz*gv;return gs};go.lerp=function(gt,gs,gr,gu){var gx=gs[0],gw=gs[1],gv=gs[2];gt[0]=gx+gu*(gr[0]-gx);gt[1]=gw+gu*(gr[1]-gw);gt[2]=gv+gu*(gr[2]-gv);return gt};go.random=function(gr,gv){gv=gv||1;var gt=gk()*2*Math.PI;var gu=(gk()*2)-1;var gs=Math.sqrt(1-gu*gu)*gv;gr[0]=Math.cos(gt)*gs;gr[1]=Math.sin(gt)*gs;gr[2]=gu*gv;return gr};go.transformMat4=function(gu,gt,gs){var gr=gt[0],gw=gt[1],gv=gt[2];gu[0]=gs[0]*gr+gs[4]*gw+gs[8]*gv+gs[12];gu[1]=gs[1]*gr+gs[5]*gw+gs[9]*gv+gs[13];gu[2]=gs[2]*gr+gs[6]*gw+gs[10]*gv+gs[14];return gu};go.transformMat3=function(gu,gt,gs){var gr=gt[0],gw=gt[1],gv=gt[2];gu[0]=gr*gs[0]+gw*gs[3]+gv*gs[6];gu[1]=gr*gs[1]+gw*gs[4]+gv*gs[7];gu[2]=gr*gs[2]+gw*gs[5]+gv*gs[8];return gu};go.transformQuat=function(gx,gD,gr){var gE=gD[0],gC=gD[1],gB=gD[2],gz=gr[0],gy=gr[1],gw=gr[2],gA=gr[3],gu=gA*gE+gy*gB-gw*gC,gt=gA*gC+gw*gE-gz*gB,gs=gA*gB+gz*gC-gy*gE,gv=-gz*gE-gy*gC-gw*gB;gx[0]=gu*gA+gv*-gz+gt*-gw-gs*-gy;gx[1]=gt*gA+gv*-gy+gs*-gz-gu*-gw;gx[2]=gs*gA+gv*-gw+gu*-gy-gt*-gz;return gx};go.rotateX=function(gt,gs,gr,gw){var gv=[],gu=[];gv[0]=gs[0]-gr[0];gv[1]=gs[1]-gr[1];gv[2]=gs[2]-gr[2];gu[0]=gv[0];gu[1]=gv[1]*Math.cos(gw)-gv[2]*Math.sin(gw);gu[2]=gv[1]*Math.sin(gw)+gv[2]*Math.cos(gw);gt[0]=gu[0]+gr[0];gt[1]=gu[1]+gr[1];gt[2]=gu[2]+gr[2];return gt};go.rotateY=function(gt,gs,gr,gw){var gv=[],gu=[];gv[0]=gs[0]-gr[0];gv[1]=gs[1]-gr[1];gv[2]=gs[2]-gr[2];gu[0]=gv[2]*Math.sin(gw)+gv[0]*Math.cos(gw);gu[1]=gv[1];gu[2]=gv[2]*Math.cos(gw)-gv[0]*Math.sin(gw);gt[0]=gu[0]+gr[0];gt[1]=gu[1]+gr[1];gt[2]=gu[2]+gr[2];return gt};go.rotateZ=function(gt,gs,gr,gw){var gv=[],gu=[];gv[0]=gs[0]-gr[0];gv[1]=gs[1]-gr[1];gv[2]=gs[2]-gr[2];gu[0]=gv[0]*Math.cos(gw)-gv[1]*Math.sin(gw);gu[1]=gv[0]*Math.sin(gw)+gv[1]*Math.cos(gw);gu[2]=gv[2];gt[0]=gu[0]+gr[0];gt[1]=gu[1]+gr[1];gt[2]=gu[2]+gr[2];return gt};go.forEach=(function(){var gr=go.create();return function(gu,gy,gz,gx,gw,gs){var gv,gt;if(!gy){gy=3}if(!gz){gz=0}if(gx){gt=Math.min((gx*gy)+gz,gu.length)}else{gt=gu.length}for(gv=gz;gv<gt;gv+=gy){gr[0]=gu[gv];gr[1]=gu[gv+1];gr[2]=gu[gv+2];gw(gr,gr,gs);gu[gv]=gr[0];gu[gv+1]=gr[1];gu[gv+2]=gr[2]}return gu}})();go.str=function(gr){return"vec3("+gr[0]+", "+gr[1]+", "+gr[2]+")"};gm.vec3=go;var gn={};gn.create=function(gs){gs=gs||i;var gr=new gs(4);gr[0]=0;gr[1]=0;gr[2]=0;gr[3]=0;return gr};gn.clone=function(gr,gt){gt=gt||i;var gs=new gt(4);gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];return gs};gn.fromValues=function(gr,gw,gu,gs,gv){gv=gv||i;var gt=new gv(4);gt[0]=gr;gt[1]=gw;gt[2]=gu;gt[3]=gs;return gt};gn.copy=function(gs,gr){gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];return gs};gn.set=function(gt,gr,gv,gu,gs){gt[0]=gr;gt[1]=gv;gt[2]=gu;gt[3]=gs;return gt};gn.add=function(gt,gs,gr){gt[0]=gs[0]+gr[0];gt[1]=gs[1]+gr[1];gt[2]=gs[2]+gr[2];gt[3]=gs[3]+gr[3];return gt};gn.subtract=function(gt,gs,gr){gt[0]=gs[0]-gr[0];gt[1]=gs[1]-gr[1];gt[2]=gs[2]-gr[2];gt[3]=gs[3]-gr[3];return gt};gn.sub=gn.subtract;gn.multiply=function(gt,gs,gr){gt[0]=gs[0]*gr[0];gt[1]=gs[1]*gr[1];gt[2]=gs[2]*gr[2];gt[3]=gs[3]*gr[3];return gt};gn.mul=gn.multiply;gn.divide=function(gt,gs,gr){gt[0]=gs[0]/gr[0];gt[1]=gs[1]/gr[1];gt[2]=gs[2]/gr[2];gt[3]=gs[3]/gr[3];return gt};gn.div=gn.divide;gn.min=function(gt,gs,gr){gt[0]=Math.min(gs[0],gr[0]);gt[1]=Math.min(gs[1],gr[1]);gt[2]=Math.min(gs[2],gr[2]);gt[3]=Math.min(gs[3],gr[3]);return gt};gn.max=function(gt,gs,gr){gt[0]=Math.max(gs[0],gr[0]);gt[1]=Math.max(gs[1],gr[1]);gt[2]=Math.max(gs[2],gr[2]);gt[3]=Math.max(gs[3],gr[3]);return gt};gn.scale=function(gt,gs,gr){gt[0]=gs[0]*gr;gt[1]=gs[1]*gr;gt[2]=gs[2]*gr;gt[3]=gs[3]*gr;return gt};gn.scaleAndAdd=function(gt,gs,gr,gu){gt[0]=gs[0]+(gr[0]*gu);gt[1]=gs[1]+(gr[1]*gu);gt[2]=gs[2]+(gr[2]*gu);gt[3]=gs[3]+(gr[3]*gu);return gt};gn.distance=function(gu,gs){var gr=gs[0]-gu[0],gw=gs[1]-gu[1],gv=gs[2]-gu[2],gt=gs[3]-gu[3];return Math.sqrt(gr*gr+gw*gw+gv*gv+gt*gt)};gn.dist=gn.distance;gn.squaredDistance=function(gu,gs){var gr=gs[0]-gu[0],gw=gs[1]-gu[1],gv=gs[2]-gu[2],gt=gs[3]-gu[3];return gr*gr+gw*gw+gv*gv+gt*gt};gn.sqrDist=gn.squaredDistance;gn.length=function(gt){var gr=gt[0],gv=gt[1],gu=gt[2],gs=gt[3];return Math.sqrt(gr*gr+gv*gv+gu*gu+gs*gs)};gn.len=gn.length;gn.squaredLength=function(gt){var gr=gt[0],gv=gt[1],gu=gt[2],gs=gt[3];return gr*gr+gv*gv+gu*gu+gs*gs};gn.sqrLen=gn.squaredLength;gn.negate=function(gs,gr){gs[0]=-gr[0];gs[1]=-gr[1];gs[2]=-gr[2];gs[3]=-gr[3];return gs};gn.normalize=function(gv,gu){var gs=gu[0],gx=gu[1],gw=gu[2],gt=gu[3];var gr=gs*gs+gx*gx+gw*gw+gt*gt;if(gr>0){gr=1/Math.sqrt(gr);gv[0]=gu[0]*gr;gv[1]=gu[1]*gr;gv[2]=gu[2]*gr;gv[3]=gu[3]*gr}return gv};gn.dot=function(gs,gr){return gs[0]*gr[0]+gs[1]*gr[1]+gs[2]*gr[2]+gs[3]*gr[3]};gn.lerp=function(gt,gs,gr,gu){var gx=gs[0],gw=gs[1],gv=gs[2],gy=gs[3];gt[0]=gx+gu*(gr[0]-gx);gt[1]=gw+gu*(gr[1]-gw);gt[2]=gv+gu*(gr[2]-gv);gt[3]=gy+gu*(gr[3]-gy);return gt};gn.random=function(gr,gs){gs=gs||1;gr[0]=gk();gr[1]=gk();gr[2]=gk();gr[3]=gk();gn.normalize(gr,gr);gn.scale(gr,gr,gs);return gr};gn.transformMat4=function(gv,gu,gs){var gr=gu[0],gx=gu[1],gw=gu[2],gt=gu[3];gv[0]=gs[0]*gr+gs[4]*gx+gs[8]*gw+gs[12]*gt;gv[1]=gs[1]*gr+gs[5]*gx+gs[9]*gw+gs[13]*gt;gv[2]=gs[2]*gr+gs[6]*gx+gs[10]*gw+gs[14]*gt;gv[3]=gs[3]*gr+gs[7]*gx+gs[11]*gw+gs[15]*gt;return gv};gn.transformQuat=function(gx,gD,gr){var gE=gD[0],gC=gD[1],gB=gD[2],gz=gr[0],gy=gr[1],gw=gr[2],gA=gr[3],gu=gA*gE+gy*gB-gw*gC,gt=gA*gC+gw*gE-gz*gB,gs=gA*gB+gz*gC-gy*gE,gv=-gz*gE-gy*gC-gw*gB;gx[0]=gu*gA+gv*-gz+gt*-gw-gs*-gy;gx[1]=gt*gA+gv*-gy+gs*-gz-gu*-gw;gx[2]=gs*gA+gv*-gw+gu*-gy-gt*-gz;return gx};gn.forEach=(function(){var gr=gn.create();return function(gu,gy,gz,gx,gw,gs){var gv,gt;if(!gy){gy=4}if(!gz){gz=0}if(gx){gt=Math.min((gx*gy)+gz,gu.length)}else{gt=gu.length}for(gv=gz;gv<gt;gv+=gy){gr[0]=gu[gv];gr[1]=gu[gv+1];gr[2]=gu[gv+2];gr[3]=gu[gv+3];gw(gr,gr,gs);gu[gv]=gr[0];gu[gv+1]=gr[1];gu[gv+2]=gr[2];gu[gv+3]=gr[3]}return gu}})();gn.str=function(gr){return"vec4("+gr[0]+", "+gr[1]+", "+gr[2]+", "+gr[3]+")"};gm.vec4=gn;var gj={};gj.create=function(gs){gs=gs||i;var gr=new gs(4);gr[0]=1;gr[1]=0;gr[2]=0;gr[3]=1;return gr};gj.clone=function(gr,gt){gt=gt||i;var gs=new gt(4);gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];return gs};gj.copy=function(gs,gr){gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];return gs};gj.identity=function(gr){gr[0]=1;gr[1]=0;gr[2]=0;gr[3]=1;return gr};gj.transpose=function(gt,gs){if(gt===gs){var gr=gs[1];gt[1]=gs[2];gt[2]=gr}else{gt[0]=gs[0];gt[1]=gs[2];gt[2]=gs[1];gt[3]=gs[3]}return gt};gj.invert=function(gv,gt){var gu=gt[0],gs=gt[1],gr=gt[2],gx=gt[3],gw=gu*gx-gr*gs;if(!gw){return null}gw=1/gw;gv[0]=gx*gw;gv[1]=-gs*gw;gv[2]=-gr*gw;gv[3]=gu*gw;return gv};gj.adjoint=function(gt,gr){var gs=gr[0];gt[0]=gr[3];gt[1]=-gr[1];gt[2]=-gr[2];gt[3]=gs;return gt};gj.determinant=function(gr){return gr[0]*gr[3]-gr[2]*gr[1]};gj.multiply=function(gv,gA,gy){var gu=gA[0],gt=gA[1],gs=gA[2],gr=gA[3];var gB=gy[0],gz=gy[1],gx=gy[2],gw=gy[3];gv[0]=gu*gB+gs*gz;gv[1]=gt*gB+gr*gz;gv[2]=gu*gx+gs*gw;gv[3]=gt*gx+gr*gw;return gv};gj.mul=gj.multiply;gj.rotate=function(gv,gy,gx){var gu=gy[0],gt=gy[1],gs=gy[2],gr=gy[3],gz=Math.sin(gx),gw=Math.cos(gx);gv[0]=gu*gw+gs*gz;gv[1]=gt*gw+gr*gz;gv[2]=gu*-gz+gs*gw;gv[3]=gt*-gz+gr*gw;return gv};gj.scale=function(gv,gw,gy){var gu=gw[0],gt=gw[1],gs=gw[2],gr=gw[3],gz=gy[0],gx=gy[1];gv[0]=gu*gz;gv[1]=gt*gz;gv[2]=gs*gx;gv[3]=gr*gx;return gv};gj.str=function(gr){return"mat2("+gr[0]+", "+gr[1]+", "+gr[2]+", "+gr[3]+")"};gj.frob=function(gr){return(Math.sqrt(Math.pow(gr[0],2)+Math.pow(gr[1],2)+Math.pow(gr[2],2)+Math.pow(gr[3],2)))};gj.LDU=function(gr,gu,gt,gs){gr[2]=gs[2]/gs[0];gt[0]=gs[0];gt[1]=gs[1];gt[3]=gs[3]-gr[2]*gt[1];return[gr,gu,gt]};gm.mat2=gj;var e={};e.create=function(gs){gs=gs||i;var gr=new gs(16);gr[0]=1;gr[1]=0;gr[2]=0;gr[3]=0;gr[4]=0;gr[5]=1;gr[6]=0;gr[7]=0;gr[8]=0;gr[9]=0;gr[10]=1;gr[11]=0;gr[12]=0;gr[13]=0;gr[14]=0;gr[15]=1;return gr};e.clone=function(gr){var gs=new i(16);gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];gs[4]=gr[4];gs[5]=gr[5];gs[6]=gr[6];gs[7]=gr[7];gs[8]=gr[8];gs[9]=gr[9];gs[10]=gr[10];gs[11]=gr[11];gs[12]=gr[12];gs[13]=gr[13];gs[14]=gr[14];gs[15]=gr[15];return gs};e.copy=function(gs,gr){gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];gs[4]=gr[4];gs[5]=gr[5];gs[6]=gr[6];gs[7]=gr[7];gs[8]=gr[8];gs[9]=gr[9];gs[10]=gr[10];gs[11]=gr[11];gs[12]=gr[12];gs[13]=gr[13];gs[14]=gr[14];gs[15]=gr[15];return gs};e.identity=function(gr){gr[0]=1;gr[1]=0;gr[2]=0;gr[3]=0;gr[4]=0;gr[5]=1;gr[6]=0;gr[7]=0;gr[8]=0;gr[9]=0;gr[10]=1;gr[11]=0;gr[12]=0;gr[13]=0;gr[14]=0;gr[15]=1;return gr};e.transpose=function(gu,gt){if(gu===gt){var gy=gt[1],gw=gt[2],gv=gt[3],gr=gt[6],gx=gt[7],gs=gt[11];gu[1]=gt[4];gu[2]=gt[8];gu[3]=gt[12];gu[4]=gy;gu[6]=gt[9];gu[7]=gt[13];gu[8]=gw;gu[9]=gr;gu[11]=gt[14];gu[12]=gv;gu[13]=gx;gu[14]=gs}else{gu[0]=gt[0];gu[1]=gt[4];gu[2]=gt[8];gu[3]=gt[12];gu[4]=gt[1];gu[5]=gt[5];gu[6]=gt[9];gu[7]=gt[13];gu[8]=gt[2];gu[9]=gt[6];gu[10]=gt[10];gu[11]=gt[14];gu[12]=gt[3];gu[13]=gt[7];gu[14]=gt[11];gu[15]=gt[15]}return gu};e.invert=function(gK,gP){var gT=gP[0],gR=gP[1],gQ=gP[2],gN=gP[3],gv=gP[4],gu=gP[5],gt=gP[6],gs=gP[7],gJ=gP[8],gI=gP[9],gH=gP[10],gG=gP[11],gV=gP[12],gU=gP[13],gS=gP[14],gO=gP[15],gF=gT*gu-gR*gv,gE=gT*gt-gQ*gv,gD=gT*gs-gN*gv,gC=gR*gt-gQ*gu,gB=gR*gs-gN*gu,gA=gQ*gs-gN*gt,gz=gJ*gU-gI*gV,gy=gJ*gS-gH*gV,gx=gJ*gO-gG*gV,gw=gI*gS-gH*gU,gM=gI*gO-gG*gU,gL=gH*gO-gG*gS,gr=gF*gL-gE*gM+gD*gw+gC*gx-gB*gy+gA*gz;if(!gr){return null}gr=1/gr;gK[0]=(gu*gL-gt*gM+gs*gw)*gr;gK[1]=(gQ*gM-gR*gL-gN*gw)*gr;gK[2]=(gU*gA-gS*gB+gO*gC)*gr;gK[3]=(gH*gB-gI*gA-gG*gC)*gr;gK[4]=(gt*gx-gv*gL-gs*gy)*gr;gK[5]=(gT*gL-gQ*gx+gN*gy)*gr;gK[6]=(gS*gD-gV*gA-gO*gE)*gr;gK[7]=(gJ*gA-gH*gD+gG*gE)*gr;gK[8]=(gv*gM-gu*gx+gs*gz)*gr;gK[9]=(gR*gx-gT*gM-gN*gz)*gr;gK[10]=(gV*gB-gU*gD+gO*gF)*gr;gK[11]=(gI*gD-gJ*gB-gG*gF)*gr;gK[12]=(gu*gy-gv*gw-gt*gz)*gr;gK[13]=(gT*gw-gR*gy+gQ*gz)*gr;gK[14]=(gU*gE-gV*gC-gS*gF)*gr;gK[15]=(gJ*gC-gI*gE+gH*gF)*gr;return gK};e.adjoint=function(gz,gC){var gG=gC[0],gE=gC[1],gD=gC[2],gA=gC[3],gu=gC[4],gt=gC[5],gs=gC[6],gr=gC[7],gy=gC[8],gx=gC[9],gw=gC[10],gv=gC[11],gI=gC[12],gH=gC[13],gF=gC[14],gB=gC[15];gz[0]=(gt*(gw*gB-gv*gF)-gx*(gs*gB-gr*gF)+gH*(gs*gv-gr*gw));gz[1]=-(gE*(gw*gB-gv*gF)-gx*(gD*gB-gA*gF)+gH*(gD*gv-gA*gw));gz[2]=(gE*(gs*gB-gr*gF)-gt*(gD*gB-gA*gF)+gH*(gD*gr-gA*gs));gz[3]=-(gE*(gs*gv-gr*gw)-gt*(gD*gv-gA*gw)+gx*(gD*gr-gA*gs));gz[4]=-(gu*(gw*gB-gv*gF)-gy*(gs*gB-gr*gF)+gI*(gs*gv-gr*gw));gz[5]=(gG*(gw*gB-gv*gF)-gy*(gD*gB-gA*gF)+gI*(gD*gv-gA*gw));gz[6]=-(gG*(gs*gB-gr*gF)-gu*(gD*gB-gA*gF)+gI*(gD*gr-gA*gs));gz[7]=(gG*(gs*gv-gr*gw)-gu*(gD*gv-gA*gw)+gy*(gD*gr-gA*gs));gz[8]=(gu*(gx*gB-gv*gH)-gy*(gt*gB-gr*gH)+gI*(gt*gv-gr*gx));gz[9]=-(gG*(gx*gB-gv*gH)-gy*(gE*gB-gA*gH)+gI*(gE*gv-gA*gx));gz[10]=(gG*(gt*gB-gr*gH)-gu*(gE*gB-gA*gH)+gI*(gE*gr-gA*gt));gz[11]=-(gG*(gt*gv-gr*gx)-gu*(gE*gv-gA*gx)+gy*(gE*gr-gA*gt));gz[12]=-(gu*(gx*gF-gw*gH)-gy*(gt*gF-gs*gH)+gI*(gt*gw-gs*gx));gz[13]=(gG*(gx*gF-gw*gH)-gy*(gE*gF-gD*gH)+gI*(gE*gw-gD*gx));gz[14]=-(gG*(gt*gF-gs*gH)-gu*(gE*gF-gD*gH)+gI*(gE*gs-gD*gt));gz[15]=(gG*(gt*gw-gs*gx)-gu*(gE*gw-gD*gx)+gy*(gE*gs-gD*gt));return gz};e.determinant=function(gM){var gR=gM[0],gP=gM[1],gN=gM[2],gL=gM[3],gu=gM[4],gt=gM[5],gs=gM[6],gr=gM[7],gI=gM[8],gH=gM[9],gG=gM[10],gF=gM[11],gT=gM[12],gS=gM[13],gQ=gM[14],gO=gM[15],gE=gR*gt-gP*gu,gD=gR*gs-gN*gu,gC=gR*gr-gL*gu,gB=gP*gs-gN*gt,gA=gP*gr-gL*gt,gz=gN*gr-gL*gs,gy=gI*gS-gH*gT,gx=gI*gQ-gG*gT,gw=gI*gO-gF*gT,gv=gH*gQ-gG*gS,gK=gH*gO-gF*gS,gJ=gG*gO-gF*gQ;return gE*gJ-gD*gK+gC*gv+gB*gw-gA*gx+gz*gy};e.multiply=function(gD,gH,gE){var gL=gH[0],gK=gH[1],gI=gH[2],gF=gH[3],gx=gH[4],gv=gH[5],gt=gH[6],gr=gH[7],gC=gH[8],gB=gH[9],gA=gH[10],gz=gH[11],gN=gH[12],gM=gH[13],gJ=gH[14],gG=gH[15];var gy=gE[0],gw=gE[1],gu=gE[2],gs=gE[3];gD[0]=gy*gL+gw*gx+gu*gC+gs*gN;gD[1]=gy*gK+gw*gv+gu*gB+gs*gM;gD[2]=gy*gI+gw*gt+gu*gA+gs*gJ;gD[3]=gy*gF+gw*gr+gu*gz+gs*gG;gy=gE[4];gw=gE[5];gu=gE[6];gs=gE[7];gD[4]=gy*gL+gw*gx+gu*gC+gs*gN;gD[5]=gy*gK+gw*gv+gu*gB+gs*gM;gD[6]=gy*gI+gw*gt+gu*gA+gs*gJ;gD[7]=gy*gF+gw*gr+gu*gz+gs*gG;gy=gE[8];gw=gE[9];gu=gE[10];gs=gE[11];gD[8]=gy*gL+gw*gx+gu*gC+gs*gN;gD[9]=gy*gK+gw*gv+gu*gB+gs*gM;gD[10]=gy*gI+gw*gt+gu*gA+gs*gJ;gD[11]=gy*gF+gw*gr+gu*gz+gs*gG;gy=gE[12];gw=gE[13];gu=gE[14];gs=gE[15];gD[12]=gy*gL+gw*gx+gu*gC+gs*gN;gD[13]=gy*gK+gw*gv+gu*gB+gs*gM;gD[14]=gy*gI+gw*gt+gu*gA+gs*gJ;gD[15]=gy*gF+gw*gr+gu*gz+gs*gG;return gD};e.mul=e.multiply;e.translate=function(gD,gF,gy){var gx=gy[0],gw=gy[1],gv=gy[2],gI,gH,gG,gE,gu,gt,gs,gr,gC,gB,gA,gz;if(gF===gD){gD[12]=gF[0]*gx+gF[4]*gw+gF[8]*gv+gF[12];gD[13]=gF[1]*gx+gF[5]*gw+gF[9]*gv+gF[13];gD[14]=gF[2]*gx+gF[6]*gw+gF[10]*gv+gF[14];gD[15]=gF[3]*gx+gF[7]*gw+gF[11]*gv+gF[15]}else{gI=gF[0];gH=gF[1];gG=gF[2];gE=gF[3];gu=gF[4];gt=gF[5];gs=gF[6];gr=gF[7];gC=gF[8];gB=gF[9];gA=gF[10];gz=gF[11];gD[0]=gI;gD[1]=gH;gD[2]=gG;gD[3]=gE;gD[4]=gu;gD[5]=gt;gD[6]=gs;gD[7]=gr;gD[8]=gC;gD[9]=gB;gD[10]=gA;gD[11]=gz;gD[12]=gI*gx+gu*gw+gC*gv+gF[12];gD[13]=gH*gx+gt*gw+gB*gv+gF[13];gD[14]=gG*gx+gs*gw+gA*gv+gF[14];gD[15]=gE*gx+gr*gw+gz*gv+gF[15]}return gD};e.scale=function(gu,gs,gt){var gr=gt[0],gw=gt[1],gv=gt[2];gu[0]=gs[0]*gr;gu[1]=gs[1]*gr;gu[2]=gs[2]*gr;gu[3]=gs[3]*gr;gu[4]=gs[4]*gw;gu[5]=gs[5]*gw;gu[6]=gs[6]*gw;gu[7]=gs[7]*gw;gu[8]=gs[8]*gv;gu[9]=gs[9]*gv;gu[10]=gs[10]*gv;gu[11]=gs[11]*gv;gu[12]=gs[12];gu[13]=gs[13];gu[14]=gs[14];gu[15]=gs[15];return gu};e.rotate=function(gL,gS,gU,gr){var gB=gr[0],gA=gr[1],gz=gr[2],gM=Math.sqrt(gB*gB+gA*gA+gz*gz),gG,gQ,gF,gW,gV,gT,gR,gy,gx,gw,gv,gK,gJ,gI,gH,gE,gD,gC,gP,gO,gN,gu,gt,gs;if(Math.abs(gM)<gq){return null}gM=1/gM;gB*=gM;gA*=gM;gz*=gM;gG=Math.sin(gU);gQ=Math.cos(gU);gF=1-gQ;gW=gS[0];gV=gS[1];gT=gS[2];gR=gS[3];gy=gS[4];gx=gS[5];gw=gS[6];gv=gS[7];gK=gS[8];gJ=gS[9];gI=gS[10];gH=gS[11];gE=gB*gB*gF+gQ;gD=gA*gB*gF+gz*gG;gC=gz*gB*gF-gA*gG;gP=gB*gA*gF-gz*gG;gO=gA*gA*gF+gQ;gN=gz*gA*gF+gB*gG;gu=gB*gz*gF+gA*gG;gt=gA*gz*gF-gB*gG;gs=gz*gz*gF+gQ;gL[0]=gW*gE+gy*gD+gK*gC;gL[1]=gV*gE+gx*gD+gJ*gC;gL[2]=gT*gE+gw*gD+gI*gC;gL[3]=gR*gE+gv*gD+gH*gC;gL[4]=gW*gP+gy*gO+gK*gN;gL[5]=gV*gP+gx*gO+gJ*gN;gL[6]=gT*gP+gw*gO+gI*gN;gL[7]=gR*gP+gv*gO+gH*gN;gL[8]=gW*gu+gy*gt+gK*gs;gL[9]=gV*gu+gx*gt+gJ*gs;gL[10]=gT*gu+gw*gt+gI*gs;gL[11]=gR*gu+gv*gt+gH*gs;if(gS!==gL){gL[12]=gS[12];gL[13]=gS[13];gL[14]=gS[14];gL[15]=gS[15]}return gL};e.rotateX=function(gr,gy,gx){var gD=Math.sin(gx),gw=Math.cos(gx),gC=gy[4],gB=gy[5],gA=gy[6],gz=gy[7],gv=gy[8],gu=gy[9],gt=gy[10],gs=gy[11];if(gy!==gr){gr[0]=gy[0];gr[1]=gy[1];gr[2]=gy[2];gr[3]=gy[3];gr[12]=gy[12];gr[13]=gy[13];gr[14]=gy[14];gr[15]=gy[15]}gr[4]=gC*gw+gv*gD;gr[5]=gB*gw+gu*gD;gr[6]=gA*gw+gt*gD;gr[7]=gz*gw+gs*gD;gr[8]=gv*gw-gC*gD;gr[9]=gu*gw-gB*gD;gr[10]=gt*gw-gA*gD;gr[11]=gs*gw-gz*gD;return gr};e.rotateY=function(gv,gC,gB){var gD=Math.sin(gB),gA=Math.cos(gB),gu=gC[0],gt=gC[1],gs=gC[2],gr=gC[3],gz=gC[8],gy=gC[9],gx=gC[10],gw=gC[11];if(gC!==gv){gv[4]=gC[4];gv[5]=gC[5];gv[6]=gC[6];gv[7]=gC[7];gv[12]=gC[12];gv[13]=gC[13];gv[14]=gC[14];gv[15]=gC[15]}gv[0]=gu*gA-gz*gD;gv[1]=gt*gA-gy*gD;gv[2]=gs*gA-gx*gD;gv[3]=gr*gA-gw*gD;gv[8]=gu*gD+gz*gA;gv[9]=gt*gD+gy*gA;gv[10]=gs*gD+gx*gA;gv[11]=gr*gD+gw*gA;return gv};e.rotateZ=function(gv,gy,gx){var gD=Math.sin(gx),gw=Math.cos(gx),gu=gy[0],gt=gy[1],gs=gy[2],gr=gy[3],gC=gy[4],gB=gy[5],gA=gy[6],gz=gy[7];if(gy!==gv){gv[8]=gy[8];gv[9]=gy[9];gv[10]=gy[10];gv[11]=gy[11];gv[12]=gy[12];gv[13]=gy[13];gv[14]=gy[14];gv[15]=gy[15]}gv[0]=gu*gw+gC*gD;gv[1]=gt*gw+gB*gD;gv[2]=gs*gw+gA*gD;gv[3]=gr*gw+gz*gD;gv[4]=gC*gw-gu*gD;gv[5]=gB*gw-gt*gD;gv[6]=gA*gw-gs*gD;gv[7]=gz*gw-gr*gD;return gv};e.fromRotationTranslation=function(gE,gC,gA){var gx=gC[0],gw=gC[1],gv=gC[2],gy=gC[3],gF=gx+gx,gr=gw+gw,gz=gv+gv,gu=gx*gF,gt=gx*gr,gs=gx*gz,gD=gw*gr,gB=gw*gz,gI=gv*gz,gJ=gy*gF,gH=gy*gr,gG=gy*gz;gE[0]=1-(gD+gI);gE[1]=gt+gG;gE[2]=gs-gH;gE[3]=0;gE[4]=gt-gG;gE[5]=1-(gu+gI);gE[6]=gB+gJ;gE[7]=0;gE[8]=gs+gH;gE[9]=gB-gJ;gE[10]=1-(gu+gD);gE[11]=0;gE[12]=gA[0];gE[13]=gA[1];gE[14]=gA[2];gE[15]=1;return gE};e.fromQuat=function(gB,gy){var gv=gy[0],gu=gy[1],gt=gy[2],gw=gy[3],gC=gv+gv,gr=gu+gu,gx=gt+gt,gs=gv*gC,gA=gu*gC,gz=gu*gr,gI=gt*gC,gH=gt*gr,gF=gt*gx,gG=gw*gC,gE=gw*gr,gD=gw*gx;gB[0]=1-gz-gF;gB[1]=gA+gD;gB[2]=gI-gE;gB[3]=0;gB[4]=gA-gD;gB[5]=1-gs-gF;gB[6]=gH+gG;gB[7]=0;gB[8]=gI+gE;gB[9]=gH-gG;gB[10]=1-gs-gz;gB[11]=0;gB[12]=0;gB[13]=0;gB[14]=0;gB[15]=1;return gB};e.frustum=function(gv,gs,gA,gr,gz,gx,gw){var gy=1/(gA-gs),gu=1/(gz-gr),gt=1/(gx-gw);gv[0]=(gx*2)*gy;gv[1]=0;gv[2]=0;gv[3]=0;gv[4]=0;gv[5]=(gx*2)*gu;gv[6]=0;gv[7]=0;gv[8]=(gA+gs)*gy;gv[9]=(gz+gr)*gu;gv[10]=(gw+gx)*gt;gv[11]=-1;gv[12]=0;gv[13]=0;gv[14]=(gw*gx*2)*gt;gv[15]=0;return gv};e.perspective=function(gu,gt,gs,gv,gr){var gx=1/Math.tan(gt/2),gw=1/(gv-gr);gu[0]=gx/gs;gu[1]=0;gu[2]=0;gu[3]=0;gu[4]=0;gu[5]=gx;gu[6]=0;gu[7]=0;gu[8]=0;gu[9]=0;gu[10]=(gr+gv)*gw;gu[11]=-1;gu[12]=0;gu[13]=0;gu[14]=(2*gr*gv)*gw;gu[15]=0;return gu};e.ortho=function(gu,gs,gA,gr,gy,gx,gw){var gv=1/(gs-gA),gz=1/(gr-gy),gt=1/(gx-gw);gu[0]=-2*gv;gu[1]=0;gu[2]=0;gu[3]=0;gu[4]=0;gu[5]=-2*gz;gu[6]=0;gu[7]=0;gu[8]=0;gu[9]=0;gu[10]=2*gt;gu[11]=0;gu[12]=(gs+gA)*gv;gu[13]=(gy+gr)*gz;gu[14]=(gw+gx)*gt;gu[15]=1;return gu};e.lookAt=function(gF,gM,gN,gx){var gL,gK,gI,gt,gs,gr,gA,gz,gy,gG,gJ=gM[0],gH=gM[1],gE=gM[2],gw=gx[0],gv=gx[1],gu=gx[2],gD=gN[0],gC=gN[1],gB=gN[2];if(Math.abs(gJ-gD)<gq&&Math.abs(gH-gC)<gq&&Math.abs(gE-gB)<gq){return e.identity(gF)}gA=gJ-gD;gz=gH-gC;gy=gE-gB;gG=1/Math.sqrt(gA*gA+gz*gz+gy*gy);gA*=gG;gz*=gG;gy*=gG;gL=gv*gy-gu*gz;gK=gu*gA-gw*gy;gI=gw*gz-gv*gA;gG=Math.sqrt(gL*gL+gK*gK+gI*gI);if(!gG){gL=0;gK=0;gI=0}else{gG=1/gG;gL*=gG;gK*=gG;gI*=gG}gt=gz*gI-gy*gK;gs=gy*gL-gA*gI;gr=gA*gK-gz*gL;gG=Math.sqrt(gt*gt+gs*gs+gr*gr);if(!gG){gt=0;gs=0;gr=0}else{gG=1/gG;gt*=gG;gs*=gG;gr*=gG}gF[0]=gL;gF[1]=gt;gF[2]=gA;gF[3]=0;gF[4]=gK;gF[5]=gs;gF[6]=gz;gF[7]=0;gF[8]=gI;gF[9]=gr;gF[10]=gy;gF[11]=0;gF[12]=-(gL*gJ+gK*gH+gI*gE);gF[13]=-(gt*gJ+gs*gH+gr*gE);gF[14]=-(gA*gJ+gz*gH+gy*gE);gF[15]=1;return gF};e.str=function(gr){return"mat4("+gr[0]+", "+gr[1]+", "+gr[2]+", "+gr[3]+", "+gr[4]+", "+gr[5]+", "+gr[6]+", "+gr[7]+", "+gr[8]+", "+gr[9]+", "+gr[10]+", "+gr[11]+", "+gr[12]+", "+gr[13]+", "+gr[14]+", "+gr[15]+")"};e.frob=function(gr){return(Math.sqrt(Math.pow(gr[0],2)+Math.pow(gr[1],2)+Math.pow(gr[2],2)+Math.pow(gr[3],2)+Math.pow(gr[4],2)+Math.pow(gr[5],2)+Math.pow(gr[6],2)+Math.pow(gr[6],2)+Math.pow(gr[7],2)+Math.pow(gr[8],2)+Math.pow(gr[9],2)+Math.pow(gr[10],2)+Math.pow(gr[11],2)+Math.pow(gr[12],2)+Math.pow(gr[13],2)+Math.pow(gr[14],2)+Math.pow(gr[15],2)))};gm.mat4=e})(window);function cq(){this.result={bkData:[],eleData:[[],[],[],[],[],[]],tileLabels:[]}}A.extend(cq.prototype,{createLayer:function(gi,i){var e=this.result.bkData;i=i||{};if(!e[gi]){e[gi]=[[],[],[]]}e[gi].dataType=i.dataType||2;e[gi].png8=i.png8||false;e[gi].clipTile=i.clipTile||false},removeLayer:function(i){var e=this.result.bkData;e[i]=null},getResult:function(){return this.result},setData:function(gl,gk,gm){var e=this.result.bkData;var gi=e[gk]?e[gk][gm]:null;if(!gi){return}for(var gj=0;gj<gi.length;gj++){if(gi[gj].key&&gi[gj].key===gl.key){gi[gj]=gl;return}}gi.push(gl)},setLabelData:function(e){this.result.tileLabels=e},getLabelData:function(){return this.result.tileLabels},setOverlayData:function(i,e){if(!this.result.eleData[e]){return}this.result.eleData[e]=i},clearLabelOverlayData:function(){this.result.eleData[2]=[];this.result.eleData[3]=[];this.result.eleData[4]=[]},clearData:function(gj){var e=this.result.bkData;if(typeof gj==="number"){if(e[gj]){e[gj][0]=[];e[gj][1]=[];e[gj][2]=[]}return}for(var gi=0;gi<e.length;gi++){if(!e[gi]){continue}e[gi][0]=[];e[gi][1]=[];e[gi][2]=[]}},sortThumbData:function(i){var e=this.result.bkData;var gi=e[i];if(!gi){return}if(gi[0]&&gi[0].length>0){gi[0].sort(function(gk,gj){return gk.tileInfo.useZoom-gj.tileInfo.useZoom})}}});var ec=(function(){var gu=new Int8Array(4);var gi=new Int32Array(gu.buffer,0,1);var go=new Float32Array(gu.buffer,0,1);function gw(gC){gi[0]=gC;return go[0]}function i(gC){go[0]=gC;return gi[0]}function gp(gC){var gE=(gC[3]<<24|gC[2]<<16|gC[1]<<8|gC[0]);var gD=gw(gE&4278190079);return gD}var gk=0;var gn=1;var gs=2;var gz=0;var gx=1;var gv=2;var gl=6;var gr=7;function gt(gC,gD){var gE;if(gD%2===0){gE=[-gC[1],gC[0]]}else{gE=[gC[1],-gC[0]]}return gE}function e(gC,gD,gE){var gF=gt(gC,gD);var gG;if(gE===gn){return gF}else{if(gD===4||gD===5){gG=[gF[0]-gC[0],gF[1]-gC[1]]}else{gG=[gF[0]+gC[0],gF[1]+gC[1]]}if(gE===gk){vec2.normalize(gG,gG)}return gG}}function gj(gG,gF,gE,gC){var gD=vec2.dot(gG,gF);if(gE===gv||gE===gx){if((gC===0||gC===1)&&gD>0){return true}else{if((gC===2||gC===3)&&gD<0){return true}}}if((gC===0||gC===1)&&gD<0){return true}else{if((gC===2||gC===3)&&gD>0){return true}}return false}function gq(gD,gI,gK){var gJ=gt(gD,gI);var gF;var gH=gD;var gG=gK;var gM=[];vec2.normalize(gM,[gH[0]+gG[0],gH[1]+gG[1]]);var gL=vec2.dot(gJ,[-gM[1],gM[0]]);if(Math.abs(gL)<0.1){gL=1}var gE=1/gL;gF=[-gM[1]*gE,gM[0]*gE];var gC=vec2.dot(gD,gF);if(gC<0){vec2.negate(gF,gF)}return{cos2:gC,offset:gF}}function gB(gD,gI,gK,gC){var gJ=gt(gD,gI);var gH;var gG;var gF;if(gI===0||gI===1){gH=gK;gG=gD}else{gH=gD;gG=gK}if(!gH||!gG){return gJ}var gM=[gH[0]+gG[0],gH[1]+gG[1]];if(gM[0]===0&&gM[1]===0){vec2.normalize(gM,gG)}else{vec2.normalize(gM,gM)}var gN=gj(gM,gJ,gC,gI);if(gN){return gJ}var gL=vec2.dot(gJ,[-gM[1],gM[0]]);if(Math.abs(gL)<0.1){gL=1}var gE=1/gL;gF=[-gM[1]*gE,gM[0]*gE];return gF}function gA(gM,gN,gG,gO,gL,gE,gH,gF,gK){var gJ;var gD=0;var gC=false;if(gK===undefined){gJ=gL.length/gl-1}else{gJ=gL.length/gr-1}gm(gN[0],gM[0],gO,gG,4,gH,gF,undefined,gL,gK);gJ++;gD++;gm(gN[0],gM[0],gO,gG,5,gH,gF,undefined,gL,gK);gJ++;gD++;for(var gI=0;gI<gM.length;gI++){gm(gN[gI],gM[gI],gO,gG,0,gH,gF,gM[gI-1],gL,gK);gy(gE,++gJ,++gD,gC);gm(gN[gI],gM[gI],gO,gG,1,gH,gF,gM[gI-1],gL,gK);gy(gE,++gJ,++gD,gC);gm(gN[gI+1],gM[gI],gO,gG,2,gH,gF,gM[gI+1],gL,gK);gy(gE,++gJ,++gD,gC);gm(gN[gI+1],gM[gI],gO,gG,3,gH,gF,gM[gI+1],gL,gK);gy(gE,++gJ,++gD,gC);if(gG===gx&&gI!==gM.length-1){gm(gN[gI+1],gM[gI],gO,gG,8,gH,gF,gM[gI+1],gL,gK);gy(gE,++gJ,++gD,gC);gC=gC?false:true}}gm(gN[gN.length-1],gM[gM.length-1],gO,gG,6,gH,gF,undefined,gL,gK);gy(gE,++gJ,++gD,gC);gm(gN[gN.length-1],gM[gM.length-1],gO,gG,7,gH,gF,undefined,gL,gK);gy(gE,++gJ,++gD,gC)}function gm(gO,gF,gP,gE,gJ,gH,gD,gM,gL,gK){var gN=gJ%2===0?1:-1;var gI;if(gJ===4||gJ===5||gJ===6||gJ===7){gI=e(gF,gJ,gP)}else{if(gJ===0||gJ===1||gJ===2||gJ===3){gI=gB(gF,gJ,gM,gE)}else{if(gJ===8){var gG=gq(gF,gJ,gM);gI=gG.offset;vec2.normalize(gI,gI);var gC=gG.cos2;if(gC<0){gN=-gN}}}}gL[gL.length]=gO[0]*10;gL[gL.length]=gO[1]*10;gL[gL.length]=gI[0]*gD*10;gL[gL.length]=gI[1]*gD*10;gL[gL.length]=gH;gL[gL.length]=gN;if(gK!==undefined){gL[gL.length]=gK}}function gy(gG,gE,gC,gF){var gD;if(gC%2===0){if(gF){gG[gG.length]=gE-2;gG[gG.length]=gE-1;gG[gG.length]=gE}else{gG[gG.length]=gE-1;gG[gG.length]=gE-2;gG[gG.length]=gE}}else{if(gF){gG[gG.length]=gE-1;gG[gG.length]=gE-2;gG[gG.length]=gE}else{gG[gG.length]=gE-2;gG[gG.length]=gE-1;gG[gG.length]=gE}}}return{getVertexCount:function(gD,gC){if(gC===gx){return gD*5-2}else{return gD*4}},overlayLine:function(gL,gE,gM,gI,gC,gG,gD,gJ){var gK=[];for(var gH=0;gH<gL.length;gH++){if(gH!==gL.length-1){var gF=[gL[gH+1][0]-gL[gH][0],gL[gH+1][1]-gL[gH][1]];var gN=[];if(gF[0]===0&&gF[1]===0){gN=[0,0]}else{vec2.normalize(gN,gF)}gK[gK.length]=[gN[0],gN[1]]}}return gA(gK,gL,gE,gM,gI,gC,gp(gG),gD,gJ)},toSolidVertices:function(gG,gD){var gE=new Float32Array(gG.length/gr*5);var gC=new Int16Array(gE.buffer);var gI=0;var gF=0;for(var gH=0;gH<gG.length;gH+=gr){gC[gI]=~~gG[gH];gC[gI+1]=~~gG[gH+1];gC[gI+2]=~~gG[gH+2];gC[gI+3]=~~gG[gH+3];gE[gF+2]=gG[gH+4];gC[gI+6]=gG[gH+5];gC[gI+7]=gD?gD:0;gC[gI+8]=gG[gH+6];gC[gI+9]=0;gI+=10;gF+=5}return gE}}})();var dD=1;var fb=2;var eF={drawIndex:0,devicePixelRatio:aJ(),zoomState:1,curViewTilesInfo:null,iconSetImg:null,LAST_CALC_ZOOM:-1,LAST_LOAD_VECTOR_ZOOM_CHANGE:false,lastCollisionTestTime:0,remove:function(){this.tileCache.clear()},initDrawData:function(){this.drawIndex=this.zIndex;this.map._featureMgr.createLayer(this.drawIndex,{dataType:this.dataType,png8:this.png8,clipTile:this.clipTile})},destroyDrawData:function(){this.map._featureMgr.removeLayer(this.drawIndex)},setZIndex:function(e){this.zIndex=e},getTileKey:function(e,gj){gj=gj||{};var i=typeof gj.useZoom==="number"?gj.useZoom:e.useZoom;var gi=e.style||this.mapStyleId||"default";return this.mapType+"_"+gi+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},getTileRenderDataKey:function(i){var gi=i.col;var gj=i.zoom;var e=i.baseTileSize;gi=c6.calcLoopParam(gi,gj,e).col;return this.mapType+"_"+gi+"_"+i.row+"_"+gj+"_"+i.useZoom},getTileUnits:function(e){var gj=this.map;var gi=bw[gj.getMapType()];var i=gi.baseUnits*Math.pow(2,gi.zoomLevelBase-e);return i},getTilesUrl:function(gk,gt,gu){var i=gk.x;var gv=gk.y;var gq=an("ditu","normal");var gm=gq.ver;var gn=gq.udt;i=c6.calcLoopParam(i,gt,gu).col;var gs=bw.B_NORMAL_MAP.vectorTileUrls;var gl=Math.abs(i+gv)%gs.length;var gr=gs[gl];if(window.offLineIPAddress){gs=[window.offLineIPAddress+"pvd/"];gr=gs[0]}var gi="x="+i+"&y="+gv+"&z="+Math.floor(gt);var gp=this.devicePixelRatio>1?"&scaler=2":"";var go="&textimg=1";if(this.map.config.textRenderType==="canvas"){go="&textimg=0"}var gj=this.map.config.style;if(typeof gj==="string"&&gj!=="default"){gi+="&styleId="+dX.mapStyleNameIdPair[gj]}gi+="&styles=pl"+go+gp+"&v="+gm+"&udt="+gn+"&json=0";var e=gr+"?qt=vtile&param="+window.encodeURIComponent(e3(gi));return e},getRasterTilesUrl:function(gi,gl,gj){var gk=bw[this.map.mapType];var i=this.map.config.style;var e=gk.tileUrls[Math.abs(gl+gi)%gk.tileUrls.length]+"?qt=tile&x="+gi+"&y="+gl+"&z="+gj+((i==="default"||typeof i!=="string")?"":("&styleId="+dX.mapStyleNameIdPair[i]))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p=1";e=e.replace(/-(\d+)/gi,"M$1");return e},getZoomState:function(){var gi=this.map;var i=gi.getZoom();var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState},releaseOutViewTileData:function(e){var gk=this.map._workerMgr.releasePendingData(e);for(var gj=0,gi=gk.length;gj<gi;gj++){var gl=this.getTileKey(gk[gj]);this.tileCache.removeData(gl)}},loadLayerData:function(e,gj,i){this.hasZoomChange=i;this.curViewTilesInfo=e;this.mapStyleId=this.map.getMapStyleId();this.releaseOutViewTileData(e);var gi=this.getZoomState();if(this.dataType===fb){if(gj){this.getVectorLayerDataFromCache(e,gi)}else{this.loadVectorLayerData(e)}}else{this.loadRasterLayerData(e,gj)}},getVectorLayerDataFromCache:function(go,gy){this.map.temp.isPermitSpotOver=false;this.tileLabels=[];if(this.baseLayer===true){var gs=this.map._customLabelMgr.virtualTile;if(gs&&gs.label){this.tileLabels.push(gs.label)}}this.thumbCache={};var gz=-1;for(var gv=0,gt=go.length;gv<gt;gv++){var gw=go[gv];var gk=gw.col;var gl=gw.row;var gi=gw.zoom;var gu=this._getTileTexImgKey(gw);var gj=gw.useZoom;gz=gi;var gm=this.getTileKey(gw);var gB=this.tileCache.getData(gm);if(gB&&gB.status==="ready"){var gC=gB;this.map._featureMgr.setData(gB,this.drawIndex,2);if(gB.label){if(gB.label.status==="ready"){gB.label.tileInfo=gB.tileInfo;this.tileLabels.push(gB.label);if(gB.label.textureSources&&gB.label.textureSources[gj]&&this.map._webglMapScene){var gA=this.map._webglMapScene._painter;if(!gA._labelTextureAtlasOffset[gu]){gA._addToAsyncJob(gB.label.textureSources[gj])}}}else{if(gB.label.status!=="processing"){this.processLabelData(gB)}}}}else{var gx={tileInfo:gw,dataType:fb,key:gm};this.map._featureMgr.setData(gx,this.drawIndex,2);if(this.useThumbData){this.setThumbData(gk,gl,gi,gj,gy)}}}this.tileLabels.labelZoom=gz;this.updateLabels(gy);var gp=this.map.getZoom();var gn=Math.floor(gp);var gr=gp-gn;var gq=Math.floor(this.LAST_CALC_ZOOM);var e=this.LAST_CALC_ZOOM-gq;var gD=false;if(this.hasZoomChange){if(Math.abs(gp-this.LAST_CALC_ZOOM)>=0.5){gD=true}else{if(gr<0.5&&e>=0.5){gD=true}else{if(gr>=0.5&&e<0.5){gD=true}}}if(gD){this.cacheDataCollideLabels(0)}this.LAST_CALC_ZOOM=gp}else{if(this.tileLabels.length>0){this.cacheDataCollideLabels(30)}}},loadVectorLayerData:function(gr,gt){this.map.temp.isPermitSpotOver=false;var gq=this;function gp(i,gv){var gx=gq.tileCache.getData(gv);if(!gx){return}if(!i||i.error){if(typeof alog!=="undefined"){alog("exception.fire","catch",{msg:i.tileKey+":"+i.message,path:"api.js",ln:1})}var gw=new aM("ontileloaderror");i=i||{};gw.error=i.error||"";gw.message=i.message||"";gq.map.fire(gw);gx.status="init";gx.reloadTimer=setTimeout(function(){if(gx.retry<3){gx.retry++;gx.status="loading";gq.loadVectorTileData(i.tileInfo,gp)}else{gq.tileCache.removeData(gv)}},4000);gq.map._featureMgr.clearData(gq.drawIndex);gq._checkTilesLoaded();gq.getVectorLayerDataFromCache(gq.curViewTilesInfo,gq.getZoomState());return}if(gx.reloadTimer){clearTimeout(gx.reloadTimer);gx.reloadTimer=null}gq.callbackDataQueue.push([i,gv]);if(gq.processDataTimer){return}gq.processDataTimer=setTimeout(function(){while(gq.callbackDataQueue.length>0){var gy=gq.callbackDataQueue.shift();gq.vectorTileDataCbk(gy[0],gy[1]);gq._checkTilesLoaded()}gq.map._featureMgr.clearData(gq.drawIndex);gq.getVectorLayerDataFromCache(gq.curViewTilesInfo,gq.getZoomState());gq.processDataTimer=null},200)}for(var go=0,gm=gr.length;go<gm;go++){var gj=gr[go];var gk=gj.col;var gu=gj.row;var gs=gj.zoom;var gi=gj.loopOffsetX;var gn=this.getTileKey(gj);var e=this.tileCache.getData(gn);if(!e){e={status:"init",tileInfo:gj,dataType:fb,key:gn,retry:0}}if(e.status!=="ready"&&e.status!=="loading"){this.numLoading++;e.status="loading";this.tileCache.setData(gn,e);var gl=this.getProcessedLabelZoom(gj);if(gl){gj.processedLabelZooms=gl}this.loadVectorTileData(gj,gp)}}},setThumbData:function(i,gk,gj,e,gi){if(gi===1){if(this._findParentZoomTile(i,gk,gj,e,8)===false){this._findChildZoomTile(i,gk,gj,e,3)}}else{if(gi===-1){if(this._findChildZoomTile(i,gk,gj,e,3)===false){this._findParentZoomTile(i,gk,gj,e,8)}}}this.map._featureMgr.sortThumbData(this.drawIndex)},_findParentZoomTile:function(gm,gv,gu,gk,gp){var gl=bw[this.getMapType()];var gi=gl.minDataZoom;var e=gm;var gs=gv;var gq=gu;var gr=gk;for(var go=1;go<=gp;go++){var gj=this.tileType.getParentTile(e,gs,gq,gr,gi);if(gj===null){continue}var gt=this.getTileKey(gj);var gn=this.tileCache.getData(gt);if(gn&&gn.status==="ready"){if(this.thumbCache[gt]){continue}this.map._featureMgr.setData(gn,this.drawIndex,0);this.thumbCache[gt]=true;return true}e=gj.col;gs=gj.row;gq=gj.zoom;gr=gj.useZoom}return false},_findChildZoomTile:function(gn,gp,e,gk,gy){var gw=bw[this.getMapType()];var gs=gw.maxDataZoom;var gm=gn;var go=gp;var gq=e;var gj=gk;var gl=true;for(var gv=1;gv<=gy;gv++){var gt=false;var gi=this.tileType.getChildTiles(gm,go,gq,gj,gs,gv);if(!gi){continue}for(var gu=0;gu<gi.length;gu++){var gr=this.getTileKey(gi[gu]);var gx=this.tileCache.getData(gr);if(gx&&gx.status==="ready"){if(!this.thumbCache[gr]){this.map._featureMgr.setData(gx,this.drawIndex,1);this.thumbCache[gr]=true}gt=true}else{gl=false}}if(gt){break}}return gl},loadVectorTileData:function(i,gk){var gi=i.col;var go=i.row;var gm=i.zoom;var gn=i.baseTileSize;var e=this.getTilesUrl(new di(gi,go),gm,gn);if(!e){return}var gl=this.getTileKey(i);a3(this.map);if(!this.processData){this.map._workerMgr.loadTileData(e,i,gl,gk);return}var gk="cbk"+gl.replace(/-/g,"_");var gj=this;aU[gk]=function(gp){var gq=(function(gr){return function(){gr.tileInfo=i;var gx=gj.processData(gr);if(!gx.road){return}var gu={tileInfo:i,renderData:{base:[]},status:"ready",key:gl,mapType:gj.mapType};var gA=[];var gD=[];for(var gw=0;gw<gx.road.length;gw++){var gz=gx.road[gw];var gy=-1;for(var gv=0;gv<gz.length;gv++){var gB=gz[gv];var gC=[];if(gA.length/7+gB[0].length/2>65536){gu.renderData.base.push({type:"line",data:[ec.toSolidVertices(gA,4000),new Uint16Array(gD)]});gA=[];gD=[]}for(var gt=0;gt<gB[0].length;gt+=2){gC[gC.length]=[gB[0][gt],gB[0][gt+1]]}var gs=gB[3];ec.overlayLine(gC,gB[1],gB[2],gA,gD,gs,gB[4],gw+20)}gu.renderData.base.push({type:"line",data:[ec.toSolidVertices(gA,4000),new Uint16Array(gD)]})}gj.tileCache.setData(gl,gu);gj.map._featureMgr.clearData(gj.drawIndex);gj.getVectorLayerDataFromCache(gj.curViewTilesInfo,gj.getZoomState());gj.map.dispatchEvent(new aM("onrefresh"))}})(gp);gj.map.jobScheduler.addJob(gq);delete aU[gk]};e+="&fn="+encodeURIComponent(dx+"."+gk);fR.load(e)},vectorTileDataCbk:function(gj,gk){var go=new aM("ontileloaded");go.perfStat=gj.perfStat||[];var e=this.map;e.fire(go);var i=gj.tileInfo;var gi=i.col;var gt=i.row;var gs=i.zoom;var gr=i.baseTileSize;var gm=this.tileCache.getData(gk);if(!gm){return}if(!this.showLabel){gj.label=null}gm.renderData=gj;gm.tileInfo=i;var gl=c6.calcLoopParam(gi,gs,gr);var gp=gl.geoOffsetX;gm.tileInfo.loopOffsetX=gp;gm.status="ready";gm.mapType=this.mapType;this.tileCache.setData(gk,gm);gm.label=gj.label;gj.label=null;if(gj.indoorData){e._indoorMgr.setData(gj.indoorData)}var gn="id_"+gi+"_"+gt+"_"+gs;if(!this.curViewTilesInfo[gn]){e.fire(new aM("ontilenotinview"));return}this.processLabelData(gm);if(gj.indoorData&&e._indoorMgr.currentUid){this._refreshIndoorData(e._indoorMgr.currentUid,e._indoorMgr.currentFloor)}var gq=new aM("onrefresh");gq.source="webgllayer";this.map.dispatchEvent(gq)},_refreshIndoorData:function(gr,gq){var gt=this.map._indoorMgr.getIndoorData(gr);var gw=gt.tileKeys;var gu=Math.floor(this.map.getZoom());for(var go=0;go<gw.length;go++){var gl=gw[go];var gn=this.tileCache.getData(gl);if(!gn){continue}var gv=gn.renderData;gv.indoorBase=[];gv.indoorBaseContour=[];gv.indoorBorder3D=[];gv.indoorArea3D=[];gn.label.indoorLabel=[];this.labelProcessor.clearCollisionCache(gn.label);for(var gp in gv.indoorData){if(gp==="tileInfo"){continue}var e=gv.indoorData[gp];var gk=e.defaultFloor;if(gp===gr){gk=gq;e.currentFloor=gq}if(e.floors[gk]){if(e.floors[gk].base){for(var gm=0;gm<e.floors[gk].base.length;gm++){gv.indoorBase.push(e.floors[gk].base[gm])}}if(e.floors[gk].contour){for(var gm=0;gm<e.floors[gk].contour.length;gm++){gv.indoorBaseContour.push(e.floors[gk].contour[gm])}}if(e.floors[gk].indoorBorder3D){gv.indoorBorder3D.push(e.floors[gk].indoorBorder3D)}if(e.floors[gk].area3D){gv.indoorArea3D.push(e.floors[gk].area3D)}if(e.floors[gk].pois){gn.label.indoorLabel=gn.label.indoorLabel.concat(e.floors[gk].pois)}}}this.updateAllIconsTextureCoords(gn);var gs=this;this.labelProcessor.loadIconImages(gn,function(i){gs.updateAllIconsTextureCoords(i)});var gj=gl.split("_");var gi=parseInt(gj[gj.length-1],10);if(gi!==gu){continue}gs.map._featureMgr.setData(gn,this.drawIndex,2)}this.dataBackCollideLabels();this.map.dispatchEvent(new aM("onrefresh"))},_removeIndoorData:function(i){if(!i.indoorData){return}for(var e in i.indoorData){if(e==="tileInfo"){continue}this.map._indoorMgr.removeData(e,i.key)}},getProcessedLabelZoom:function(gj){var gk=cv.baseZoomInfo[gj.zoom];if(!gk){return false}var gi=[];for(var gl=0;gl<gk.length;gl++){var gm=this.getTileKey(gj,{useZoom:gk[gl]});var e=this.tileCache.getData(gm);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){gi.push(gk[gl])}}if(gi.length){return gi}else{return false}},getSameZoomDataFromCache:function(gi){var gj=cv.baseZoomInfo[gi.zoom];for(var gk=0;gk<gj.length;gk++){var gl=this.getTileKey(gi,{useZoom:gj[gk]});if(gi.useZoom===gj[gk]){continue}var e=this.tileCache.getData(gl);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){return e}}return false},hasSameLabelData:function(gj,gi){for(var e=0;e<gi.length;e++){if(gi[e].key===gj){return true}}return false},getDataByFloorName:function(gi,gj){for(var e=0;e<gi.length;e++){if(gi[e].floorName===gj){return gi[e]}}return null},mergeIndoorLabelData:function(go,e){for(var gm in go){if(gm==="tileInfo"){continue}if(e[gm]){var gi=go[gm].floors;var gp=e[gm].floors;for(var gk=0;gk<gi.length;gk++){var gj=gi[gk];var gn=gj.floorName;var gl=this.getDataByFloorName(gp,gn);if(gl){if(gl.pois){gl.pois=gl.pois.concat(gj.pois);gj.pois=gl.pois}else{gl.pois=gj.pois}}}}}},mergeSameZoomLabelData:function(gm){var gk=gm.label;if(!gk){return}var e=gm.tileInfo;var gl=this.getSameZoomDataFromCache(e);if(!gl){return}var gj=gl.label;if(!gj){return}for(var gi=0;gi<gk.fixedLabel.length;gi++){if(!this.hasSameLabelData(gk.fixedLabel[gi].key,gj.fixedLabel)){gj.hasNewData=true;gj.fixedLabel.push(gk.fixedLabel[gi])}}for(var gi=0;gi<gk.lineLabel.length;gi++){if(!this.hasSameLabelData(gk.lineLabel[gi].key,gj.lineLabel)){gj.hasNewData=true;gj.lineLabel.push(gk.lineLabel[gi])}}for(var gi=0;gi<gk.indoorLabel.length;gi++){if(!this.hasSameLabelData(gk.indoorLabel[gi].key,gj.indoorLabel)){gj.hasNewData=true;gj.indoorLabel.push(gk.indoorLabel[gi])}}gm.label=gj;if(gl.renderData.indoorData&&gm.renderData.indoorData){this.mergeIndoorLabelData(gm.renderData.indoorData,gl.renderData.indoorData)}},processLabelData:function(gl){if(!gl.label){return}if(gl.label.status==="processing"){return}gl.label.status="processing";var gj=this;gj.updateAllIconsTextureCoords(gl);this.labelProcessor.loadIconImages(gl,function(gm){gj.updateAllIconsTextureCoords(gm)});if(this.map.config.textRenderType==="canvas"){var e=this.labelProcessor.drawLabelsOnCanvas(gl,function(go,gp){var gn=gl.tileInfo;if(!aU.customStyleInfo){gj.mergeSameZoomLabelData(gl)}if(go){if(!gl.label.textureHeights){gl.label.textureHeights=[]}gl.label.textureHeights[gn.useZoom]=go.height}if(gp){if(!gl.label.indoorTextureHeights){gl.label.indoorTextureHeights=[]}gl.label.indoorTextureHeights[gn.useZoom]=gp.height}var gm=gj._getTileTexImgKey(gn);gj._doWorkAfterLabelImageLoad(gl,go,gp,gm)});return}var gi=gl.label.textImageBitmap||gl.label.textImgStr;var gk=gl.label.indoorTextImageBitmap||gl.label.indoorTextImgStr;this.labelProcessor.loadImgByStr(gi,gk,function i(gr,gp){var go=gl.label.textureHeight;var gs=gl.label.indoorTextureHeight;gl.label.textureHeight=undefined;gl.label.indoorTextureHeight=undefined;var gn=gl.tileInfo;gj.mergeSameZoomLabelData(gl);var gq=gl.label;gq.textImgStr="";gq.indoorTextImgStr&&(gq.indoorTextImgStr="");if(!gq.textureHeights){gq.textureHeights=[]}gq.textureHeights[gn.useZoom]=go;if(!gq.indoorTextureHeights){gq.indoorTextureHeights=[]}gq.indoorTextureHeights[gn.useZoom]=gs;var gm=gj._getTileTexImgKey(gn);gj._doWorkAfterLabelImageLoad(gl,gr,gp,gm)})},_getTileTexImgKey:function(i){var gi=i.style||this.mapStyleId||"default";var e=gi+"_"+i.col+"_"+i.row+"_"+i.zoom;if(this.map.config.textRenderType==="canvas"){e+="_"+i.useZoom}return e},_doWorkAfterLabelImageLoad:function(gn,gl,gj,i){var gm=this;var gk=gn.label;gk.tileInfo=gn.tileInfo;gk.status="ready";if(gl||gj){var e=gk.tileInfo;if(gl){gl.id=i;if(!gk.textureSources){gk.textureSources=[]}gk.textureSources[e.useZoom]=gl}if(gj){gj.id=i+"_indoor";if(!gk.indoorTextureSources){gk.indoorTextureSources=[]}gk.indoorTextureSources[e.useZoom]=gj}if(gm.map._webglMapScene){var gi=gm.map._webglMapScene._painter;if(gl){gi._addToAsyncJob(gk.textureSources[e.useZoom])}}}if(gn.custom!==true){gm.tileLabels.push(gk)}if(gm.collisionTimer){return}gm.collisionTimer=setTimeout(function(){gm.dataBackCollideLabels();gm.collisionTimer=null},300)},_updateIconTextureCoords:function(gn,gi){if(!gn){return}var gm=this.map;for(var gj=0;gj<gn.length;gj++){var gl=gn[gj];if(!gl.iconPos){continue}if(gm._webglMapScene){var e=gm._webglMapScene._painter;var gk=gi+"_"+gl.iconPos.iconType;gl.iconPos.texcoord=e._iconTextureAtlasCoords[gk]||null}}},updateAllIconsTextureCoords:function(gk){if(this.map.viewAnimationTime){return}if(gk){if(gk.label){var i=gk.tileInfo.style;this._updateIconTextureCoords(gk.label.fixedLabel,i);this._updateIconTextureCoords(gk.label.indoorLabel,i)}}else{var gj=this.tileCache.getAllData();for(var gi in gj){var e=gj[gi].data;if(e.status==="ready"&&e.label){var i=e.tileInfo.style;this._updateIconTextureCoords(e.label.fixedLabel,i);this._updateIconTextureCoords(e.label.indoorLabel,i)}}}this.updateLabels();this.map.dispatchEvent(new aM("onrefresh"))},cacheDataCollideLabels:function(gi){var gk=this;var i=this.map._featureMgr;function gj(){gk.cacheLabelTimer=null;var gl;var gm=gk.map.getTilt();var gn=gk.map.getHeading()%360;if(gk.tileLabels.length===0||(gk.tileLabels.length===1&&gk.tileLabels[0].tileInfo.zoom===0)){gl=i.getLabelData();if(gl.length>0){gl=gk.labelProcessor.collisionTest(gl,-1)}}else{if(gm||gn){if(this._collisionTimer){if(!gm){clearTimeout(this._collisionTimer)}else{if(Date.now()-gk.lastCollisionTestTime>500){gk.lastCollisionTestTime=Date.now()}else{clearTimeout(this._collisionTimer)}}}this._collisionTimer=setTimeout(function(){gl=gk.labelProcessor.collisionTest(gk.tileLabels);if(gl){i.setLabelData(gl)}gk.updateLabels();gk.map.dispatchEvent(new aM("onrefresh"));gk._collisionTimer=null},60);return}else{gl=gk.labelProcessor.getCachedLabels(gk.tileLabels)}}if(gl){i.setLabelData(gl)}gk.updateLabels();gk.map.dispatchEvent(new aM("onrefresh"))}if(!gi){clearTimeout(gk.cacheLabelTimer);gj()}else{if(gk.cacheLabelTimer){return}gk.cacheLabelTimer=setTimeout(function e(){gj()},gi)}},dataBackCollideLabels:function(){var i=this;if((i.tileLabels&&i.tileLabels.length===0)){return}var e;i.labelProcessor.calcLabelsCollision(i.tileLabels);e=i.labelProcessor.getCachedLabels(i.tileLabels);if(e){i.map._featureMgr.setLabelData(e)}i.updateLabels();i.map.dispatchEvent(new aM("onrefresh"));if(eP()){this.labelProcessor._refreshSpotData()}},updateLabels:function(gk){var gl=this.map;var i=gl._featureMgr;var gi=i.getLabelData();if(gi.length>0){var gj=gl.getZoom();if(gi.labelZoom-gj<3){this.labelProcessor.updateLabels(gi);var e=this.labelProcessor.fixDataFormat(gi);i.setOverlayData(e[0],2);i.setOverlayData(e[1],3);i.setOverlayData(e[2],4)}else{i.clearLabelOverlayData()}gl.temp.isPermitSpotOver=false;this.labelProcessor.curSpotAdded=false}},loadRasterLayerData:function(gj,gn){if(gn){for(var gl=0,gk=gj.length;gl<gk;gl++){var gi=gj[gl];var go=this.getTileKey(gi);var e=this.tileCache.getData(go);if(e&&e.status==="ready"){this.map._featureMgr.setData(e,this.drawIndex,2)}}return}for(var gl=0,gk=gj.length;gl<gk;gl++){var gi=gj[gl];var go=this.getTileKey(gi);var e=this.tileCache.getData(go);if(!e){this.tileCache.setData(go,{});var gm=this;this.loadRasterTileData(gi,function(i,gp){gm.rasterTileDataCbk(i,gp)})}}},loadRasterTileData:function(i,e){var gk=i.col;var gn=i.row;var gl=i.zoom;var gj=this.getTilesUrl(new di(gk,gn),gl);if(!gj){return}var gm=this.getTileKey(i);var gi=this.loadTileImage(gj,gm,e);gi.tileInfo=i},loadTileImage:function(gj,gi,e){var i=new Image();i.crossOrigin="anonymous";i.onload=function(){e&&e(this,gi)};i.onerror=function(){e&&e(null,gi)};i.src=gj;return i},rasterTileDataCbk:function(gl,gj){if(!gl){this.tileCache.removeData(gj);return}var i=gl.tileInfo;var gi=i.col;var gr=i.row;var gq=i.zoom;var e=this.tileCache.getData(gj);if(!e){return}var gk=c6.calcLoopParam(gi,gq);var go=gk.geoOffsetX;gl.tileInfo.loopOffsetX=go;e.textureSource=gl;e.dataType=dD;e.tileInfo=i;e.renderData={vertexAll:[0,0,0,0,0,256,0,0,1,0,256,256,0,1,1,0,0,0,0,0,256,256,0,1,1,0,256,0,0,1]};e.status="ready";this.tileCache.setData(gj,e);var gm="id_"+gi+"_"+gr+"_"+gq;var gn=false;if(this.curViewTilesInfo[gm]){e.dataType=dD;e.png8=this.png8||false;this.map._featureMgr.setData(e,this.drawIndex,2);gn=true}if(gn){var gp=new aM("onrefresh");gp.source="webgllayer";this.map.dispatchEvent(gp)}},_checkTilesLoaded:function(){this.numLoading--;if(this.map.firstTileLoad===false){this.map.dispatchEvent(new aM("onfirsttilesloaded"));this.map.firstTileLoad=true}var e=this;if(this.numLoading===0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading===0){e.map.dispatchEvent(new aM("ontilesloaded"))}e._checkLoadedTimer=null},60)}},isClickableLabel:function(e){if(e.isDel){return false}if(e.zoom>9&&!e.guid){return false}if(e.zoom<=9&&!e.name&&!e.guid){return false}return true}};var bz=5;var c3=4;var fV=3;var ea=2;var gb=1;var c5=0;function t(e){this._ratio=aJ();this._iconCache={};this._map=e;this._drawingCanvasPool=[];this._drawingCanvasHeight=4096}A.extend(t.prototype,{_loadIcons:function(i,gn){var gl=0;var gk=this;var gi=this._map.config.style;for(var gm in i){gl++;var e=new Image();e.id=gm;e.crossOrigin="anonymous";e.onload=function(){gk._iconCache[this.id].loaded=true;gl--;if(gl===0){gn()}this.onload=null};e.onerror=function(){gk._iconCache[this.id]=null;gl--;if(gl===0){gn()}this.onerror=null};var gj=dX.getIconSetPath(gi)+gm+".png";e.src=gj;this._iconCache[gm]={loaded:false,image:e}}},_getEmptyDrawingCanvas:function(){for(var gi=0;gi<this._drawingCanvasPool.length;gi++){if(this._drawingCanvasPool[gi]._free===true){this._drawingCanvasPool[gi]._free=false;return this._drawingCanvasPool[gi]}}var e=this._createNewDrawingCanvas();this._drawingCanvasPool.push(e);e._free=false;return e},_createNewDrawingCanvas:function(){var e=M("canvas");e.width=512;e.height=this._drawingCanvasHeight;e._free=true;e._id=aU.getGUID();var i=e.getContext("2d");i.textBaseline="bottom";i.lineJoin="round";return e},drawLabelsOnCanvas:function(gB,gj){var gr=gB.label.fixedLabel.slice(0);var gx=gB.label.lineLabel.slice(0);var gi=gB.label.indoorLabel.slice(0);if(gr.length===0&&gx.length===0&&gi.length===0){gj();return}var gm=function(gG,i){return gG.styleId-i.styleId};gr.sort(gm);gx.sort(gm);gi.sort(gm);var gA={};var e=this._getEmptyDrawingCanvas();var gw=e.getContext("2d");gw.clearRect(0,0,e.width,e.height);var gE=0;var gs=null;var gl=0;if(gr.length>0){while(gl<gr.length&&!gr[gl].styleText[0]){gl++}if(gr[gl]&&gr[gl].styleText[0]){gs=gr[gl].styleText[0].fontSize+gr[gl].styleText[0].haloSize*2}}if(gs===null&&gi.length>0){gl=0;while(gl<gi.length&&!gi[gl].styleText[0]){gl++}if(gi[gl]&&gi[gl].styleText[0]){gs=gi[gl].styleText[0].fontSize+gi[gl].styleText[0].haloSize*2}}if(gs===null&&gx.length>0){gl=0;while(gl<gx.length&&!gx[gl].styleText[0]){gl++}if(gx[gl]&&gx[gl].styleText[0]){gs=gx[gl].styleText[0].fontSize+gx[gl].styleText[0].haloSize*2}}if(gs===null||isNaN(gs)){gj();return}var go=0;var gn=gs;var gu={};var gF=0;var gv=[];for(var gz=0;gz<gr.length;gz++){var gq=gr[gz];var gt=gq.name;var gy=gq.styleText;if(!gt||gy.length===0){continue}var gk=gq.icon;if(gq.textOnIcon&&(!this._iconCache[gk]||this._iconCache[gk].loaded===false)){gv.push(gq);gF++;if(!gu[gk]){gu[gk]=true}continue}var gC=this._drawEachText(gw,gq,gE,go,gn,gs,gA);if(!gC){continue}go=gC.curX;gn=gC.curY;gs=gC.curLineHeight;gE=gC.styleId}var gC=this._drawEachTypeOfLabels(gw,gi,gE,go,gn,gs,gA);gE=gC.curStyleId;go=gC.curX;gn=gC.curY;gs=gC.curLineHeight;var gC=this._drawEachTypeOfLabels(gw,gx,gE,go,gn,gs,gA);gE=gC.curStyleId;go=gC.curX;gn=gC.curY;gs=gC.curLineHeight;if(gF>0){var gD=this;this._loadIcons(gu,function(){gC=gD._drawEachTypeOfLabels(gw,gv,gE,go,gn,gs,gA);gE=gC.curStyleId;go=gC.curX;gn=gC.curY;gs=gC.curLineHeight;var i=gD._generateEachLabelCanvas(e,gn,gr,gx,gi,gB);gj(i[0],i[1])});return}var gp=this._generateEachLabelCanvas(e,gn,gr,gx,gi,gB);gj(gp[0],gp[1])},drawCustomLabelsOnCanvas:function(gm,gs){if(gm.length===0){gs();return}var gi=0;var e=(gm[0].style.fontSize+(gm[0].style.haloSize||0)*2)||0;var gj=e;var go=this._getEmptyDrawingCanvas();var gt=go.getContext("2d");gt.clearRect(0,0,go.width,go.height);var gp={};var gr=-1;for(var gk=0;gk<gm.length;gk++){if(!gm[gk].name){continue}var gq=this._drawEachText(gt,gm[gk],gr,gi,e,gj,gp);if(!gq){continue}gi=gq.curX;e=gq.curY;gj=gq.curLineHeight;gr=gq.styleId}var gl=e;var gn=this._copyToNewCanvas(go,gl);for(var gk=0;gk<gm.length;gk++){if(!gm[gk].name&&gm[gk].style.iconSize){this._addFixedLabelBounds(gm[gk]);continue}if(!gm[gk].textSize){continue}this._updateFixedLabelCoords(gm[gk],gl);this._addFixedLabelBounds(gm[gk])}gs(gn)},_drawEachTypeOfLabels:function(gs,gm,gq,gj,gi,gk,go){for(var gl=0;gl<gm.length;gl++){var gn=gm[gl];var gr=gn.name;var e=gn.styleText;if(!gr||e.length===0){continue}var gp=this._drawEachText(gs,gn,gq,gj,gi,gk,go);if(!gp){continue}gj=gp.curX;gi=gp.curY;gk=gp.curLineHeight;gq=gp.styleId;if(gp.curY>this._drawingCanvasHeight){return{curX:gj,curY:gi,curLineHeight:gk,curStyleId:gq}}}return{curX:gj,curY:gi,curLineHeight:gk,curStyleId:gq}},_drawIndoorTextLabelOnCanvas:function(gk){var e=this._getEmptyDrawingCanvas();var gr=e.getContext("2d");gr.clearRect(0,0,e.width,e.height);var gz=0;var gq=null;var gp=0;var gn;var gw={};var gv=[];for(var gl in gk){if(gl==="tileInfo"){continue}var gj=gk[gl];var gu=gj.defaultFloor;var go=gj.floors;for(var gt=0;gt<go.length;gt++){if(gt===gu){continue}var gx=go[gt];if(!gx.pois){continue}var gm=gx.pois;for(var gs=0;gs<gm.length;gs++){if(gq===null&&gm[gs].styleText[0]){gq=gm[gs].styleText[0].fontSize+gm[gs].styleText[0].haloSize*2;gn=gq}gv.push(gm[gs])}}}if(gq===null){return null}gv.sort(function(gA,i){return i.rank-gA.rank||gA.styleId-i.styleId});var gy=this._drawEachTypeOfLabels(gr,gv,gz,gp,gn,gq,gw);gz=gy.curStyleId;gp=gy.curX;gn=gy.curY;gq=gy.curLineHeight;var gi=this._copyToNewCanvas(e,gn);return gi},_updateIndoorLabelsCoords:function(gq,gr){for(var gp in gq){if(gp==="tileInfo"){continue}var e=gq[gp];var gl=e.defaultFloor;var gm=e.floors;for(var gn=0;gn<gm.length;gn++){if(gn===gl){continue}var gi=gm[gn];if(!gi.pois){continue}var gk=gi.pois;for(var gj=0;gj<gk.length;gj++){var go=gk[gj];if(go.name&&(!go.textSize||go.textSize.length===0)){gk.splice(gj,1);gj--;continue}this._updateFixedLabelCoords(go,gr);this._addFixedLabelBounds(go)}}}},_generateEachLabelCanvas:function(gm,gl,gn,e,gp,gi){gl=Math.min(gl,this._drawingCanvasHeight);var go=this._copyToNewCanvas(gm,gl);var gj=null;if(gi.renderData.indoorData){gj=this._drawIndoorTextLabelOnCanvas(gi.renderData.indoorData);if(gj){this._updateIndoorLabelsCoords(gi.renderData.indoorData,gj.height)}}for(var gk=0;gk<gn.length;gk++){if(!gn[gk].textSize){continue}this._updateFixedLabelCoords(gn[gk],gl);this._addFixedLabelBounds(gn[gk])}for(var gk=0;gk<gp.length;gk++){if(!gp[gk].textSize){continue}this._updateFixedLabelCoords(gp[gk],gl);this._addFixedLabelBounds(gp[gk])}for(var gk=0;gk<e.length;gk++){this._updateLineLabelCoords(e[gk],gl)}return[go,gj]},_copyToNewCanvas:function(gi,i){if(i===0){return null}var gj=M("canvas");gj.width=gi.width;gj.height=i;var e=gj.getContext("2d");e.drawImage(gi,0,0,512,i,0,0,512,i);gj._id=gi._id;gi._free=true;return gj},_drawEachText:function(gB,gn,gi,gD,gC,gK,gk){var gJ=gn.name;var gs=gn.styleText?gn.styleText[0]:gn.style;if(!gs){return null}var gv=gs.fontSize;var gO=gs.fontWeight;var g1=gs.haloSize||0;if(!gw){}if(gs.fontRgba){var g7=gs.fontRgba[3]/255;var gr=[];gr[3]=g7;for(var g6=0;g6<3;g6++){gr[g6]=gs.fontRgba[g6]}}if(gs.haloRgba){var g7=gs.haloRgba[3]/255;var gy=[];gy[3]=g7;for(var g6=0;g6<3;g6++){gy[g6]=gs.haloRgba[g6]}}var gV=gr?"rgba("+gr.join(",")+")":gs.color;var gm=gy?"rgba("+gy.join(",")+")":gs.strokeColor;var g3=gn.styleId||0;if(g1>4){g1=4}var gL=[];var gA=[];var gH=0;if(gk&&!gk[g3]){gk[g3]={}}var gu=gv+g1*2;var gM=gu;if(gn.containDescendings){gM+=4}if(g1===0){gM+=2}if(gn.textOnIcon){gM=Math.max(gM,gn.iconSize[1])}if(g3!==gi||gM>gK){gi=g3;if(gO>=10&&gO%10===0){gB.font=gO*10+" "+gv+"px sans-serif"}else{gB.font=gv+"px sans-serif"}if(gM>gK){var gI=gM-gK;gK+=gI;gC+=gI}if(g1>0){gB.lineWidth=g1*2;gB.strokeStyle=gm}gB.fillStyle=gV}if(gn.type==="line"){var gp=gJ.split("");for(var g4=0;g4<gp.length;g4++){var gX=gp[g4];var gE;var gP;if(gk[g3][gX]){var gw=gk[g3][gX];gE=gw.displaySize;gP=gw.curWordPosition}else{var gj=Math.ceil(gB.measureText(gX).width);if(gD+gj>512){gD=0;gC+=gM;gK=gM}if(gC>this._drawingCanvasHeight){return{curX:gD,curY:gC,curLineHeight:gK,styleId:g3}}var gY=gD;if(g1>0){gj+=g1;gY-=Math.round(g1/2);gB.strokeText(gX,gD,gC)}gB.fillText(gX,gD,gC);var gU=[gj,gM];gE=[Math.round(gU[0]/2),Math.round(gU[1]/2)];gP=[gY,gC-gM];gk[g3][gX]={displaySize:gE,curWordPosition:gP,totalHeight:gH};gD+=gj+2}gL.push(gE);gA.push(gP)}gH=Math.round(gL[0][1])}else{if(gk[g3][gJ]){var gw=gk[g3][gJ];gL=gw.textSize;gA=gw.labelImagePosition;gH=gw.totalHeight}else{var gx=gJ.split("\\");if(gx.length>1&&gn.textOnIcon){var g5=0;var g2=0;var g8=[];var gF=8;for(var g4=0;g4<gx.length;g4++){var gJ=gx[g4];var gt=Math.ceil(gB.measureText(gJ).width);if(gt>g5){g5=gt}g8.push(Math.round(gt/2));g2+=gM}var gq=g5+2*gF;var g0=g2+2*gF;if(gD+gq>512){gD=0;gC+=gK}gC+=g2-gM+2*gF;var gT=gD;var gG=gC-g0;var e=Math.round(gq/2);var gz=this._iconCache[gn.icon].image;this.drawStretchedIcon(gB,gz,[gT,gG],gF,g5,g2);for(var g4=0;g4<gx.length;g4++){var gJ=gx[g4];var gZ=gT+(e-g8[g4]);var gW=gG+4+(g4+1)*gM;gB.fillText(gJ,gZ,gW)}gL.push([Math.round(gq/2),Math.round(g0/2)]);gA.push([gT,gG]);gD+=gq;gK=g0;gH=Math.round(g0/2)}else{for(var g4=0;g4<gx.length;g4++){var gJ=gx[g4];var gt=Math.ceil(gB.measureText(gJ).width);var gq=gt;var gl=0;if(gn.textOnIcon){gl=10;gq+=gl*2;if(gn.styleId===519){gq=gn.iconSize[0];gl=Math.round((gq-gt)/2)}}if(gD+gq>512){gD=0;gC+=gM;gK=gM}if(gC>this._drawingCanvasHeight){return{curX:gD,curY:gC,curLineHeight:gK,styleId:g3}}var gT=gD;var gG=gC-gM;var gS=gD;var gR=gC;if(gn.containDescendings){gR-=4}if(gn.textOnIcon){var gN=false;var gz=this._iconCache[gn.icon].image;var gQ=gn.iconSize.concat([]);if(gu>gQ[1]){gQ[1]=gu;gN=true}if(gt>gQ[0]){gQ[0]=gt;gN=true}if(gn.styleId===519){gB.drawImage(gz,0,0,gQ[0],gQ[1],gT,gG,gQ[0],gQ[1])}else{if(gN){this.drawStretchedIcon(gB,gz,[gT,gG],gl,gt,gQ[1])}else{this.draw3StretchedIcon(gB,gz,[gT,gG],gl,gt,gQ[1])}}gS+=gl;if(gn.iconSize[1]>gu){gR-=(gn.iconSize[1]-gu)/2-1}gq+=1}if(g1>0){gq+=g1;gT-=Math.round(g1/2);gG+=Math.round(g1/2);if(g3===71028){gM-=2}if(g3===32){gM-=2}gB.strokeText(gJ,gS,gR)}gB.fillText(gJ,gS,gR);var go=[gq,gM];var gE=[Math.round(go[0]/2),Math.round(go[1]/2)];gL.push(gE);gA.push([gT,gG]);gH+=Math.round(gE[1]);gD+=gq}}gk[g3][gJ]={textSize:gL,labelImagePosition:gA,totalHeight:gH}}}gn.textSize=gL;gn.labelImagePosition=gA;gn.totalHeight=gH;return{curX:gD,curY:gC,curLineHeight:gK,styleId:g3}},drawStretchedIcon:function(e,gi,gj,gm,gn,i){var gl=gj[0];var gk=gj[1];e.drawImage(gi,0,0,gm,gm,gl,gk,gm,gm);e.drawImage(gi,gm,0,1,gm,gl+gm,gk,gn,gm);e.drawImage(gi,gi.width-gm,0,gm,gm,gl+gn+gm,gk,gm,gm);e.drawImage(gi,0,gm,gm,1,gl,gk+gm,gm,i);e.drawImage(gi,gm,gm,1,1,gl+gm,gk+gm,gn,i);e.drawImage(gi,gi.width-gm,gm,gm,1,gl+gn+gm,gk+gm,gm,i);e.drawImage(gi,0,gi.height-gm,gm,gm,gl,gk+i+gm,gm,gm);e.drawImage(gi,gm,gi.height-gm,1,gm,gl+gm,gk+i+gm,gn,gm);e.drawImage(gi,gi.width-gm,gi.height-gm,gm,gm,gl+gn+gm,gk+i+gm,gm,gm)},draw3StretchedIcon:function(e,i,gi,gl,gn,gm){var gk=gi[0];var gj=gi[1];e.drawImage(i,0,0,gl,i.height,gk,gj,gl,i.height);e.drawImage(i,gl,0,1,i.height,gk+gl,gj,gn,i.height);e.drawImage(i,i.width-gl,0,gl,i.height,gk+gl+gn,gj,gl,i.height)},_updateFixedLabelCoords:function(gk,gz){if(gz===0){return}var gu=[];var gG=[];var gH=0;var gx=gk.totalHeight;var gP=gk.textSize.length;var gl=gk.direction;if(typeof gl!=="number"){gl=0}for(var gI=0;gI<gP;gI++){var gA=gk.labelImagePosition[gI];var gy=gk.textSize[gI];var gw=gA[0];var gj=gA[1];var gm=gy[0];var gr=gy[1];var gt=0;var gF=0;if(typeof gk.textMargin==="number"){gF=gk.textMargin}var gs;var e;var go=0;var gv=0;if(!gk.iconPos){if(!gk.custom){gl=c3}}else{go=gk.iconPos.width;gv=gk.iconPos.height}switch(gl){case fV:var gi=gx/2-gr+gt*(gP-1)/2;gs=Math.round(-go/2-gm-gF);e=Math.round(gi-gH-gt*gI);break;case gb:var gi=gx/2-gr+gt*(gP-1)/2;gs=Math.round(go/2+gF);e=Math.round(gi-gH-gt*gI);break;case ea:var gi=gv/2+gx-gr+gt*gP;gs=Math.round(-gm/2);e=Math.round(gi-gH-gt*gI);break;case c5:var gi=-gv/2-gt-gr;gs=Math.round(-gm/2);e=Math.round(gi-gH-gt*gI);break;case c3:var gi=-gx/2-gt*(gP-1)/2;gs=Math.round(-gm/2);e=Math.round(gi-gH-gt*gI);break}gH+=gr;var gq=gs+gm;var gQ=e;var gp=gq;var gO=gQ+gr;var gn=gs;var gN=gO;gu.push(gs,e,gq,gQ,gp,gO,gs,e,gp,gO,gn,gN);var gM=gw/512;var gE=(gz-gj-gr*2)/gz;var gL=(gw+gm*2)/512;var gD=gE;var gK=gL;var gC=(gz-gj)/gz;var gJ=gM;var gB=gC;gG.push(gM,gE,gL,gD,gK,gC,gM,gE,gK,gC,gJ,gB)}if(!gk.textPos){gk.textPos={}}gk.textPos.vertex=gu;gk.textPos.texcoord=gG},_addFixedLabelBounds:function(gp){var gl=1000;var gj=1000;var gi=-1000;var e=-1000;if(gp.iconPos){var gn=gp.iconPos["vertex"];for(var go=0,gk=gn.length;go<gk;go+=2){var gt=gn[go];var gr=gn[go+1];if(gt<gl){gl=gt}if(gt>gi){gi=gt}if(gr<gj){gj=gr}if(gr>e){e=gr}}}if(gp.custom&&gp.style.iconSize&&!gp.name){var gq=gp.style.iconSize;var gs=gp.direction;switch(gs){case c3:gl=-Math.round(gq[0]/2);gj=-Math.round(gq[1]/2);gi=Math.round(gq[0]/2);e=Math.round(gq[1]/2);break;case ea:gl=-Math.round(gq[0]/2);gj=0;gi=Math.round(gq[0]/2);e=gq[1];break}}if(gp.textPos){var gm=gp.textPos["vertex"];for(var go=0,gk=gm.length;go<gk;go+=2){var gt=gm[go];var gr=gm[go+1];if(gt<gl){gl=gt}if(gt>gi){gi=gt}if(gr<gj){gj=gr}if(gr>e){e=gr}}}gp.bds=[gl,gj,gi,e]},_updateLineLabelCoords:function(gA,gq){if(gq===0){return}var gj=gA.wordsInfo;var gx=gA.wordCount;if(!gA.labelImagePosition){return}var gs=gA.labelImagePosition.slice(0);if(gA.reverse){gs.reverse()}var gJ=1000;var gG=1000;var gH=-1000;var gF=-1000;for(var gB=0;gB<gx;gB++){var gK=gs[gB];var gI=gK[0];var gy=gK[1];var gw=gA.textSize[gB];var gp=gw[0];var e=gw[1];var go=gI/512;var gv=(gq-gy-e*2)/gq;var gm=(gI+gp*2)/512;var gu=gv;var gk=gm;var gt=(gq-gy)/gq;var gi=go;var gr=gt;gj[gB].size=[gp,e];gj[gB].texcoord=[go,gv,gm,gu,gk,gt,go,gv,gk,gt,gi,gr];var gE=gj[gB].offset[0];var gD=gj[gB].offset[1];var gC=gE-gp/2;var gn=gD+e/2;var gl=gD-e/2;var gz=gE+gp/2;if(gC<gJ){gJ=gC}if(gz>gH){gH=gz}if(gl<gG){gG=gl}if(gn>gF){gF=gn}}gA.bds=[gJ,gG,gH,gF]}});var b9={0:"00000000",16:"00010000",32:"00100000",48:"00110000",64:"01000000",96:"01100000"};function bN(gi,gj,gk){var e=gi.bds;if(!e){return false}var i=gi.tracer;var gn;if(i){if(!b9[i]){gn=i.toString(2);if(gn.length<8){gn=new Array(8-gn.length+1).join("0")+gn}b9[i]=gn}gn=b9[i];var gm=cv.mapZoomStartZoomMapping[gj];return gn[gj-gm]==="1"}var gl=gi.displayRange;if(gk>=gl[0]&&gk<=gl[1]){return true}return false}function cw(i,e){this.map=i.map;this.layer=i;e=e||[];this.allLabels=[];this._spotData=[];this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000;this._useRound=false;this._mapIsMoving=false;this._onMapIdleCallback=e.onMapIdleCallback;this.map.temp.isPermitSpotOver=true;this.currentSelectedLabel=null;this.map._labelProcessor=this;this.iconCache={};this.fixedLabelData=[];this.lineLabelData=[];this.highlightLabelData=[];this._iconLoadTimer=null;this._labelTextCanvas=null;if(this.map.config.textRenderType==="canvas"){this._labelTextCanvas=this.map.tileMgr.getLabelTextCanvas()}this.bind()}A.extend(cw.prototype,{bind:function(){var gi=this.map;var i=this;gi.addEventListener("mapstatusbusy_inner",function(gj){i._useRound=false;i._mapIsMoving=true});gi.addEventListener("mapstatusidle_inner",function(gj){if(!eP()){i._useRound=true}i._mapIsMoving=false});gi.addEventListener("onspotmouseover",function(gl){if(!this.temp.isPermitSpotOver){return}if(gl.spots.length>0){var gk=gl.spots[0].userdata.uid;var gm=gl.spots[0].userdata.tilePosStr;var gj=i.getLabelByUid(gk,gm);gj&&gj.formatedData&&i._toHighlightColor(gj.formatedData)}});gi.addEventListener("onspotmouseout",function(gl){if(!this.temp.isPermitSpotOver){return}if(gl.spots.length>0){var gk=gl.spots[0].userdata.uid;var gm=gl.spots[0].userdata.tilePosStr;var gj=i.getLabelByUid(gk,gm);gj&&gj.formatedData&&i._toDefaultColor(gj.formatedData)}});gi.addEventListener("spotclick",function(gl){if(gl.spots&&gl.spots.length>0){if(gl.spots[0].userdata.zoom<10){return}var gk=gl.spots[0].userdata.uid;var gm=gl.spots[0].userdata.tilePosStr;if(i.currentSelectedLabel&&(i.currentSelectedLabel.uid!==gk||i.currentSelectedLabel.tilePosStr!==gm)){i._recoverNormalState()}var gj=i.getLabelByUid(gk,gm);gj&&i._changeBaseMapState(gj)}else{i._recoverNormalState()}});gi.on("spot_status_reset",function(){i._recoverNormalState()});gi.on("spot_highlight",function(gk){var gj=i.getLabelByUid(gk.uid,gk.tilePosStr);gj&&gj.formatedData&&i._toHighlightColor(gj.formatedData)});gi.addEventListener("mousemove",function(gj){if(i.curSpotAdded){return}if(this.currentOperation!==c0.idle||i._mapIsMoving===true){return}i._refreshSpotData();this.temp.isPermitSpotOver=true;i.curSpotAdded=true});if(eP()){function e(){i._refreshSpotData()}gi.addEventListener("mapstatusidle_inner",e)}gi.on("style_loaded",function(){if(i.map.config.textRenderType==="canvas"&&!i._labelTextCanvas){i._labelTextCanvas=i.map.tileMgr.getLabelTextCanvas()}})},getLabelByUid:function(gm,gn){var e=this.map._featureMgr.getResult().tileLabels;for(var gl=0;gl<e.length;gl++){var gi=e[gl].fixedLabel;for(var gk=0;gk<gi.length;gk++){if(e[gl].fixedLabel[gk].guid===gm&&e[gl].fixedLabel[gk].tilePosStr===gn){return e[gl].fixedLabel[gk]}}var gj=e[gl].indoorLabel;for(var gk=0;gk<gj.length;gk++){if(e[gl].indoorLabel[gk].guid===gm&&e[gl].indoorLabel[gk].tilePosStr===gn){return e[gl].indoorLabel[gk]}}}return null},getTileByLabelUid:function(gm){var e=this.map._featureMgr.getResult().tileLabels;for(var gl=0;gl<e.length;gl++){var gi=e[gl].fixedLabel;for(var gk=0;gk<gi.length;gk++){if(e[gl].fixedLabel[gk].guid===gm){return e[gl]}}var gj=e[gl].indoorLabel;for(var gk=0;gk<gj.length;gk++){if(e[gl].indoorLabel[gk].guid===gm){return e[gl]}}}return null},_toHighlightColor:function(gi){if(gi.tempRank&&gi.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4]||[];var gk=false;for(var gj=0;gj<e.length;gj++){if(e[gj]===gi||(e[gj].guid===gi.guid&&e[gj].tilePosStr===gi.tilePosStr&&e[gj].zoom===gi.zoom)){gk=true;break}}if(gk){return}e.push(gi);this.map._featureMgr.setOverlayData(e,4);this.map.dispatchEvent(new aM("onrefresh"))},_toDefaultColor:function(gi){if(gi.tempRank&&gi.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4]||[];for(var gj=0;gj<e.length;gj++){if(gi===e[gj]||(gi.guid===e[gj].guid&&gi.tilePosStr===e[gj].tilePosStr&&gi.zoom===e[gj].zoom)){e.splice(gj,1);break}}this.map._featureMgr.setOverlayData(e,4);this.map.dispatchEvent(new aM("onrefresh"))},_changeBaseMapState:function(i){var gk=i.guid;var go=i.formatedData.guidExt;var gq={guid:gk,tilePosStr:i.tilePosStr,guidExt:go};this._strategyInfo=gq;this.currentSelectedLabel=i;var gj=this.map._featureMgr;var e=gj.getLabelData();e=this.collisionTest(e);this.updateLabels(e);var gr=this.fixDataFormat(e);gj.setOverlayData(gr[0],2);gj.setOverlayData(gr[1],3);gj.setOverlayData(gr[2],4);var gi=this.getTileByLabelUid(gk);this.currentSelectedLabel.tileInfo=gi.tileInfo;var gp=gi.tileInfo.zoom;var gn=this.layer.tileCache.getAllData();for(var gm in gn){var gl=gn[gm].data;if(!gl.label){continue}this.clearCollisionCache(gl.label)}this.map.dispatchEvent(new aM("onrefresh"))},_recoverNormalState:function(){this._strategyInfo=null;var gn=false;var gl=this.map._featureMgr.getLabelData();if(this.currentSelectedLabel){var gi=this.currentSelectedLabel.guid;this.clearCollisionCache(this.getTileByLabelUid(gi));var gk=this.layer.tileCache.getAllData();for(var gj in gk){var gm=gk[gj].data;if(!gm.label){continue}this.clearCollisionCache(gm.label)}this.currentSelectedLabel.tempRank=null;this.currentSelectedLabel=null;gn=true}gl=this.collisionTest(gl);this.updateLabels(gl);var e=this.fixDataFormat(gl);var i=this.map._featureMgr;i.setOverlayData(e[0],2);i.setOverlayData(e[1],3);i.setOverlayData([],4);this.map.dispatchEvent(new aM("onrefresh"));if(gn){this.curSpotAdded=false;this._refreshSpotData()}},loadIconImages:function(gk,gv){var gn=gk.label;var gl=gk.tileInfo.style;var gi=gn.fixedLabel;var gs=gn.indoorLabel;var gw=gi.length+gs.length;var gp=this;var gj=0;var gu=200;for(var gm=0;gm<gw;gm++){var go;if(gm<gi.length){go=gi[gm]}else{go=gs[gm-gi.length]}if(!go.iconPos){continue}var gr=go.iconPos.iconType;var gt=gl+"_"+gr;gj++;if(this.iconCache[gt]){if(this.iconCache[gt].loaded){gv(gk)}continue}var gq=new Image();gq.id=gt;gq.crossOrigin="anonymous";gq.onload=function(){gp.iconCache[this.id].loaded=true;gp._addToIconTexture(this);if(gp._iconLoadTimer===null){gp._iconLoadTimer=setTimeout(function(){gv();gp._iconLoadTimer=null},gu)}this.onload=null};gq.onerror=function(){if(!gp._iconLoadTimer){gp._iconLoadTimer=setTimeout(function(){gv();gp._iconLoadTimer=null},gu)}gp.iconCache[this.id]=null;this.onerror=null};var e=dX.getIconSetPath(this.map.config.style)+gr+".png";gq.src=e;this.iconCache[gt]={loaded:false,image:gq}}return gj},_addToIconTexture:function(gl){if(!this.map._webglMapScene){return}var gn=this.map._webglMapScene._painter;var e=gn._iconTextureAtlas.addTexture(gl);gn._iconTextureAtlasOffset[gl.id]=e;var gq=0*gl.width/1024+e.width;var gk=0*gl.height/1024+e.height;var gp=gl.width/1024+e.width;var gj=gk;var go=gp;var gi=gl.height/1024+e.height;var gm=gq;var i=gi;gn._iconTextureAtlasCoords[gl.id]=[gq,gk,gp,gj,go,gi,gq,gk,go,gi,gm,i]},loadImgByStr:function(gj,gk,gl){if(!gj&&!gk){gl&&gl(null,null);return}if(typeof gj==="object"&&typeof gk==="object"){gl(gj,gk);return}var i=0;var gi=null;var e=null;if(gj){i++;gi=new Image();gi.onload=function(){i--;if(i===0){gl&&gl(this,e)}this.onload=null};gi.src=gj}if(gk){i++;e=new Image();e.onload=function(){i--;if(i===0){gl&&gl(gi,this)}this.onload=null};e.src=gk}},collisionTest:function(gq,g3,gI){if(this.map.viewAnimationTime){return[]}if(!gq){return[]}var gA=this.map;var gP=gA.getHeading();gP=this.calcLoopHeading(gP);var gY=gA.height;var gU=this.allLabels;gU.length=0;gq.sort(function(g5,i){var g7=g5.tileInfo;var g6=i.tileInfo;if(g7.col*g7.row<g6.col*g6.row){return -1}else{return 1}});var gr=gq.labelZoom;var gB=gA.getTilt();var gt=gA.getZoom();var gT;if(gI){gT=gI}else{gT=this.getZoomStep()}for(var g1=0,gZ=gq.length;g1<gZ;g1++){var gE=gq[g1];var go=gE.tileInfo;var gl=go.zoom;var gS=go.loopOffsetX/Math.pow(2,18-gl);if(!gP&&!gB){if(gE.unnecessaryCollisionTest&&gE.unnecessaryCollisionTest[gI]){continue}}var gL=gE.fixedLabel||[];for(var g0=0,gG=gL.length;g0<gG;g0++){var gm=gL[g0];gm.zoom=gl;if(g3===-1&&gm.isDel){continue}if(!bN(gm,go.useZoom,gt)){gm.isDel=true;continue}this.calcCollisionBounds(gm,gT,gS,gY);gU.push(gm)}var gK=gE.indoorLabel||[];for(var g0=0,gG=gK.length;g0<gG;g0++){var gm=gK[g0];gm.zoom=gl;if(g3===-1&&gm.isDel){continue}if(!bN(gm,go.useZoom)){gm.isDel=true;continue}this.calcCollisionBounds(gm,gT,gS,gY);gU.push(gm)}var gn=gE.lineLabel||[];for(var g0=0,gG=gn.length;g0<gG;g0++){var gm=gn[g0];if(g3===-1&&gm.isDel){continue}if(!bN(gm,go.useZoom)){gm.isDel=true;continue}var g4=gm.pt;var gH=gA.pointToPixelIn(g4,{zoom:gT,useRound:this._useRound});var gF=gH.x+gS;var gD=gY-gH.y;var gJ=gm.bds;var gX=gJ[0];var gV=gJ[1];var gy=gJ[2];var gx=gJ[3];var gQ=gX;var gO=gV;var gw=gy;var gv=gx;if((gP>=0&&gP<45)||(gP>=315&&gP<360)){gQ=gX;gO=gV;gw=gy;gv=gx}else{if(gP>=45&&gP<135){gQ=gV;gO=-gy;gw=gx;gv=-gX}else{if(gP>=135&&gP<225){gQ=-gy;gO=-gx;gw=-gX;gv=-gV}else{if(gP>=225&&gP<315){gQ=-gx;gO=gX;gw=-gV;gv=gy}}}}gm._tempBds=[gF+gQ,gD+gO,gF+gw,gD+gv];var gp=gA.pixelToPointIn(new di(gm._tempBds[0],gH.y+gO),{zoom:gT});var gj=gA.pixelToPointIn(new di(gm._tempBds[2],gH.y+gv),{zoom:gT});gm._mcBds=[gp,gj];gU.push(gm)}}var gR=this._strategyInfo;if(gR){var gu=gR.guid;var gC=gR.guidExt;var gi=false;for(var g1=0,gZ=gU.length;g1<gZ;g1++){var gW=gU[g1];delete gW.tempRank;if(!this.layer.isClickableLabel(gW)||(gC===1&&!gW.guidExt)){continue}if(gu===gW.guid&&gR.tilePosStr===gW.tilePosStr){gW.tempRank=this.RANK5;gi=true}}if(!gi&&this.currentSelectedLabel){this.currentSelectedLabel.tempRank=this.RANK5;var go=this.currentSelectedLabel.tileInfo;var gl=go.zoom;var gS=go.loopOffsetX/Math.pow(2,18-gl);this.calcCollisionBounds(this.currentSelectedLabel,gT,gS,gY);gU.push(this.currentSelectedLabel)}}else{for(var g1=0,gZ=gU.length;g1<gZ;g1++){var gW=gU[g1];if(gW.type==="line"||!gW.iconPos){continue}delete gW.tempRank}}gU.sort(function(g6,g5){var g7=g6.tempRank?g6.tempRank:g6.rank;var i=g5.tempRank?g5.tempRank:g5.rank;return i-g7||g6.startZoom-g5.startZoom||g5.pt.lng-g6.pt.lng||g5.pt.lat-g6.pt.lat});var gk=0;if(gB>0){gk=6}var gt=gA.getZoom();if(gt>=8&&gt<9){gt<8.5?(gk=6):(gk=3)}var e=2;if(gt<6&&gt>=5){e=-1}for(var g1=0,gZ=gU.length;g1<gZ;g1++){var gN=gU[g1];var gs=gN._tempBds;gN.isDel=false;gN._intersectIdx=[];for(g0=g1+1;g0<gZ;g0++){var gz=gU[g0];var g2=gz._tempBds;if(!(gs[2]+gk+e<g2[0]-gk||gs[0]-gk>g2[2]+gk+e||gs[3]+gk+e<g2[1]-gk||gs[1]-gk>g2[3]+gk+e)){gN._intersectIdx.push(g0)}}}for(var g1=0,gZ=gU.length;g1<gZ;g1++){var gW=gU[g1];if(gW.isDel===false){var gM=gW._intersectIdx;for(var g0=0,gG=gM.length;g0<gG;g0++){gU[gM[g0]].isDel=true}}}return gq},calcCollisionBounds:function(gp,gn,i,go){var gl=gp.pt;var gj=this.map;var gk=gj.pointToPixelIn(gl,{zoom:gn,useRound:this._useRound});var gi=gk.x+i;var gr=go-gk.y;var e=gp.bds;gp._tempBds=[gi+e[0],gr+e[1],gi+e[2],gr+e[3]];var gm=gj.pixelToPointIn(new di(gp._tempBds[0],gk.y+e[1]),{zoom:gn});var gq=gj.pixelToPointIn(new di(gp._tempBds[2],gk.y+e[3]),{zoom:gn});gp._mcBds=[gm,gq]},getZoomStep:function(){var gi=this.map.getZoom();var e=Math.floor(gi);var i=gi-e>=0.5?e+0.5:e;return i},clearCollisionCache:function(e){if(!e){return}e.cacheState=null;e.unnecessaryCollisionTest=null},getCachedLabels:function(e){e=e||[];var gi=this.getZoomStep();var gk=[];var gm=false;for(var gj=0;gj<e.length;gj++){var gl=e[gj];if(!gl.cacheState||!gl.cacheState[gi]){gm=true;break}if(gl.hasNewData){gm=true;break}}if(gm){this.calcLabelsCollision(e)}return e},calcLabelsCollision:function(gi){var gk=this.getZoomStep();var gl={};var go;var gj;gi=this.collisionTest(gi,undefined,gk);bd.addLabelIntoAreaSpots(gi);for(var gn=0;gn<gi.length;gn++){go=gi[gn];gj=go.tileInfo;var gs=gj.col+","+gj.row;gl[gs]=1}var e={};for(var gn=0;gn<gi.length;gn++){go=gi[gn];if(!go.cacheState){go.cacheState={}}gj=go.tileInfo;var gr=gj.col;var gp=gj.row;gs=gr+","+gp;if(go.cacheState[gk]==="stable"){e[gs]=1;if(!go.hasNewData){continue}}for(var gm=0;gm<go.fixedLabel.length;gm++){var gq=go.fixedLabel[gm];if(!gq.cachedIsDel){gq.cachedIsDel={}}gq.cachedIsDel[gk]=gq.isDel}for(var gm=0;gm<go.indoorLabel.length;gm++){var gq=go.indoorLabel[gm];if(!gq.cachedIsDel){gq.cachedIsDel={}}gq.cachedIsDel[gk]=gq.isDel}for(var gm=0;gm<go.lineLabel.length;gm++){var gq=go.lineLabel[gm];if(!gq.cachedIsDel){gq.cachedIsDel={}}gq.cachedIsDel[gk]=gq.isDel}if(gl[(gr-1)+","+(gp-1)]&&gl[(gr-1)+","+gp]&&gl[(gr-1)+","+(gp+1)]&&gl[gr+","+(gp-1)]&&gl[gr+","+(gp+1)]&&gl[(gr+1)+","+(gp-1)]&&gl[(gr+1)+","+gp]&&gl[(gr+1)+","+(gp+1)]){go.cacheState[gk]="stable";e[gs]=1}else{if(!go.cacheState[gk]){go.cacheState[gk]="unstable"}}}for(var gn=0;gn<gi.length;gn++){var go=gi[gn];gj=go.tileInfo;var gs=gj.col+","+gj.row;var gr=+gj.col;var gp=+gj.row;if(e[(gr-1)+","+(gp-1)]&&e[(gr-1)+","+gp]&&e[(gr-1)+","+(gp+1)]&&e[gr+","+(gp-1)]&&e[gr+","+(gp+1)]&&e[(gr+1)+","+(gp-1)]&&e[(gr+1)+","+gp]&&e[(gr+1)+","+(gp+1)]){if(!go.unnecessaryCollisionTest){go.unnecessaryCollisionTest={}}go.unnecessaryCollisionTest[gk]=1}}gi.hasNewData=false},updateLabels:function(gj){var e=this.map;var gp=e.getZoom();var gr=e.getHeading();gr=this.calcLoopHeading(gr);var gq=e.getTilt();var gk=this.getZoomStep();for(var go=0,gl=gj.length;go<gl;go++){var gn=gj[go];var gi=gn.tileInfo;var gm=gi.loopOffsetX||0;this.updateFixedLabel(gn.fixedLabel,gq,gr,gn,gk,gp,gm);this.updateFixedLabel(gn.indoorLabel,gq,gr,gn,gk,gp,0);this.updateLineLabel(gn.lineLabel,gq,gr,gn,gk)}},updateFixedLabel:function(go,gq,i,gs,gk,e,gj){if(go.length===1){}for(var gt=0,gl=go.length;gt<gl;gt++){var gp=go[gt];if(!gp.cachedIsDel){continue}if(!gq&&!i&&gs.cacheState&&gs.cacheState[gk]){gp.isDel=gp.cachedIsDel[gk];if(typeof gp.isDel==="undefined"){gp.isDel=gp.cachedIsDel[gk]=true}}if(gp.startScale>e){gp.isDel=true}if(gp.isDel){continue}var gv=gp.pt;var gi=gp.iconPos;if(gi&&gi.texcoord){if(!gi.rtVertex){gi.rtVertex=[];var gx=gi.vertex;var gm=ao(gv.lng);var gu=ao(gv.lat);gi.rtVertex=[gm[0],gu[0],gm[1],gu[1],0,gx[0],gx[1],0,0,gi.texcoord[0],gi.texcoord[1],gm[0],gu[0],gm[1],gu[1],0,gx[2],gx[3],0,0,gi.texcoord[2],gi.texcoord[3],gm[0],gu[0],gm[1],gu[1],0,gx[4],gx[5],0,0,gi.texcoord[4],gi.texcoord[5],gm[0],gu[0],gm[1],gu[1],0,gx[6],gx[7],0,0,gi.texcoord[6],gi.texcoord[7],gm[0],gu[0],gm[1],gu[1],0,gx[8],gx[9],0,0,gi.texcoord[8],gi.texcoord[9],gm[0],gu[0],gm[1],gu[1],0,gx[10],gx[11],0,0,gi.texcoord[10],gi.texcoord[11]]}}var gw=gp.textPos;if(gw){if(!gw.rtVertex){gw.rtVertex=[];var gx=gw.vertex;var gn=gw.rtVertex;var gm=ao(gv.lng);var gu=ao(gv.lat);var gz=ao(gj);for(var gr=0,gy=gx.length;gr<gy;gr+=12){gn.push(gm[0],gu[0],gm[1],gu[1],0,gx[gr],gx[gr+1],gz[0],gz[1],gw.texcoord[0],gw.texcoord[1]);gn.push(gm[0],gu[0],gm[1],gu[1],0,gx[gr+2],gx[gr+3],gz[0],gz[1],gw.texcoord[2],gw.texcoord[3]);gn.push(gm[0],gu[0],gm[1],gu[1],0,gx[gr+4],gx[gr+5],gz[0],gz[1],gw.texcoord[4],gw.texcoord[5]);gn.push(gm[0],gu[0],gm[1],gu[1],0,gx[gr+6],gx[gr+7],gz[0],gz[1],gw.texcoord[6],gw.texcoord[7]);gn.push(gm[0],gu[0],gm[1],gu[1],0,gx[gr+8],gx[gr+9],gz[0],gz[1],gw.texcoord[8],gw.texcoord[9]);gn.push(gm[0],gu[0],gm[1],gu[1],0,gx[gr+10],gx[gr+11],gz[0],gz[1],gw.texcoord[10],gw.texcoord[11])}}}}},updateLineLabel:function(go,gS,gI,gD,gE){go=go||[];var gy=this.map;var gr=gy.getZoomUnits();for(var gR=0,gP=go.length;gR<gP;gR++){var gn=go[gR];if(!gn.cachedIsDel){continue}if(!gS&&!gI&&gD.cacheState&&gD.cacheState[gE]){gn.isDel=gn.cachedIsDel[gE];if(typeof gn.isDel==="undefined"){gn.isDel=gn.cachedIsDel[gE]=true}}if(gn.isDel){continue}if(!gn.styleText||gn.styleText.length===0){continue}var gp=gn.mcInTile;var gL=gp.x;var gJ=gp.y;var gC=gn.wordsInfo;var gA=gn.labelAngle;var gw=false;var gK=0;if(gI!==0){var gx=gC[0].angle;var gO=this.calcLoopHeading(gx-gI);var gu=this.calcLoopHeading(gA-gI);if(gO>45&&gO<315){if(gO>45&&gO<=135){gK=270}else{if(gO>135&&gO<=225){gK=180}else{if(gO>225&&gO<315){gK=90}}}if(gA>225&&gA<=315&&gK<=180){gw=true}else{if((gA>=0&&gA<=45||gA>=315&&gA<360)&&gK>=180){gw=true}}}}for(var gQ=0,gs=gC.length;gQ<gs;gQ++){var gN=gC[gQ];var gv=gN.calcInfo;var gH=gN.offset[0];var gF=gN.offset[1];if(!gN.size){continue}var e=gN.size[0];var gi=gN.size[1];var gt=gN.angle;if(!gv){gv={}}if(gI!==gv.mapHeading||gr!==gv.zoomUnits){gv.mapHeading=gI;gv.zoomUnits=gr;if(gw){var gz=gC[gs-1-gQ];gH=gz.offset[0];gF=gz.offset[1];gt=gz.angle}var gk=gL+gH*gr;var gj=gJ+gF*gr;gv.rotationCenter={lng:gk,lat:gj};gv.calcHeading=gK;gv.angle=gt;gv.offsetX=gH;gv.offsetY=gF;gN.calcInfo=gv}if(!gN.rtVertex){gN.rtVertex=[]}gN.rtVertex.length=0;var gB=gv.calcHeading+gv.angle;var gl=gv.rotationCenter;gH=gv.offsetX;gF=gv.offsetY;var gm=Math.round(gH-e/2);var gM=Math.round(gH+e/2);var gG=Math.round(gF+gi/2);var gq=Math.round(gF-gi/2);gN.rtVertex.push(gL,gJ,gN.z,gm,gq,gl.lng,gl.lat,gB,gN.texcoord[0],gN.texcoord[1],gL,gJ,gN.z,gM,gq,gl.lng,gl.lat,gB,gN.texcoord[2],gN.texcoord[3],gL,gJ,gN.z,gM,gG,gl.lng,gl.lat,gB,gN.texcoord[4],gN.texcoord[5],gL,gJ,gN.z,gm,gq,gl.lng,gl.lat,gB,gN.texcoord[6],gN.texcoord[7],gL,gJ,gN.z,gM,gG,gl.lng,gl.lat,gB,gN.texcoord[8],gN.texcoord[9],gL,gJ,gN.z,gm,gG,gl.lng,gl.lat,gB,gN.texcoord[10],gN.texcoord[11])}}},calcLoopHeading:function(e){while(e>=360){e-=360}while(e<0){e+=360}return e},fixDataFormat:function(gr){var gj=this.fixedLabelData;var e=this.lineLabelData;var gi=this.highlightLabelData;var gy=0;var gn=0;var gw=0;var gx;if(this.currentSelectedLabel){var gm=this.getLabelByUid(this.currentSelectedLabel.guid,this.currentSelectedLabel.tilePosStr);if(!gm||gm.isDel){gj[gy]=this.currentSelectedLabel.formatedData;gy++;gi[gw]=this.currentSelectedLabel.formatedData;gw++}}for(var gv=0;gv<gr.length;gv++){var gp=gr[gv];var go=gp.fixedLabel;var gk=gp.indoorLabel;var gu=gp.lineLabel;gx=this.fixFixedLabelDataFormat(go,gp,gj,gy,gi,gw);gy=gx[0];gw=gx[1];gx=this.fixFixedLabelDataFormat(gk,gp,gj,gy,gi,gw,true);gy=gx[0];gw=gx[1];e[gn]={tileInfo:gp.tileInfo,lineLabels:[]};for(var gt=0;gt<gu.length;gt++){if(gu[gt].isDel){continue}var gq=gu[gt].wordsInfo;if(gq){for(var gs=0;gs<gq.length;gs++){if(!gq[gs].rtVertex){continue}var gl=gq[gs].formatedData;if(!gl){gl={textureSource:gp.textureSources[gu[gt].processedInZoom],textureHeight:gp.textureHeights[gu[gt].processedInZoom],renderData:{vertex:gq[gs].rtVertex,textureCoord:gq[gs].texcoord}};gq[gs].formatedData=gl}e[gn].lineLabels.push(gl)}}}gn++}gj.length=gy;e.length=gn;gi.length=gw;return[e,gj,gi]},fixFixedLabelDataFormat:function(gm,gp,gq,gn,gk,e,go){for(var i=0;i<gm.length;i++){if(gm[i].isDel){continue}var gl=gm[i].textPos;var gj=gm[i].iconPos;var gi=null;if(gl&&gl.rtVertex){if(!gm[i].formatedData){gi={guid:gm[i].guid,guidExt:gm[i].guidExt,tilePosStr:gm[i].tilePosStr,zoom:gm[i].zoom,tempRank:gm[i].tempRank,textureSource:gp.textureSources[gm[i].processedInZoom],textureHeight:gp.textureHeights[gm[i].processedInZoom],renderData:{vertex:gl.rtVertex,textureCoord:gl.texcoord}};if(go&&gm[i].onDefaultFloor===false){gi.textureSource=gp.indoorTextureSources[gm[i].processedInZoom];gi.textureHeight=gp.indoorTextureHeights[gm[i].processedInZoom]}gm[i].formatedData=gi}else{gi=gm[i].formatedData;gi.tempRank=gm[i].tempRank}if(this.currentSelectedLabel&&gi.guid===this.currentSelectedLabel.guid&&gi.tilePosStr===this.currentSelectedLabel.tilePosStr){gk[e]=gi;e++}}if(gj&&gj.rtVertex){if(gi){if(!gi.iconRenderData){gi.iconRenderData={vertex:gj.rtVertex,textureCoord:gj.texcoord}}}else{gi={guid:gm[i].guid,guidExt:gm[i].guidExt,zoom:gm[i].zoom,tempRank:gm[i].tempRank,iconRenderData:{vertex:gj.rtVertex,textureCoord:gj.texcoord}};gm[i].formatedData=gi}}gq[gn]=gi;gn++}return[gn,e]},_refreshSpotData:function(){this._spotData.length=0;var go=this.map;var gm=Math.floor(go.getZoom());var gi=this.map._featureMgr.getLabelData();if(gi){for(var gk=0,gj=gi.length;gk<gj;gk++){this._addFixedSpotData(gi[gk].fixedLabel,gm);this._addFixedSpotData(gi[gk].indoorLabel,gm)}}var gp=this.currentSelectedLabel;if(gp&&!this.getTileByLabelUid(gp.guid,gp.tilePosStr)){var gl=this._getSpotDataFromLabel(this.currentSelectedLabel);if(gl){this._spotData.push(gl)}}var gn=new aM("onspotsdataready");gn.spots=this._spotData;go._spotDataOnCanvas=this._spotData;go.dispatchEvent(gn)},_addFixedSpotData:function(gk,gj){for(var e=0;e<gk.length;e++){var gi=gk[e];if(!this.layer.isClickableLabel(gi)||(gi.guidExt===1&&gi.startScale>gj)){continue}var i=gk[e].spot||this._getSpotDataFromLabel(gk[e]);if(i){this._spotData.push(i)}}},_getSpotDataFromLabel:function(gi){var gl=this.map;if(!gi.bds){return null}var e=gi.bds.slice(0);var gj=null;if(gi.iconPos){gj=new fX(gi.pt.lng,gi.pt.lat)}var i=gi.name?gi.name.replace("\\\\","<br>"):"";if(gi.iconPos&&gi.iconPos.iconType.indexOf("ditie")>-1&&gl.getZoom()>14){i=""}var gk={n:i,pt:new fX(gi.pt.lng,gi.pt.lat),userdata:{iconPoint:gj,uid:gi.guid,name:i,mapPoi:true,type:gi.iconPos?gi.iconPos.iconType:"",rank:gi.rank,zoom:gi.zoom,tilePosStr:gi.tilePosStr},bd:e,tag:"MAP_SPOT_INFO"};gi.spot=gk;return gk},drawLabelsOnCanvas:function(i,e){if(this._labelTextCanvas){this._labelTextCanvas.drawLabelsOnCanvas(i,e)}}});function eG(e){this._map=e;this.virtualTile={custom:true,label:{fixedLabel:[],indoorLabel:[],lineLabel:[],textureHeights:[],status:"ready"},tileInfo:{col:0,row:0,zoom:0,useZoom:0,loopOffsetX:0},status:"ready"};this.virtualTile.label.tileInfo=this.virtualTile.tileInfo;this.init()}eG.prototype.init=function(){var gi=this._map;var i=this;function e(){i.updateLabels()}gi.addEventListener("add_tile_labels",e);gi.addEventListener("onremove_tile_labels",e);gi.addEventListener("onclear_labels",e)};eG.prototype.updateLabels=function(){var i=this._map.tileMgr.getLabelTextCanvas();var gi=this._map;var e=this;i.drawCustomLabelsOnCanvas(gi._customTileLabels,function(gk){var gj=e.virtualTile;if(gk){gj.label.textureHeights[0]=[gk.height]}gj.label.fixedLabel=gi._customTileLabels;var gl=new aM("oncustom_labels_ready");gl.virtualTile=gj;gl.labelCanvas=gk;gl.imgKey=aU.getGUID("custom_labels_");gi.dispatchEvent(gl)})};aU.register(function(e){e._customLabelMgr=new eG(e)});function dI(i){var gj=null;try{if(cF.inMapHost){gj=new Worker(i);gj.onerror=function(e){e.preventDefault();gj=r(i)}}else{gj=r(i)}}catch(gi){gj=r(i)}return gj}function r(gl){var go=null;try{var gi;try{gi=new Blob(['importScripts("'+gl+'");'],{type:"application/javascript"})}catch(gm){var gk=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();gk.append('importScripts("'+gl+'");');gi=gk.getBlob("application/javascript")}var gj=window.URL||window.webkitURL;var i=gj.createObjectURL(gi);go=new Worker(i)}catch(gn){}return go}function eT(e){this.init(e)}var aO={init:function(gi){var i=this;this.map=gi;this.arrPendingData=[];var e=navigator.hardwareConcurrency||4;if(eP()&&e>2){e=2}this.arrWorker=[];this.ratio=aJ();this.wordSpaceRatio=this.ratio;if(this.ratio>1){this.textSizeRatio=2}else{this.textSizeRatio=1}cg.canUseWebAssembly(function(gj){var gm;if(gj){gm="https://api.map.baidu.com/res/webgl/10/worker_wasm_qnrvmk.js"}else{gm="https://api.map.baidu.com/res/webgl/10/worker_asm_3t3wpd.js"}for(var gl=0;gl<e;gl++){var go=dI(gm);go.onmessage=function gk(gq){if(gq.data){this._cbk&&this._cbk(gq.data,this._parsingTileKey)}else{this._cbk&&this._cbk(null,this._parsingTileKey)}this._isBusy=false;this._cbk=null;this._parsingTileInfo=null;this._parsingTileKey=null;if(i.arrPendingData.length>0){var gs=i.arrPendingData.shift();var gp=gs.cbk;i.loadTileData(gs.url,gs.tileInfo,gs.tileKey,gp)}var gr=new aM("onrefresh");gr.source="workermgr";gi.fire(gr)};i.arrWorker.push(go)}if(i.arrPendingData.length>0){for(var gl=0;gl<Math.min(i.arrPendingData.length,e);gl++){var gn=i.arrPendingData.shift();i.loadTileData(gn.url,gn.tileInfo,gn.tileKey,gn.cbk)}}});gi.on("onstyle_loaded",function(){for(var gk=0,gj=i.arrWorker.length;gk<gj;gk++){i.arrWorker[gk].isSendFS=false}if(typeof this.config.style!=="string"){eT.stringifiedCustomStyleInfo=null;eT.stringifiedCustomStyleInfoZoom=[]}});gi.on("onstylezoomupdate",function(){for(var gk=0,gj=i.arrWorker.length;gk<gj;gk++){i.arrWorker[gk].isSendFS=false}if(typeof this.config.style!=="string"){eT.stringifiedCustomStyleInfo=null;eT.stringifiedCustomStyleInfoZoom=[]}})},getIdleWorker:function(){for(var gi=0,e=this.arrWorker.length;gi<e;gi++){var gj=this.arrWorker[gi];if(!gj._isBusy){gj._isBusy=true;return gj}}return null},releasePendingData:function(gi){var gj=[];var gm=this.arrPendingData;for(var gl=gm.length-1;gl>=0;gl--){var gn=gm[gl];var e=gn.tileInfo;if(gi.tileTypeName!==e.tileTypeName){continue}var gk="id_"+e.col+"_"+e.row+"_"+e.zoom;if(!gi[gk]){gm.splice(gl,1);gj.push(e)}}return gj},loadTileData:function(e,gi,gp,go){var gj=this.getIdleWorker();if(gj){gj._cbk=go;gj._parsingTileInfo=gi;gj._parsingTileKey=gp;var i={action:"loadTileData",url:e,tileInfo:gi,tileKey:gp};var gn=this.map.getMapStyleId();var gm=!!(gn.indexOf("custom")===0);var gl=gn;if(gm){gl="Custom"}if(!gj.isSendFS){if(!eT["stringifiedFeatureStyle"+gn]&&aU["FeatureStyle"+gn]){eT["stringifiedFeatureStyle"+gn]=JSON.stringify(aU["FeatureStyle"+gn])}if(!eT["stringifiedIconSetInfo"+gl]){eT["stringifiedIconSetInfo"+gl]=JSON.stringify(aU["iconSetInfo"+gl])}if(!eT.stringifiedIndoorStyle){eT.stringifiedIndoorStyle=JSON.stringify(aU.indoorStyle)}if(gm&&aU.customStyleInfo){if(!eT.stringifiedCustomStyleInfo){eT.stringifiedCustomStyleInfo=JSON.stringify(aU.customStyleInfo)}}if(eT["stringifiedFeatureStyle"+gn]){i.featureStyle=eT["stringifiedFeatureStyle"+gn]}i.iconSetInfo=eT["stringifiedIconSetInfo"+gl];i.indoorStyle=eT.stringifiedIndoorStyle;if(gm&&eT.stringifiedCustomStyleInfo){i.customMapStyle=eT.stringifiedCustomStyleInfo}i.iconInfo={wordSpaceRatio:this.wordSpaceRatio,textSizeRatio:this.textSizeRatio};i.mapStyleId=gn;gj.isSendFS=true}gj.postMessage(i)}else{var gk={url:e,tileInfo:gi,tileKey:gp,cbk:go};this.arrPendingData.push(gk)}}};A.extend(eT.prototype,aO);function cZ(i){this.tileLayers=[];this.map=i;var e=this.config=bw[this.map.mapType];this.errorUrl=e.errorUrl;this.tileSize=e.tileSize;this.baseUnits=e.baseUnits;this.baseZoomLevel=e.zoomLevelBase;this.tileURLs=e.tileUrls;this.tilesInfoCache={};this.loadDelay=10;this._labelTextCanvas=null}aU.register(function(i){if(i._renderType!=="webgl"){return}var e=i.tileMgr=new cZ(i);i.addEventListener("addtilelayer",function(gj){e.addWebGLLayer(gj.target)});i.addEventListener("removetilelayer",function(gj){e.removeWebGLLayer(gj.target)});i.on("update",function gi(gj){if(!aU["FeatureStyle"+this.config.style]&&!aU.customStyleLoaded){return}e.loadLayersData({zoomChanged:gj.changedStatus.onzoom_changed?true:false})});i.on("style_changed",function(){e.loadLayersData()})});A.extend(cZ.prototype,{addWebGLLayer:function(gj){this.tileLayers.push(gj);gj.initDrawData();if(this.tileLayers.length>1){for(var gi=1;gi<this.tileLayers.length;gi++){if(this.tileLayers[gi].isFlat){this.map.setDisplayOptions({isFlat:true});break}}}var e=this.map.config.style;if(aU["FeatureStyle"+e]){this.loadLayersData()}else{var gk=this;this.map.loadMapStyleFiles(function(){gk.loadLayersData()})}},removeWebGLLayer:function(gl){var gm=false;for(var gk=0,gj=this.tileLayers.length;gk<gj;gk++){if(gl===this.tileLayers[gk]){gm=true;this.tileLayers.splice(gk,1);break}}if(gm===false){return}gl.destroyDrawData();if(aU["FeatureStyle"+this.map.config.style]){this.loadLayersData()}if(this.tileLayers.length===1){this.map.setDisplayOptions({isFlat:false})}else{var e=false;for(var gk=1;gk<this.tileLayers.length;gk++){if(this.tileLayers[gk].isFlat){e=true;break}}this.map.setDisplayOptions({isFlat:e})}var gi=new aM("onrefresh");gi.source="removewebgllayer";this.map.fire(gi)},getLabelTextCanvas:function(){if(!this._labelTextCanvas){this._labelTextCanvas=new t(this.map)}return this._labelTextCanvas},loadLayersData:function(i){if(this.map.suspendLoad){return}var gj=this;i=i||{};var gi=!!i.zoomChanged;var e=(gi===true||this.map.getTilt()>50);if(!e){if(!this.syncLoadTimer){this.syncLoadTimer=setTimeout(function(){gj._loadLayersFromCache(gi);gj.syncLoadTimer=null},40)}}else{this._loadLayersFromCache(gi)}if(!gj.map.viewAnimationTime){this.timer&&window.clearTimeout(this.timer)}this.timer=window.setTimeout(function(){if(gj.map.viewAnimationTime){if(new Date().getTime()-gj.map.viewAnimationTime<1000){return}gj.map.viewAnimationTime=new Date().getTime()}var gl=gj.tileLayers.length;gj.tilesInfoCache={};for(var gm=0;gm<gl;gm++){var go=gj.tileLayers[gm];var gn=go.tileType;var gk=null;if(gj.tilesInfoCache[gn.getName()]){gk=gj.tilesInfoCache[gn.getName()]}else{gk=gj.calcTilesInfo(gn);gj.tilesInfoCache[gn.getName()]=gk}go.loadLayerData(gk,false,gi)}gj.timer=null},this.loadDelay);if(eP()&&gi){this.loadDelay=200}else{this.loadDelay=80}},_loadLayersFromCache:function(gk){this.map._featureMgr.clearData();var gn=this.tileLayers;gn.sort(function(go,i){return go.zIndex-i.zIndex>0});var gi=gn.length;this.tilesInfoCache={};for(var gj=0;gj<gi;gj++){var gm=gn[gj];var gl=gm.tileType;var e=null;if(this.tilesInfoCache[gl.getName()]){e=this.tilesInfoCache[gl.getName()]}else{e=this.calcTilesInfo(gl);this.tilesInfoCache[gl.getName()]=e}gm.loadLayerData(e,true,gk)}},calcTilesInfo:function(gu){var gG=this.map;var gM=gG.getMapType();var gH=bw[gM];var gB=gG.getZoom();var e=Math.floor(gB);var gl=gu.getDataZoom(gB);var gW=gu.getName();gl=et(gl,gH.minDataZoom,gH.maxDataZoom);var gP=e;if(gu._name==="web"){gP=gl}var gF=gu.getTileSize(gB);var gk=gu.getBaseTileSize(gB);var gy=gu.getMercatorSize(gB,gl);var gx;var gN;var gE;var gR;var gI=gG.getCenterIn();if(gM!==BMAP_SATELLITE_MAP){gI=c6.calcLoopCenterPoint(gI)}var gC=Math.floor(gI.lng/gy);var gn=Math.floor(gI.lat/gy);var gD=gG.getBoundsIn();var gK=0;var gi=0;gD=c6.calcLoopMapBounds(gD,gG.getCenter());if(gD.ne.lng>c6._mc180X){var gs=c6.getSpaceDistanceInPixel(gl);gK=Math.ceil(gs/gk)}if(gD.sw.lng<c6._mcM180X){var gs=c6.getSpaceDistanceInPixel(gl);gi=Math.ceil(gs/gk)}var gp=[Math.floor(gD.sw.lng/gy)-gi,Math.floor(gD.sw.lat/gy)];var gU=[Math.floor(gD.ne.lng/gy)+gK,Math.floor(gD.ne.lat/gy)];gx=gp[0];gN=gU[0]+1;gE=gp[1];gR=gU[1]+1;var gt=[];for(var gq=gx;gq<gN;gq++){if(c6.isTileBlank(gq,gl,gk)===true){continue}for(var gv=gE;gv<gR;gv++){var gr={col:gq,row:gv,zoom:gl,useZoom:gP,tileTypeName:gW,loopOffsetX:0,tileSize:gF,baseTileSize:gk,mercatorSize:gy};gt.push(gr);var gL="id_"+gq+"_"+gv+"_"+gl;gt[gL]=true}}if(gM!==BMAP_SATELLITE_MAP){gt=c6.calcLoopTiles(gt,gl,gk,gy)}if(gl===3){for(var gT=0,gS=gt.length;gT<gS;gT++){var gq=gt[gT].col;var gv=gt[gT].row;var gO=c6.calcLoopParam(gq,gl);var gm=gO.T;var gz=gq>=0?gq-gm:gq+gm;var gA="id_"+gz+"_"+gv+"_"+gl;if(!gt[gA]){var gr={col:gz,row:gv,zoom:gl,useZoom:gP,loopOffsetX:0,tileSize:gF,baseTileSize:gk,mercatorSize:gy};gt.push(gr);gt[gA]=true}}}if(this.map._tilt>0){for(var gT=0;gT<gt.length;gT++){var go=gt[gT];var gQ=go.col;var gV=go.row;var gJ=[];gJ.minX=gQ*gy;gJ.maxX=(gQ+1)*gy;gJ.minY=gV*gy;gJ.maxY=(gV+1)*gy;var gj=new fX(0,0);gj.lng=(gJ.minX+gJ.maxX)/2;gj.lat=(gJ.minY+gJ.maxY)/2;var gw=gG.pointToPixelIn(gj);if(gw.x>0&&gw.x<this.map.width&&gw.y>0&&gw.y<this.map.height){continue}if(gJ.minX<gI.lng&&gJ.maxX>gI.lng&&gJ.minY<gI.lat&&gJ.maxY>gI.lat){continue}if(!this.ifTileInMapBounds(gJ,gD,gQ,gV)){gt.splice(gT,1);gT--}}}gt.sort((function(i){return function(gX,gY){return((0.4*Math.abs(gX.col-i[0])+0.6*Math.abs(gX.row-i[1]))-(0.4*Math.abs(gY.col-i[0])+0.6*Math.abs(gY.row-i[1])))}})([gC,gn]));gt.zoom=gl;gt.tileTypeName=gW;return gt},getCurrentViewTilesInfo:function(i){var e=this.tilesInfoCache[i.getName()];if(!e){return this.calcTilesInfo(i)}return e},ifTileInMapBounds:function(e,gl,gi,gk){var i=gl.normalizedBottomLeft;var gw=gl.normalizedTopRight;var go=gl.normalizedTopLeft;var gm=gl.normalizedBottomRight;var gj=false;var gv=new fX(e.minX,e.minY);var gs=new fX(e.maxX,e.maxY);var gn=new fX(gs.lng,gv.lat);var gt=new fX(gv.lng,gs.lat);var gq=[gt,gs,gn,gv];for(var gu=0,gp=gq.length;gu<gp;gu++){var gr=gu+1;if(gr===gp){gr=0}var gx=gu;var gy=ff(gq[gr],gq[gx],go,i);if(gy){gj=true;break}gy=ff(gq[gr],gq[gx],gm,gw);if(gy){gj=true;break}gy=ff(gq[gr],gq[gx],gw,go);if(gy){gj=true;break}gy=ff(gq[gr],gq[gx],i,gm);if(gy){gj=true;break}}return gj},getTileLayer:function(gk){for(var gj=0,e=this.tileLayers.length;gj<e;gj++){var gi=this.tileLayers[gj];if(gi.mapType===gk){return gi}}return null}});function ay(e){this._map=e;this._spotsId=null;this._init()}ay.prototype._init=function(){var e=this._map;e.addEventListener("onspotsdataready",function(gi){var i=gi.spots;if(this._spotsId){e.removeSpots(this._spotsId)}this._spotsId=e.addSpots(i)})};aU.register(function(e){if(!e.config.enableIconClick){return}e._mapIcon=new ay(e)});function aB(e){this._indoorData={};this._map=e;this.currentUid=null;this.currentFloor=null;this._indoorControl=null;this.enterMethod=null;this.showMask=false;this._isMobile=eP();this._autoEnterZoom=19;if(this._isMobile){this._autoEnterZoom=17}this._init(e);window._indoorMgr=this}aB.prototype._init=function(i){var e=this;i.on("indoor_status_changed",function(gm){var gi=gm.uid;var gk=gm.floor;if(gi===null){gi=e.currentUid;if(e._indoorData[gi]){gk=e._indoorData[gi].defaultFloor}if(e._indoorControl){e._indoorControl.hide()}e.currentUid=null;e.currentFloor=null;e.enterMethod=null}else{if(e._indoorData[gi]){var gl=e._indoorData[gi];gk=(typeof gk==="number")?gk:gl.defaultFloor;if(!e._indoorControl){if(i.config.showControls&&i._displayOptions.indoor){e._indoorControl=new fi(i,gl)}}else{e._indoorControl.setInfo(gl);e._indoorControl.show()}e.currentUid=gi;e.currentFloor=gk}}if(!e._indoorData||!e._indoorData[gi]||e._indoorData[gi].currentFloor===gk){this.fire(new aM("onrefresh"));return}var gj=new aM("onindoor_data_refresh");gj.uid=gi;gj.floor=gk;gj.tileKey=e._indoorData[gi].tileKey;e._indoorData[gi].currentFloor=gk;e.currentFloor=gk;this.fire(gj)});i.on("spotclick",function(gj){var gi=null;if(gj.curAreaSpot&&this.areaSpots[gj.curAreaSpot]){gi=this.areaSpots[gj.curAreaSpot].userData.uid}if(gi===e.currentUid){if(gj.curAreaSpot){e.enterMethod="byClick"}return}if(gi===null){if(e.currentUid&&e.enterMethod==="byClick"){i.showIndoor(null);e.enterMethod=null}}else{e.enterMethod="byClick";if(e.currentUid){i.showIndoor(e.currentUid,e._indoorData[e.currentUid].defaultFloor)}i.showIndoor(gi,e._indoorData[gi].defaultFloor)}});i.on("moveend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}});i.on("zoomend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}else{if(e.enterMethod!=="byClick"&&e.currentUid!==null){this.showIndoor(null)}}})};aB.prototype._checkIndoorByMove=function(){var gi=this._map;var gp=gi.getSize();var gu={x:gp.width/2,y:gp.height/2};var gt=Math.max(gp.width,gp.height);var gv=[];for(var gq in this._indoorData){var e=this._indoorData[gq].center;var gj=gi.pointToPixelIn(new aU.Point(e[0],e[1]));var gm=fw(gu,gj);gv.push({uid:gq,distance:gm})}if(gv.length===0){return}gv.sort(function(gw,i){return gw.distance-i.distance});var gl=gv[0];var gr=gi.getCenterIn();var gk=false;for(var go=0;go<this._indoorData[gl.uid].contour.length;go++){if(ct([gr.lng,gr.lat],this._indoorData[gl.uid].contour[go])){gk=true;break}}if(gk===false&&gl.uid==="e96b44200baa3b4082288acc"){var gn=this._indoorData[gl.uid].boundsMin;var gs=this._indoorData[gl.uid].boundsMax;if(gr.lng>gn[0]&&gr.lat>gn[1]&&gr.lng<gs[0]&&gr.lat<gs[1]){gk=true}}if(gk){if(this.enterMethod!=="byClick"){if(this.currentUid!==null&&this.currentUid!==gl.uid){this._map.showIndoor(this.currentUid,this._indoorData[this.currentUid].defaultFloor)}if(this.currentUid!==gl.uid){this._map.showIndoor(gl.uid,this._indoorData[gl.uid].defaultFloor)}this.enterMethod="byMove"}}else{if(this.enterMethod!=="byClick"){this._map.showIndoor(null)}}};aB.prototype.setData=function(gj){if(gj===null){return}for(var gi in gj){if(gi==="tileInfo"){continue}var gk=gj[gi].tileKey;if(this._indoorData[gi]){if(!this._indoorData[gi][gk]){this._indoorData[gi].tileKeys.push(gk);this._indoorData[gi][gk]=true}}else{this._indoorData[gi]=gj[gi];this._indoorData[gi].tileKeys=[gj[gi].tileKey];this._indoorData[gi][gk]=true;for(var e=0;e<this._indoorData[gi].contour.length;e++){this._map.addAreaSpot(this._indoorData[gi].contour[e],{id:gi+e,userData:{uid:gi}})}}}if(this._map.getZoom()>=this._autoEnterZoom){this._checkIndoorByMove()}};aB.prototype.removeData=function(gi,gk){if(!this._indoorData[gi]){return}var gj=this._indoorData[gi];for(var e=0;e<gj.tileKeys.length;e++){if(gj.tileKeys[e]===gk){gj.tileKeys.splice(e,1);break}}delete gj[gk];if(gj.tileKeys.length===0){delete this._indoorData[gi]}};aB.prototype.getIndoorData=function(e){return this._indoorData[e]||null};aB.prototype.getData=function(){return this._indoorData};aU.register(function(e){e._indoorMgr=new aB(e)});var dk=(function(){var gj={};var gs={};var go={};function gq(gu){if(Object.prototype.toString.call(gu)==="[object Object]"){for(var gt in gu){return false}return true}else{return false}}function gp(gz,gA,gD,gw,gC){gw=gw||FS;var gu;if(gw){gu=gr(gz,gA,gD,gw)}else{gu=gi(gz,gA,gD,gC)}var gy=gu.drawId;var gt=gu.style;var gB=gu.styleUpdate;var gE=[];if(!gy){return gE}for(var gv=0;gv<gy.length;gv++){var gx=gB[gy[gv]]||gt[gy[gv]];if(gx){switch(gA){case"polygon":gx=gk(gx,gz);break;case"line":gx=gn(gx,gz);break;case"pointText":gx=gl(gx,gz);break;case"point":gx=e(gx,gz);break;case"polygon3d":gx=gm(gx,gz);break}if(gx){gE[gE.length]=gx}}}return gE}function gr(gu,gw,gx,gt){var gv=gt[2];switch(gw){case"point":gv=gv[0];break;case"pointText":gv=gv[1];break;case"line":gv=gv[3];break;case"polygon":gv=gv[4];break;case"polygon3d":gv=gv[5];break}var gz=gx-1;if(gw==="line"&&gx===12){gz=gx}var gA=gt[1][gz][0];var gy=gA[gu];if(!gy){if(gw==="point"||gw==="pointText"){gA=gt[1][gx][0];gy=gA[gu]}}return{drawId:gy,style:gv,styleUpdate:[]}}function gi(gx,gy,gB,gA){if(!gA){return{drawId:null,style:[],styleUpdate:[]}}var gz;var gv=gA.baseFs;gz=gA.StyleBody||[];gz=gA.zoomStyleBody[gB]||[];var gu=gv[2];switch(gy){case"point":gu=gu[0];gz=gz[0]||{};break;case"pointText":gu=gu[1];gz=gz[1]||{};break;case"line":gu=gu[3];gz=gz[3]||{};break;case"polygon":gu=gu[4];gz=gz[4]||{};break;case"polygon3d":gu=gu[5];gz=gz[5]||{};break}var gt=gv[1][gB-1][0];var gw=gt[gx];return{drawId:gw,style:gu,styleUpdate:gz}}function gl(gu,gt){if(!gu||gu.length===0){return null}return{sid:gt,fontRgba:i(gu[0]),haloRgba:i(gu[1]),backRgba:i(gu[2]),fontSize:gu[3],haloSize:gu[4],fontWeight:gu[5],fontStyle:gu[6],density:gu[7]}}function e(gu,gt){return{sid:gt,rank:gu[0],ucflag:gu[1],icon:gu[2],iconType:gu[3],nineGG:gu[4],density:gu[5],zoom:gu[6]}}function gn(gu,gt){return{sid:gt,borderRgba:i(gu[0]),fillRgba:i(gu[1]),borderWidth:gu[2],fillWidth:gu[3],borderCap:gu[4],fillCap:gu[5],haveBorderLine:gu[6],haveBorderTexture:gu[7],haveFillTexture:gu[8],isUseBorderRgba:gu[9],isUseFillRgba:gu[10],borderTexture:gu[11],fillTexture:gu[12],borderTextureType:gu[13],fillTextureType:gu[14],isRealWidth:gu[15],haveArrow:gu[16],needRound:gu[17],realBorderWidth:gu[18]}}function gk(gu,gt){return{sid:gt,fillRgba:i(gu[0]),borderRgba:i(gu[1]),borderWidth:gu[2],borderTexture:gu[3],borderTextureType:gu[4],waterStyle:gu[5],haloStyle:gu[6],textureStyle:gu[7],thickRgba:i(gu[8])}}function gm(gu,gt){return{sid:gt,filter:gu[0],ratio:gu[1],haveBorder:gu[2],borderWidth:gu[3],borderRgba:i(gu[4]),fillTop:i(gu[5]),fillSide:i(gu[6]),polyTexture:gu[7]}}function i(gy){var gx=gy;if(go[gx]){return go[gx]}gy=gy>>>0;var gw=(gy)&255;var gv=(gy>>8)&255;var gt=(gy>>16)&255;var gu=(gy>>24)&255;go[gx]=[gw,gv,gt,gu];return go[gx]}return{getStyleFromCache:function(gA,gv,gy,gz,gu,gx,gt){gA=gA||"default";var gw=gA+"-"+gv+"-"+gy+"-"+gz;if(gx){gw+="-indoor"}if(gu){if(!gs[gw]){gs[gw]=gp(gv,gy,gz,gu)}return gs[gw]}if(!gj[gw]){gj[gw]=gp(gv,gy,gz,gu,gt)}return gj[gw]}}})();aU.register(function(i){var e=new cP(i)});function cP(e){e.container.appendChild(this.render());this.bind(e)}cP.prototype.render=function(){var i=document.createElement("div");i.className="click-ripple-container";var e=document.createElement("div");e.className="click-ripple";i.appendChild(e);this._div=i;this._ripple=e;return i};cP.prototype.bind=function(i){var e=this;i.addEventListener("spotclick",function(gi){if(!gi.spots||gi.spots.length===0){return}e._div.style.left=gi.pixel.x+"px";e._div.style.top=gi.pixel.y+"px";A.ac(e._ripple,"ripple-playing")});A.on(e._ripple,"transitionend",function(){A.rc(e._ripple,"ripple-playing")})};function eN(e){dc.call(this);if(!e){return}this._opts={};this._map=e;this._maxLat=84.6;this._minLat=-80.6;this._maxLatMC=dm.convertLL2MC(new cj(this._maxLat,0)).lat;this._minLatMC=dm.convertLL2MC(new cj(this._minLat,0)).lat}eN.inherits(dc,"ToolbarItem");A.extend(eN.prototype,{open:function(){if(this._isOpen==true){return true}if(this._map._toolInUse){return false}this._map._toolInUse=true;this._isOpen=true;return true},close:function(){if(!this._isOpen){return}this._map._toolInUse=false;this._isOpen=false},_checkStr:function(e){if(!e){return""}return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}});function fq(gi,i){eN.call(this,gi);i=i||{};this._opts=A.extend(A.extend(this._opts||{},{autoClear:false,tips:"测距",followText:"单击确定起点，双击结束绘制",unit:"metric",showResult:true,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:dX.distCursor,styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:true}),i);if(this._opts.showResult===false){if(typeof i.tips==="undefined"){this._opts.tips="绘制折线"}if(!i.cursor){this._opts.cursor="crosshair"}}if(this._opts.lineStroke<=0){this._opts.lineStroke=2}if(this._opts.opacity>1){this._opts.opacity=1}else{if(this._opts.opacity<0){this._opts.opacity=0}}if(this._opts.lineStyle!=="solid"&&this._opts.lineStyle!=="dashed"){this._opts.lineStyle="solid"}this._checked=false;this._drawing=null;this.followTitle=null;this._totalDis={};this._points=[];this._paths=[];this._dots=[];this._segDistance=[];this._overlays=[];this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}};if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._dLineColor="#ff6319";this._dLineStroke=3;this._dOpacity=0.8;this._dLineStyle="solid";this._dCursor=dX.distCursor;if(this._opts.showResult){this._opts.followText="单击确定起点"}this._followTextM="单击确定地点，双击结束";this._sectionMarkerTip="单击可删除此点，拖拽可调整位置";this._movingTimerId=null;if(this._opts.showResult){this.text="测距"}else{this.text="绘线"}this._isOpen=false;var e=this;da.load("tools",function(){e._draw()})}fq.inherits(eN,"PolylineTItem");A.extend(fq.prototype,{setLineColor:function(e){this._opts.lineColor=e},setLineStroke:function(e){if(Math.round(e)>0){this._opts.lineStroke=Math.round(e)}},setOpacity:function(e){if(e>=0&&e<=1){this._opts.opacity=e}},setLineStyle:function(e){if(e==="solid"||e==="dashed"){this._opts.lineStyle=e}},clear:function(){for(var gi=0,e=this._overlays.length;gi<e;gi++){if(this._overlays[gi]){this._map.removeOverlay(this._overlays[gi])}}this._overlays.length=0;for(var gi=0,e=this._dots.length;gi<e;gi++){if(this._dots[gi]&&this._dots[gi].parentNode){this._dots[gi].parentNode.removeChild(this._dots[gi])}}this._dots.length=0},setCursor:function(e){if(this._opts.showResult===true){return}this._opts.cursor=e},getCursor:function(){if(this._opts.showResult===true){return this._dCursor}var e=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);if(e!==null){return e[1]}else{return this._opts.cursor}},showResult:function(e){this._opts.showResult=!!e}});function bR(){var gk=3;var gr=256;var gj=Math.pow(2,18-gk)*gr;var gs=2;var gq=(gs+1)*gj;var gi=dm.convertLL2MC(new fX(180,0));var go=gi.lng;var gm=gq-go;var gp=-3;var e=gp*gj;var gl=dm.convertLL2MC(new fX(-180,0));var gn=gl.lng;var i=gn-e;this._validPixels=go/Math.pow(2,18-gk);this._mc180X=go;this._mcM180X=gn;this._loopOffset=gm+i;this._mcTSpan=go-gn;this._spaceDistance=gm;this._mSpaceDistance=i}bR.prototype={calcLoopParam:function(gi,i,gp){gp=gp||256;var gm=0;var gj=3;var gl=6;var gk=gl*Math.pow(2,(i-gj))*256/gp;var go=gk/2-1;var gn=-gk/2;while(gi>go){gi-=gk;gm-=this._loopOffset}while(gi<gn){gi+=gk;gm+=this._loopOffset}var e=gm;gm=Math.round(gm/Math.pow(2,18-i));return{offsetX:gm,geoOffsetX:e,col:gi,T:gk,maxCol:go,minCol:gn}},calcLoopCenterPoint:function(i){var e=i.lng;while(e>this._mc180X){e-=this._mcTSpan}while(e<this._mcM180X){e+=this._mcTSpan}i.lng=e;return i},calcLoopMapBounds:function(gi,gj){var i=gj||gi.getCenter();var e=gi.sw.lng;var gk=gi.ne.lng;while(i.lng>this._mc180X){i.lng-=this._mcTSpan;e-=this._mcTSpan;gk-=this._mcTSpan}while(i.lng<this._mcM180X){i.lng+=this._mcTSpan;e+=this._mcTSpan;gk+=this._mcTSpan}gi.sw.lng=e;gi.ne.lng=gk;if(gi.pointBottomLeft){gi.pointBottomLeft=this.calcLoopCenterPoint(gi.pointBottomLeft);gi.pointTopLeft=this.calcLoopCenterPoint(gi.pointTopLeft);gi.pointTopRight=this.calcLoopCenterPoint(gi.pointTopRight);gi.pointBottomRight=this.calcLoopCenterPoint(gi.pointBottomRight)}return gi},calcLoopTiles:function(gr,e,gv,go){gv=gv||256;var gk=go||Math.pow(2,18-e)*gv;var gq=Math.floor(this._mc180X/gk);var gm=Math.floor(this._mcM180X/gk);var gs=Math.floor(this._loopOffset/gk);var gt=[];for(var gn=0;gn<gr.length;gn++){var gu=gr[gn];var gj=gu[0];var gw=gu[1];if(gj>=gq){var gp=gj+gs;if(this.isTileBlank(gp,e,gv)===true){continue}var gi="id_"+gp+"_"+gw+"_"+e;if(!gr[gi]){gr[gi]=true;gt.push([gp,gw,e,0])}}else{if(gj<=gm){var gp=gj-gs;if(this.isTileBlank(gp,e,gv)===true){continue}var gi="id_"+gp+"_"+gw+"_"+e;if(!gr[gi]){gr[gi]=true;gt.push([gp,gw,e,0])}}}}for(var gn=0,gl=gt.length;gn<gl;gn++){gr.push(gt[gn])}for(var gn=gr.length-1;gn>=0;gn--){var gj=gr[gn][0];if(this.isTileBlank(gj,e,gv)){gr.splice(gn,1)}}return gr},isTileBlank:function(gi,gk,e){var gl=Math.pow(2,gk-3);var i=Math.round(this._validPixels*gl);var gj=6*gl*256/e;while(gi>gj/2-1){gi-=gj}while(gi<-(gj/2)){gi+=gj}if(gi>0&&gi*e>i){return true}if(gi<0&&Math.abs((gi+1)*e)>i){return true}return false},isAddWidth:function(e,i){return e<this._mcM180X||i>this._mc180X},getSpaceDistanceInPixel:function(i){var e=Math.round((this._spaceDistance+this._mSpaceDistance)/Math.pow(2,18-i));return e}};var c6=new bR();var bD=(function(){var e=true;var gj=256;var gl=an("ditu","normalTraffic");var gi=gl.udt;var gm="https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/";var gk=[[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",4,2,0,[],0,0],[2,"79,210,125,1",5,2,0,[],0,0],[2,"79,210,125,1",6,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",4,2,0,[],0,0],[2,"255,208,69,1",5,2,0,[],0,0],[2,"255,208,69,1",6,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",4,2,0,[],0,0],[2,"232,14,14,1",5,2,0,[],0,0],[2,"232,14,14,1",6,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",4,2,0,[],0,0],[2,"181,0,0,1",5,2,0,[],0,0],[2,"181,0,0,1",6,2,0,[],0,0],[2,"255,255,255,1",4,0,0,[],0,0],[2,"255,255,255,1",5.5,0,0,[],0,0],[2,"255,255,255,1",7,0,0,[],0,0],[2,"255,255,255,1",8.5,0,0,[],0,0],[2,"255,255,255,1",10,0,0,[],0,0]];var i=new b8({transparentPng:true,dataType:2,cacheSize:256,clipTile:true});i.zIndex=2;i.getTilesUrl=function(gp,gq){if(!gp||gq<7){return null}var go=gp.x;var gr=gp.y;var gn=gm+"?qt=vtraffic&z="+gq+"&x="+go+"&y="+gr+"&udt="+gi;return gn};i.processData=function(gq){var gu=gq.content;var gs=10;if(typeof gq.precision==="number"){gs=gq.precision*10}var gB={road:[[],[]]};if(!gu){return gB}var gz=gu.tf;if(!gz){return gB}for(var gr=0;gr<gz.length;gr++){var gA=gz[gr][1];var gy=[];var gw=0;var gv=0;var gx=gk[gz[gr][3]];for(var gp=0,gn=gA.length;gp<gn/2;gp++){gw+=gA[gp*2]/gs;gv+=gA[gp*2+1]/gs;gy.push(gw,256-gv)}var go=gx[1].split(",");go[3]=go[3]*255;var gt=gx[2]/2;gB.road[0].push([gy,1,2,[255,255,255,255],gt+2]);gB.road[1].push([gy,1,2,go,gt])}return gB};return i})();aU.register(function(i){if(i.config&&i.config.isOverviewMap){return}if(i.isLoaded()){er(i)}else{i.addEventListener("load",function(){er(this)})}i.cityName="中国";i.cCode="1";var e={};e.enableRequest=true;e.request=function(){if(e.enableRequest){e.enableRequest=false;setTimeout(function(){e._request()},500)}};e._request=function(){var gj=i.getBoundsIn();var gl=i.getZoom();var gi=gj.getSouthWest();var gk=gj.getNorthEast();bW.request(function(go){if(go.current_city["code"]>=9000&&go.current_city["code"]<=9378){go.current_city["name"]="台湾省"}if(go.current_city["code"]>=20000&&go.current_city["code"]<=20499){go.current_city["name"]="新加坡"}if(go.current_city["code"]>=20500&&go.current_city["code"]<=25999){go.current_city["name"]="泰国"}if(go.current_city["code"]>=26000&&go.current_city["code"]<=29999){go.current_city["name"]="日本"}if(go.current_city["code"]>=30000&&go.current_city["code"]<=30999){go.current_city["name"]="韩国"}if(go.current_city["code"]>=31000&&go.current_city["code"]<=37000){go.current_city["name"]="亚太"}if(go.current_city["code"]>=46609&&go.current_city["code"]<=52505){go.current_city["name"]="欧洲"}if(go.current_city["code"]>=39509&&go.current_city["code"]<=53500){go.current_city["name"]="南美洲"}if(go.current_city["code"]>=54000&&go.current_city["code"]<=70000){go.current_city["name"]="北美洲"}if(go.current_city["code"]===54003&&go.current_city["code"]>=60731&&go.current_city["code"]<=61123){go.current_city["name"]="美国"}if(go.current_city["code"]===54015||go.current_city["code"]>=57970&&go.current_city["code"]<=60223){go.current_city["name"]="加拿大"}if(go.current_city["code"]===54025||go.current_city["code"]>=54338&&go.current_city["code"]<=57374){go.current_city["name"]="墨西哥"}e.enableRequest=true;if(go&&go.current_city){var gn=go.current_city["name"];var gm=go.current_city["code"];if(gm!==i.cCode){i.dispatchEvent("citychange",{name:gn,code:gm})}i.cityName=gn;i.cCode=go.current_city["code"];if(!eP()){du(i)}}},{qt:"cen",b:gi.lng+","+gi.lat+";"+gk.lng+","+gk.lat,l:gl},"","",true)};i.addEventListener("load",function(gi){e.request()});i.addEventListener("moveend",function(gi){e.request()});i.addEventListener("zoomend",function(gi){e.request()});e.request()});function er(i){if(i.temp.copyadded){return}i.temp.copyadded=true;if(!i.cpyCtrl){var gj=new c9(2,2);i.config.cpyCtrlOffset=gj;if(eP()){gj.width=72;gj.height=0}var gi=new cQ({offset:gj,printable:true});i.cpyCtrl=gi}if(!eP()){du(i);i.addEventListener("maptypechange",function(){du(i)})}i.addControl(gi);var e=new V();e._opts={printable:true};i.logoCtrl=e;i.addControl(e);i.addEventListener("resize",function(){if(this.getSize().width>=300&&i.getSize().height>=100){e.show();gi.setOffset(i.config.cpyCtrlOffset)}else{e.hide();gi.setOffset(new c9(4,2))}});if(i.getSize().width>=300&&i.getSize().height>=100){e.show()}else{e.hide();gi.setOffset(new c9(4,2))}i.addEventListener("oncopyrightoffsetchange",function(gk){i.logoCtrl.setOffset(gk.target.logo);i.cpyCtrl.setOffset(gk.target.cpy)});i.dispatchEvent(new aM("oncopyrightaddend"))}function du(gy){if(!gy.cpyCtrl){var gG=new c9(2,2);if(eP()){gG.width=72;gG.height=0}var gB=new cQ({offset:gG,printable:true});gy.cpyCtrl=gB}var gP=gy.cityName||"中国";var gz=gy.getMapType();var gA=["常州市","南昌市","乌鲁木齐市","无锡市","福州市","泉州市","珠海市","贵阳市"];var gs=["北京市","上海市","广州市","深圳市","宁波市","石家庄市","沈阳市","长春市","青岛市","温州市","台州市","金华市","佛山市","中山市","昆明市","南宁市","苏州市","西安市","济南市","郑州市","合肥市","呼和浩特市","杭州市","成都市","武汉市","长沙市","天津市","南京市","重庆市","大连市","东莞市","厦门市"];var gu=["香港特别行政区"];var go=["台湾省"];var gH=["日本"];var gN=["韩国"];var gC=["泰国"];var gF=["亚太"];var gp=["新加坡"];var gO=["欧洲"];var gj=["南美洲"];var gK=["北美洲"];var gi=["美国"];var gE=["墨西哥"];var gm=["加拿大"];for(var gL in gA){if(gA[gL]===gP){var gv=true;break}}for(var gL in gs){if(gs[gL]===gP){var gk=true;break}}for(var gL in gu){if(gu[gL]===gP){var gR=true;break}}if(go[0]===gP){var gJ=true}if(gp[0]===gP){var i=true}if(gH[0]===gP){var gr=true}if(gN[0]===gP){var gx=true}if(gC[0]===gP){var gw=true}if(gF[0]===gP){var gn=true}if(gO[0]===gP){var gt=true}if(gj[0]===gP){var gq=true}if(gK[0]===gP){var e=true}if(gi[0]===gP){var gM=true}if(gm[0]===gP){var gI=true}if(gE[0]===gP){var gl=true}var gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "];var gD="rgba(255, 255, 255, 0.701961)";if(gy.getZoom()<=9){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(gJ){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(gr||gx){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(i||gw){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(gn){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(gt){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(gq){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(e){gQ=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}}}}}}}}if(gy.getZoom()<=9){gQ.push("长地万方");gQ.push(' &amp; <a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');gQ.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');if(gz===BMAP_SATELLITE_MAP||gz===BMAP_HYBRID_MAP){gQ.push(' &amp; <a target="_blank" href="http://www.eso.org/public/">ESO</a>');gD="rgba(0,0,0,.7)"}}else{if(gr||gx){gQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>')}else{if(i||gw){gQ.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>')}else{if(gn){gQ.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');gQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(gt){gQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');gQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(gq){gQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');gQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(gM||gl||gI){gQ.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');gQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(e){gQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');gQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{gQ.push("长地万方");if(gv){gQ.push(' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>')}if(gR){gQ.push(' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>')}if(gJ){gQ.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');gQ.push(' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>')}if(gz===BMAP_SATELLITE_MAP||gz===BMAP_HYBRID_MAP){gD="rgba(0,0,0,.7)"}}}}}}}}}gQ.unshift('<span style="background: '+gD+';padding: 0px 1px;line-height: 16px;display: inline;height: 16px;">');gQ.push("</span>");gQ=gQ.join("");gy.cpyCtrl.addCopyright({id:1,content:gQ})}window.BMAP_STATUS_SUCCESS=0;window.BMAP_STATUS_CITY_LIST=1;window.BMAP_STATUS_UNKNOWN_LOCATION=2;window.BMAP_STATUS_UNKNOWN_ROUTE=3;window.BMAP_STATUS_INVALID_KEY=4;window.BMAP_STATUS_INVALID_REQUEST=5;window.BMAP_STATUS_PERMISSION_DENIED=6;window.BMAP_STATUS_SERVICE_UNAVAILABLE=7;window.BMAP_STATUS_TIMEOUT=8;var dB="cur";var bt="cen";var dl="s";var L="con";var cV="bd";var eW="nb";var ga="bt";var b6="nav";var dj="walk";var f6="gc";var ez="rgc";var dw="dec";var d6="bse";var eg="nse";var g="bl";var aN="bsl";var aV="bda";var P="sa";var ak="nba";var br="drag";var E="ext";var e7=2;var eB=4;var fF=7;var fE=11;var en=12;var f4=14;var bj=15;var cS=18;var d9=20;var b2=21;var bM=19;var d2=23;var bG=26;var ae=28;var dh=31;var b0=35;var e0=44;var gg=45;var dE=46;var bY=47;var fg=-1;var fx=0;var fI=1;var bK=2;var by=3;window.BMAP_POI_TYPE_NORMAL=0;function O(i){this._opts={};A.extend(this._opts,i);this._queryList=[];var e=this;da.load("otherSearch",function(){e._asyncSearch()})}O.inherits(dc,"Geocoder");A.extend(O.prototype,{getPoint:function(e,gi,i){this._queryList.push({method:"getPoint",arguments:[e,gi,i]})},getLocation:function(e,gi,i){this._queryList.push({method:"getLocation",arguments:[e,gi,i]})},toString:function(){return"Geocoder"}});function ca(e){e=e||{};this.config={timeout:e.timeout||1000*10,maximumAge:e.maximumAge||0,enableHighAccuracy:e.enableHighAccuracy||false,SDKLocation:e.SDKLocation||false};this._pendingCalls=[];var i=this;da.load("otherSearch",function(){var gi=i._pendingCalls[gj].length;for(var gj=0;gj<gi;gj++){i[call.method].apply(i,call.arguments)}})}A.extend(ca.prototype,{getCurrentPosition:function(e,i){this._pendingCalls.push({method:"getCurrentPosition",arguments:arguments})},getStatus:function(){return BMAP_STATUS_UNKNOWN_LOCATION},enableSDKLocation:function(){if(eP()){this.config.SDKLocation=true}},disableSDKLocation:function(){this.config.SDKLocation=false}});aU.Map=cm;aU.MapType=bw;aU.Point=fX;aU.Pixel=di;aU.Size=c9;aU.Bounds=cY;aU.TileLayer=b8;aU.Copyright=ck;aU.Projection=aU.Project=dm;aU.RenderTypeUtils=aL;aU.Overlay=aT;aU.Label=eD;aU.Marker=am;aU.Icon=fH;aU.Polyline=aa;aU.PolylineMultipart=ef;aU.Polygon=fC;aU.InfoWindow=ad;aU.SimpleInfoWindow=f9;aU.Circle=cO;aU.GroundOverlay=c1;aU.Control=aK;aU.NavigationControl=cC;aU.NavigationControl3D=dP;aU.CopyrightControl=cQ;aU.ScaleControl=fM;aU.MapTypeControl=a7;aU.ZoomControl=bU;aU.LocationControl=a5;aU.LogoControl=V;aU.DistanceTool=fq;aU.ContextMenu=bE;aU.MenuItem=eo;aU.OperationMask=dg;aU.Animation=n;aU.ViewAnimation=b5;aU.Transitions=bL;aU.Event=aM;aU.trafficLayer=bD;aU.Geolocation=ca;aU.Geocoder=O;aU.verify();aU.apiLoad();})(BMapGL,"BMapGL");